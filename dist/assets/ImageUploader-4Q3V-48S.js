import{R as a,j as e}from"./index-LUC8W6HM.js";import{a as U}from"./AdminApp-BAIHpeWj.js";import{i as D}from"./media-Cid05Mxy.js";const c={},b="/api/admin/uploads",h=(c==null?void 0:c.VITE_CLOUDINARY_UPLOAD_PRESET)||"";function q({label:y="Image",value:o,onChange:i,fieldName:v="file",extra:j={},accept:N="image/*,video/*,.pdf",requiredPerm:F=null,folder:u="",multiple:R=!1,onMultipleChange:E}){const m=a.useId(),[I,L]=a.useState([]),[O,T]=a.useState([]),[M,A]=a.useState([]),[z,C]=a.useState([]),[x,d]=a.useState(""),n=a.useMemo(()=>D(o||""),[o]);a.useEffect(()=>{if(!file)return;const t=URL.createObjectURL(file);return setPreview(t),setFileName(file.name||""),()=>URL.revokeObjectURL(t)},[file]);const p=t=>t?t.type.startsWith("image/")?"image":t.type.startsWith("video/")?"video":t.type==="application/pdf"?"pdf":"unknown":"unknown",w=t=>{var r;const l=((r=t.target.files)==null?void 0:r[0])||null;d(""),setFile(l)},k=t=>{var r,s;t.preventDefault(),t.stopPropagation();const l=((s=(r=t.dataTransfer)==null?void 0:r.files)==null?void 0:s[0])||null;l&&(d(""),setFile(l))},S=t=>{t.preventDefault(),t.stopPropagation()},f=()=>{setFile(null),setPreview(""),setFileName("")},P=async()=>{var t;if(file){setStatus("loading"),d("");try{const l=/cloudinary\.com/i.test(b),r={...j||{}};l&&h&&!r.upload_preset&&(r.upload_preset=h),u&&!l&&(r.folder=u);const s=await U.upload(b,file,{fieldName:v,data:r}),g=(s==null?void 0:s.url)||(s==null?void 0:s.url_path)||(s==null?void 0:s.secure_url)||(s==null?void 0:s.location)||((t=s==null?void 0:s.data)==null?void 0:t.url)||"";if(!g)throw new Error((s==null?void 0:s.message)||"Upload response missing URL");i==null||i(g),setStatus("done"),f()}catch(l){setStatus("error"),d((l==null?void 0:l.message)||"Upload failed")}}};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:y}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"text",className:"flex-1 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",placeholder:"https://...",value:o||"",onChange:t=>i==null?void 0:i(t.target.value)})}),e.jsxs("div",{className:"mt-2 rounded-md border border-dashed px-3 py-3 text-sm text-gray-600 dark:text-neutral-300 dark:border-neutral-700",onDrop:k,onDragOver:S,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{id:m,type:"file",accept:N,onChange:w,className:"sr-only"}),e.jsx("label",{htmlFor:m,className:"inline-flex items-center rounded-md border px-3 py-2 text-sm cursor-pointer dark:border-neutral-700 dark:text-neutral-200",role:"button",children:"Choose"}),e.jsx("button",{className:"inline-flex items-center rounded-md bg-gray-900 text-white px-3 py-2 text-sm disabled:opacity-50",onClick:P,disabled:!file||status==="loading",type:"button",children:status==="loading"?"Uploadingâ€¦":"Upload"}),fileName?e.jsxs("span",{className:"text-xs text-gray-500 dark:text-neutral-400",children:["Selected: ",fileName]}):null,file?e.jsx("button",{className:"inline-flex items-center rounded-md border px-2 py-1 text-xs dark:border-neutral-700 dark:text-neutral-200",onClick:f,type:"button",children:"Clear"}):null]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 dark:text-neutral-400",children:"Drag a file here, or click Choose to select."})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[preview?e.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:p(file)==="video"?e.jsx("video",{src:preview,className:"w-full h-full object-cover",muted:!0}):p(file)==="pdf"?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):e.jsx("img",{src:preview,alt:"snowcity",loading:"lazy",className:"w-full h-full object-cover"})}):null,n?e.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:n.match(/\.(mp4|webm|ogg)$/i)?e.jsx("video",{src:n,className:"w-full h-full object-cover",muted:!0}):n.match(/\.pdf$/i)?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):e.jsx("img",{src:n,alt:"snowcity",loading:"lazy",className:"w-full h-full object-cover"})}):null]}),x?e.jsx("div",{className:"text-xs text-red-600 mt-2",children:x}):null]})}export{q as I};
