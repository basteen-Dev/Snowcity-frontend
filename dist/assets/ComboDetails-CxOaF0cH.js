import{C as Pe,B as Le,h as Be,u as he,R as x,t as Te,p as Ie,i as H,k as K,D as b,j as s,A as Z,L as Fe,E as Oe,F as Re}from"./index-Buz5vlJT.js";import{E as U}from"./ErrorState-DW0DLMd4.js";import{f as M}from"./formatters-CmiLqhJj.js";import{g as ze,a as He,b as Ke,d as ye,c as Ue}from"./pricing-CIeFTiJd.js";import{i as G}from"./media-DTTax9V0.js";const ie="https://picsum.photos/seed/combo-hero/1920/800",_e="https://picsum.photos/seed/combo-hero/800/600",be=ie,je=(e,r=!1)=>r?`https://picsum.photos/seed/${e}/1920/800`:`https://picsum.photos/seed/${e}/640/400`,qe=e=>b(e).format("YYYY-MM-DD"),Ge=e=>(e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.attraction_id)??null,Ne=e=>{if(!e)return"";const[r="0",l="0"]=String(e).split(":"),d=Number(r),c=Number(l);if(!Number.isFinite(d)||!Number.isFinite(c))return"";const u=d>=12?"PM":"AM",o=d%12||12,g=c.toString().padStart(2,"0");return`${o}:${g} ${u}`},ve=e=>e?String(e).slice(0,5):"",ee=e=>{const r=Ne(e==null?void 0:e.start_time),l=Ne(e==null?void 0:e.end_time);if(r&&l)return`${r} → ${l}`;const d=ve(e==null?void 0:e.start_time),c=ve(e==null?void 0:e.end_time);return d&&c?`${d} → ${c}`:""},te=e=>{if(!e||typeof e!="string")return null;const[r="0",l="0"]=e.split(":"),d=Number(r),c=Number(l);return!Number.isFinite(d)||!Number.isFinite(c)?null:d*60+c},Ve=(e={},r)=>{if(!e.day_type)return!0;const l=b(r).day(),d=String(e.day_type).toLowerCase();return d==="weekday"?l>=1&&l<=5:d==="weekend"?l===0||l===6:d==="custom"&&Array.isArray(e.specific_days)?e.specific_days.map(Number).includes(l):!0},we=e=>String(e||"").toLowerCase(),Se=(e,r)=>e==null||r==null?!1:String(e)===String(r),Qe=e=>{if(typeof e=="boolean")return e;if(e==null)return!1;if(typeof e=="number")return e!==0;const r=String(e).trim().toLowerCase();return r?["true","1","yes","y"].includes(r)?!0:["false","0","no","n"].includes(r)?!1:!!e:!1},We=(e={},r=null)=>{if(!r)return!(e.slot_id!=null||Array.isArray(e.slot_ids)&&e.slot_ids.length||e.specific_time||e.time_from&&e.time_to);const l=[];if(e.slot_id!=null&&l.push(e.slot_id),Array.isArray(e.slot_ids)&&l.push(...e.slot_ids),e.target_slot_id!=null&&l.push(e.target_slot_id),l.length){const c=[r.slot_id,r.id,r._id,r.combo_slot_id].filter(o=>o!=null);if(!l.some(o=>c.some(g=>Se(o,g))))return!1}const d=r.start_time||r.time||r.startTime||null;if(e.specific_time&&d&&d.slice(0,5)!==String(e.specific_time).slice(0,5))return!1;if(e.time_from&&e.time_to&&d){const c=te(d),u=te(e.time_from),o=te(e.time_to);if(c==null||u==null||o==null||c<u||c>o)return!1}return!0},Je=(e,{targetType:r,targetId:l,date:d,slot:c})=>{if(!e||!r||!l)return!1;const u=b(d).format("YYYY-MM-DD"),o=we(e.target_type),g=we(r);if(o&&g&&o!==g)return!1;if(!Qe(e.applies_to_all)){const m=[];if(e.target_id!=null&&m.push(e.target_id),Array.isArray(e.target_ids)&&m.push(...e.target_ids),!m.length||!m.some(j=>Se(j,l)))return!1}return!(e.specific_date&&u!==e.specific_date||Array.isArray(e.specific_dates)&&e.specific_dates.length&&!e.specific_dates.some(m=>b(m).format("YYYY-MM-DD")===u)||e.date_from&&u<e.date_from||e.date_to&&u>e.date_to||!Ve(e,u)||!We(e,c))},Xe=(e={},r=null,l=0)=>{const d=Number(l);if(!d||d<=0)return 0;let c=(r==null?void 0:r.rule_discount_type)||e.discount_type||(e.discount_percent?"percent":null),u=(r==null?void 0:r.rule_discount_value)??e.discount_value??e.discount_percent??0;if(!c||!u)return 0;c=String(c).toLowerCase();let o=c==="amount"?Number(u):Number(u)/100*d;return Number.isFinite(Number(e.max_discount))&&(o=Math.min(o,Number(e.max_discount))),o=Math.min(o,d),Math.max(0,o)},Ze=(e=[],{targetType:r,targetId:l,date:d,slot:c,basePrice:u})=>{if(!Array.isArray(e)||!e.length||!u||!l)return null;let o=null;return e.forEach(g=>{(Array.isArray(g.rules)&&g.rules.length?g.rules:[null]).forEach(m=>{if(m&&!Je(m,{targetType:r,targetId:l,date:d,slot:c}))return;const j=Xe(g,m,u);if(!j)return;const N=Math.max(0,u-j);(!o||N<o.price)&&(o={offer:g,rule:m,price:N,discount:j})})}),o},se=(e,r,l)=>{if(!e||typeof e!="object")return{title:r,image_url:je(l),slug:null,price:0,attraction_id:null};const d=e.title||e.name||r,c=e.desktop_image_url??e.hero_desktop_image??e.hero_image??e.image_media_id??e.media_id??e.cover_media_id??e.banner_media_id??e.url_path??e.image_url??e.cover_image??e.web_image??e.mobile_image??e.image??null,u=G(c,je(l)),o=e.slug||e.id||e.attraction_id||null,g=Number(e.base_price||e.price||e.amount||0),p=e.attraction_id??e.id??o;return{title:d,image_url:u,slug:o,price:g,attraction_id:p}};function et(e,r,l,d=!1){if(r!=null&&r.image_url)return r.image_url;const u=(e==null?void 0:e.banner_media_id)??(e==null?void 0:e.image_media_id)??(e==null?void 0:e.cover_media_id)??(e==null?void 0:e.banner_image)??(e==null?void 0:e.hero_image)??(e==null?void 0:e.image_web)??(e==null?void 0:e.image_url)??(e==null?void 0:e.image)??null,o=G(u,d?ie:_e);return o||(r==null?void 0:r.image_url)||(l==null?void 0:l.image_url)||(d?ie:_e)}const ae=(e,r)=>{if(!e)return!1;const l=b().format("YYYY-MM-DD");if(r===l){const d=b(),c=e.start_time||e.time||null;if(!c)return!0;const[u,o]=c.split(":").map(Number),g=(u||0)*60+(o||0),p=d.hour()*60+d.minute();return g>=p+60}return!0},q=e=>e?String(e.combo_slot_id??e.id??e._id??e.slot_id??`${e.start_time||""}-${e.end_time||""}`):"";function lt(){var ge;const{id:e}=Pe(),r=Le(),l=Be(),{items:d=[],status:c}=he(t=>t.combos||{items:[],status:"idle"}),{items:u=[],status:o}=he(t=>t.attractions||{items:[],status:"idle"});x.useEffect(()=>{c==="idle"&&l(Te({active:!0,limit:100})),o==="idle"&&l(Ie({active:!0,limit:200}))},[o,c,l]);const g=x.useMemo(()=>{if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null},[e]),p=x.useMemo(()=>!e||!d.length?null:d.find(t=>String((t==null?void 0:t.combo_id)??(t==null?void 0:t.id)??"")===e)||d.find(t=>e&&(t==null?void 0:t.slug)&&String(t.slug)===e)||null,[d,e]),m=x.useMemo(()=>g??(p!=null&&p.combo_id?Number(p.combo_id):p!=null&&p.id?Number(p.id):null),[p,g]),[j,N]=x.useState({status:"idle",data:null,error:null}),[A,I]=x.useState({status:"idle",items:[],error:null}),[re,F]=x.useState({status:"idle",items:[],error:null}),[Me,ke]=x.useState(typeof window<"u"?window.innerWidth>=1024:!1);x.useEffect(()=>{if(typeof window>"u")return;const t=()=>ke(window.innerWidth>=1024);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),x.useEffect(()=>{if(!e){N({status:"failed",data:null,error:"Combo not found"});return}if(m==null){g==null&&(c==="loading"||c==="idle")?N(n=>n.status==="loading"?n:{status:"loading",data:null,error:null}):g==null&&c==="failed"&&N({status:"failed",data:null,error:"Combo not found"});return}let t=!0;const i=new AbortController;return N({status:"loading",data:null,error:null}),(async()=>{try{const n=await H.get(K.combos.byId(m),{signal:i.signal});if(!t)return;N({status:"succeeded",data:n,error:null})}catch(n){if(n!=null&&n.canceled||!t)return;N(p?{status:"succeeded",data:p,error:null}:{status:"failed",data:null,error:(n==null?void 0:n.message)||"Failed to load combo"})}})(),()=>{t=!1,i.abort()}},[e,m,c,g,p]);const[h,Ce]=x.useState(b().format("YYYY-MM-DD")),[$,V]=x.useState(1),[E,De]=x.useState([]),[v,P]=x.useState({status:"idle",selectedKey:""}),[Ae,ne]=x.useState(""),le=x.useCallback(async()=>{if(!(!m||!h))try{P(f=>({...f,status:"loading"})),ne("");const t=await H.get(K.combos.slots(m),{params:{date:h}}),i=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:[];De(i);const n=i.find(f=>ae(f,h))||i[0]||null;P({status:"loaded",selectedKey:n?q(n):""})}catch(t){ne((t==null?void 0:t.message)||"Failed to load slots"),P(i=>({...i,status:"failed",selectedKey:""}))}},[m,h]);x.useEffect(()=>{m&&h&&le()},[m,h,le]),x.useEffect(()=>{if(!m)return F({status:"idle",items:[],error:null}),()=>{};let t=!1;return F(i=>({...i,status:"loading",error:null})),(async()=>{try{const i=await H.get(K.offers.list(),{params:{active:!0,target_type:"combo",target_id:m}});if(t)return;const n=Array.isArray(i==null?void 0:i.data)?i.data:Array.isArray(i)?i:[];F({status:"succeeded",items:n,error:null})}catch(i){if(t)return;F({status:"failed",items:[],error:(i==null?void 0:i.message)||"Failed to load offers"})}})(),()=>{t=!0}},[m]),x.useEffect(()=>{if(!m)return;let t=!1;return I(i=>({...i,status:"loading",error:null})),(async()=>{try{const i=await H.get(K.gallery.list(),{params:{active:!0,target_type:"combo",target_ref_id:m,limit:12}});if(t)return;const n=Array.isArray(i==null?void 0:i.data)?i.data:Array.isArray(i)?i:[];I({status:"succeeded",items:n,error:null})}catch(i){if(t)return;I({status:"failed",items:[],error:(i==null?void 0:i.message)||"Failed to load gallery"})}})(),()=>{t=!0}},[m]);const a=j.data||p,de=x.useMemo(()=>{if(!a)return[];const t=[a.attraction_1||{title:a==null?void 0:a.attraction_1_title,image_url:a==null?void 0:a.attraction_1_image,slug:a==null?void 0:a.attraction_1_slug,base_price:a==null?void 0:a.attraction_1_price,attraction_id:a==null?void 0:a.attraction_1_id},a.attraction_2||{title:a==null?void 0:a.attraction_2_title,image_url:a==null?void 0:a.attraction_2_image,slug:a==null?void 0:a.attraction_2_slug,base_price:a==null?void 0:a.attraction_2_price,attraction_id:a==null?void 0:a.attraction_2_id}];return Array.isArray(t)?t.filter(Boolean):[]},[a]),_=x.useMemo(()=>{if(!a)return[];if(Array.isArray(a==null?void 0:a.attractions)&&a.attractions.length)return a.attractions.map((i,n)=>se(i,`Experience ${n+1}`,`combo-${n}`));const t=Array.isArray(a==null?void 0:a.attraction_ids)?a.attraction_ids.filter(Boolean):[];return t.length&&u.length?t.map((i,n)=>{const f=u.find(y=>String(Ge(y))===String(i));return se(f||{title:`Experience ${n+1}`},`Experience ${n+1}`,`combo-${n}`)}).filter(Boolean):de.map((i,n)=>se(i,`Experience ${n+1}`,`combo-${n}`)).filter(Boolean)},[a,u,de]),[Ye,Ee]=[_[0],_[1]];if(j.status==="loading"&&!a)return s.jsx("div",{className:"min-h-[60vh] flex items-center justify-center bg-white",children:s.jsx(Z,{})});if(j.status==="failed")return s.jsx("div",{className:"min-h-[60vh] flex items-center justify-center bg-white px-4",children:s.jsx("div",{className:"max-w-lg w-full",children:s.jsx(U,{message:j.error||"Combo not found"})})});if(!a)return s.jsx("div",{className:"min-h-[60vh] flex items-center justify-center bg-white px-4",children:s.jsx("div",{className:"max-w-lg w-full",children:s.jsx(U,{message:"Combo not found"})})});const k=(a==null?void 0:a.combo_id)||(a==null?void 0:a.id)||m||null,L=(a==null?void 0:a.name)||(a==null?void 0:a.title)||"Combo Deal",ce=(a==null?void 0:a.short_description)||(a==null?void 0:a.subtitle)||"",oe=(a==null?void 0:a.description)||(a==null?void 0:a.long_description)||"",Q=et(a,Ye,Ee,Me),W=(_.length?_:[{title:L,image_url:be}]).slice(0,Math.max(2,Math.min(3,_.length||2))),ue=W.map(t=>t.title).join(" + "),me=ze(a),S=me>0?me:Number((a==null?void 0:a.combo_price)||(a==null?void 0:a.total_price)||0),J=He(a),C=J||_.reduce((t,i)=>t+Number((i==null?void 0:i.price)||0),0),X=C>0,$e=X&&S>0?C-S:0,O=X&&S>0&&S<C?Math.max(0,Math.round(Ke(a)||(C-S)/C*100)):Number((a==null?void 0:a.discount_percent)||0),R=x.useCallback(t=>{const i=Number(S||0),n=Number(J||C||i),f=ye(t,i),y=Ue(t,n),D=f||y||0,Y=k?Ze(re.items,{targetType:"combo",targetId:k,date:h,slot:t,basePrice:D}):null,w=Y?Y.price:f,z=y>w?y-w:0;return{finalPrice:w,originalPrice:y,savings:z,bestOffer:Y}},[S,J,C,re.items,k,h]),fe=(t,i)=>{var w,z,xe,pe;const n=Math.max(1,Number($)||1),f=i||R(t),y=(f==null?void 0:f.finalPrice)??ye(t,S),D=(t==null?void 0:t.combo_slot_id)??(t==null?void 0:t.id)??(t==null?void 0:t._id)??null;if(!D)return;l(Oe({itemType:"combo",comboId:Number(k)||k,combo:a,date:h,booking_date:qe(h),booking_time:(t==null?void 0:t.start_time)||(t==null?void 0:t.startTime)||(t==null?void 0:t.slot_start_time)||null,comboSlotId:D,slot:t,qty:n,unitPrice:y,title:(a==null?void 0:a.title)||(a==null?void 0:a.name)||(a==null?void 0:a.combo_name)||`Combo #${k}`,slotLabel:ee(t),dateLabel:b(h).format("DD MMM YYYY"),meta:{title:(a==null?void 0:a.title)||(a==null?void 0:a.name)||(a==null?void 0:a.combo_name)||`Combo #${k}`,start_time:t==null?void 0:t.start_time,end_time:t==null?void 0:t.end_time,capacity:t==null?void 0:t.capacity,available:t==null?void 0:t.available},offer_id:(z=(w=f==null?void 0:f.bestOffer)==null?void 0:w.offer)==null?void 0:z.offer_id,offer_rule_id:(pe=(xe=f==null?void 0:f.bestOffer)==null?void 0:xe.rule)==null?void 0:pe.rule_id})),l(Re(1));const Y=new URLSearchParams({type:"combo",combo_id:String(k),date:h,slot:q(t),qty:String(n)});r(`/booking?${Y.toString()}`)},B=E.find(t=>q(t)===v.selectedKey)||null,T=B?R(B):null;return s.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#e0f2fe] via-[#bae6fd] to-white font-sans",children:[s.jsxs("section",{className:"relative h-[42vh] md:h-[56vh] bg-gray-200",children:[Q?s.jsx("img",{src:Q,alt:L,className:"w-full h-full object-cover",loading:"lazy",draggable:"false"}):s.jsx("div",{className:"absolute inset-0 grid gap-1",style:{gridTemplateColumns:`repeat(${W.length}, minmax(0, 1fr))`},children:W.map((t,i)=>s.jsxs("div",{className:"relative overflow-hidden",children:[s.jsx("img",{src:t.image_url||be,alt:t.title,className:"w-full h-full object-cover",loading:"lazy",draggable:"false"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"})]},`hero-attr-${i}`))}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"}),s.jsx("div",{className:"absolute bottom-6 left-0 right-0 px-4",children:s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur px-3 py-1 rounded-full text-xs uppercase tracking-wide text-gray-100 mb-2",children:[s.jsx("span",{children:"Combo Deal"}),O>0?s.jsxs("span",{children:["Save ",O,"%"]}):null]}),s.jsx("h1",{className:"text-3xl md:text-5xl font-bold text-white drop-shadow",children:L}),ce?s.jsx("p",{className:"text-gray-200 text-sm md:text-base max-w-2xl mt-2",children:ce}):null,!Q&&ue?s.jsx("p",{className:"text-xs uppercase tracking-[0.25em] text-gray-200 mt-3 line-clamp-2",children:ue}):null]})})]}),s.jsx("section",{className:"bg-white/90 backdrop-blur border-b border-gray-100 shadow-sm",children:s.jsx("div",{className:"max-w-6xl mx-auto px-4 py-4 md:py-5",children:s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3 md:gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500 mb-1",children:"Book this combo"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Choose your date, time slot & tickets to continue to checkout."})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 md:gap-4 md:flex-none",children:[s.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 sm:px-4 sm:py-2.5",children:[s.jsx("span",{className:"text-xs text-gray-500",children:"Date"}),s.jsx("input",{type:"date",className:"bg-transparent border-none outline-none text-sm font-medium text-gray-900",value:h,min:b().format("YYYY-MM-DD"),onChange:t=>{Ce(t.target.value),P(i=>({...i,selectedKey:""}))}})]}),s.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 sm:px-4 sm:py-2.5 min-w-[180px]",children:[s.jsx("span",{className:"text-xs text-gray-500",children:"Slot"}),s.jsxs("select",{className:"flex-1 bg-transparent border-none outline-none text-sm font-medium text-gray-900 truncate",value:v.selectedKey,onChange:t=>P(i=>({...i,selectedKey:t.target.value})),disabled:v.status==="loading"||!E.length,children:[v.status==="loading"&&s.jsx("option",{children:"Loading slots…"}),v.status!=="loading"&&!E.length&&s.jsx("option",{children:"No slots"}),v.status!=="loading"&&E.filter(t=>ae(t,h)).map(t=>{const i=q(t),n=R(t),f=ee(t)||"Slot",y=(n==null?void 0:n.finalPrice)!=null?` • ${M(n.finalPrice)}`:"";return s.jsxs("option",{value:i,children:[f,y]},i)})]})]}),s.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 sm:px-4 sm:py-2.5",children:[s.jsx("span",{className:"text-xs text-gray-500",children:"Qty"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{type:"button",className:"w-7 h-7 text-sm rounded-full border border-gray-300 flex items-center justify-center",onClick:()=>V(t=>Math.max(1,Number(t||1)-1)),children:"-"}),s.jsx("input",{type:"number",min:1,value:$,onChange:t=>V(Math.max(1,Number(t.target.value)||1)),className:"w-12 bg-transparent border-none text-center text-sm font-semibold outline-none"}),s.jsx("button",{type:"button",className:"w-7 h-7 text-sm rounded-full border border-gray-300 flex items-center justify-center",onClick:()=>V(t=>Math.max(1,Number(t||1)+1)),children:"+"})]})]}),s.jsx("button",{type:"button",className:"w-full sm:w-auto inline-flex items-center justify-center rounded-xl bg-blue-600 text-white px-6 py-2.5 text-sm font-semibold shadow-md hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed",disabled:!B||v.status==="loading",onClick:()=>{B&&fe(B,T)},children:T!=null&&T.finalPrice?`Book Now • ${M(T.finalPrice*$)}`:"Book Now"})]})]})})}),s.jsxs("section",{className:"max-w-6xl mx-auto px-4 py-8 md:py-12 grid grid-cols-1 lg:grid-cols-3 gap-10 md:gap-12",children:[s.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[_.length>0&&s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map((t,i)=>s.jsxs("figure",{className:"relative rounded-2xl overflow-hidden shadow-sm bg-white",children:[s.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-60 md:h-64 object-cover",loading:"lazy"}),s.jsxs("figcaption",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/75 to-transparent p-4 text-white",children:[s.jsxs("p",{className:"text-[11px] uppercase tracking-wide text-gray-300",children:["Experience ",i+1]}),s.jsx("h2",{className:"text-lg font-semibold line-clamp-2",children:t.title}),t.price?s.jsxs("p",{className:"text-xs text-gray-200 mt-1",children:["Base price: ",M(t.price)]}):null]})]},`included-${i}`))}),oe?s.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 md:p-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"About this combo"}),s.jsx("div",{className:"prose prose-sm md:prose max-w-none text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:oe}})]}):null,A.status==="loading"&&!A.items.length?s.jsx(Z,{}):null,A.status==="failed"?s.jsx(U,{message:A.error,onRetry:()=>I(t=>({...t,status:"idle"}))}):null,A.items.length?s.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 md:p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Gallery"}),s.jsxs("span",{className:"text-xs text-gray-500",children:["#",((ge=A.items[0])==null?void 0:ge.target_name)||L]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:A.items.map(t=>{const i=String(t.media_type||"").toLowerCase()==="video",n=i?t.url:G(t);return n?s.jsxs("figure",{className:"relative rounded-xl overflow-hidden border shadow-sm bg-white",children:[i?s.jsx("video",{className:"w-full h-48 object-cover",src:n,controls:!0,preload:"metadata",poster:G(t.thumbnail)}):s.jsx("img",{src:n,alt:t.title||L,className:"w-full h-48 object-cover",loading:"lazy"}),(t.title||t.description)&&s.jsxs("figcaption",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 to-transparent p-3 text-xs text-white",children:[t.title?s.jsx("div",{className:"font-medium text-sm",children:t.title}):null,t.description?s.jsx("div",{className:"opacity-80 mt-1",children:t.description}):null]})]},`combo-gallery-${t.gallery_item_id}`):null})})]}):null,s.jsxs("div",{id:"availability",className:"rounded-2xl border shadow-sm p-4 md:p-5 bg-white",children:[s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-3",children:[s.jsx("h2",{className:"text-lg md:text-xl font-semibold text-gray-900",children:"All time slots"}),s.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:s.jsxs("span",{children:[b(h).format("DD MMM YYYY")," • ",$," ticket",$>1?"s":""]})})]}),v.status==="loading"?s.jsx("div",{className:"py-3",children:s.jsx(Z,{size:"sm"})}):null,v.status==="failed"?s.jsx("div",{className:"py-3",children:s.jsx(U,{message:Ae||"Failed to load slots"})}):null,v.status==="loaded"&&s.jsx(s.Fragment,{children:E.length?s.jsx("div",{className:"space-y-2",children:E.filter(t=>ae(t,h)).map(t=>{const i=ee(t),n=R(t),f=n.finalPrice,y=n.originalPrice,D=y>0&&f>=0&&f<y,Y=D&&y?Math.max(0,Math.round((y-f)/y*100)):null,w=(t==null?void 0:t.available)===0||(t==null?void 0:t.capacity)===0;return s.jsxs("div",{className:`flex items-center justify-between rounded-xl border px-4 py-3 shadow-sm ${w?"opacity-50 bg-gray-100 border-gray-200":"bg-white border-gray-200 hover:border-blue-300 hover:shadow-md transition-all"}`,children:[s.jsxs("div",{className:"flex flex-col gap-0.5",children:[s.jsx("span",{className:"font-semibold text-base text-gray-900",children:i||"Time slot"}),s.jsxs("span",{className:"text-xs text-gray-500",children:["Capacity: ",t.capacity," •"," ",t.available?"Available":"Unavailable"]}),D?s.jsxs("span",{className:"text-sm text-emerald-600 font-medium mt-1",children:[M(f)," ",s.jsx("span",{className:"line-through text-gray-400 ml-1",children:M(y)})]}):s.jsx("span",{className:"text-sm text-gray-700 mt-1",children:M(f)}),D&&s.jsxs("span",{className:"text-[11px] font-semibold text-emerald-600 mt-0.5",children:["Save ",Y,"%"]})]}),s.jsx("button",{type:"button",disabled:w,onClick:()=>fe(t,n),className:`px-4 py-2 rounded-full border text-sm font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${w?"opacity-50 cursor-not-allowed bg-gray-100 border-gray-200 text-gray-400":"bg-blue-600 text-white border-blue-600 hover:bg-blue-700"}`,children:"Book this slot"})]},t.combo_slot_id||`${t.combo_id}-${t.start_time}-${t.end_time}`)})}):s.jsxs("div",{className:"text-sm text-gray-500",children:["No slots available for"," ",b(h).format("DD MMM YYYY"),"."]})})]})]}),s.jsx("aside",{className:"lg:col-span-1",children:s.jsxs("div",{className:"rounded-3xl border shadow-lg bg-white p-6 sticky top-24 space-y-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:"Combo price"}),s.jsxs("div",{className:"flex items-baseline gap-2 mt-1",children:[s.jsx("span",{className:"text-3xl font-semibold text-gray-900",children:M(S)}),s.jsx("span",{className:"text-sm text-gray-500",children:"per combo"})]}),X&&s.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[s.jsx("span",{className:"line-through mr-2",children:M(C)}),O>0?s.jsxs("span",{className:"text-emerald-600 font-medium",children:["Save ",O,"% (",M($e),")"]}):s.jsxs("span",{children:["Special pricing across"," ",_.length||2," experiences"]})]})]}),s.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[s.jsxs("p",{children:["Includes admission for"," ",_.length||2," attraction(s). Book together to lock in bundled savings."]}),s.jsx("ul",{className:"list-disc list-inside space-y-1",children:_.map((t,i)=>s.jsx("li",{children:t.title},`sidebar-attr-${i}`))})]}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx("a",{href:"#availability",className:"inline-flex items-center justify-center rounded-full bg-blue-600 text-white px-6 py-3 text-sm font-medium hover:bg-blue-700",children:"View all time slots"}),s.jsx(Fe,{to:"/combos",className:"inline-flex items-center justify-center rounded-full border border-blue-100 text-blue-600 px-6 py-3 text-sm font-medium hover:bg-blue-50",children:"Explore other combos"})]})]})})]})]})}export{lt as default};
