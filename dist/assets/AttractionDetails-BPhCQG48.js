import{C as rt,A as at,h as nt,R as u,D as g,i as ne,k as le,j as e,z as ge,L as Le,E as lt,F as it,G as ot}from"./index-DpUnVvi7.js";import{E as Z}from"./ErrorState-maGIkZl4.js";import{G as ct}from"./GalleryViewer-zY-4gTil.js";import{g as Ee}from"./ids-YExsbyMi.js";import{i as V}from"./media-CQLQFIy8.js";import{g as dt,a as mt,b as ut,c as ye,d as xt}from"./pricing-Df4qX4St.js";import{f as M}from"./formatters-CmiLqhJj.js";import{X as ft}from"./x-DjnihLtx.js";import"./createLucideIcon-DlloiUI2.js";const ie=t=>g(t).format("YYYY-MM-DD"),B=()=>g().format("YYYY-MM-DD"),oe=(t,l)=>String((t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.slot_id)??`${(t==null?void 0:t.start_time)||""}-${(t==null?void 0:t.end_time)||""}-${l}`),ze=t=>{if(!t)return"";const[l,m]=t.split(":"),d=parseInt(l,10),x=d>=12?"PM":"AM";return`${d%12||12}:${m} ${x}`},ee=t=>{if(t!=null&&t.label)return t.label;const l=ze(t==null?void 0:t.start_time),m=ze(t==null?void 0:t.end_time);return l&&m?`${l} - ${m}`:l||`Slot #${(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.slot_id)??"?"}`},he=t=>{if(!t||typeof t!="string")return null;const[l="0",m="0"]=t.split(":"),d=Number(l),x=Number(m);return!Number.isFinite(d)||!Number.isFinite(x)?null:d*60+x},gt=(t={},l)=>{if(!t.day_type)return!0;const m=g(l).day(),d=String(t.day_type).toLowerCase();return d==="weekday"?m>=1&&m<=5:d==="weekend"?m===0||m===6:d==="custom"&&Array.isArray(t.specific_days)?t.specific_days.map(Number).includes(m):!0},Ge=t=>String(t||"").toLowerCase(),Re=(t,l)=>t==null||l==null?!1:String(t)===String(l),yt=t=>{if(typeof t=="boolean")return t;if(t==null)return!1;if(typeof t=="number")return t!==0;const l=String(t).trim().toLowerCase();return l?["true","1","yes","y"].includes(l)?!0:["false","0","no","n"].includes(l)?!1:!!t:!1},ht=(t={},l=null)=>{if(!l)return!(t.slot_id!=null||Array.isArray(t.slot_ids)&&t.slot_ids.length||t.specific_time||t.time_from&&t.time_to);const m=[];if(t.slot_id!=null&&m.push(t.slot_id),Array.isArray(t.slot_ids)&&m.push(...t.slot_ids),t.target_slot_id!=null&&m.push(t.target_slot_id),m.length){const x=[l.slot_id,l.id,l._id,l.combo_slot_id].filter(a=>a!=null);if(!m.some(a=>x.some(D=>Re(a,D))))return!1}const d=l.start_time||l.time||l.startTime||null;if(t.specific_time&&d&&d.slice(0,5)!==String(t.specific_time).slice(0,5))return!1;if(t.time_from&&t.time_to&&d){const x=he(d),f=he(t.time_from),a=he(t.time_to);if(x==null||f==null||a==null||x<f||x>a)return!1}return!0},pt=(t,{targetType:l,targetId:m,date:d,slot:x})=>{if(!t||!l||!m)return!1;const f=g(d).format("YYYY-MM-DD"),a=Ge(t.target_type),D=Ge(l);if(a&&D&&a!==D)return!1;if(!yt(t.applies_to_all)){const v=[];if(t.target_id!=null&&v.push(t.target_id),Array.isArray(t.target_ids)&&v.push(...t.target_ids),!v.length||!v.some(_=>Re(_,m)))return!1}return!(t.specific_date&&f!==t.specific_date||Array.isArray(t.specific_dates)&&t.specific_dates.length&&!t.specific_dates.some(v=>g(v).format("YYYY-MM-DD")===f)||t.date_from&&f<t.date_from||t.date_to&&f>t.date_to||!gt(t,f)||!ht(t,x))},bt=(t={},l=null,m=0)=>{const d=Number(m);if(!d||d<=0)return 0;let x=(l==null?void 0:l.rule_discount_type)||t.discount_type||(t.discount_percent?"percent":null),f=(l==null?void 0:l.rule_discount_value)??t.discount_value??t.discount_percent??0;if(!x||!f)return 0;x=String(x).toLowerCase();let a=x==="amount"?Number(f):Number(f)/100*d;return Number.isFinite(Number(t.max_discount))&&(a=Math.min(a,Number(t.max_discount))),a=Math.min(a,d),Math.max(0,a)},jt=(t=[],{targetType:l,targetId:m,date:d,slot:x,basePrice:f})=>{if(!Array.isArray(t)||!t.length||!f||!m)return null;let a=null;return t.forEach(D=>{(Array.isArray(D.rules)&&D.rules.length?D.rules:[null]).forEach(v=>{if(v&&!pt(v,{targetType:l,targetId:m,date:d,slot:x}))return;const _=bt(D,v,f);if(!_)return;const S=Math.max(0,f-_);(!a||S<a.price)&&(a={offer:D,rule:v,price:S,discount:_})})}),a},pe=(t,l)=>{if(!t||!l)return!0;const m=g().format("YYYY-MM-DD"),d=g(l).format("YYYY-MM-DD");if(d>m)return!0;if(d===m){const x=g(),f=t.start_time||t.time||null;if(!f)return!0;const[a,D]=f.split(":").map(Number),y=(a||0)*60+(D||0),_=x.hour()*60+x.minute()+60;return y>=_}return!1},Ue=(t,l="")=>t?typeof t=="string"?V(t,l):V(t.url||t.image_url,l):l;function At(){var Ae,Ce,Se,Te,$e,Be,Pe;const{slug:t}=rt(),l=at(),m=nt(),d=u.useMemo(()=>!t||t==="undefined"||t==="null"?null:t,[t]),[x,f]=u.useState({status:"idle",data:null,error:null}),[a,D]=u.useState(B()),[y,v]=u.useState({status:"idle",items:[],error:null}),[_,S]=u.useState(""),[te,W]=u.useState(1),[be,se]=u.useState(!1),[He,Ve]=u.useState(null),q=u.useMemo(()=>null,[He,be]),R=u.useCallback(s=>{D(s),S("")},[]),je=u.useCallback(()=>{R(B())},[R]),Ne=u.useCallback(()=>{R(g().add(1,"day").format("YYYY-MM-DD"))},[R]),ve=u.useCallback(s=>{s.preventDefault(),s.stopPropagation(),Ve(s.currentTarget),se(!0)},[]),We=u.useCallback(s=>{R(s),se(!1)},[R]),[we,K]=u.useState(null),[I,O]=u.useState({status:"idle",items:[],error:null}),[Q,ce]=u.useState({status:"idle",items:[],error:null});u.useEffect(()=>{d||f({status:"failed",data:null,error:"Invalid attraction slug"})},[d]);const w=u.useMemo(()=>{var s;return((s=x.data)==null?void 0:s.attraction_id)||null},[x.data]),_e=u.useCallback(s=>{if(!s)return()=>{};let n=!1;return O({status:"loading",items:[],error:null}),console.log("Debug - Loading gallery for attraction ID:",s),(async()=>{var o;try{const c=await ne.get(le.gallery.list(),{params:{active:!0,target_type:"attraction",target_ref_id:s,limit:12}});if(n)return;const k=((o=c==null?void 0:c.data)==null?void 0:o.data)||(Array.isArray(c==null?void 0:c.data)?c.data:Array.isArray(c)?c:[]);console.log("Debug - Raw gallery response:",c),console.log("Debug - Processed gallery items:",k),console.log("Debug - Expected target ID:",s);const ae=k.filter(p=>{const Y=String((p==null?void 0:p.target_type)||"").toLowerCase(),C=p==null?void 0:p.target_ref_id,G=Y==="attraction",U=C&&(C===s||String(C)===String(s)||Number(C)===Number(s));return(!G||!U)&&console.warn("Debug - Filtering out invalid gallery item:",{item:p,itemTargetType:Y,itemTargetId:C,targetId:s,typeMatches:G,idMatches:U}),G&&U});console.log("Debug - Validated gallery items for attraction",s,":",ae);const J=ae.sort((p,Y)=>p.created_at&&Y.created_at?new Date(p.created_at)-new Date(Y.created_at):p.id&&Y.id?p.id-Y.id:p.gallery_item_id&&Y.gallery_item_id?p.gallery_item_id-Y.gallery_item_id:0);console.log("Debug - Final sorted gallery items:",J),O({status:"succeeded",items:J,error:null})}catch(c){if(n)return;console.log("Debug - Gallery loading error:",c),O({status:"failed",items:[],error:(c==null?void 0:c.message)||"Failed to load gallery"})}})(),()=>{n=!0}},[]);u.useEffect(()=>{if(console.log("Debug - Gallery loading effect triggered. numericAttrId:",w),O({status:"loading",items:[],error:null}),!w)return console.log("Debug - No numericAttrId, setting gallery to idle"),O({status:"idle",items:[],error:null}),()=>{};const s=setTimeout(()=>_e(w),100);return()=>{clearTimeout(s)}},[w,_e]),u.useEffect(()=>{if(!d)return;f({status:"loading",data:null,error:null});const s=new AbortController;return(async()=>{var n;try{const o=await ne.get(le.attractions.bySlug(d),{signal:s.signal}),c=(o==null?void 0:o.attraction)||o||null;f({status:"succeeded",data:c,error:null}),document.title=(c==null?void 0:c.meta_title)||(c==null?void 0:c.title)||(c==null?void 0:c.name)||"Attraction Details"}catch(o){if(o!=null&&o.canceled)return;if((o==null?void 0:o.status)===404||((n=o==null?void 0:o.response)==null?void 0:n.status)===404){l("/404",{replace:!0});return}f({status:"failed",data:null,error:(o==null?void 0:o.message)||"Failed to load attraction"})}})(),()=>s.abort()},[d]);const ke=u.useCallback(async()=>{if(!w||!a)return;v(n=>({...n,status:"loading",error:null,items:[]}));const s=new AbortController;try{const n=await ne.get(le.slots.list(),{params:{attraction_id:w,date:ie(a)},signal:s.signal}),o=Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n)?n:[];v({status:"succeeded",items:o,error:null});const c=o.find(k=>pe(k,a))||o[0]||null;S(c?oe(c,0):"")}catch(n){if(n!=null&&n.canceled)return;v({status:"failed",items:[],error:(n==null?void 0:n.message)||"Failed to load slots"})}return()=>s.abort()},[w,a]);u.useEffect(()=>{w&&a?(S(""),ke()):v({status:"idle",items:[],error:null})},[w,a,ke]),u.useEffect(()=>{if(!w||Q.status==="loading")return;let s=!1;return ce(n=>({...n,status:"loading",error:null})),(async()=>{try{const n=await ne.get(le.offers.list(),{params:{active:!0,target_type:"attraction",target_id:w}});if(s)return;const o=Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n)?n:[];ce({status:"succeeded",items:o,error:null})}catch(n){if(s)return;ce({status:"failed",items:[],error:(n==null?void 0:n.message)||"Failed to load offers"})}})(),()=>{s=!0}},[w,Q.status]);const r=x.data,P=(r==null?void 0:r.name)||(r==null?void 0:r.title)||"Attraction",qe=`https://picsum.photos/seed/attr${w}/1920/800`,Ke=`https://picsum.photos/seed/attr${w}/800/600`,[Oe,Qe]=u.useState(typeof window<"u"?window.innerWidth>=1024:!1);u.useEffect(()=>{if(typeof window>"u")return;const s=()=>Qe(window.innerWidth>=1024);return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const Xe=V((r==null?void 0:r.desktop_image_url)||(r==null?void 0:r.hero_image)||(r==null?void 0:r.banner_image)||(r==null?void 0:r.image_web)||(r==null?void 0:r.image_url)||r,qe),Je=V((r==null?void 0:r.mobile_image)||(r==null?void 0:r.image_mobile)||(r==null?void 0:r.image_url)||r,Ke),T=Oe?Xe:Je,Me=u.useMemo(()=>{const n=(I.items||[]).map(o=>({...o,image_url:Ue(o)||V(o.image_url||o.url||o,"")}));return T?[{image_url:T,isCover:!0},...n]:n},[I.items,T]),h=u.useMemo(()=>(I.items||[]).map(n=>({...n,image_url:Ue(n)||V(n.image_url||n.url||n,"")})),[I.items]);u.useEffect(()=>{console.log("Debug - Attraction ID:",w),console.log("Debug - Attraction Data:",r),console.log("Debug - Cover URL:",T),console.log("Debug - Gallery Items:",I.items),console.log("Debug - Hero Gallery Items:",Me),console.log("Debug - Gallery Viewer Items:",h)},[w,r,T,I.items,Me,h]);const De=T||((Ae=h[0])==null?void 0:Ae.image_url)||null;(Ce=h[0])!=null&&Ce.image_url,(Se=h[1])!=null&&Se.image_url||(Te=h[0])!=null&&Te.image_url,h.length;const i=u.useMemo(()=>{for(let s=0;s<y.items.length;s+=1){const n=y.items[s];if(oe(n,s)===_)return n}return null},[y.items,_]),L=Number(dt(r)||0),Ye=Number(mt(r)||L),de=(i==null?void 0:i.pricing)||{},Ie=(i==null?void 0:i.offer)||null,Ze=i?ut(i,Ye):Ye,et=i?ye(i,L):L,b=Number(de.base_price??Ze??0),E=Number(de.final_price??et??0),H=!!Ie||b>0&&E>0&&E<b&&de.final_price!=null,tt=H&&b>0?Math.round((b-E)/b*100):0,z=Math.max(1,Number(te)||1),A=u.useMemo(()=>{if(!i||!r||!Q.items.length||H)return null;const s=E||b||0;if(!s)return null;const n=Ee(r);return jt(Q.items,{targetType:"attraction",targetId:n,date:a,slot:i,basePrice:s})},[r,i,Q.items,E,b,a,H]),j=H?E||b:A?A.price:E,N=H?Ie:(A==null?void 0:A.offer)||null,X=(N==null?void 0:N.description)||"",me=H?tt:A&&b>0?Math.round((b-j)/b*100):xt(r)||0,$=b>0&&j>0&&j<b,ue=Number(j||0)*z,xe=()=>{var k;if(!r||!a||!i||!te)return;const s=(i==null?void 0:i.id)??(i==null?void 0:i._id)??(i==null?void 0:i.slot_id);if(!s)return;const n=Ee(r),o=z;m(lt({itemType:"attraction",attractionId:n,attraction:r,date:ie(a),booking_date:ie(a),booking_time:(i==null?void 0:i.start_time)||(i==null?void 0:i.startTime)||(i==null?void 0:i.slot_start_time)||null,slotId:s,slot:i,qty:o,unitPrice:Number(j??(i==null?void 0:i.price)??b),title:(r==null?void 0:r.title)||(r==null?void 0:r.name)||`Attraction #${n}`,slotLabel:ee(i),dateLabel:g(a).format("DD MMM YYYY"),meta:{title:(r==null?void 0:r.title)||(r==null?void 0:r.name)||`Attraction #${n}`,start_time:i==null?void 0:i.start_time,end_time:i==null?void 0:i.end_time,capacity:i==null?void 0:i.capacity,available:i==null?void 0:i.available},offer_id:N==null?void 0:N.offer_id,offer_rule_id:(N==null?void 0:N.rule_id)||((k=A==null?void 0:A.rule)==null?void 0:k.rule_id),offerDescription:X||(N==null?void 0:N.description)||""})),it.success("Added to your booking!"),m(ot(1));const c=new URLSearchParams({type:"attraction",attraction_id:String(n),date:ie(a),slot:_,qty:String(o)});sessionStorage.removeItem("snowcity_booking_state"),l(`/booking?${c.toString()}`)};if(x.status==="loading"&&!r)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center bg-white",children:e.jsx(ge,{})});if(x.status==="failed")return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center bg-white px-4",children:e.jsx("div",{className:"max-w-lg w-full",children:e.jsx(Z,{message:x.error||"Attraction not found"})})});if(!r)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center bg-white px-4",children:e.jsx("div",{className:"max-w-lg w-full",children:e.jsx(Z,{message:"Attraction not found"})})});const Fe=(r==null?void 0:r.short_description)||(r==null?void 0:r.subtitle)||"",F=i,re=F&&j?j*z:null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#e0f2fe] via-[#bae6fd] to-white font-sans pb-24 lg:pb-0",children:[e.jsx("section",{className:"mt-0 bg-transparent",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 pt-6 space-y-4",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900",style:{fontFamily:"Inter, sans-serif"},children:P}),e.jsx("div",{className:"overflow-hidden shadow-lg bg-gray-100",children:h.length>0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[2fr_1fr] gap-[2px] bg-white",children:[e.jsx("button",{type:"button",className:"relative w-full group",onClick:()=>h.length&&K(0),children:e.jsxs("div",{className:"md:h-[420px] w-full overflow-hidden",children:[e.jsx("img",{src:T,alt:P,className:"w-full h-full object-cover",loading:"lazy",draggable:"false"}),e.jsx("div",{className:"absolute inset-0 flex items-start justify-start p-6",children:e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white drop-shadow-lg",style:{fontFamily:"Inter, sans-serif",color:"#87CEEB",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:P})})]})}),e.jsxs("div",{className:"hidden md:grid grid-rows-2 gap-[2px] h-[420px]",children:[e.jsx("button",{type:"button",className:"relative w-full group",onClick:()=>h.length>0&&K(0),children:e.jsxs("div",{className:"w-full h-full overflow-hidden",children:[e.jsx("img",{src:(($e=h[0])==null?void 0:$e.image_url)||"",alt:P,className:"w-full h-full object-cover brightness-[0.95]",loading:"lazy",draggable:"false"}),e.jsx("div",{className:"absolute inset-x-0 top-0 h-32 bg-gradient-to-b from-black/50 via-black/10 to-transparent pointer-events-none"})]})}),e.jsx("button",{type:"button",className:"relative w-full group",onClick:()=>h.length>1&&K(1),children:e.jsxs("div",{className:"w-full h-full overflow-hidden",children:[e.jsx("img",{src:((Be=h[1])==null?void 0:Be.image_url)||((Pe=h[0])==null?void 0:Pe.image_url)||"",alt:P,className:"w-full h-full object-cover",loading:"lazy",draggable:"false"}),e.jsx("div",{className:"absolute bottom-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full",children:h.length>1?e.jsxs(e.Fragment,{children:["1 / ",h.length]}):null})]})})]})]}):e.jsx("button",{type:"button",className:"relative w-full group",onClick:()=>h.length&&K(0),children:e.jsxs("div",{className:"h-[420px] w-full overflow-hidden",children:[e.jsx("img",{src:T,alt:P,className:"w-full h-full object-cover",loading:"lazy",draggable:"false"}),e.jsx("div",{className:"absolute inset-0 flex items-start justify-start p-6",children:e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white drop-shadow-lg",style:{fontFamily:"Inter, sans-serif",color:"#87CEEB",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:P})})]})})})]})}),e.jsx("div",{className:"lg:hidden max-w-6xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"rounded-3xl border shadow-lg bg-white p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",style:{fontFamily:"Inter, sans-serif"},children:"Base price"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900 rupee",style:{fontFamily:"Inter, sans-serif"},children:M(b||j||0)})]}),$?e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500",style:{fontFamily:"Inter, sans-serif"},children:"Offer price"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600 rupee",style:{fontFamily:"Inter, sans-serif"},children:M(j||0)}),X?e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:X}):null]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Per person • taxes included"}),N?e.jsxs("span",{className:"mt-1 text-xs font-semibold text-emerald-600 flex items-center gap-1",children:[e.jsxs("span",{children:[N.rule_type==="happy_hour"?"Happy Hour":"Offer"," ","applied:"]}),e.jsx("span",{children:N.title||"Special offer"})]}):null]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"per ticket"}),$&&e.jsxs("div",{className:"text-xs font-semibold text-emerald-600",children:["Save ",me,"%"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",style:{fontFamily:"Inter, sans-serif"},children:"Select Date"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:je,className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${a===B()?"bg-[#003de6] text-white border-[#003de6]":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,style:{fontFamily:"Inter, sans-serif"},children:"Today"}),e.jsx("button",{type:"button",onClick:Ne,className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${a===g().add(1,"day").format("YYYY-MM-DD")?"bg-[#003de6] text-white border-[#003de6]":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,style:{fontFamily:"Inter, sans-serif"},children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:ve,className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${a&&a!==B()&&a!==g().add(1,"day").format("YYYY-MM-DD")?"bg-[#003de6] text-white border-[#003de6]":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,style:{fontFamily:"Inter, sans-serif"},children:a&&a!==B()&&a!==g().add(1,"day").format("YYYY-MM-DD")?g(a).format("D MMM"):"All Days"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",style:{fontFamily:"Inter, sans-serif"},children:"Select Time Slot"}),y.status==="loading"?e.jsx("div",{className:"py-3",children:e.jsx(ge,{size:"sm"})}):y.status==="failed"?e.jsx("div",{className:"py-3",children:e.jsx(Z,{message:y.error||"Failed to load slots"})}):e.jsx("select",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2.5 text-sm font-medium text-gray-900 outline-none",value:_,onChange:s=>S(s.target.value),disabled:!y.items.length,style:{fontFamily:"Inter, sans-serif"},children:y.items.length?e.jsxs(e.Fragment,{children:[!_&&e.jsx("option",{value:"",children:"Select slot"}),y.items.filter(s=>pe(s,a)).map((s,n)=>{const o=oe(s,n),c=(s==null?void 0:s.available)===0||(s==null?void 0:s.capacity)===0,k=ye(s,L)||L||0;return e.jsxs("option",{value:o,disabled:c,children:[ee(s),k?` • ${M(k)}`:"",c?" — Unavailable":""]},o)})]}):e.jsx("option",{children:"No slots"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",style:{fontFamily:"Inter, sans-serif"},children:"Number of Tickets"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",className:"w-7 h-7 text-sm rounded-full border border-gray-300 flex items-center justify-center",onClick:()=>W(s=>Math.max(1,Number(s||1)-1)),children:"-"}),e.jsx("input",{type:"number",min:1,value:te,readOnly:!0,className:"w-16 text-center border border-gray-300 rounded-lg px-2 py-1 text-sm bg-gray-50",style:{fontFamily:"Inter, sans-serif"}}),e.jsx("button",{type:"button",className:"w-7 h-7 text-sm rounded-full border border-gray-300 flex items-center justify-center",onClick:()=>W(s=>Math.max(1,Number(s||1)+1)),children:"+"})]})]}),a&&F&&e.jsxs("div",{className:"mt-4 rounded-2xl border border-sky-100 bg-sky-50 px-4 py-3 text-sm flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-gray-700",children:[e.jsx("span",{className:"font-semibold",style:{fontFamily:"Inter, sans-serif"},children:"Selection:"}),e.jsxs("span",{className:"font-medium text-right",children:[g(a).format("DD MMM YYYY")," ",e.jsx("br",{})," ",ee(F)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-gray-700 pt-2 border-t border-sky-200 border-dashed",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"rupee",children:[z," × ",M(j||0)]})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-gray-900 font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"rupee",children:M(ue||0)})]})]}),!a||!F?e.jsx("div",{className:"mt-4 rounded-2xl border bg-gray-50 px-3 py-2 text-sm text-center text-gray-500",children:"Please select a date and time slot."}):null,e.jsx("button",{type:"button",className:"w-full inline-flex items-center justify-center rounded-xl bg-[#003de6] text-white px-6 py-2.5 text-sm font-semibold shadow-md hover:bg-[#002db3] disabled:opacity-60 disabled:cursor-not-allowed",disabled:!F||!j,onClick:xe,style:{fontFamily:"Inter, sans-serif"},children:re?e.jsxs(e.Fragment,{children:["Book Now •"," ",e.jsx("span",{className:"ml-1 rupee",children:M(re)})]}):"Book Now"})]})}),e.jsx("section",{className:"max-w-6xl mx-auto px-4 py-8 md:py-12 mt-0",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-10 md:gap-12",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:x.status==="failed"?e.jsx(Z,{message:x.error}):e.jsxs(e.Fragment,{children:[Fe?e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 md:p-6",children:e.jsx("p",{className:"text-gray-700 text-base md:text-lg",style:{fontFamily:"Inter, sans-serif"},children:Fe})}):null,r!=null&&r.description?e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 md:p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",style:{fontFamily:"Inter, sans-serif",color:"#87CEEB"},children:"About this attraction"}),e.jsx("div",{className:"prose prose-sm md:prose max-w-none text-gray-700 leading-relaxed text-left",style:{fontFamily:"Inter, sans-serif"},dangerouslySetInnerHTML:{__html:r.description}})]}):null,I.items&&I.items.length>0?e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 md:p-6",children:e.jsxs(Le,{to:`/gallery?attraction=${w}`,className:"inline-flex items-center gap-2 text-sky-600 hover:text-sky-700 font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"View ",I.items.length," Gallery ",I.items.length===1?"Image":"Images"]})}):null]})}),e.jsx("aside",{className:"hidden lg:block lg:col-span-1",children:e.jsxs("div",{className:"rounded-3xl border shadow-lg bg-white p-6 sticky top-24 space-y-6",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",style:{fontFamily:"Inter, sans-serif"},children:"Base price"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900 rupee",style:{fontFamily:"Inter, sans-serif"},children:M(b||j||0)})]}),$?e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500",style:{fontFamily:"Inter, sans-serif"},children:"Offer price"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600 rupee",style:{fontFamily:"Inter, sans-serif"},children:M(j||0)}),X?e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:X}):null]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Per person • taxes included"}),N?e.jsxs("span",{className:"mt-1 text-xs font-semibold text-emerald-600 flex items-center gap-1",children:[e.jsxs("span",{children:[N.rule_type==="happy_hour"?"Happy Hour":"Offer"," ","applied:"]}),e.jsx("span",{children:N.title||"Special offer"})]}):null]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"per ticket"}),$&&e.jsxs("div",{className:"text-xs font-semibold text-emerald-600",children:["Save ",me,"%"]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",style:{fontFamily:"Inter, sans-serif"},children:"Select Date"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:je,className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${a===B()?"bg-[#003de6] text-white border-[#003de6]":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,style:{fontFamily:"Inter, sans-serif"},children:"Today"}),e.jsx("button",{type:"button",onClick:Ne,className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${a===g().add(1,"day").format("YYYY-MM-DD")?"bg-[#003de6] text-white border-[#003de6]":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,style:{fontFamily:"Inter, sans-serif"},children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:ve,className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${a&&a!==B()&&a!==g().add(1,"day").format("YYYY-MM-DD")?"bg-[#003de6] text-white border-[#003de6]":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,style:{fontFamily:"Inter, sans-serif"},children:a&&a!==B()&&a!==g().add(1,"day").format("YYYY-MM-DD")?g(a).format("D MMM"):"All Days"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",style:{fontFamily:"Inter, sans-serif"},children:"Select Time Slot"}),y.status==="loading"?e.jsx("div",{className:"py-2",children:e.jsx(ge,{size:"sm"})}):y.status==="failed"?e.jsx(Z,{message:y.error||"Failed to load slots"}):e.jsx("select",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2.5 text-sm font-medium text-gray-900 outline-none",value:_,onChange:s=>S(s.target.value),disabled:!y.items.length,style:{fontFamily:"Inter, sans-serif"},children:y.items.length?e.jsxs(e.Fragment,{children:[!_&&e.jsx("option",{value:"",children:"Select slot"}),y.items.filter(s=>pe(s,a)).map((s,n)=>{const o=oe(s,n),c=(s==null?void 0:s.available)===0||(s==null?void 0:s.capacity)===0,k=ye(s,L)||L||0;return e.jsxs("option",{value:o,disabled:c,children:[ee(s),k?` • ${M(k)}`:"",c?" — Unavailable":""]},o)})]}):e.jsx("option",{children:"No slots"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",style:{fontFamily:"Inter, sans-serif"},children:"Number of Tickets"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",className:"w-8 h-8 text-sm rounded-full border border-gray-300 flex items-center justify-center",onClick:()=>W(s=>Math.max(1,Number(s||1)-1)),children:"-"}),e.jsx("input",{type:"number",min:1,value:te,onChange:s=>W(Math.max(1,Number(s.target.value)||1)),className:"w-16 text-center border border-gray-300 rounded-lg px-2 py-1 text-sm",style:{fontFamily:"Inter, sans-serif"}}),e.jsx("button",{type:"button",className:"w-8 h-8 text-sm rounded-full border border-gray-300 flex items-center justify-center",onClick:()=>W(s=>Math.max(1,Number(s||1)+1)),children:"+"})]})]}),a&&F&&e.jsxs("div",{className:"mt-4 rounded-2xl border border-sky-100 bg-sky-50 px-4 py-3 text-sm flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-gray-700",children:[e.jsx("span",{className:"font-semibold",style:{fontFamily:"Inter, sans-serif"},children:"Selection:"}),e.jsxs("span",{className:"font-medium",children:[g(a).format("DD MMM YYYY")," • ",ee(F)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-gray-700 pt-2 border-t border-sky-200 border-dashed",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"rupee",children:[z," × ",M(j||0)]})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-gray-900 font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"rupee",children:M(ue||0)})]})]}),!a||!F?e.jsx("div",{className:"mt-4 rounded-2xl border bg-gray-50 px-3 py-2 text-sm text-center text-gray-500",children:"Please select a date and time slot to book."}):null,e.jsx("button",{type:"button",className:"w-full inline-flex items-center justify-center rounded-xl bg-[#003de6] text-white px-6 py-2.5 text-sm font-semibold shadow-md hover:bg-[#002db3] disabled:opacity-60 disabled:cursor-not-allowed",disabled:!F||!j,onClick:xe,style:{fontFamily:"Inter, sans-serif"},children:re?e.jsxs(e.Fragment,{children:["Book Now •"," ",e.jsx("span",{className:"ml-1 rupee",children:M(re)})]}):"Book Now"})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("p",{className:"text-gray-600",style:{fontFamily:"Inter, sans-serif"},children:"Slots and pricing may vary by date and time. Use the options above to choose your preferred session."}),e.jsx(Le,{to:"/attractions",className:"inline-flex items-center justify-center rounded-full border border-blue-100 text-blue-600 px-5 py-2.5 text-sm font-medium hover:bg-blue-50",style:{fontFamily:"Inter, sans-serif"},children:"Explore other attractions"})]}),e.jsx("p",{className:"text-[11px] text-gray-400 text-center",children:"We'll add this to your cart so you can add more attractions before checkout."})]})})]})}),e.jsx("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-[70] border-t border-gray-200 bg-white/95 backdrop-blur",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-3 pb-[calc(env(safe-area-inset-bottom)+12px)]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",children:$?"Offer price":"Base price"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900 rupee",children:M($?j||0:b||j||0)}),$?e.jsx("div",{className:"text-sm text-gray-400 line-through rupee",children:M(b||0)}):null,$?e.jsxs("div",{className:"text-xs font-semibold text-emerald-600",children:["Save ",me,"%"]}):null]}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[z," ticket",z>1?"s":""," • Total"," ",e.jsx("span",{className:"rupee font-semibold text-gray-800",children:M(ue||0)})]})]}),e.jsx("button",{type:"button",className:"shrink-0 inline-flex items-center justify-center rounded-xl bg-[#003de6] text-white px-5 py-2.5 text-sm font-semibold shadow-md hover:bg-[#002db3] disabled:opacity-60 disabled:cursor-not-allowed",disabled:!F||!j,onClick:xe,style:{fontFamily:"Inter, sans-serif"},children:"Book Now"})]})})})]}),be&&e.jsxs("div",{className:"fixed inset-0 z-[80] flex",onClick:()=>se(!1),children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"absolute bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 w-80 max-h-[70vh] overflow-y-auto",style:{top:q?`${q.top}px`:"50%",left:q?`${q.left-160}px`:"50%",transform:q?"none":"translate(-50%, -50%)"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Select Date"}),e.jsx("button",{type:"button",onClick:()=>se(!1),className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 transition-colors",children:e.jsx(ft,{size:18})})]}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(s=>{const n=g().add(s,"month"),o=n.startOf("month"),c=n.endOf("month"),k=o.day(),ae=c.date(),J=g();return e.jsxs("div",{className:"border border-gray-100 rounded-xl p-3 bg-white",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:n.format("MMMM YYYY")}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-xs",children:[["S","M","T","W","T","F","S"].map(p=>e.jsx("div",{className:"text-center text-gray-400 font-medium py-2",children:p},p)),Array.from({length:k}).map((p,Y)=>e.jsx("div",{className:"p-2"},`empty-${Y}`)),Array.from({length:ae}).map((p,Y)=>{const C=o.date(Y+1),G=C.format("YYYY-MM-DD"),U=C.isBefore(J,"day"),fe=a===G,st=C.isSame(J,"day");return e.jsx("button",{type:"button",onClick:()=>We(G),disabled:U,className:`
                              p-2 rounded-lg text-sm font-medium transition-all duration-200
                              ${U?"text-gray-300 cursor-not-allowed bg-gray-50":""}
                              ${fe?"bg-sky-600 text-white shadow-sm scale-105":""}
                              ${!U&&!fe?"hover:bg-sky-50 text-gray-700 hover:text-sky-700":""}
                              ${st&&!fe?"bg-sky-100 text-sky-700 font-semibold border border-sky-200":""}
                            `,children:Y+1},G)})]})]},s)})})]})]}),we!==null&&h.length>0&&e.jsx(ct,{items:h,initialIndex:we,onClose:()=>K(null)})]})}export{At as default};
