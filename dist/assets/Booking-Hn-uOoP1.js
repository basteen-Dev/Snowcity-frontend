import{j as e,h as bs,B as js,u as fe,r as u,D as M,G as vs,p as Ns,t as ws,q as St,F as E,H as ks,i as Ae,k as Se,I as Dt,E as _s,J as Ge,K as he,M as Pt,Q as Cs,S as Ms,T as Ts,U as As,V as Ss}from"./index-CNdOvwUA.js";import{i as Ye}from"./media-Ct2xuz47.js";import{a as It,c as Yt,d as $t,g as tt}from"./pricing-CIeFTiJd.js";import{f as Ot}from"./formatters-CmiLqhJj.js";import{c as O}from"./createLucideIcon-D7GIchwo.js";import{X as Xe}from"./x-BWu8kqUV.js";import{C as Et}from"./circle-alert-Z_jJIT5c.js";import{T as We}from"./ticket-BYx_I3BZ.js";import{C as Ds}from"./clock-Cy1_l83i.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Is=O("arrow-left",Ps);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],De=O("arrow-right",Ys);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],qt=O("check",$s);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Qe=O("chevron-right",Os);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],qs=O("globe",Es);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Ls=O("log-in",zs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Rs=O("mail",Fs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"M5 12h14",key:"1ays0h"}]],zt=O("minus",Ks);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Us=O("phone",Bs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Lt=O("plus",Hs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],X=O("shopping-bag",Vs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Xs=O("triangle-alert",Gs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Qs=O("user-plus",Ws);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Zs=O("user",Js);function ea({isOpen:t,onClose:i,onSignIn:c}){return t?e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl bg-white shadow-2xl dark:bg-neutral-900 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-8 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Xs,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-lg font-bold",children:"Session Expired"})]}),e.jsx("p",{className:"mt-2 text-sm opacity-90",children:"Your login session has expired. Please sign in again to continue booking."})]}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mb-6",children:"Your booking information is saved. Sign in again to complete your purchase without losing your selections."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:c,className:"w-full flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3 text-white font-semibold transition-all duration-200 hover:shadow-lg hover:from-blue-700 hover:to-blue-800 active:scale-95",children:[e.jsx(Ls,{className:"h-5 w-5"}),"Sign In Again"]}),e.jsx("button",{onClick:i,className:"w-full rounded-lg border border-gray-300 px-4 py-2 text-gray-700 font-medium transition-all hover:bg-gray-50 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",children:"Continue as Guest"})]})]})]})}):null}const W=t=>M(t).format("YYYY-MM-DD"),L=()=>M().format("YYYY-MM-DD"),ne=t=>(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.attraction_id)??null,ie=t=>(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.combo_id)??null,Ft=(t,i)=>String((t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.slot_id)??(t==null?void 0:t.combo_slot_id)??`${(t==null?void 0:t.start_time)||""}-${(t==null?void 0:t.end_time)||""}-${i}`),Rt=t=>{if(!t)return"";const[i,c]=t.split(":"),x=parseInt(i,10),p=x>=12?"PM":"AM";return`${x%12||12}:${c} ${p}`},Kt=t=>{if(t!=null&&t.label)return t.label;const i=Rt(t==null?void 0:t.start_time),c=Rt(t==null?void 0:t.end_time);return i&&c?`${i} - ${c}`:i||`Slot #${(t==null?void 0:t.id)||"?"}`},ta=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,Bt=[{code:"+91",label:"IN (+91)"},{code:"+1",label:"US (+1)"},{code:"+971",label:"AE (+971)"},{code:"+44",label:"UK (+44)"},{code:"+65",label:"SG (+65)"}],Ut=t=>Number((t==null?void 0:t.price)??(t==null?void 0:t.amount)??0),sa=t=>(t==null?void 0:t.id)??(t==null?void 0:t.addon_id)??(t==null?void 0:t._id)??null,Ht=t=>(t==null?void 0:t.name)??(t==null?void 0:t.title)??(t==null?void 0:t.label)??"Addon",aa=t=>{if(!t)return null;const i=[t,t==null?void 0:t.image_url,t==null?void 0:t.image,t==null?void 0:t.thumbnail,t==null?void 0:t.cover_image];for(const c of i){if(!c)continue;const x=typeof c=="string"?Ye(c):Ye(c);if(x)return x}return null};function ra(t){const i=()=>typeof window<"u"?window.matchMedia(t).matches:!1,[c,x]=u.useState(i);return u.useEffect(()=>{if(typeof window>"u")return;const p=window.matchMedia(t),v=_=>x(_.matches);return p.addEventListener("change",v),()=>p.removeEventListener("change",v)},[t]),c}const Je=()=>({itemType:"attraction",attractionId:"",comboId:"",date:L(),slotKey:"",qty:1}),na=()=>`sel_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`,Vt=(t,i=null)=>{if(!t)return i?`Combo ${i}`:"Combo";const c=t.name??t.title??t.combo_name??t.label??null;return c||(i?`Combo ${i}`:"Combo")},ge=t=>{if(!t)return null;if(typeof t=="string")return Ye(t);if(typeof t=="object"){const i=t.url||t.src||t.image_url||t.path;if(i)return Ye(i)}return null},Pe=t=>{var c;if(!t)return null;const i=[t.desktop_image_url,t.hero_image,t.banner_image,t.image_url,t.cover_image,t.thumbnail,(c=t.media)==null?void 0:c[0]];for(const x of i){const p=ge(x);if(p)return p}return null},Ie=t=>{var c;if(!t)return null;const i=[t.desktop_image_url,t.hero_image,t.banner_image,t.image_url,t.cover_image,(c=t.media)==null?void 0:c[0],t.attraction_1_image,t.attraction_2_image];for(const x of i){const p=ge(x);if(p)return p}return null},ia=t=>{if(!t)return[];const i=[];return t.attraction_1_image&&i.push(ge(t.attraction_1_image)),t.attraction_2_image&&i.push(ge(t.attraction_2_image)),i.length<2&&Array.isArray(t.media)&&t.media.forEach(c=>{const x=ge(c);x&&!i.includes(x)&&i.push(x)}),i.slice(0,2).filter(Boolean)},Y=t=>{const i=Number(t);return Number.isFinite(i)?i:0},st=t=>String(t||"").toLowerCase(),$e=(t,i)=>t==null||i==null?!1:String(t)===String(i),oa=t=>{if(typeof t=="boolean")return t;if(t==null)return!1;if(typeof t=="number")return t!==0;const i=String(t).trim().toLowerCase();return i?["true","1","yes","y"].includes(i)?!0:["false","0","no","n"].includes(i)?!1:!!t:!1},la=t=>t?Array.isArray(t)?t.reduce((i,c)=>i+Y(c),0):typeof t=="object"?Object.values(t).reduce((i,c)=>i+Y(c),0):0:0,Gt=t=>{if(!t)return 0;const i=tt(t);if(i>0)return i;const c=(t==null?void 0:t.combo_price)??(t==null?void 0:t.price)??(t==null?void 0:t.amount)??(t==null?void 0:t.total_price)??(t==null?void 0:t.starting_price)??(t==null?void 0:t.min_price)??(t==null?void 0:t.base_price)??0;if(Y(c)>0)return Y(c);const x=t==null?void 0:t.combo_attractions;if(Array.isArray(x)&&x.length){const _=x.reduce((C,g)=>C+Y((g==null?void 0:g.attraction_price)??(g==null?void 0:g.price)),0);if(_>0)return _}const p=la(t==null?void 0:t.attraction_prices);if(p>0)return p;const v=Y(t==null?void 0:t.attraction_1_price)+Y(t==null?void 0:t.attraction_2_price);return v>0?v:0},ca=t=>{const i=String(t||"").replace(/\D/g,"");return i.length>=10?i.slice(-10):i},da=(t,i)=>{if(!t)return!0;const c=M();if(M(i).format("YYYY-MM-DD")===c.format("YYYY-MM-DD")){const p=t.start_time||t.time||t.startTime;if(!p)return!0;const[v,_]=p.split(":"),C=parseInt(v)*60+parseInt(_),T=c.hour()*60+c.minute()+60;return C>=T}return!0},ma=t=>{if(!t)return!0;if(t.available===!1)return!1;const i=Number(t.capacity??t.available_capacity??t.available);if(Number.isNaN(i))return!0;if(t.booked!=null){const c=Number(t.booked);if(!Number.isNaN(c))return i-c>0}return i>0},at=t=>(t==null?void 0:t.id)??(t==null?void 0:t.offer_id)??(t==null?void 0:t.offerId)??(t==null?void 0:t.slug)??null,Xt=t=>(t==null?void 0:t.title)||(t==null?void 0:t.name)||`Offer ${at(t)??""}`.trim(),Ze=t=>(t==null?void 0:t.short_description)||(t==null?void 0:t.subtitle)||(t==null?void 0:t.description)||"",et=t=>{if(!t||typeof t!="string")return null;const[i="0",c="0"]=t.split(":"),x=Number(i),p=Number(c);return!Number.isFinite(x)||!Number.isFinite(p)?null:x*60+p},ua=(t={},i)=>{if(!t.day_type)return!0;const c=M(i).day(),x=String(t.day_type).toLowerCase();return x==="weekday"?c>=1&&c<=5:x==="weekend"?c===0||c===6:x==="custom"&&Array.isArray(t.specific_days)?t.specific_days.map(Number).includes(c):!0},xa=(t={},i=null)=>{if(!i)return!(t.slot_id!=null||Array.isArray(t.slot_ids)&&t.slot_ids.length||t.specific_time||t.time_from&&t.time_to);const c=[];if(t.slot_id!=null&&c.push(t.slot_id),Array.isArray(t.slot_ids)&&c.push(...t.slot_ids),t.target_slot_id!=null&&c.push(t.target_slot_id),c.length){const v=[i.slot_id,i.id,i._id,i.combo_slot_id].filter(C=>C!=null);if(!c.some(C=>v.some(g=>$e(C,g))))return!1}if(!(t.specific_time||t.time_from&&t.time_to))return!0;const p=i.start_time||i.time||i.startTime||null;if(t.specific_time&&p&&p.slice(0,5)!==String(t.specific_time).slice(0,5))return!1;if(t.time_from&&t.time_to&&p){const v=et(p),_=et(t.time_from),C=et(t.time_to);if(v==null||_==null||C==null||v<_||v>C)return!1}return!0},Qt=({rule:t,selectedDate:i,selectedSlot:c,itemType:x,itemId:p})=>{if(!t||!i)return!1;const v=M(i).format("YYYY-MM-DD"),_=st(t.target_type),C=st(x);if(_&&C&&_!==C)return!1;if(!oa(t.applies_to_all)){const T=[];if(t.target_id!=null&&T.push(t.target_id),Array.isArray(t.target_ids)&&T.push(...t.target_ids),!T.length||!T.some(P=>$e(P,p)))return!1}return!(t.specific_date&&v!==t.specific_date||Array.isArray(t.specific_dates)&&t.specific_dates.length&&!t.specific_dates.some(T=>M(T).format("YYYY-MM-DD")===v)||t.date_from&&v<t.date_from||t.date_to&&v>t.date_to||!ua(t,v)||!xa(t,c))},Wt=(t,i,c,x,p)=>!t||!i||!c?!1:(Array.isArray(t.rules)?t.rules:[]).filter(C=>Qt({rule:C,selectedDate:i,selectedSlot:c,itemType:x,itemId:p})).length>0,pa=(t,i,c)=>{const x=Number(i||0)*Number(c||1);if(!t||x<=0)return null;const p=computeOfferDiscount(t,x)||0;return{total:x,totalDiscount:p,final:Math.max(0,x-p)}};function ka(){var kt,_t,Ct,Mt,Tt;const t=bs(),i=js(),c=ra("(min-width: 768px)"),x=fe(s=>s.auth),p=!!(x!=null&&x.token),v=fe(s=>s.attractions),_=fe(s=>s.combos),C=fe(s=>s.addons),{step:g,contact:T,otp:z,coupon:P,creating:R,cart:Q}=fe(s=>s.bookings),S=(Q==null?void 0:Q.items)||[],F=S.length>0,Oe=Q==null?void 0:Q.activeKey,I=u.useMemo(()=>{if(!S.length)return null;if(Oe){const s=S.find(r=>r.key===Oe);if(s)return s}return S[0]},[S,Oe]),J=(I==null?void 0:I.key)||null;u.useRef(null);const rt=u.useRef(!1),[n,$]=u.useState(()=>Je()),[oe,Ee]=u.useState(null),[Jt,le]=u.useState(!1),[Zt,Z]=u.useState(!1),[es,qe]=u.useState("booking"),[ts,ss]=u.useState(null),[w,ee]=u.useState({status:"idle",error:null,offers:[],offerRules:[],activeOffer:null,activeRule:null,selectedOffer:null,selectedRule:null,offerPreview:null,loadingOffers:!1}),[be,nt]=u.useState("+91"),[ce,je]=u.useState(""),[K,ve]=u.useState({}),[te,de]=u.useState({status:"idle",items:[],error:null}),[Ne,as]=u.useState(""),[me,it]=u.useState(""),[B,ot]=u.useState(""),[U,ze]=u.useState(new Map),[lt,ct]=u.useState([]),[we,dt]=u.useState(!1),ke=v.items||[],_e=_.items||[],mt=u.useCallback(()=>{if(!Array.isArray(w.offers)||!I)return null;const s=st(I.item_type||(I.combo_id?"Combo":"Attraction")),r=I.attraction_id||I.combo_id||null,a=I.date||"",o=I.slot||{};let l=null;for(const d of w.offers){const f=Array.isArray(d.rules)?d.rules:[];for(const y of f)Qt({rule:y,selectedDate:a,selectedSlot:o,itemType:s,itemId:r})&&(!l||y.priority>l.rule.priority||y.priority===l.rule.priority&&y.rule_id<l.rule.rule_id)&&(l={offer:d,rule:y})}return l},[w.offers,I]);u.useEffect(()=>{const s=mt();ee(r=>({...r,activeOffer:(s==null?void 0:s.offer)||null,activeRule:(s==null?void 0:s.rule)||null}))},[mt]),u.useEffect(()=>{if(!w.activeOffer||!w.activeRule||!I){ee(d=>({...d,offerPreview:null}));return}const s=Number(I.price||I.unitPrice||0),r=w.activeRule.rule_discount_type||w.activeOffer.discount_type||"percent",a=Number(w.activeRule.rule_discount_value??w.activeOffer.discount_value??0);let o=s;r==="percent"?o=s*(1-a/100):r==="amount"&&(o=Math.max(0,s-a));const l=s-o;ee(d=>({...d,offerPreview:{basePrice:s,newPrice:o,savings:l,discountType:r,discountValue:a,offerTitle:w.activeOffer.title,ruleId:w.activeRule.rule_id}}))},[w.activeOffer,w.activeRule,I]),u.useEffect(()=>{if(T!=null&&T.phone&&!ce){const s=String(T.phone).replace(/\D/g,"");if(s.length>10){const r=Bt.find(a=>s.startsWith(a.code.replace("+","")));r?(nt(r.code),je(s.slice(r.code.length-1))):je(s.slice(-10))}else je(s)}},[]),u.useEffect(()=>{if(w.status!=="idle")return;let s=!1;return(async()=>{ee(a=>({...a,status:"loading",loadingOffers:!0}));try{const a=await Ae.get(Se.offers.list(),{params:{active:!0,limit:20}});if(s)return;const o=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];ee(l=>({...l,status:"succeeded",offers:o,loadingOffers:!1}))}catch{s||ee(a=>({...a,status:"failed",loadingOffers:!1}))}})(),()=>{s=!0}},[w.status]),u.useEffect(()=>{if(we||lt.length>0)return;let s=!1;return(async()=>{dt(!0);try{const a=await Ae.get(Se.coupons.list(),{params:{active:!0,limit:50}});if(s)return;const o=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];ct(o)}catch(a){console.error("Failed to fetch promos:",a),ct([])}finally{dt(!1)}})(),()=>{s=!0}},[]);const rs=u.useCallback(()=>{i("/")},[i]),[H]=vs(),ue=H.get("type"),se=H.get("attraction_id"),ae=H.get("combo_id"),Le=H.get("date"),Fe=H.get("slot"),Re=H.get("qty"),Ke=H.get("openDrawer");u.useEffect(()=>{v.status==="idle"&&t(Ns({active:!0,limit:100})),_.status==="idle"&&t(ws({active:!0,limit:100})),C.status==="idle"&&t(St({active:!0,limit:100}))},[t,v.status,_.status,C.status]),u.useEffect(()=>{g===3&&p&&t(E(4))},[g,p,t]),u.useEffect(()=>{const s=typeof document<"u"&&document.querySelector("footer"),r=s?s.style.display:null;return s&&(s.style.display="none"),()=>{s&&(s.style.display=r||"")}},[]),u.useEffect(()=>{!se&&!ae&&t(ks())},[t,se||"",ae||""]),u.useEffect(()=>{const s={};ue&&(s.itemType=ue),se&&(v.items||[]).some(a=>String(ne(a))===String(se))&&(s.attractionId=String(se),ue||(s.itemType="attraction")),ae&&(_.items||[]).some(a=>String(ie(a))===String(ae))&&(s.comboId=String(ae),ue||(s.itemType="combo")),Le&&(s.date=Le),Fe&&(s.slotKey=Fe),Re&&(s.qty=Math.max(1,Number(Re)||1)),Object.keys(s).length>0&&$(r=>({...r,...s}))},[ue||"",se||"",ae||"",Le||"",Fe||"",Re||"",Ke||"",v.items||[],_.items||[]]);const ut=u.useCallback(async({itemType:s,attractionId:r,comboId:a,date:o})=>{if(!o)return;const l=s==="combo"?a:r;if(l){de({status:"loading",items:[],error:null});try{if(s==="combo"){const d=await Ae.get(Se.combos.slots(l),{params:{date:W(o)}}),f=Array.isArray(d==null?void 0:d.data)?d.data:Array.isArray(d)?d:[];de({status:"succeeded",items:f,error:null})}else{const d=await Ae.get(Se.slots.list(),{params:{attraction_id:l,date:W(o)}}),f=Array.isArray(d==null?void 0:d.data)?d.data:Array.isArray(d)?d:[];de({status:"succeeded",items:f,error:null})}}catch(d){de({status:"failed",items:[],error:(d==null?void 0:d.message)||"Failed to load slots"})}}},[]);u.useEffect(()=>{const s=n.itemType,r=n.date,a=n.attractionId,o=n.comboId;(s==="combo"?o:a)&&r?($(d=>({...d,slotKey:n.slotKey||""})),ut({itemType:s,attractionId:a,comboId:o,date:r})):de({status:"idle",items:[],error:null})},[n.itemType||"",n.attractionId||"",n.comboId||"",n.date||"",ut]);const h=u.useMemo(()=>n.itemType==="attraction"?ke.find(s=>String(ne(s))===String(n.attractionId)):null,[ke||[],n.itemType||"",n.attractionId||""]),k=u.useMemo(()=>n.itemType==="combo"?_e.find(s=>String(ie(s))===String(n.comboId)):null,[_e||[],n.itemType||"",n.comboId||""]),m=u.useMemo(()=>{for(let s=0;s<te.items.length;s+=1){const r=te.items[s];if(Ft(r,s)===n.slotKey)return r;const a=[r==null?void 0:r.slot_id,r==null?void 0:r.id,r==null?void 0:r._id,r==null?void 0:r.combo_slot_id].filter(Boolean);if(n.slotKey&&a.map(String).includes(String(n.slotKey)))return r}return null},[te.items,n.slotKey]),D=u.useMemo(()=>{if(n.itemType==="combo"&&k){const s=Y(Gt(k)),r=Y(It(k)||s),a=(m==null?void 0:m.pricing)||{},o=(m==null?void 0:m.offer)||null,l=m?Yt(m,r):r,d=m?$t(m,s):s;let f=Y(a.base_price??l),y=Y(a.final_price??d);f||(f=l),y||(y=d);const A=W(n.date),b=ie(k);let N=o||null;if(!N&&(N=w.offers.find(j=>(j.rule_type==="happy_hour"||j.rule_type==="holiday"||j.rule_type==="special")&&Wt(j,A,m,"combo",b)),N)){const j=computeOfferDiscount(N,f||y);y=Math.max(0,(f||y)-j)}return{title:Vt(k,ie(k)),price:y,originalPrice:f||y,happyHourOffer:N,offerDescription:(N==null?void 0:N.description)||"",image:Ie(k),previewImages:ia(k)}}if(n.itemType==="attraction"&&h){const s=Y(tt(h)||(h==null?void 0:h.price)||(h==null?void 0:h.base_price)||(h==null?void 0:h.amount)||0),r=Y(It(h)||s),a=(m==null?void 0:m.pricing)||{},o=(m==null?void 0:m.offer)||null,l=m?Yt(m,r):r,d=m?$t(m,s):s;let f=Y(a.base_price??l),y=Y(a.final_price??d);f||(f=l),y||(y=d);const A=W(n.date),b=ne(h);let N=o||null;if(!N&&(N=w.offers.find(j=>(j.rule_type==="happy_hour"||j.rule_type==="holiday"||j.rule_type==="special")&&Wt(j,A,m,"attraction",b)),N)){const j=computeOfferDiscount(N,f||y);y=Math.max(0,(f||y)-j)}return{title:(h==null?void 0:h.name)||(h==null?void 0:h.title)||`Attraction #${ne(h)}`,price:y,originalPrice:f||y,happyHourOffer:N,offerDescription:(N==null?void 0:N.description)||"",image:Pe(h)}}return{title:"",price:0,originalPrice:0,offerDescription:""}},[n.itemType||"",k||null,h||null,m||null,n.date||"",w.offers||[]]);u.useEffect(()=>{Ke==="true"&&(n.itemType==="attraction"||n.itemType==="combo")&&D.title&&!rt.current&&(rt.current=!0,Z(!0))},[Ke,n.itemType,D.title]);const xe=Math.max(1,Number(n.qty)||1),ns=Number(D.price||0)*xe,V=!!(D.title&&n.date&&n.slotKey&&xe),is=u.useMemo(()=>S.reduce((s,r)=>s+Number(r.unitPrice||0)*Number(r.quantity||0),0),[S||[]]),Be=u.useMemo(()=>{let s=0;return U.forEach((r,a)=>{S.find(l=>l.key===a)&&r.forEach(l=>{s+=Number(l.price||0)*Number(l.quantity||0)})}),s},[U||new Map,S||[]]),Ue=is+Be,pe=Number(P.discount||0),xt=pe>0&&(P.code||((kt=P.data)==null?void 0:kt.code)),re=Math.max(0,Ue-pe);D.image||Pe(ke[0])||Ie(_e[0]);const os=u.useMemo(()=>J?U.get(J)||new Map:new Map,[U,J]),Ce=u.useCallback(()=>{if(!V)return!1;const s=n.itemType==="combo"?"Combo":"Attraction",r=n.itemType==="combo"?(m==null?void 0:m.combo_slot_id)??(m==null?void 0:m.id)??(m==null?void 0:m._id)??null:(m==null?void 0:m.slot_id)??(m==null?void 0:m.id)??(m==null?void 0:m._id)??null,a=(m==null?void 0:m.offer)||D.happyHourOffer||null,o={key:oe||na(),merge:!1,item_type:s,title:D.title,slotLabel:m?Kt(m):"",quantity:xe,booking_date:W(n.date),booking_time:(m==null?void 0:m.start_time)||(m==null?void 0:m.startTime)||(m==null?void 0:m.slot_start_time)||null,unitPrice:D.price||0,dateLabel:W(n.date),slot_id:s==="Attraction"?r:null,combo_slot_id:s==="Combo"?r:null,attraction_id:s==="Attraction"?ne(h):null,combo_id:s==="Combo"?ie(k):null,slot:m||null,attraction:h||null,combo:k||null,pricing:(m==null?void 0:m.pricing)||null,originalPrice:D.originalPrice||null,offer:a,offerDescription:D.offerDescription||(a==null?void 0:a.description)||""};return oe&&t(Dt(oe)),t(_s(o)),t(Ge(o.key)),Ee(null),$(Je()),ze(l=>{const d=new Map(l);return d.has(o.key)||d.set(o.key,new Map),d}),!0},[V,n||{},D||{},m||null,h||null,k||null,xe||1,oe||null,t]),ls=u.useCallback(()=>{if(!V){alert("Please select a date, a time slot, and quantity first.");return}const r=[n.itemType==="combo"?"Combo":"Attraction",n.itemType==="combo"?n.comboId:n.attractionId||"na",(n.itemType==="attraction",n.slotKey||"na"),n.date||"na"].join(":");S.some(o=>o.fingerprint===r)||Ce(),t(E(2))},[V,n,S,Ce,t,p]),He=()=>{if(g===1)if(F)t(E(2));else{if(!V){alert("Please select date, time slot and quantity.");return}Ce()&&t(E(2))}else g===2?t(E(p?4:3)):g===3&&(z.verified?t(E(4)):alert("Please verify OTP to continue."))},pt=()=>{g!==1&&(g===2?t(E(1)):g===3?t(E(2)):g===4&&t(E(p?2:3)))},yt=(s,r,a)=>{ze(o=>{const l=new Map(o),d=l.get(J)||new Map;return r<=0?d.delete(s):d.set(s,{addon_id:s,name:Ht(a),price:Ut(a),quantity:r}),l.set(J,d),l})},cs=async()=>{var s,r,a,o;if((R==null?void 0:R.status)!=="loading"){if(!p){le(!0);return}if(F)try{const l=((P==null?void 0:P.code)||"").trim()||void 0,d=B?Number(B):void 0,f=S.map(q=>{const G=q.item_type==="Combo",At=U.get(q.key),gs=At?Array.from(At.values()).filter(Te=>Number(Te.quantity)>0).map(Te=>({addon_id:Te.addon_id,quantity:Number(Te.quantity)})):[];return{item_type:G?"Combo":"Attraction",combo_id:G?q.combo_id:void 0,combo_slot_id:G?q.combo_slot_id:void 0,attraction_id:G?void 0:q.attraction_id,slot_id:G?void 0:q.slot_id,booking_date:q.booking_date,quantity:q.quantity,addons:gs,coupon_code:l,offer_id:d}}),y=await t(Cs(f)).unwrap(),A=((s=y==null?void 0:y.data)==null?void 0:s.order_id)||(y==null?void 0:y.order_id);if(!A)throw new Error("Order ID missing");const b=(T.email||((r=x==null?void 0:x.user)==null?void 0:r.email)||"").trim(),N=ca(T.phone||((a=x==null?void 0:x.user)==null?void 0:a.phone)||""),j=await t(Ms({bookingId:A,email:b,mobile:N,amount:re})).unwrap();j!=null&&j.redirectUrl?window.location.assign(j.redirectUrl):alert("Payment initiation failed.")}catch(l){(l==null?void 0:l.status)===401||((o=l==null?void 0:l.response)==null?void 0:o.status)===401?le(!0):alert(`Payment failed: ${l.message}`)}}},ft=s=>{t(Dt(s)),ze(r=>{const a=new Map(r);return a.delete(s),a}),oe===s&&(Ee(null),$(Je()))},Ve=s=>{const r=s.item_type==="Combo"?"combo":"attraction";$({itemType:r,attractionId:s.attraction_id?String(s.attraction_id):"",comboId:s.combo_id?String(s.combo_id):"",date:s.booking_date||L(),slotKey:"",qty:Number(s.quantity||1)}),Ee(s.key),t(Ge(s.key)),t(E(1)),Z(!0)},ds=s=>{const a=s.target.value.replace(/\D/g,"").slice(0,10);je(a),a.length===10&&(ve(o=>({...o,phone:void 0})),t(he({phone:`${be}${a}`})))},ht=async()=>{const s={},r=(T.email||"").trim();if(ta.test(r)||(s.email="Please enter a valid email address"),ce.length!==10&&(s.phone="Phone number must be exactly 10 digits"),Object.keys(s).length>0){ve(s);return}ve({});const a=`${be}${ce}`;t(he({email:r,phone:a}));try{await t(Ts({email:r,phone:a})).unwrap()}catch(o){alert((o==null?void 0:o.message)||"Failed to send OTP")}},ms=async()=>{if(!Ne||Ne.length<4)return alert("Enter the full OTP code");await t(As({otp:Ne})).unwrap().then(()=>t(E(3))).catch(s=>alert((s==null?void 0:s.message)||"OTP verification failed"))},us=async()=>{me&&await t(Ss({code:me,total_amount:Math.max(0,Ue),onDate:n.date||W(new Date)})).unwrap().then(()=>t(Pt(me))).catch(()=>{})},xs=()=>e.jsxs("div",{className:"flex items-center justify-between mb-1 md:mb-2 px-4",children:[[{n:1,l:"Select",icon:X},{n:2,l:"Extras",icon:We},{n:3,l:"Verify",icon:Ds},{n:4,l:"Pay",icon:qt}].map(s=>{if(p&&s.n===3)return null;const r=g>s.n||p&&s.n===3,a=g===s.n,o=r||p&&s.n===3,l=s.icon;return e.jsxs("div",{className:"flex flex-col items-center relative z-10 group",children:[e.jsx("div",{className:`w-11 h-11 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300 border-2 shadow-sm ${a?"bg-gradient-to-br from-sky-600 to-sky-700 border-sky-600 text-white scale-110 ring-4 ring-sky-100":o?"bg-gradient-to-br from-emerald-600 to-emerald-700 border-emerald-600 text-white shadow-md":"bg-white border-gray-200 text-gray-300 shadow-sm"}`,children:o&&!a?e.jsx(qt,{size:18,strokeWidth:3}):e.jsx(l,{size:18})}),e.jsx("span",{className:`text-[10px] mt-2 font-bold uppercase tracking-widest ${a?"text-sky-600":o?"text-emerald-600":"text-gray-400"}`,children:s.l})]},s.n)}),e.jsx("div",{className:"absolute left-8 right-8 top-[22px] h-[3px] bg-gradient-to-r from-sky-100 to-sky-200 -z-0 overflow-hidden rounded-full",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sky-600 to-sky-500 transition-all duration-500 ease-out shadow-sm",style:{width:`${(g-1)/(p?2:3)*100}%`}})})]}),ps=()=>{const r=n.itemType==="attraction"?ke:_e;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-sky-50 p-1 rounded-xl inline-flex border border-sky-100",children:["attraction","combo"].map(a=>e.jsx("button",{onClick:()=>{$(o=>({...o,itemType:a,attractionId:"",comboId:"",slotKey:""}))},className:`px-6 py-2 text-sm font-semibold rounded-lg capitalize transition-all duration-200 ${n.itemType===a?"bg-white text-sky-700 shadow-sm ring-1 ring-black/5":"text-gray-600 hover:text-gray-900"}`,children:a==="attraction"?"Attractions":"Combos"},a))})}),r.length===0?e.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-dashed border-gray-200 px-4 py-6 text-center text-sm text-gray-500",children:n.itemType==="combo"?"No combos available":"No attractions available"}):r.map(a=>{const o=n.itemType==="attraction"?ne(a):ie(a),l=String(n.itemType==="attraction"?n.attractionId:n.comboId)===String(o),d=n.itemType==="combo"?Number(Gt(a)||0):Number(tt(a)||a.price||a.base_price||a.amount||0),f=n.itemType==="attraction"?a.title||a.name:Vt(a),y=n.itemType==="combo"?Ie(a):Pe(a),A=()=>{const b=n.itemType==="combo",N=S.find(j=>b?j.item_type==="Combo"&&$e(j.combo_id,o):(j.item_type==="Attraction"||j.item_type===void 0)&&$e(j.attraction_id,o));if(N){Ve(N);return}$(j=>({...j,itemType:n.itemType,attractionId:n.itemType==="attraction"?String(o):"",comboId:n.itemType==="combo"?String(o):"",slotKey:""})),qe("booking"),Z(!0)};return e.jsxs("div",{className:`bg-white rounded-3xl shadow-sm border px-4 sm:px-6 py-4 sm:py-5 flex items-center justify-between gap-4 transition-all ${l?"border-sky-400 shadow-md":"border-gray-100 hover:border-sky-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-28 h-28 rounded-2xl overflow-hidden border border-gray-100 bg-sky-50 shrink-0",children:y?e.jsx("img",{src:y,alt:f,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sky-400",children:e.jsx(X,{})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1 truncate",children:f}),e.jsx("p",{className:"text-xs text-gray-500",children:"Great for families • Flexible slots • Instant confirmation"}),e.jsxs("button",{type:"button",onClick:()=>{$(b=>({...b,itemType:n.itemType,attractionId:n.itemType==="attraction"?String(o):"",comboId:n.itemType==="combo"?String(o):"",slotKey:""})),ss(y||null),qe("details"),Z(!0)},className:"inline-flex items-center gap-1 text-xs sm:text-sm font-semibold text-sky-700 hover:text-sky-900 mt-2",children:["View details",e.jsx(Qe,{size:14})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 sm:gap-3",children:[e.jsx("div",{className:"text-right text-xs text-gray-500 uppercase tracking-wide",children:"From"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-sky-700 tabular-nums",children:["₹",d||0]})}),e.jsx("button",{type:"button",onClick:A,className:`px-6 py-2.5 sm:py-3 rounded-full text-white text-sm font-semibold shadow-md active:scale-[0.98] transition-all ${l?"bg-sky-700":"bg-sky-600 hover:bg-sky-700"}`,children:l?"Selected":"Select"})]})]},o)})]})},ys=()=>w.loadingOffers||!w.offers.length?null:e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"Available Offers"}),B&&e.jsx("button",{type:"button",onClick:()=>ot(""),className:"text-xs font-medium text-sky-700 hover:underline",children:"Remove"})]}),e.jsx("div",{className:"space-y-3",children:w.offers.map(s=>{const r=String(at(s));if(!r)return null;const a=pa(s,D.price||0,xe);return e.jsxs("label",{className:`flex items-start gap-3 rounded-2xl border px-3 py-3 cursor-pointer transition-all duration-200 ${String(B)===r?"border-sky-500 bg-sky-50 shadow-sm":"hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"selected-offer",className:"mt-1",checked:String(B)===r,onChange:()=>ot(r)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:Xt(s)}),Ze(s)?e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 line-clamp-2",children:Ze(s)}):null]}),e.jsx("span",{className:"text-xs font-semibold text-sky-700 bg-sky-50 px-2 py-1 rounded-full",children:a?`Save ₹${a.totalDiscount.toFixed(0)}`:"No discount"})]}),a&&a.totalDiscount>0&&e.jsxs("p",{className:"text-xs text-emerald-600 mt-1",children:["Save up to ₹",a.totalDiscount.toFixed(0)," with this offer"]})]})]},`offer-${r}`)})})]}),gt=()=>{$(s=>({...s,date:L(),slotKey:""}))},bt=()=>{$(s=>({...s,date:M().add(1,"day").format("YYYY-MM-DD"),slotKey:""}))},[jt,Me]=u.useState(!1),[fs,vt]=u.useState(null),ye=u.useMemo(()=>null,[fs,jt]),Nt=s=>{s.preventDefault(),s.stopPropagation(),vt(s.currentTarget),Me(!0)},hs=s=>{$(r=>({...r,date:s,slotKey:""})),Me(!1)},wt=s=>{if(!s)return"All Days";const r=M(s);return s===L()||s===M().add(1,"day").format("YYYY-MM-DD")?"All Days":r.format("D MMM")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 to-white font-inter",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-3 lg:px-0 pb-24 lg:pb-20 pt-20 md:pt-24",children:[e.jsxs("div",{className:"mt-4 md:mt-6 bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-sky-100",children:[e.jsxs("div",{className:"px-4 md:px-6 pt-3 md:pt-4 pb-2 md:pb-3 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900",children:g===1?"Select tickets":g===2?"Customize Add-ons":g===3?"Verify OTP":"Checkout"}),e.jsx("button",{onClick:rs,className:"p-2 hover:bg-sky-50 rounded-full text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Xe,{size:22})})]}),e.jsx("div",{className:"relative pb-2",children:e.jsx(xs,{})})]}),e.jsxs("div",{className:"mt-2 md:mt-4",children:[g===1&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mb-1",children:[e.jsx("button",{type:"button",onClick:gt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date===L()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),e.jsx("button",{type:"button",onClick:bt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date===M().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:Nt,ref:vt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date&&n.date!==""&&n.date!==L()&&n.date!==M().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:n.date&&n.date!==L()&&n.date!==M().add(1,"day").format("YYYY-MM-DD")?wt(n.date):"All Days"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-500 ml-1",children:"Change date/time in details panel"})]}),e.jsx(ps,{})]}),e.jsx("div",{className:"lg:sticky lg:top-28",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),F?e.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:S.map(s=>{var r,a,o,l,d,f;return e.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((r=s.meta)==null?void 0:r.title)||(s.item_type==="combo"?((a=s.combo)==null?void 0:a.title)||((o=s.combo)==null?void 0:o.name)||((l=s.combo)==null?void 0:l.combo_name)||`Combo #${s.combo_id}`:((d=s.attraction)==null?void 0:d.title)||((f=s.attraction)==null?void 0:f.name)||`Attraction #${s.attraction_id}`)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) •"," ",s.dateLabel||M(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` • ${s.slotLabel}`:""]}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>Ve(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>ft(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["₹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:e.jsx(X,{className:"text-sky-600"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),e.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["₹",re.toFixed(0)]})]}),e.jsxs("button",{type:"button",disabled:!F,onClick:He,className:`w-full flex items-center justify-center gap-2 rounded-full px-6 py-3 text-sm font-semibold transition-all ${F?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx("span",{children:"Continue"}),e.jsx(De,{size:18})]})]})]})})]}),g===2&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start mt-4",children:[e.jsxs("div",{className:"space-y-6",children:[S.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:S.map(s=>{var r,a,o,l,d,f;return e.jsx("button",{onClick:()=>t(Ge(s.key)),className:`px-4 py-2 rounded-full border text-sm font-medium transition-all ${s.key===J?"bg-sky-600 text-white border-sky-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-sky-200"}`,children:s.title||((r=s.meta)==null?void 0:r.title)||(s.item_type==="combo"?((a=s.combo)==null?void 0:a.title)||((o=s.combo)==null?void 0:o.name)||((l=s.combo)==null?void 0:l.combo_name)||`Combo #${s.combo_id}`:((d=s.attraction)==null?void 0:d.title)||((f=s.attraction)==null?void 0:f.name)||`Attraction #${s.attraction_id}`)||"Item"},s.key)})}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Add-ons"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enhance your experience with optional extras"})]}),e.jsx("button",{onClick:()=>t(St({active:!0,limit:100})),className:"text-xs font-semibold text-sky-700 hover:underline",children:"Refresh"})]}),C.status==="loading"?e.jsx("div",{className:"text-center py-10 text-gray-500 text-sm",children:"Loading add-ons..."}):e.jsx("div",{className:"space-y-4",children:(C.items||[]).map(s=>{var f;const r=sa(s),a=Ut(s),o=Ht(s),l=aa(s),d=Number(((f=os.get(r))==null?void 0:f.quantity)||0);return e.jsxs("div",{className:"flex gap-4 items-center border border-gray-200 rounded-2xl p-4 hover:border-sky-200 transition-all",children:[l?e.jsx("img",{src:l,alt:o,className:"w-16 h-16 rounded-xl object-cover border border-gray-100"}):e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center text-gray-400",children:e.jsx(X,{})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",children:o}),e.jsx("div",{className:"text-sm text-gray-500 tabular-nums",children:Ot(a)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>yt(r,Math.max(0,d-1),s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 transition",children:e.jsx(zt,{size:16})}),e.jsx("span",{className:"w-6 text-center font-semibold text-gray-800 tabular-nums",children:d}),e.jsx("button",{onClick:()=>yt(r,d+1,s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 bg-sky-600 text-white shadow",children:e.jsx(Lt,{size:16})})]})]},r)})})]})]}),e.jsx("div",{className:"lg:sticky lg:top-28",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),F?e.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:S.map(s=>{var o,l,d,f,y,A;const r=U.get(s.key)||new Map,a=Array.from(r.values()).filter(b=>Number(b.quantity)>0);return e.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((o=s.meta)==null?void 0:o.title)||(s.item_type==="combo"?((l=s.combo)==null?void 0:l.title)||((d=s.combo)==null?void 0:d.name)||((f=s.combo)==null?void 0:f.combo_name)||`Combo #${s.combo_id}`:((y=s.attraction)==null?void 0:y.title)||((A=s.attraction)==null?void 0:A.name)||`Attraction #${s.attraction_id}`)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) • ",s.dateLabel||M(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` • ${s.slotLabel}`:""]}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>Ve(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>ft(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]}),a.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Extras"}),e.jsx("div",{className:"space-y-1",children:a.map(b=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"truncate",children:[b.name," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["x",b.quantity]})]}),e.jsxs("div",{className:"tabular-nums",children:["₹",(Number(b.price||0)*Number(b.quantity||0)).toFixed(0)]})]},b.addon_id))})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["₹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:e.jsx(X,{className:"text-sky-600"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),e.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["₹",re.toFixed(0)]})]}),e.jsxs("button",{type:"button",disabled:!F,onClick:He,className:`w-full flex items-center justify-center gap-2 rounded-full px-6 py-3 text-sm font-semibold transition-all ${F?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx("span",{children:"Continue"}),e.jsx(De,{size:18})]})]})]})})]}),g===3&&!p&&e.jsxs("div",{className:"space-y-6 max-w-md mx-auto animate-in fade-in slide-in-from-right-8 duration-300 mt-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-sky-50 text-sky-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Qs,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Guest Details"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Enter your details to receive tickets via Email & SMS."})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Full Name"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Zs,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"John Doe",className:"w-full pl-11 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 focus:bg-white outline-none transition-all font-medium",value:T.name,onChange:s=>t(he({name:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Rs,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"name@example.com",type:"email",className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium ${K.email?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:T.email,onChange:s=>{t(he({email:s.target.value})),K.email&&ve(r=>({...r,email:void 0}))}})]}),K.email&&e.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[e.jsx(Et,{size:12})," ",K.email]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Mobile Number"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative w-32",children:[e.jsx("div",{className:"absolute left-3 top-3.5 z-10 pointer-events-none",children:e.jsx(qs,{size:18,className:"text-gray-400"})}),e.jsx("select",{className:"w-full pl-10 pr-8 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none appearance-none font-medium text-sm",value:be,onChange:s=>nt(s.target.value),children:Bt.map(s=>e.jsx("option",{value:s.code,children:s.code},s.code))}),e.jsx(Qe,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 rotate-90 pointer-events-none"})]}),e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Us,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"98765 43210",type:"tel",maxLength:10,className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium tracking-wide ${K.phone?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:ce,onChange:ds})]})]}),K.phone&&e.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[e.jsx(Et,{size:12})," ",K.phone]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",required:!0,checked:T.whatsapp_consent||!1,onChange:s=>t(he({whatsapp_consent:s.target.checked})),className:"w-4 h-4 text-sky-600 bg-gray-100 border-gray-300 rounded focus:ring-sky-500 focus:ring-2"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"I agree to receive WhatsApp notifications *"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"We'll send booking confirmations and updates via WhatsApp"})]}),z.sent?e.jsxs("div",{className:"mt-6 bg-sky-50 border border-sky-100 p-5 rounded-2xl animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("p",{className:"text-sm text-sky-800 mb-3 font-medium",children:["Enter OTP sent to ",be," ",ce]}),e.jsxs("div",{className:"flex gap-3 flex-col sm:flex-row",children:[e.jsx("input",{placeholder:"XXXXXX",className:"flex-1 p-3.5 text-center tracking-[0.5em] font-bold text-xl border-2 border-sky-200 rounded-xl focus:border-sky-600 focus:ring-4 focus:ring-sky-100 outline-none bg-white transition-all",maxLength:6,value:Ne,onChange:s=>as(s.target.value)}),e.jsx("button",{onClick:ms,disabled:z.status==="loading",className:"bg-sky-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-sky-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 w-full sm:w-auto text-sm sm:text-base",children:z.status==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):z.verified?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Verified"]}):"Verify"})]}),e.jsx("button",{onClick:ht,className:"text-xs text-sky-700 font-medium mt-3 hover:underline",children:"Resend Code"})]}):e.jsx("button",{onClick:ht,disabled:z.status==="loading",className:"w-full bg-sky-700 text-white py-3 rounded-xl font-bold text-base shadow-lg hover:bg-sky-800 transition-all disabled:opacity-70 flex items-center justify-center gap-2 mt-4",children:z.status==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Sending..."})]}):"Send OTP Verification"})]})]}),g===4&&e.jsxs("div",{className:"space-y-6 max-w-lg mx-auto animate-in fade-in slide-in-from-right-8 duration-300 mt-4 pb-20",children:[e.jsx(ys,{}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-4 text-lg flex items-center gap-2",children:[e.jsx(X,{className:"text-sky-600",size:20}),"Booking Summary"]}),xt&&e.jsxs("div",{className:"mb-4 rounded-xl bg-emerald-50 border border-emerald-100 p-3 text-sm text-emerald-700",children:[e.jsxs("div",{className:"font-semibold text-emerald-800",children:["Coupon ",String(P.code||((_t=P.data)==null?void 0:_t.code)).toUpperCase()," applied"]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 text-emerald-700",children:[e.jsx("span",{children:((Ct=P.data)==null?void 0:Ct.description)||"Discount applied successfully"}),e.jsxs("span",{className:"font-bold tabular-nums",children:["-₹",pe.toFixed(0)]})]})]}),B&&(()=>{const s=w.offers.find(r=>String(at(r))===String(B));return s?e.jsxs("div",{className:"mb-4 rounded-xl bg-green-50 border border-green-100 p-3 text-sm text-green-700",children:[e.jsxs("div",{className:"font-semibold text-green-800",children:["Offer Applied: ",Xt(s)]}),e.jsxs("div",{className:"mt-1 text-green-600",children:[Ze(s),s.rule_type==="buy_x_get_y"&&s.buy_qty&&s.get_qty&&e.jsxs("div",{className:"mt-1",children:["Buy ",s.buy_qty," Get ",s.get_qty,s.get_discount_type==="percent"&&s.get_discount_value&&e.jsxs("span",{children:[" (",s.get_discount_value,"% off)"]}),s.get_discount_type==="amount"&&s.get_discount_value&&e.jsxs("span",{children:[" (",Ot(s.get_discount_value)," off)"]}),!s.get_discount_value&&e.jsx("span",{children:" Free"})]})]})]}):null})(),e.jsxs("div",{className:"mb-4 space-y-2 max-h-40 overflow-y-auto custom-scrollbar pr-2",children:[S.map(s=>{var o,l,d,f,y,A;const r=U.get(s.key)||new Map,a=Array.from(r.values()).filter(b=>Number(b.quantity)>0);return e.jsxs("div",{className:"text-sm py-2 border-b border-dashed border-gray-100 last:border-0",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsxs("div",{className:"text-gray-700",children:[e.jsxs("span",{className:"font-bold text-gray-900",children:[s.quantity,"x"]})," ",s.title||((o=s.meta)==null?void 0:o.title)||(s.item_type==="combo"?((l=s.combo)==null?void 0:l.title)||((d=s.combo)==null?void 0:d.name)||((f=s.combo)==null?void 0:f.combo_name)||`Combo #${s.combo_id}`:((y=s.attraction)==null?void 0:y.title)||((A=s.attraction)==null?void 0:A.name)||`Attraction #${s.attraction_id}`),e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:[s.dateLabel||M(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` • ${s.slotLabel}`:""]})]}),e.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["₹",s.unitPrice*s.quantity]})]}),a.length>0&&e.jsx("div",{className:"ml-1 mt-1.5 pl-2 border-l-2 border-sky-200 space-y-1",children:a.map(b=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{className:"text-gray-600",children:["• ",b.name," ",e.jsxs("span",{className:"text-gray-400",children:["x",b.quantity]})]}),e.jsxs("span",{className:"font-medium text-gray-700 tabular-nums",children:["₹",(Number(b.price||0)*Number(b.quantity||0)).toFixed(0)]})]},b.addon_id))})]},s.key)}),Be>0&&e.jsxs("div",{className:"flex justify-between text-sm py-2 border-t border-gray-100 pt-3",children:[e.jsx("div",{className:"text-gray-600 font-medium",children:"Extras / Add-ons"}),e.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["₹",Be]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl space-y-2 text-sm mt-2",children:[e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Subtotal (with offers)"})," ",e.jsxs("span",{className:"tabular-nums",children:["₹",Ue]})]}),pe>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-medium",children:[e.jsxs("span",{children:["Coupon (",String(P.code||((Mt=P.data)==null?void 0:Mt.code)).toUpperCase(),")"]}),e.jsxs("span",{className:"tabular-nums",children:["-₹",pe.toFixed(0)]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 flex justify-between items-center mt-2",children:[e.jsx("span",{className:"font-bold text-gray-800 text-lg",children:"Total Payable"}),e.jsxs("span",{className:"font-bold text-2xl text-sky-700 tabular-nums",children:["₹",re]})]})]})]}),e.jsx("div",{className:"space-y-3 border-t border-gray-200 pt-4",children:xt?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Current Promo Code"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex-1 px-4 py-3 border border-green-200 rounded-xl bg-green-50 text-sm font-bold text-green-700 uppercase tracking-wider",children:["✓ ",String(P.code||((Tt=P.data)==null?void 0:Tt.code)).toUpperCase()," Applied"]}),e.jsx("button",{onClick:()=>{it(""),t(Pt(""))},className:"px-4 py-3 rounded-xl border border-red-200 bg-red-50 text-red-600 text-sm font-semibold hover:bg-red-100 transition-colors",title:"Remove promo code",children:"Remove"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Apply Promo Code"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(We,{size:18,className:"absolute left-3 top-3 text-gray-400 pointer-events-none"}),e.jsxs("select",{className:"w-full pl-10 pr-20 p-3 border border-gray-200 rounded-xl text-sm uppercase focus:ring-2 focus:ring-sky-500 outline-none font-bold tracking-wider appearance-none bg-white cursor-pointer disabled:bg-gray-50 disabled:text-gray-400",value:me,onChange:s=>it(s.target.value),disabled:we,children:[e.jsx("option",{value:"",children:we?"Loading promos...":"Select a promo code"}),lt.map(s=>e.jsxs("option",{value:s.code,children:[s.code," ",s.discount?`(${s.discount}% off)`:""]},s.id||s.code))]}),e.jsx("button",{onClick:us,disabled:!me||we,className:"absolute right-1 top-1 bottom-1 px-4 rounded-lg bg-sky-600 text-white text-xs font-bold tracking-wide hover:bg-sky-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"APPLY"})]})})]})})]})]}),(g!==1||!c)&&!(g===2&&c)&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 md:px-0 py-3 md:py-4 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] z-30",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex gap-3 items-center",children:[!c&&g>1&&e.jsx("button",{onClick:pt,className:"md:hidden p-3 rounded-xl border border-gray-200 text-gray-700 hover:border-gray-300 active:scale-[0.95] transition-all flex items-center justify-center",title:"Go back",children:e.jsx(Is,{size:20})}),e.jsxs("div",{className:`flex-1 ${c?"hidden":""}`,children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Total"}),e.jsxs("div",{className:"text-xl font-bold text-gray-900 tabular-nums",children:["₹",re]})]}),g>1&&e.jsx("button",{onClick:pt,className:`px-6 py-3 rounded-xl border border-gray-200 text-gray-700 font-semibold hover:border-gray-300 active:scale-[0.98] transition-all ${c?"":"hidden md:block"}`,children:"Back"}),e.jsx("button",{onClick:g===4?cs:He,disabled:g===3&&!p&&!z.verified||(R==null?void 0:R.status)==="loading",className:`bg-gradient-to-r from-sky-600 to-sky-700 text-white py-3 px-8 rounded-xl font-bold shadow-lg hover:shadow-xl active:scale-[0.98] transition-all flex items-center justify-center gap-3 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed text-sm md:text-base ${c?"":"md:w-auto"}`,children:g===4?R.status==="loading"?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 w-5 h-5 border-2 border-transparent border-b-white/50 rounded-full animate-spin animation-delay-150"})]}),e.jsx("span",{className:"animate-pulse",children:"Processing..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2 group",children:[e.jsx("div",{className:"p-1.5 bg-white/20 rounded-lg transition-all duration-300 group-hover:bg-white/30",children:e.jsx(We,{size:18,className:"text-white"})}),e.jsxs("span",{className:"font-semibold",children:["Pay ₹",re]}),e.jsx("div",{className:"w-0 group-hover:w-5 overflow-hidden transition-all duration-300",children:e.jsx(De,{size:16,className:"text-white"})})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2 group",children:[e.jsx("span",{className:"font-semibold",children:"Continue"}),e.jsx(De,{size:20,className:"transition-transform duration-300 group-hover:translate-x-1"})]})})]})})]})}),Zt&&D.title&&e.jsxs("div",{className:"fixed inset-0 z-50 flex justify-end items-end md:items-stretch bg-black/40 backdrop-blur-[2px] md:bg-black/20",children:[e.jsx("div",{className:"flex-1 hidden md:block",onClick:()=>Z(!1)}),e.jsxs("div",{className:"w-full md:w-1/2 bg-white rounded-t-3xl md:rounded-l-3xl shadow-2xl flex flex-col transform translate-y-0 transition-all h-[90vh] md:h-screen max-h-[90vh] md:max-h-screen md:mt-0 mt-16",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between px-4 sm:px-6 pt-4 pb-2 border-b border-gray-100 bg-white rounded-t-3xl md:rounded-tl-3xl sm:rounded-tl-3xl",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 pr-3 truncate",children:D.title}),e.jsx("button",{type:"button",onClick:()=>Z(!1),className:"p-2 rounded-full hover:bg-gray-100 text-gray-500 flex-shrink-0",children:e.jsx(Xe,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-4 py-4 space-y-4",children:es==="details"?e.jsxs("div",{className:"space-y-4",children:[(()=>{const s=ts||D.image||(n.itemType==="combo"?Ie(k):Pe(h));return s?e.jsxs("div",{className:"relative rounded-2xl overflow-hidden border border-gray-100 shadow-sm",children:[e.jsx("img",{src:s,alt:D.title,className:"w-full h-56 sm:h-64 object-cover"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 px-4 py-2 bg-gradient-to-t from-black/60 to-transparent text-white text-sm font-semibold",children:D.title})]}):null})(),e.jsx("div",{className:"text-sm text-gray-700",children:((n.itemType==="combo"?(k==null?void 0:k.description)||(k==null?void 0:k.short_description)||(k==null?void 0:k.summary)||"":(h==null?void 0:h.description)||(h==null?void 0:h.short_description)||(h==null?void 0:h.summary)||(h==null?void 0:h.about)||"")||"").split(`
`).map((r,a)=>e.jsx("p",{className:"mb-2",children:r},a))}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",onClick:()=>qe("booking"),className:"w-full px-4 py-3 rounded-xl bg-sky-600 text-white font-semibold",children:"Book this"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:gt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date===L()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),e.jsx("button",{type:"button",onClick:bt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date===M().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:Nt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date&&n.date!==""&&n.date!==L()&&n.date!==M().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:wt(n.date)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Time slot"}),e.jsx("div",{className:"relative",children:te.status==="loading"?e.jsx("div",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-sky-600 rounded-full animate-spin"}),"Loading slots..."]})}):te.status==="failed"?e.jsx("div",{className:"w-full p-3.5 bg-red-50 border border-red-200 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-red-600 text-sm",children:"Failed to load slots"})}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none text-sm font-medium appearance-none cursor-pointer disabled:bg-gray-100 disabled:text-gray-400 transition-all hover:border-gray-300",value:n.slotKey,onChange:s=>$(r=>({...r,slotKey:s.target.value})),disabled:!n.attractionId&&!n.comboId,children:[e.jsx("option",{value:"",children:!n.attractionId&&!n.comboId?"Select a ticket above first":"Select a time slot"}),te.items.map((s,r)=>{const a=Ft(s,r),o=ma(s),l=da(s,n.date),d=!o||!l;return e.jsxs("option",{value:a,disabled:d,children:[Kt(s)," ",o?l?"":"(Not Available)":"(Full)"]},a)})]}),e.jsx(Qe,{size:16,className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 rotate-90"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 rounded-xl p-1.5 border border-gray-200 w-fit",children:[e.jsx("button",{onClick:()=>$(s=>({...s,qty:Math.max(1,s.qty-1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-white text-gray-600 shadow-sm hover:text-sky-700 active:scale-95 transition",children:e.jsx(zt,{size:16})}),e.jsx("span",{className:"font-bold text-lg w-8 text-center text-gray-800 tabular-nums",children:n.qty}),e.jsx("button",{onClick:()=>$(s=>({...s,qty:Math.max(1,s.qty+1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-95 transition",children:e.jsx(Lt,{size:16})})]})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-x-0 top-0 h-4 bg-gradient-to-t from-white via-white/70 to-transparent pointer-events-none"}),e.jsxs("div",{className:"px-4 sm:px-6 py-3 border-t border-gray-100 bg-white flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",children:"Subtotal"}),e.jsxs("div",{className:"text-lg font-bold text-sky-700 tabular-nums",children:["₹",ns.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Ce,disabled:!V,className:"inline-flex items-center px-4 py-2 rounded-full border border-gray-200 text-xs font-semibold text-gray-700 hover:border-sky-300 disabled:opacity-40 disabled:cursor-not-allowed",children:"Add to order"}),e.jsxs("button",{type:"button",onClick:ls,disabled:!V,className:"flex items-center gap-2 px-4 py-2.5 rounded-full bg-sky-600 text-white text-sm font-semibold shadow-md hover:bg-sky-700 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(X,{size:18}),e.jsx("span",{children:"Buy"})]})]})]})]})]})]}),Jt&&e.jsx(ea,{onClose:()=>le(!1),onSignIn:()=>{le(!1),t(E(3))},onContinueAsGuest:()=>{le(!1),t(E(3))}}),jt&&e.jsxs("div",{className:"fixed inset-0 z-[80] flex",onClick:()=>Me(!1),children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"absolute bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 w-80 max-h-[70vh] overflow-y-auto",style:{top:ye?`${ye.top}px`:"50%",left:ye?`${ye.left-160}px`:"50%",transform:ye?"none":"translate(-50%, -50%)"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Select Date"}),e.jsx("button",{onClick:()=>Me(!1),className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 transition-colors",children:e.jsx(Xe,{size:18})})]}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(s=>{const r=M().add(s,"month"),a=r.startOf("month"),o=r.endOf("month"),l=a.day(),d=o.date(),f=M();return e.jsxs("div",{className:"border border-gray-100 rounded-xl p-3 bg-white",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:r.format("MMMM YYYY")}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-xs",children:[["Su","Mo","Tu","We","Th","Fr","Sa"].map(y=>e.jsx("div",{className:"text-center text-gray-400 font-medium py-2",children:y},y)),Array.from({length:l}).map((y,A)=>e.jsx("div",{className:"p-2"},`empty-${A}`)),Array.from({length:d}).map((y,A)=>{const b=a.date(A+1),N=b.format("YYYY-MM-DD"),j=b.isBefore(f,"day"),q=n.date===N,G=b.isSame(f,"day");return e.jsx("button",{onClick:()=>hs(N),disabled:j,className:`
                                  p-2 rounded-lg text-sm font-medium transition-all duration-200
                                  ${j?"text-gray-300 cursor-not-allowed bg-gray-50":""}
                                  ${q?"bg-sky-600 text-white shadow-md":""}
                                  ${!j&&!q?"hover:bg-sky-50 text-gray-700":""}
                                  ${G?"ring-2 ring-sky-300":""}
                                `,children:b.date()},A)})]})]},s)})})]})]})]})}export{ka as default};
