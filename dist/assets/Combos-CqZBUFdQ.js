import{h as R,B as $,u as F,R as o,D as C,t as q,j as e,A as w}from"./index-CNdOvwUA.js";import{C as P}from"./ComboCard-Capzegi7.js";import{E as k}from"./ErrorState-CuVT3_I5.js";import"./formatters-CmiLqhJj.js";import"./pricing-CIeFTiJd.js";import"./media-Ct2xuz47.js";async function U({combo_id:c,date:m}){const d=new URLSearchParams;c&&d.set("combo_id",c),m&&d.set("date",m);const l=await fetch(`/api/combo-slots?${d.toString()}`,{credentials:"include"});if(!l.ok)throw new Error(await l.text());const i=await l.json().catch(()=>({}));return Array.isArray(i)?i:Array.isArray(i==null?void 0:i.data)?i.data:[]}function J(){const c=R(),m=$(),{items:d,status:l,error:i}=F(t=>t.combos),[n,D]=o.useState(C().format("YYYY-MM-DD")),[p,E]=o.useState(null),[y,A]=o.useState({}),[g,h]=o.useState({}),[B,f]=o.useState({}),[j,v]=o.useState({});o.useEffect(()=>{l==="idle"&&c(q({active:!0,page:1,limit:24}))},[l,c]),o.useEffect(()=>{p&&N(p)},[n]);const N=async t=>{try{h(s=>({...s,[t]:"loading"})),f(s=>({...s,[t]:""}));const a=await U({combo_id:t,date:n});A(s=>({...s,[t]:a||[]})),h(s=>({...s,[t]:"loaded"}))}catch(a){h(s=>({...s,[t]:"failed"})),f(s=>({...s,[t]:(a==null?void 0:a.message)||"Failed to load slots"}))}},Y=t=>{E(s=>s===t?null:t),v(s=>({...s,[t]:s[t]||1})),Array.isArray(y[t])&&g[t]==="loaded"||N(t)},M=(t,a)=>{const s=Math.max(1,Number(j[t.combo_id]||1)),x=new URLSearchParams({type:"combo",combo_id:String(t.combo_id),combo_slot_id:String(a.combo_slot_id),date:n,qty:String(s)}).toString();m(`/checkout?${x}`,{state:{type:"combo",combo_id:t.combo_id,combo_slot_id:a.combo_slot_id,date:n,quantity:s}})};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#e0f2fe] via-[#bae6fd] to-white px-4 pt-20 pb-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Combo Deals"}),e.jsx("p",{className:"text-gray-600",children:"Best value combinations for your Snowcity adventure."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Date"}),e.jsx("input",{type:"date",className:"rounded-md border px-3 py-2 text-sm dark:bg-neutral-900 dark:border-neutral-700",value:n,onChange:t=>D(t.target.value)})]})]}),l==="loading"&&!d.length?e.jsx(w,{}):null,l==="failed"?e.jsx(k,{message:(i==null?void 0:i.message)||"Failed to load combos"}):null,e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:d.map(t=>{const a=t.combo_id||t.id,s=p===a,x=y[a]||[],b=g[a]||"idle",L=B[a]||"";return e.jsxs("div",{className:"rounded-xl border bg-white dark:bg-neutral-900 border-gray-200 dark:border-neutral-800",children:[e.jsx("button",{className:"w-full text-left",onClick:()=>Y(a),"aria-expanded":s,children:e.jsx(P,{item:{...t,id:a}})}),s&&e.jsxs("div",{className:"px-3 pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("div",{className:"text-sm text-gray-700",children:C(n).format("ddd, DD MMM YYYY")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Qty"}),e.jsx("input",{type:"number",min:1,className:"w-20 rounded-md border px-2 py-1 text-sm dark:bg-neutral-900 dark:border-neutral-700",value:j[a]||1,onChange:r=>v(u=>({...u,[a]:Math.max(1,Number(r.target.value)||1)}))})]})]}),b==="loading"?e.jsx("div",{className:"py-3",children:e.jsx(w,{size:"sm"})}):null,b==="failed"?e.jsx("div",{className:"py-3",children:e.jsx(k,{message:L||"Failed to load slots"})}):null,b==="loaded"&&e.jsx(e.Fragment,{children:x.length?e.jsx("div",{className:"space-y-2",children:x.map(r=>{const u=r.start_time_12h||r.start_time,S=r.end_time_12h||r.end_time,_=r.price==null?null:Number(r.price);return e.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2 dark:border-neutral-800",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:[u," → ",S]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Capacity: ",r.capacity," • ",r.available?"Available":"Unavailable"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_!=null?e.jsxs("div",{className:"text-sm font-medium",children:["₹ ",_.toLocaleString()]}):e.jsx("div",{className:"text-xs text-gray-500",children:"Price at checkout"}),e.jsx("button",{disabled:!r.available,onClick:()=>M({combo_id:a,...t},r),className:"px-3 py-1.5 rounded-md bg-gray-900 text-white text-sm disabled:opacity-50",children:"Book"})]})]},r.combo_slot_id||`${r.combo_id}-${u}-${S}`)})}):e.jsx("div",{className:"text-sm text-gray-500 py-3",children:"No slots available for this date."})})]})]},a)})})]})})}export{J as default};
