import{j as e,D as F,r as d,h as Is,A as Ds,u as Ae,I as Ut,E as Vt,G as Z,m as $s,q as Ys,t as zs,J as Es,K as Be,i as Ke,k as Ue,M as Ht,Q as Wt,S as Xt,T as Ls,U as Os,V as qs,W as Fs,X as Rs,Y as Bs}from"./index-DpUnVvi7.js";import{i as Ge}from"./media-CQLQFIy8.js";import{U as Ks,p as Us}from"./attractions-CMXCNK_F.js";import{a as Gt,b as Qt,c as Jt,g as bt}from"./pricing-Df4qX4St.js";import{f as Vs}from"./formatters-CmiLqhJj.js";import{c as J}from"./createLucideIcon-DlloiUI2.js";import{P as us}from"./plus-BPthzweF.js";import{M as Hs}from"./mail-B3lRn09-.js";import{C as mt}from"./circle-alert-CQlX8UJX.js";import{P as Ws}from"./phone-D5OkylkG.js";import{R as Xs,S as Zt}from"./shopping-cart-Bm7tXnuc.js";import{C as Gs,U as Qs}from"./users-Dj4zQjFo.js";import{C as Js}from"./clock-DEBO4GCj.js";import{T as es}from"./ticket-DJwTfedz.js";import{C as ts}from"./credit-card-DU5bQE_R.js";import{S as ss}from"./shield-D-OVSuts.js";import{X as ut}from"./x-DjnihLtx.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],xs=J("arrow-left",Zs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],De=J("arrow-right",er);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],xt=J("check",tr);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],vt=J("chevron-right",sr);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],ar=J("globe",rr);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],pt=J("lock",nr);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],lr=J("log-in",ir);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=[["path",{d:"M5 12h14",key:"1ays0h"}]],ps=J("minus",or);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],Ne=J("shopping-bag",cr);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],ft=J("sparkles",dr);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],rs=J("tag",mr);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],xr=J("triangle-alert",ur);function pr({isOpen:t,onClose:a,onSignIn:o}){return t?e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl bg-white shadow-2xl dark:bg-neutral-900 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-8 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xr,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-lg font-bold",children:"Session Expired"})]}),e.jsx("p",{className:"mt-2 text-sm opacity-90",children:"Your login session has expired. Please sign in again to continue booking."})]}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mb-6",children:"Your booking information is saved. Sign in again to complete your purchase without losing your selections."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:o,className:"w-full flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3 text-white font-semibold transition-all duration-200 hover:shadow-lg hover:from-blue-700 hover:to-blue-800 active:scale-95",children:[e.jsx(lr,{className:"h-5 w-5"}),"Sign In Again"]}),e.jsx("button",{onClick:a,className:"w-full rounded-lg border border-gray-300 px-4 py-2 text-gray-700 font-medium transition-all hover:bg-gray-50 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",children:"Continue as Guest"})]})]})]})}):null}function fr({cartItems:t,hasCartItems:a,onEditCartItem:o,onRemoveCartItem:m,finalTotal:u,handleNext:g,step:v,paymentLoading:_}){return e.jsx("div",{className:"lg:sticky lg:top-[140px]",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),a?e.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:t.map(l=>{var S,$,G,N,c,Y,i,M;const b=((S=l.offer)==null?void 0:S.title)||(($=l.offer)==null?void 0:$.offerTitle)||l.offerDescription||null,B=Number(l.originalPrice||l.basePrice||0),w=Number(l.unitPrice||0),D=l.qty||l.quantity||1,E=b&&B>w;return e.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:l.title||((G=l.meta)==null?void 0:G.title)||(l.item_type&&l.item_type.toLowerCase()==="combo"?((N=l.combo)==null?void 0:N.title)||((c=l.combo)==null?void 0:c.name)||((Y=l.combo)==null?void 0:Y.combo_name)||`Combo #${l.combo_id||l.comboId}`:((i=l.attraction)==null?void 0:i.title)||((M=l.attraction)==null?void 0:M.name)||`Attraction #${l.attraction_id||l.attractionId}`)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[D," ticket(s) â€¢"," ",l.dateLabel||F(l.booking_date).format("D MMMM YYYY")||l.booking_date,l.slotLabel?` â€¢ ${l.slotLabel}`:""]}),b&&e.jsx("div",{className:"mt-1.5 flex items-center gap-1.5",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-emerald-50 text-emerald-700 border border-emerald-100",children:["ðŸ·ï¸ ",b]})}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>o(l),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>m(l.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]})]}),e.jsxs("div",{className:"text-right",children:[E&&e.jsxs("div",{className:"text-xs text-gray-400 line-through tabular-nums",children:["â‚¹",(B*D).toFixed(0)]}),e.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["â‚¹",(w*D).toFixed(0)]}),E&&e.jsxs("div",{className:"text-[10px] text-emerald-600 font-medium",children:["Save â‚¹",((B-w)*D).toFixed(0)]})]})]},l.key)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:e.jsx(Ne,{className:"text-sky-600"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),e.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["â‚¹",u.toFixed(0)]})]}),e.jsxs("button",{type:"button",disabled:!a,onClick:g,className:`w-full flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${a?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[v===4?_?"Processing...":`Pay â‚¹${u}`:"Continue",v!==4&&e.jsx(De,{size:16})]})]})]})})}function hr({sel:t,setSel:a,combos:o,prioritizedAttractions:m,cartItems:u,hasCartItems:g,finalTotal:v,todayYMD:_,handleToday:l,handleTomorrow:b,onCalendarButtonClick:B,setCalendarAnchor:w,formatDateDisplay:D,getAttrId:E,getComboId:S,getComboDisplayPrice:$,getPrice:G,getComboLabel:N,getComboPrimaryImage:c,getAttractionImage:Y,idsMatch:i,onEditCartItem:M,setDetailsMainImage:L,setDrawerMode:k,setDrawerOpen:H,onRemoveCartItem:W,handleNext:ee,step:R,paymentLoading:fe}){const ie=()=>{const T=t.itemType,U=d.useMemo(()=>T!=="attraction"?o:m,[T,m,o]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-sky-50 p-1 rounded-xl inline-flex border border-sky-100",children:["attraction","combo"].map(I=>e.jsx("button",{onClick:()=>{a(A=>({...A,itemType:I,attractionId:"",comboId:"",slotKey:""}))},className:`px-6 py-2 text-sm font-semibold rounded-lg capitalize transition-all duration-200 ${t.itemType===I?"bg-white text-sky-700 shadow-sm ring-1 ring-black/5":"text-gray-600 hover:text-gray-900"}`,children:I==="attraction"?"Attractions":"Combos"},I))})}),U.length===0?e.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-dashed border-gray-200 px-4 py-6 text-center text-sm text-gray-500",children:t.itemType==="combo"?"No combos available":"No attractions available"}):U.map(I=>{const A=t.itemType==="attraction"?E(I):S(I),C=String(t.itemType==="attraction"?t.attractionId:t.comboId)===String(A),le=t.itemType==="combo"?Number($(I)||0):Number(G(I)||I.price||I.base_price||I.amount||0),de=t.itemType==="attraction"?I.title||I.name:N(I),me=t.itemType==="combo"?c(I):Y(I),oe=()=>{const se=t.itemType==="combo",we=u.find(Q=>se?Q.item_type==="Combo"&&i(Q.combo_id,A):(Q.item_type==="Attraction"||Q.item_type===void 0)&&i(Q.attraction_id,A));if(we){M(we);return}a(Q=>({...Q,itemType:t.itemType,attractionId:t.itemType==="attraction"?String(A):"",comboId:t.itemType==="combo"?String(A):"",slotKey:""})),k("booking"),H(!0)};return e.jsxs("div",{className:`bg-white rounded-3xl shadow-sm border px-4 sm:px-6 py-4 sm:py-5 flex items-center justify-between gap-4 transition-all ${C?"border-sky-400 shadow-md":"border-gray-100 hover:border-sky-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-28 h-28 rounded-2xl overflow-hidden border border-gray-100 bg-sky-50 shrink-0",children:me?e.jsx("img",{src:me,alt:de,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sky-400",children:e.jsx(Ne,{})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1 truncate",children:de}),e.jsx("p",{className:"text-xs text-gray-500",children:"Great for families â€¢ Flexible slots â€¢ Instant confirmation"}),e.jsxs("button",{type:"button",onClick:()=>{a(se=>({...se,itemType:t.itemType,attractionId:t.itemType==="attraction"?String(A):"",comboId:t.itemType==="combo"?String(A):"",slotKey:""})),L(me||null),k("details"),H(!0)},className:"inline-flex items-center gap-1 text-xs sm:text-sm font-semibold text-sky-700 hover:text-sky-900 mt-2",children:["View details",e.jsx(vt,{size:14})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 sm:gap-3",children:[e.jsx("div",{className:"text-right text-xs text-gray-500 uppercase tracking-wide",children:"From"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-sky-700 tabular-nums",children:["â‚¹",le||0]})}),e.jsx("button",{type:"button",onClick:oe,className:`px-6 py-2 rounded-full text-white text-sm font-semibold shadow-md active:scale-[0.98] transition-all ${C?"bg-sky-700":"bg-sky-600 hover:bg-sky-700"}`,children:C?"Selected":"Select"})]})]},A)})]})};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mb-1",children:[e.jsx("button",{type:"button",onClick:l,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${t.date===_()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),e.jsx("button",{type:"button",onClick:b,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${t.date===F().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:B,ref:w,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${t.date&&t.date!==""&&t.date!==_()&&t.date!==F().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:t.date&&t.date!==_()&&t.date!==F().add(1,"day").format("YYYY-MM-DD")?D(t.date):"All Days"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-500 ml-1",children:"Change date/time in details panel"})]}),e.jsx(ie,{})]}),e.jsx(fr,{cartItems:u,hasCartItems:g,onEditCartItem:M,onRemoveCartItem:W,finalTotal:v,handleNext:ee,step:R,paymentLoading:fe})]})}function yr({cartItems:t,activeItemKey:a,setActiveCartItem:o,dispatch:m,addonsState:u,getAddonId:g,getAddonPrice:v,getAddonName:_,getAddonImage:l,currentItemAddons:b,handleAddonQuantityChange:B,cartAddons:w,onEditCartItem:D,onRemoveCartItem:E,finalTotal:S,handleNext:$,handleBack:G,hasCartItems:N}){return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start mt-4",children:[e.jsxs("div",{className:"space-y-6",children:[t.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:t.map(c=>{var Y,i,M,L,k,H;return e.jsx("button",{onClick:()=>m(o(c.key)),className:`px-4 py-2 rounded-full border text-sm font-medium transition-all ${c.key===a?"bg-sky-600 text-white border-sky-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-sky-200"}`,children:c.title||((Y=c.meta)==null?void 0:Y.title)||(c.item_type==="combo"?((i=c.combo)==null?void 0:i.title)||((M=c.combo)==null?void 0:M.name)||((L=c.combo)==null?void 0:L.combo_name)||`Combo #${c.combo_id}`:((k=c.attraction)==null?void 0:k.title)||((H=c.attraction)==null?void 0:H.name)||`Attraction #${c.attraction_id}`)||"Item"},c.key)})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:u.status==="loading"?e.jsx("div",{className:"text-center py-10 text-gray-500 text-sm",children:"Loading add-ons..."}):e.jsx("div",{className:"space-y-4",children:(u.items||[]).map(c=>{var W;const Y=g(c),i=v(c),M=_(c),L=l(c),k=Number(((W=b.get(Y))==null?void 0:W.quantity)||0),H=ee=>`â‚¹${Number(ee).toFixed(0)}`;return e.jsxs("div",{className:"flex gap-4 items-center border border-gray-200 rounded-2xl p-4 hover:border-sky-200 transition-all",children:[L?e.jsx("img",{src:L,alt:M,className:"w-16 h-16 rounded-xl object-cover border border-gray-100"}):e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center text-gray-400",children:e.jsx(Ne,{})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",children:M}),e.jsx("div",{className:"text-sm text-gray-500 tabular-nums",children:H(i)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>B(Y,Math.max(0,k-1),c),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 transition",children:e.jsx(ps,{size:16})}),e.jsx("span",{className:"w-6 text-center font-semibold text-gray-800 tabular-nums",children:k}),e.jsx("button",{onClick:()=>B(Y,k+1,c),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 bg-sky-600 text-white shadow",children:e.jsx(us,{size:16})})]})]},Y)})})})]}),e.jsx("div",{className:"lg:sticky lg:top-[140px]",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),N?e.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:t.map(c=>{var M,L,k,H,W,ee;const Y=w.get(c.key)||new Map,i=Array.from(Y.values()).filter(R=>Number(R.quantity)>0);return e.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:c.title||((M=c.meta)==null?void 0:M.title)||(c.item_type==="combo"?((L=c.combo)==null?void 0:L.title)||((k=c.combo)==null?void 0:k.name)||((H=c.combo)==null?void 0:H.combo_name)||`Combo #${c.combo_id}`:((W=c.attraction)==null?void 0:W.title)||((ee=c.attraction)==null?void 0:ee.name)||`Attraction #${c.attraction_id}`)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[c.quantity," ticket(s) â€¢"," ",c.dateLabel||F(c.booking_date).format("D MMMM YYYY")||c.booking_date,c.slotLabel?` â€¢ ${c.slotLabel}`:""]}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>D(c),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>E(c.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]}),i.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Extras"}),e.jsx("div",{className:"space-y-1",children:i.map(R=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"truncate",children:[R.name," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["x",R.quantity]})]}),e.jsxs("div",{className:"tabular-nums",children:["â‚¹",(Number(R.price||0)*Number(R.quantity||0)).toFixed(0)]})]},R.addon_id))})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["â‚¹",(c.unitPrice*c.quantity).toFixed(0)]})})]},c.key)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:e.jsx(Ne,{className:"text-sky-600"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),e.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["â‚¹",S.toFixed(0)]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{type:"button",disabled:!N,onClick:$,className:`w-full flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${N?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx("span",{children:"Continue"}),e.jsx(De,{size:18})]}),e.jsxs("button",{type:"button",onClick:G,className:"hidden lg:flex items-center justify-center gap-2 w-full rounded-xl px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-50 transition-all border border-gray-100",children:[e.jsx(xs,{size:16}),"Back"]})]})]})]})})]})}function gr({hasToken:t,contact:a,dispatch:o,setContact:m,contactErrors:u,setContactErrors:g,countryCode:v,setCountryCode:_,COUNTRY_CODES:l,phoneLocal:b,handlePhoneChange:B,otp:w,sendOTP:D,otpCode:E,setOtpCode:S,verifyOTP:$,handleBack:G,handleNext:N}){var L;const[c,Y]=d.useState(0),i=d.useRef(null);d.useEffect(()=>{w.sent&&c===0&&Y(30)},[w.sent]),d.useEffect(()=>{if(c<=0){i.current&&clearInterval(i.current);return}return i.current=setInterval(()=>{Y(k=>k<=1?(clearInterval(i.current),0):k-1)},1e3),()=>clearInterval(i.current)},[c]);const M=()=>{c>0||w.status==="loading"||(Y(30),D())};return t?null:e.jsx("div",{className:"space-y-6 max-w-md mx-auto animate-in fade-in slide-in-from-right-8 duration-300 mt-4",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Full Name"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Ks,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"John Doe",className:"w-full pl-11 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 focus:bg-white outline-none transition-all font-medium",value:a.name,onChange:k=>o(m({name:k.target.value}))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Hs,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"name@example.com",type:"email",className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium ${u.email?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:a.email,onChange:k=>{o(m({email:k.target.value})),u.email&&g(H=>({...H,email:void 0}))}})]}),u.email&&e.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[e.jsx(mt,{size:12})," ",u.email]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Mobile Number"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative w-32",children:[e.jsx("div",{className:"absolute left-3 top-3.5 z-10 pointer-events-none",children:e.jsx(ar,{size:18,className:"text-gray-400"})}),e.jsx("select",{className:"w-full pl-10 pr-8 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none appearance-none font-medium text-sm",value:v,onChange:k=>_(k.target.value),children:l.map(k=>e.jsx("option",{value:k.code,children:k.code},k.code))}),e.jsx(vt,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 rotate-90 pointer-events-none"})]}),e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Ws,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"98765 43210",type:"tel",maxLength:10,className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium tracking-wide ${u.phone?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:b,onChange:B})]})]}),u.phone&&e.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[e.jsx(mt,{size:12})," ",u.phone]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",required:!0,checked:a.whatsapp_consent||!1,onChange:k=>o(m({whatsapp_consent:k.target.checked})),className:"w-4 h-4 text-sky-600 bg-gray-100 border-gray-300 rounded focus:ring-sky-500 focus:ring-2"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"I agree to receive WhatsApp notifications *"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"We'll send booking confirmations and updates via WhatsApp"})]}),w.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl px-4 py-3 flex items-start gap-2",children:[e.jsx(mt,{size:16,className:"text-red-500 mt-0.5 shrink-0"}),e.jsx("p",{className:"text-sm text-red-700 font-medium",children:((L=w.error)==null?void 0:L.message)||w.error||"Something went wrong. Please try again."})]}),w.sent?e.jsxs("div",{className:"mt-6 bg-sky-50 border border-sky-100 p-5 rounded-2xl animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("p",{className:"text-sm text-sky-800 mb-3 font-medium",children:["Enter OTP sent to ",v," ",b]}),e.jsxs("div",{className:"flex gap-3 flex-col sm:flex-row",children:[e.jsx("input",{placeholder:"XXXXXX",className:"flex-1 p-3.5 text-center tracking-[0.5em] font-bold text-xl border-2 border-sky-200 rounded-xl focus:border-sky-600 focus:ring-4 focus:ring-sky-100 outline-none bg-white transition-all",maxLength:6,value:E,onChange:k=>S(k.target.value)}),e.jsx("button",{onClick:$,disabled:w.status==="loading",className:"bg-sky-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-sky-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 w-full sm:w-auto text-sm sm:text-base",children:w.status==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):w.verified?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Verified"]}):"Verify"})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between pt-3 border-t border-sky-100",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Didn't receive the OTP?"}),e.jsxs("button",{type:"button",onClick:M,disabled:c>0||w.status==="loading",className:`inline-flex items-center gap-1.5 text-sm font-semibold transition-all ${c>0||w.status==="loading"?"text-gray-400 cursor-not-allowed":"text-sky-700 hover:text-sky-900 active:scale-95"}`,children:[e.jsx(Xs,{size:14,className:w.status==="loading"?"animate-spin":""}),c>0?`Resend in ${c}s`:w.status==="loading"?"Sending...":"Resend OTP"]})]})]}):e.jsx("button",{onClick:D,disabled:w.status==="loading",className:"w-full bg-sky-700 text-white py-3 rounded-xl font-bold text-base shadow-lg hover:bg-sky-800 transition-all disabled:opacity-70 flex items-center justify-center gap-2 mt-4",children:w.status==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Sending..."})]}):"Send OTP Verification"}),e.jsxs("div",{className:"hidden md:flex items-center gap-4 mt-8 pt-6 border-t border-gray-100",children:[e.jsx("button",{type:"button",onClick:G,className:"px-8 py-3 rounded-xl border border-gray-200 text-gray-700 font-bold hover:bg-gray-50 transition-all",children:"Back"}),e.jsxs("button",{type:"button",onClick:N,disabled:!w.verified,className:`flex-1 flex items-center justify-center gap-2 rounded-xl px-8 py-3 text-base font-bold transition-all ${w.verified?"bg-sky-600 text-white shadow-lg hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:["Continue",e.jsx(De,{size:20})]})]})]})})}function br({OfferSelector:t,paymentGateway:a,setPaymentGateway:o,couponApplied:m,coupon:u,couponDiscount:g,selectedOfferDiscount:v,finalTotal:_,promoInput:l,setPromoInput:b,dispatch:B,setCouponCode:w,applyPromo:D,promosLoading:E,availablePromos:S,handleBack:$,onPlaceOrderAndPay:G,creating:N,paymentLoading:c,hasCartItems:Y,cartItems:i=[],cartAddons:M=new Map,totalAddonsCost:L=0,grossTotal:k=0,formatCurrency:H,dayjs:W}){var R,fe,ie;const ee=i.reduce((T,U)=>T+Number(U.unitPrice||0)*Number(U.quantity||0),0);return e.jsxs("div",{className:"space-y-5 max-w-lg mx-auto animate-in fade-in slide-in-from-right-8 duration-300 pb-20",children:[e.jsx("div",{className:"text-center mb-2",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-sky-50 border border-sky-100 mb-3",children:[e.jsx(pt,{size:14,className:"text-sky-600"}),e.jsx("span",{className:"text-xs font-semibold text-sky-700",children:"Secure Checkout"})]})}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-5 py-4 bg-gradient-to-r from-gray-50 to-white border-b border-gray-100",children:e.jsxs("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Ne,{className:"text-sky-600",size:18}),"Order Details",e.jsxs("span",{className:"ml-auto text-xs font-medium text-gray-500 bg-gray-100 px-2.5 py-1 rounded-full",children:[i.length," ",i.length===1?"item":"items"]})]})}),e.jsxs("div",{className:"divide-y divide-gray-50",children:[i.map((T,U)=>{const I=Number(T.unitPrice||0),A=Number(T.quantity||0),C=I*A;return e.jsx("div",{className:"px-5 py-4 hover:bg-gray-50/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm leading-tight truncate",children:T.title||"Ticket"}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 mt-1.5",children:[T.booking_date&&W&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Gs,{size:11,className:"text-gray-400"}),W(T.booking_date).format("D MMM YYYY")]}),T.slotLabel&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Js,{size:11,className:"text-gray-400"}),T.slotLabel]}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Qs,{size:11,className:"text-gray-400"}),A," ",A===1?"ticket":"tickets"]})]}),T.offerDescription&&e.jsxs("div",{className:"mt-1.5 inline-flex items-center gap-1 text-[11px] text-amber-700 bg-amber-50 px-2 py-0.5 rounded-md font-medium",children:[e.jsx(ft,{size:10})," ",T.offerDescription]})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsxs("p",{className:"text-sm font-bold text-gray-900 tabular-nums",children:["â‚¹",C.toLocaleString()]}),A>1&&e.jsxs("p",{className:"text-[11px] text-gray-400 tabular-nums",children:["â‚¹",I," Ã— ",A]})]})]})},T.key||U)}),L>0&&e.jsxs("div",{className:"px-5 py-3 bg-purple-50/40",children:[e.jsxs("p",{className:"text-xs font-semibold text-purple-700 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(ft,{size:12})," Add-ons"]}),Array.from(M.entries()).map(([T,U])=>!U||U instanceof Map&&U.size===0?null:(U instanceof Map?Array.from(U.values()):Object.values(U||{})).filter(A=>Number((A==null?void 0:A.quantity)||0)>0).map((A,C)=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("span",{className:"text-xs text-gray-600",children:[A.name||"Add-on"," Ã— ",A.quantity]}),e.jsxs("span",{className:"text-xs font-semibold text-gray-700 tabular-nums",children:["â‚¹",(Number(A.price||0)*Number(A.quantity||0)).toLocaleString()]})]},`${T}-${C}`)))]})]})]}),e.jsx(t,{}),e.jsx("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:e.jsx("div",{className:"px-5 py-4",children:m?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx(xt,{size:16,className:"text-emerald-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-bold text-emerald-800",children:[String(u.code||((R=u.data)==null?void 0:R.code)).toUpperCase()," applied"]}),e.jsx("p",{className:"text-xs text-emerald-600",children:((fe=u.data)==null?void 0:fe.description)||`You save â‚¹${g.toFixed(0)}`})]}),e.jsx("button",{onClick:()=>{b(""),B(w(""))},className:"text-xs font-semibold text-red-500 hover:text-red-700 transition-colors px-3 py-1.5 rounded-lg hover:bg-red-50",children:"Remove"})]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider flex items-center gap-1.5",children:[e.jsx(rs,{size:12})," Apply Promo Code"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(es,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"}),e.jsxs("select",{className:"w-full pl-9 pr-20 py-3 border border-gray-200 rounded-xl text-sm uppercase focus:ring-2 focus:ring-sky-500 focus:border-sky-400 outline-none font-bold tracking-wider appearance-none bg-white cursor-pointer disabled:bg-gray-50 disabled:text-gray-400 transition-all hover:border-gray-300",value:l,onChange:T=>b(T.target.value),disabled:E,children:[e.jsx("option",{value:"",children:E?"Loading promos...":"Select a promo code"}),S.map(T=>e.jsxs("option",{value:T.code,children:[T.code," ",T.discount?`(${T.discount}% off)`:""]},T.id||T.code))]}),e.jsx("button",{onClick:D,disabled:!l||E,className:"absolute right-1.5 top-1/2 -translate-y-1/2 px-4 py-2 rounded-lg bg-sky-600 text-white text-xs font-bold tracking-wide hover:bg-sky-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"APPLY"})]})})]})})}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-5 py-4 bg-gradient-to-r from-gray-50 to-white border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(ts,{className:"text-sky-600",size:18}),"Payment Method"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-emerald-700 bg-emerald-50 px-2 py-1 rounded-full font-medium border border-emerald-100",children:[e.jsx(ss,{size:10})," Secure"]})]})}),e.jsxs("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("label",{className:`relative flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 ${a==="payphi"?"border-sky-500 bg-sky-50/60 shadow-md ring-1 ring-sky-200":"border-gray-150 bg-white hover:border-sky-200 hover:shadow-sm"}`,children:[e.jsx("input",{type:"radio",name:"paymentGateway",value:"payphi",checked:a==="payphi",onChange:()=>o("payphi"),className:"sr-only"}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center shrink-0 transition-all ${a==="payphi"?"border-sky-500 bg-sky-500":"border-gray-300"}`,children:a==="payphi"&&e.jsx(xt,{size:11,className:"text-white",strokeWidth:3})}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-sm shrink-0",children:e.jsx(ts,{size:18,className:"text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-bold text-gray-900 text-sm",children:"PayPhi"}),e.jsx("p",{className:"text-[11px] text-gray-500",children:"Cards Â· UPI Â· Netbanking"})]})]}),e.jsxs("label",{className:`relative flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 ${a==="phonepe"?"border-purple-500 bg-purple-50/60 shadow-md ring-1 ring-purple-200":"border-gray-150 bg-white hover:border-purple-200 hover:shadow-sm"}`,children:[e.jsx("input",{type:"radio",name:"paymentGateway",value:"phonepe",checked:a==="phonepe",onChange:()=>o("phonepe"),className:"sr-only"}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center shrink-0 transition-all ${a==="phonepe"?"border-purple-500 bg-purple-500":"border-gray-300"}`,children:a==="phonepe"&&e.jsx(xt,{size:11,className:"text-white",strokeWidth:3})}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-600 to-indigo-600 flex items-center justify-center shadow-sm shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-bold text-gray-900 text-sm",children:"PhonePe"}),e.jsx("p",{className:"text-[11px] text-gray-500",children:"UPI Â· Wallet Â· Cards"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-5 py-4 bg-gradient-to-r from-gray-50 to-white border-b border-gray-100",children:e.jsxs("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(es,{className:"text-sky-600",size:18}),"Payment Summary"]})}),e.jsxs("div",{className:"px-5 py-4 space-y-2.5",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Tickets Subtotal"}),e.jsxs("span",{className:"font-semibold text-gray-800 tabular-nums",children:["â‚¹",ee.toLocaleString()]})]}),L>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Add-ons"}),e.jsxs("span",{className:"font-semibold text-gray-800 tabular-nums",children:["â‚¹",L.toLocaleString()]})]}),m&&g>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm text-emerald-700",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rs,{size:12}),"Coupon (",String(u.code||((ie=u.data)==null?void 0:ie.code)).toUpperCase(),")"]}),e.jsxs("span",{className:"font-semibold tabular-nums",children:["-â‚¹",g.toFixed(0)]})]}),v>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm text-emerald-700",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ft,{size:12}),"Offer Discount"]}),e.jsxs("span",{className:"font-semibold tabular-nums",children:["-â‚¹",v.toFixed(0)]})]}),e.jsxs("div",{className:"border-t border-dashed border-gray-200 pt-3 mt-3 flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-gray-900 text-base",children:"Total Amount"}),e.jsxs("span",{className:"font-extrabold text-2xl text-sky-700 tabular-nums",children:["â‚¹",_.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-6 py-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-[11px] font-medium",children:"256-bit SSL"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400",children:[e.jsx(pt,{size:13}),e.jsx("span",{className:"text-[11px] font-medium",children:"PCI Compliant"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-400",children:[e.jsx(ss,{size:13}),e.jsx("span",{className:"text-[11px] font-medium",children:"100% Secure"})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-4 mt-6 pt-5 border-t border-gray-100",children:[e.jsx("button",{type:"button",onClick:$,disabled:(N==null?void 0:N.status)==="loading"||c,className:"px-8 py-3.5 rounded-xl border border-gray-200 text-gray-700 font-bold hover:bg-gray-50 transition-all disabled:opacity-50",children:"Back"}),e.jsxs("button",{type:"button",onClick:G,disabled:(N==null?void 0:N.status)==="loading"||c||!Y,className:`flex-1 flex items-center justify-center gap-2 rounded-xl px-8 py-3.5 text-base font-bold transition-all ${(N==null?void 0:N.status)==="loading"||c||!Y?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-sky-600 to-sky-700 text-white shadow-lg shadow-sky-600/20 hover:from-sky-700 hover:to-sky-800 active:scale-[0.98]"}`,children:[c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{size:16}),"Pay â‚¹",_.toLocaleString()]}),e.jsx(De,{size:18})]})]})]})}const pe=t=>F(t).format("YYYY-MM-DD"),ve=()=>F().format("YYYY-MM-DD"),be=t=>(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.attraction_id)??null,je=t=>(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.combo_id)??null,ht=(t,a)=>String((t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.slot_id)??(t==null?void 0:t.combo_slot_id)??`${(t==null?void 0:t.start_time)||""}-${(t==null?void 0:t.end_time)||""}-${a}`),as=t=>{if(!t)return"";const[a,o]=t.split(":"),m=parseInt(a,10),u=m>=12?"PM":"AM";return`${m%12||12}:${o} ${u}`},ns=t=>{if(t!=null&&t.label)return t.label;const a=as(t==null?void 0:t.start_time),o=as(t==null?void 0:t.end_time);return a&&o?`${a} - ${o}`:a||`Slot #${(t==null?void 0:t.id)||"?"}`},jr=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,is=[{code:"+91",label:"IN (+91)"},{code:"+1",label:"US (+1)"},{code:"+971",label:"AE (+971)"},{code:"+44",label:"UK (+44)"},{code:"+65",label:"SG (+65)"}],vr=t=>Number((t==null?void 0:t.price)??(t==null?void 0:t.amount)??0),Nr=t=>(t==null?void 0:t.id)??(t==null?void 0:t.addon_id)??(t==null?void 0:t._id)??null,wr=t=>(t==null?void 0:t.name)??(t==null?void 0:t.title)??(t==null?void 0:t.label)??"Addon",kr=t=>{if(!t)return null;const a=[t,t==null?void 0:t.image_url,t==null?void 0:t.image,t==null?void 0:t.thumbnail,t==null?void 0:t.cover_image];for(const o of a){if(!o)continue;const m=typeof o=="string"?Ge(o):Ge(o);if(m)return m}return null};function _r(t){const a=()=>typeof window<"u"?window.matchMedia(t).matches:!1,[o,m]=d.useState(a);return d.useEffect(()=>{if(typeof window>"u")return;const u=window.matchMedia(t),g=v=>m(v.matches);return u.addEventListener("change",g),()=>u.removeEventListener("change",g)},[t]),o}const ls=()=>({itemType:"attraction",attractionId:"",comboId:"",date:ve(),slotKey:"",qty:1}),Cr=()=>`sel_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`,os=(t,a=null)=>{if(!t)return a?`Combo ${a}`:"Combo";const o=t.name??t.title??t.combo_name??t.label??null;return o||(a?`Combo ${a}`:"Combo")},Ie=t=>{if(!t)return null;if(typeof t=="string")return Ge(t);if(typeof t=="object"){const a=t.url||t.src||t.image_url||t.path;if(a)return Ge(a)}return null},Ve=t=>{var o;if(!t)return null;const a=[t.desktop_image_url,t.hero_image,t.banner_image,t.image_url,t.cover_image,t.thumbnail,(o=t.media)==null?void 0:o[0]];for(const m of a){const u=Ie(m);if(u)return u}return null},He=t=>{var o;if(!t)return null;const a=[t.desktop_image_url,t.hero_image,t.banner_image,t.image_url,t.cover_image,(o=t.media)==null?void 0:o[0],t.attraction_1_image,t.attraction_2_image];for(const m of a){const u=Ie(m);if(u)return u}return null},Mr=t=>{if(!t)return[];const a=[];return t.attraction_1_image&&a.push(Ie(t.attraction_1_image)),t.attraction_2_image&&a.push(Ie(t.attraction_2_image)),a.length<2&&Array.isArray(t.media)&&t.media.forEach(o=>{const m=Ie(o);m&&!a.includes(m)&&a.push(m)}),a.slice(0,2).filter(Boolean)},X=t=>{const a=Number(t);return Number.isFinite(a)?a:0},jt=t=>String(t||"").toLowerCase(),Nt=(t,a)=>t==null||a==null?!1:String(t)===String(a),Pr=t=>{if(typeof t=="boolean")return t;if(t==null)return!1;if(typeof t=="number")return t!==0;const a=String(t).trim().toLowerCase();return a?["true","1","yes","y"].includes(a)?!0:["false","0","no","n"].includes(a)?!1:!!t:!1},Sr=t=>t?Array.isArray(t)?t.reduce((a,o)=>a+X(o),0):typeof t=="object"?Object.values(t).reduce((a,o)=>a+X(o),0):0:0,cs=t=>{if(!t)return 0;const a=bt(t);if(a>0)return a;const o=(t==null?void 0:t.combo_price)??(t==null?void 0:t.price)??(t==null?void 0:t.amount)??(t==null?void 0:t.total_price)??(t==null?void 0:t.starting_price)??(t==null?void 0:t.min_price)??(t==null?void 0:t.base_price)??0;if(X(o)>0)return X(o);const m=t==null?void 0:t.combo_attractions;if(Array.isArray(m)&&m.length){const v=m.reduce((_,l)=>_+X((l==null?void 0:l.attraction_price)??(l==null?void 0:l.price)),0);if(v>0)return v}const u=Sr(t==null?void 0:t.attraction_prices);if(u>0)return u;const g=X(t==null?void 0:t.attraction_1_price)+X(t==null?void 0:t.attraction_2_price);return g>0?g:0},Tr=(t,a)=>{if(!t)return!0;const o=F();if(F(a).format("YYYY-MM-DD")===o.format("YYYY-MM-DD")){const u=t.start_time||t.time||t.startTime;if(!u)return!0;const[g,v]=u.split(":"),_=parseInt(g)*60+parseInt(v),b=o.hour()*60+o.minute()+60;return _>=b}return!0},Ar=t=>{if(!t)return!0;if(t.available===!1)return!1;const a=Number(t.capacity??t.available_capacity??t.available);if(Number.isNaN(a))return!0;if(t.booked!=null){const o=Number(t.booked);if(!Number.isNaN(o))return a-o>0}return a>0},We=t=>(t==null?void 0:t.id)??(t==null?void 0:t.offer_id)??(t==null?void 0:t.offerId)??(t==null?void 0:t.slug)??null,ds=t=>(t==null?void 0:t.title)||(t==null?void 0:t.name)||`Offer ${We(t)??""}`.trim(),yt=t=>(t==null?void 0:t.short_description)||(t==null?void 0:t.subtitle)||(t==null?void 0:t.description)||"",Xe=(t,a)=>{if(!t||!a)return 0;const o=String(t.discount_type||t.rule_discount_type||"").toLowerCase(),m=Number(t.discount_percent??t.discountPercent??(o==="percent"?t.discount_value??t.discountValue:0))||0,u=Number(t.discount_value??t.discountValue??t.flat_discount??0)||0;let g=0;o==="percent"&&m>0||m>0?g=a*m/100:g=u;const v=Number(t.max_discount??t.maxDiscount??0);return v>0&&(g=Math.min(g,v)),Math.max(0,Math.min(g,a))},gt=t=>{if(!t||typeof t!="string")return null;const[a="0",o="0"]=t.split(":"),m=Number(a),u=Number(o);return!Number.isFinite(m)||!Number.isFinite(u)?null:m*60+u},Ir=(t={},a)=>{if(!t.day_type)return!0;const o=F(a).day(),m=String(t.day_type).toLowerCase();return m==="weekday"?o>=1&&o<=5:m==="weekend"?o===0||o===6:m==="custom"&&Array.isArray(t.specific_days)?t.specific_days.map(Number).includes(o):!0},Dr=(t={},a=null)=>{if(!a)return!(t.slot_id!=null||Array.isArray(t.slot_ids)&&t.slot_ids.length||t.specific_time||t.time_from&&t.time_to);const o=[];if(t.slot_id!=null&&o.push(t.slot_id),Array.isArray(t.slot_ids)&&o.push(...t.slot_ids),t.target_slot_id!=null&&o.push(t.target_slot_id),o.length){const g=[a.slot_id,a.id,a._id,a.combo_slot_id].filter(_=>_!=null);if(!o.some(_=>g.some(l=>Nt(_,l))))return!1}if(!(t.specific_time||t.time_from&&t.time_to))return!0;const u=a.start_time||a.time||a.startTime||null;if(t.specific_time&&u&&u.slice(0,5)!==String(t.specific_time).slice(0,5))return!1;if(t.time_from&&t.time_to&&u){const g=gt(u),v=gt(t.time_from),_=gt(t.time_to);if(g==null||v==null||_==null||g<v||g>_)return!1}return!0},fs=({rule:t,selectedDate:a,selectedSlot:o,itemType:m,itemId:u})=>{if(!t||!a)return!1;const g=F(a).format("YYYY-MM-DD"),v=jt(t.target_type),_=jt(m);if(v&&_&&v!==_)return!1;if(!Pr(t.applies_to_all)){const b=[];if(t.target_id!=null&&b.push(t.target_id),Array.isArray(t.target_ids)&&b.push(...t.target_ids),!b.length||!b.some(w=>Nt(w,u)))return!1}return!(t.specific_date&&g!==t.specific_date||Array.isArray(t.specific_dates)&&t.specific_dates.length&&!t.specific_dates.some(b=>F(b).format("YYYY-MM-DD")===g)||t.date_from&&g<t.date_from||t.date_to&&g>t.date_to||!Ir(t,g)||!Dr(t,o))},ms=(t,a,o,m,u)=>!t||!a||!o?!1:(Array.isArray(t.rules)?t.rules:[]).filter(_=>fs({rule:_,selectedDate:a,selectedSlot:o,itemType:m,itemId:u})).length>0,$r=(t,a,o)=>{const m=Number(a||0)*Number(o||1);if(!t||m<=0)return null;const u=Xe(t,m)||0;return{total:m,totalDiscount:u,final:Math.max(0,m-u)}};function Zr(){var Rt;const t=Is(),a=Ds(),o=_r("(min-width: 768px)"),m=Ae(s=>s.auth),u=!!(m!=null&&m.token),g=Ae(s=>s.attractions),v=Ae(s=>s.combos),_=Ae(s=>s.addons),{step:l,contact:b,otp:B,coupon:w,creating:D,cart:E}=Ae(s=>s.bookings),S=(E==null?void 0:E.items)||[],$=S.length>0,G=E==null?void 0:E.activeKey,N=d.useMemo(()=>{if(!S.length)return null;if(G){const s=S.find(n=>n.key===G);if(s)return s}return S[0]},[S,G]),c=(N==null?void 0:N.key)||null;d.useRef(null);const Y=d.useRef(!1),[i,M]=d.useState(()=>ls()),[L,k]=d.useState(null),[H,W]=d.useState(!1),[ee,R]=d.useState(!1),[fe,ie]=d.useState("booking"),[T,U]=d.useState(null),[I,A]=d.useState("payphi"),[C,le]=d.useState({status:"idle",error:null,offers:[],offerRules:[],activeOffer:null,activeRule:null,selectedOffer:null,selectedRule:null,offerPreview:null,loadingOffers:!1}),[de,me]=d.useState("+91"),[oe,se]=d.useState(""),[we,Q]=d.useState({}),[he,ke]=d.useState({status:"idle",items:[],error:null}),[$e,wt]=d.useState(""),[Ye,hs]=d.useState(""),[re,Qe]=d.useState(""),[ae,Je]=d.useState(new Map),[kt,_t]=d.useState([]),[Ct,Mt]=d.useState(!1),[ce,Ze]=d.useState(!1),[Yr,et]=d.useState(null),[ys,tt]=d.useState(!1),[Pt,st]=d.useState(""),_e=g.items||[],gs=d.useMemo(()=>Us(_e),[_e]),ze=v.items||[],bs=s=>{const n=s.target.value.replace(/\D/g,"");n.length<=10&&(se(n),we.phone&&Q(r=>({...r,phone:null})))},St=d.useCallback(()=>{if(!Array.isArray(C.offers)||!N)return null;const s=jt(N.item_type||(N.combo_id?"Combo":"Attraction")),n=N.attraction_id||N.combo_id||null,r=N.date||"",f=N.slot||{};let y=null;for(const h of C.offers){const P=Array.isArray(h.rules)?h.rules:[];for(const p of P)fs({rule:p,selectedDate:r,selectedSlot:f,itemType:s,itemId:n})&&(!y||p.priority>y.rule.priority||p.priority===y.rule.priority&&p.rule_id<y.rule.rule_id)&&(y={offer:h,rule:p})}return y},[C.offers,N]);d.useEffect(()=>{const s=St();le(n=>({...n,activeOffer:(s==null?void 0:s.offer)||null,activeRule:(s==null?void 0:s.rule)||null}))},[St]),d.useEffect(()=>{if(!C.activeOffer||!C.activeRule||!N){le(h=>({...h,offerPreview:null}));return}const s=Number(N.price||N.unitPrice||0),n=C.activeRule.rule_discount_type||C.activeOffer.discount_type||"percent",r=Number(C.activeRule.rule_discount_value??C.activeOffer.discount_value??0);let f=s;n==="percent"?f=s*(1-r/100):n==="amount"&&(f=Math.max(0,s-r));const y=s-f;le(h=>({...h,offerPreview:{basePrice:s,newPrice:f,savings:y,discountType:n,discountValue:r,offerTitle:C.activeOffer.title,ruleId:C.activeRule.rule_id}}))},[C.activeOffer,C.activeRule,N]);const rt="snowcity_booking_state";d.useEffect(()=>{if(!(!$&&l===1))try{const s={};ae.forEach((r,f)=>{r instanceof Map&&(s[f]=Array.from(r.entries()))});const n={step:l,cartItems:S,cartAddons:s,sel:i,countryCode:de,phoneLocal:oe,paymentGateway:I,selectedOfferId:re,timestamp:Date.now()};sessionStorage.setItem(rt,JSON.stringify(n))}catch(s){console.warn("Failed to save booking state:",s)}},[l,S,ae,i,de,oe,I,re,$]),d.useEffect(()=>{var s;try{const n=sessionStorage.getItem(rt);if(!n)return;const r=JSON.parse(n);if(Date.now()-(r.timestamp||0)>30*60*1e3){sessionStorage.removeItem(rt);return}if((s=r.cartItems)!=null&&s.length&&(t(Ut()),r.cartItems.forEach(f=>t(Vt(f)))),r.cartAddons){const f=new Map;Object.entries(r.cartAddons).forEach(([y,h])=>{f.set(y,new Map(h))}),Je(f)}r.step&&r.step>1&&(t(Z(r.step)),R(!1)),r.sel&&M(f=>({...f,...r.sel})),r.countryCode&&me(r.countryCode),r.phoneLocal&&se(r.phoneLocal),r.paymentGateway&&A(r.paymentGateway),r.selectedOfferId&&Qe(r.selectedOfferId)}catch(n){console.warn("Failed to restore booking state:",n)}},[]),d.useEffect(()=>{const s=()=>{};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[]);const at=d.useRef(!1);d.useEffect(()=>{if(at.current){at.current=!1;return}l>1&&window.history.pushState({bookingStep:l},"",`#step-${l}`)},[l]),d.useEffect(()=>{const s=n=>{var f;const r=((f=n.state)==null?void 0:f.bookingStep)||1;at.current=!0,t(Z(r))};return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[t]),d.useEffect(()=>{if(b!=null&&b.phone&&!oe){const s=String(b.phone).replace(/\D/g,"");if(s.length>10){const n=is.find(r=>s.startsWith(r.code.replace("+","")));n?(me(n.code),se(s.slice(n.code.length-1))):se(s.slice(-10))}else se(s)}},[]),d.useEffect(()=>{if(C.status!=="idle")return;let s=!1;return(async()=>{le(r=>({...r,status:"loading",loadingOffers:!0}));try{const r=await Ke.get(Ue.offers.list(),{params:{active:!0,limit:20}});if(s)return;const f=Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[];le(y=>({...y,status:"succeeded",offers:f,loadingOffers:!1}))}catch{s||le(r=>({...r,status:"failed",loadingOffers:!1}))}})(),()=>{s=!0}},[C.status]),d.useEffect(()=>{if(Ct||kt.length>0)return;let s=!1;return(async()=>{Mt(!0);try{const r=await Ke.get(Ue.coupons.list(),{params:{active:!0,limit:50}});if(s)return;const f=Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[];_t(f)}catch(r){console.error("Failed to fetch promos:",r),_t([])}finally{Mt(!1)}})(),()=>{s=!0}},[]),d.useCallback(()=>{a("/")},[a]);const js=(s,n,r)=>{const f=c;f&&Je(y=>{const h=new Map(y),P=new Map(h.get(f)||[]);return n<=0?P.delete(s):P.set(s,{addon_id:s,name:(r==null?void 0:r.name)??(r==null?void 0:r.title)??(r==null?void 0:r.label)??"Addon",price:Number((r==null?void 0:r.price)??(r==null?void 0:r.amount)??0),quantity:n}),h.set(f,P),h})},[ue]=$s(),Ce=ue.get("type"),ye=ue.get("attraction_id"),ge=ue.get("combo_id"),nt=ue.get("date"),it=ue.get("slot"),lt=ue.get("qty"),ot=ue.get("openDrawer");d.useEffect(()=>{g.status==="idle"&&t(Ys({active:!0,limit:100})),v.status==="idle"&&t(zs({active:!0,limit:100})),_.status==="idle"&&t(Es({active:!0,limit:100}))},[t,g.status,v.status,_.status]),d.useEffect(()=>{l===3&&u&&t(Z(4))},[l,u,t]),d.useEffect(()=>{const s=localStorage.getItem("pendingOrderData");if(s)try{const n=JSON.parse(s);console.log(" Found pending order data:",n),n.email&&!b.email&&t(Be({email:n.email})),n.mobile&&!b.phone&&t(Be({phone:n.mobile})),localStorage.removeItem("pendingOrderData")}catch(n){console.error("Error parsing pending order data:",n),localStorage.removeItem("pendingOrderData")}},[t,b.email,b.phone]),d.useEffect(()=>{!ye&&!ge&&t(Ut())},[t,ye||"",ge||""]),d.useEffect(()=>{const s={};Ce&&(s.itemType=Ce),ye&&(g.items||[]).some(r=>String(be(r))===String(ye))&&(s.attractionId=String(ye),Ce||(s.itemType="attraction")),ge&&(v.items||[]).some(r=>String(je(r))===String(ge))&&(s.comboId=String(ge),Ce||(s.itemType="combo")),nt&&(s.date=nt),it&&(s.slotKey=it),lt&&(s.qty=Math.max(1,Number(lt)||1)),Object.keys(s).length>0&&M(n=>({...n,...s}))},[Ce||"",ye||"",ge||"",nt||"",it||"",lt||"",ot||"",g.items||[],v.items||[]]);const Tt=d.useCallback(async({itemType:s,attractionId:n,comboId:r,date:f})=>{if(!f)return;const y=s==="combo"?r:n;if(y){ke({status:"loading",items:[],error:null});try{if(s==="combo"){const h=await Ke.get(Ue.combos.slots(y),{params:{date:pe(f)}}),P=Array.isArray(h==null?void 0:h.data)?h.data:Array.isArray(h)?h:[];ke({status:"succeeded",items:P,error:null})}else{const h=await Ke.get(Ue.slots.list(),{params:{attraction_id:y,date:pe(f)}}),P=Array.isArray(h==null?void 0:h.data)?h.data:Array.isArray(h)?h:[];ke({status:"succeeded",items:P,error:null})}}catch(h){ke({status:"failed",items:[],error:(h==null?void 0:h.message)||"Failed to load slots"})}}},[]);d.useEffect(()=>{const s=i.itemType,n=i.date,r=i.attractionId,f=i.comboId;(s==="combo"?f:r)&&n?(M(h=>({...h,slotKey:i.slotKey||""})),Tt({itemType:s,attractionId:r,comboId:f,date:n})):ke({status:"idle",items:[],error:null})},[i.itemType||"",i.attractionId||"",i.comboId||"",i.date||"",Tt]);const j=d.useMemo(()=>i.itemType==="attraction"?_e.find(s=>String(be(s))===String(i.attractionId)):null,[_e||[],i.itemType||"",i.attractionId||""]),O=d.useMemo(()=>i.itemType==="combo"?ze.find(s=>String(je(s))===String(i.comboId)):null,[ze||[],i.itemType||"",i.comboId||""]),x=d.useMemo(()=>{for(let s=0;s<he.items.length;s+=1){const n=he.items[s];if(ht(n,s)===i.slotKey)return n;const r=[n==null?void 0:n.slot_id,n==null?void 0:n.id,n==null?void 0:n._id,n==null?void 0:n.combo_slot_id].filter(Boolean);if(i.slotKey&&r.map(String).includes(String(i.slotKey)))return n}return null},[he.items,i.slotKey]),K=d.useMemo(()=>{if(i.itemType==="combo"&&O){const s=X(cs(O)),n=X(Gt(O)||s),r=(x==null?void 0:x.pricing)||{},f=(x==null?void 0:x.offer)||null,y=x?Qt(x,n):n,h=x?Jt(x,s):s;let P=X(r.base_price??y),p=X(r.final_price??h);P||(P=y),p||(p=h);const V=pe(i.date),te=je(O);let z=f||null;if(!z&&(z=C.offers.find(q=>(q.rule_type==="happy_hour"||q.rule_type==="holiday"||q.rule_type==="special")&&ms(q,V,x,"combo",te)),z)){const q=Xe(z,P||p);p=Math.max(0,(P||p)-q)}return{title:os(O,je(O)),price:p,originalPrice:P||p,happyHourOffer:z,offerDescription:(z==null?void 0:z.description)||"",image:He(O),previewImages:Mr(O)}}if(i.itemType==="attraction"&&j){const s=X(bt(j)||(j==null?void 0:j.price)||(j==null?void 0:j.base_price)||(j==null?void 0:j.amount)||0),n=X(Gt(j)||s),r=(x==null?void 0:x.pricing)||{},f=(x==null?void 0:x.offer)||null,y=x?Qt(x,n):n,h=x?Jt(x,s):s;let P=X(r.base_price??y),p=X(r.final_price??h);P||(P=y),p||(p=h);const V=pe(i.date),te=be(j);let z=f||null;if(!z&&(z=C.offers.find(q=>(q.rule_type==="happy_hour"||q.rule_type==="holiday"||q.rule_type==="special")&&ms(q,V,x,"attraction",te)),z)){const q=Xe(z,P||p);p=Math.max(0,(P||p)-q)}return{title:(j==null?void 0:j.name)||(j==null?void 0:j.title)||`Attraction #${be(j)}`,price:p,originalPrice:P||p,happyHourOffer:z,offerDescription:(z==null?void 0:z.description)||"",image:Ve(j)}}return{title:"",price:0,originalPrice:0,offerDescription:""}},[i.itemType||"",O||null,j||null,x||null,i.date||"",C.offers||[]]);d.useEffect(()=>{l===1&&ot==="true"&&(i.itemType==="attraction"||i.itemType==="combo")&&K.title&&!Y.current&&(Y.current=!0,R(!0))},[l,ot,i.itemType,K.title]);const Me=Math.max(1,Number(i.qty)||1),vs=Number(K.price||0)*Me,ne=!!(K.title&&i.date&&i.slotKey&&Me),Ns=d.useMemo(()=>S.reduce((s,n)=>s+Number(n.unitPrice||0)*Number(n.quantity||0),0),[S||[]]),At=d.useMemo(()=>{let s=0;return ae.forEach((n,r)=>{S.find(y=>y.key===r)&&n.forEach(y=>{s+=Number(y.price||0)*Number(y.quantity||0)})}),s},[ae||new Map,S||[]]),Pe=Ns+At,ct=Number(w.discount||0),dt=d.useMemo(()=>re?C.offers.find(s=>String(We(s))===String(re)):null,[C.offers,re]),It=d.useMemo(()=>dt?Xe(dt,Pe):0,[dt,Pe]),ws=ct>0&&(w.code||((Rt=w.data)==null?void 0:Rt.code)),xe=Math.max(0,Pe-ct-It);K.image||Ve(_e[0])||He(ze[0]);const ks=d.useMemo(()=>{if(!c)return new Map;const s=ae.get(c);return s instanceof Map?s:new Map},[ae,c]),Ee=d.useCallback(()=>{if(!ne)return!1;const s=i.itemType==="combo"?"Combo":"Attraction",n=i.itemType==="combo"?(x==null?void 0:x.combo_slot_id)??(x==null?void 0:x.id)??(x==null?void 0:x._id)??null:(x==null?void 0:x.slot_id)??(x==null?void 0:x.id)??(x==null?void 0:x._id)??null,r=(x==null?void 0:x.offer)||K.happyHourOffer||null,f={key:L||Cr(),merge:!1,item_type:s,title:K.title,slotLabel:x?ns(x):"",quantity:Me,booking_date:pe(i.date),booking_time:(x==null?void 0:x.start_time)||(x==null?void 0:x.startTime)||(x==null?void 0:x.slot_start_time)||null,unitPrice:K.price||0,dateLabel:pe(i.date),slot_id:s==="Attraction"?n:null,combo_slot_id:s==="Combo"?n:null,attraction_id:s==="Attraction"?be(j):null,combo_id:s==="Combo"?je(O):null,slot:x||null,attraction:j||null,combo:O||null,pricing:(x==null?void 0:x.pricing)||null,originalPrice:K.originalPrice||null,offer:r,offerDescription:K.offerDescription||(r==null?void 0:r.description)||""};return L&&t(Ht(L)),t(Vt(f)),t(Wt(f.key)),k(null),M(ls()),Je(y=>{const h=new Map(y);return h.has(f.key)||h.set(f.key,new Map),h}),!0},[ne,i||{},K||{},x||null,j||null,O||null,Me||1,L||null,t]),_s=d.useCallback(()=>{if(!ne){alert("Please select a date, a time slot, and quantity first.");return}const n=[i.itemType==="combo"?"Combo":"Attraction",i.itemType==="combo"?i.comboId:i.attractionId||"na",(i.itemType==="attraction",i.slotKey||"na"),i.date||"na"].join(":");S.some(f=>f.fingerprint===n)||Ee(),t(Z(2))},[ne,i,S,Ee,t,u]),Le=()=>{if(l===1)if($)t(Z(2));else{if(!ne){alert("Please select date, time slot and quantity.");return}Ee()&&t(Z(2))}else l===2?t(Z(u?4:3)):l===3&&(B.verified?t(Z(4)):alert("Please verify OTP to continue."))},Oe=()=>{l!==1&&window.history.back()},Cs=async()=>{const s={},n=(b.email||"").trim();if(jr.test(n)||(s.email="Please enter a valid email address"),oe.length!==10&&(s.phone="Phone number must be exactly 10 digits"),Object.keys(s).length>0){Q(s);return}Q({});const r=`${de}${oe}`;t(Be({email:n,phone:r}));try{await t(Ls({email:n,phone:r})).unwrap()}catch(f){alert((f==null?void 0:f.message)||"Failed to send OTP")}},Ms=async()=>{if(!$e||$e.length<4)return alert("Enter the full OTP code");await t(Os({otp:$e})).unwrap().then(()=>{wt(""),t(Z(4))}).catch(s=>alert((s==null?void 0:s.message)||"OTP verification failed"))},Ps=async()=>{Ye&&await t(qs({code:Ye,total_amount:Math.max(0,Pe),onDate:i.date||pe(new Date)})).unwrap().then(()=>t(Xt(Ye))).catch(()=>{})},Dt=s=>{window.confirm("Are you sure you want to remove this item?")&&t(Ht(s))},$t=s=>{M({itemType:s.item_type==="Combo"?"combo":"attraction",attractionId:s.attraction_id?String(s.attraction_id):"",comboId:s.combo_id?String(s.combo_id):"",date:s.booking_date,slotKey:s.slot?ht(s.slot):s.slot_id||"",qty:s.quantity}),k(s.key),ie("booking"),R(!0)},Ss=()=>C.loadingOffers||!C.offers.length?null:e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"Available Offers"}),re&&e.jsx("button",{type:"button",onClick:()=>Qe(""),className:"text-xs font-medium text-sky-700 hover:underline",children:"Remove"})]}),e.jsx("div",{className:"space-y-3",children:C.offers.map(s=>{const n=String(We(s));if(!n)return null;const r=$r(s,K.price||0,Me);return e.jsxs("label",{className:`flex items-start gap-3 rounded-2xl border px-3 py-3 cursor-pointer transition-all duration-200 ${String(re)===n?"border-sky-500 bg-sky-50 shadow-sm":"hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"selected-offer",className:"mt-1",checked:String(re)===n,onChange:()=>Qe(n)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:ds(s)}),yt(s)?e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 line-clamp-2",children:yt(s)}):null]}),e.jsx("span",{className:"text-xs font-semibold text-sky-700 bg-sky-50 px-2 py-1 rounded-full",children:r?`Save â‚¹${r.totalDiscount.toFixed(0)}`:"No discount"})]}),r&&r.totalDiscount>0&&e.jsxs("p",{className:"text-xs text-emerald-600 mt-1",children:["Save up to â‚¹",r.totalDiscount.toFixed(0)," with this offer"]})]})]},`offer-${n}`)})})]}),Yt=()=>{M(s=>({...s,date:ve(),slotKey:""}))},zt=()=>{M(s=>({...s,date:F().add(1,"day").format("YYYY-MM-DD"),slotKey:""}))},[Et,qe]=d.useState(!1),[Ts,Lt]=d.useState(null),Se=d.useMemo(()=>null,[Ts,Et]),Ot=s=>{s.preventDefault(),s.stopPropagation(),Lt(s.currentTarget),qe(!0)},As=s=>{M(n=>({...n,date:s,slotKey:""})),qe(!1)},qt=s=>{if(!s)return"All Days";const n=F(s);return s===ve()||s===F().add(1,"day").format("YYYY-MM-DD")?"All Days":n.format("D MMM")},Ft=async()=>{var r,f;if((D==null?void 0:D.status)==="loading"||ce)return;if(!u){W(!0);return}if(!$)return;Ze(!0),et(Date.now());const s=((b==null?void 0:b.email)||((r=m==null?void 0:m.user)==null?void 0:r.email)||"").trim(),n=((b==null?void 0:b.phone)||((f=m==null?void 0:m.user)==null?void 0:f.phone)||"").trim();if(!s||!n){Ze(!1),et(null),alert("Email and mobile number are required for payment. Please complete your contact details.");return}try{const y=S.map(p=>{var q,Te,Fe,Bt,Kt;const V={item_type:p.item_type,attraction_id:p.attraction_id,combo_id:p.combo_id,slot_id:p.slot_id,combo_slot_id:p.combo_slot_id,booking_date:p.booking_date,quantity:p.quantity,slot_label:p.slotLabel,slot_start_time:((q=p.slot)==null?void 0:q.start_time)||p.booking_time||null,slot_end_time:((Te=p.slot)==null?void 0:Te.end_time)||null,booking_time:((Fe=p.slot)==null?void 0:Fe.start_time)||p.booking_time||null,offer_id:((Bt=p.offer)==null?void 0:Bt.offer_id)||p.offer_id||null,offer_rule_id:((Kt=p.offer)==null?void 0:Kt.rule_id)||p.offer_rule_id||null},te=ae.get(p.key)||new Map,z=Array.from(te.values()).filter(Re=>Number(Re.quantity)>0).map(Re=>({addon_id:Re.addon_id,quantity:Number(Re.quantity)}));return z.length>0&&(V.addons=z),V});console.log("ðŸ“¦ Creating booking with payload:",y);const h=await t(Fs(y)).unwrap();console.log("âœ… Booking creation result:",h);const P=(h==null?void 0:h.order_id)||(h==null?void 0:h.orderId);if(console.log("ðŸ”¢ Order ID extracted:",P),!P)throw console.error("Ã¢ÂÅ’ No order ID in response:",h),new Error("Failed to create order - no order ID returned");if(I==="phonepe"){const p=await t(Rs({orderId:P,email:s,mobile:n,amount:xe})).unwrap();if(console.log("âœ… PhonePe payment initiated:",p),p.ok&&p.redirectUrl)st(p.redirectUrl),tt(!0),window.PhonePeCheckout&&window.PhonePeCheckout.transact?window.PhonePeCheckout.transact({tokenUrl:p.redirectUrl,callback:V=>{console.log("ðŸ“¡ PhonePe iframe callback:",V),tt(!1),st(""),V==="USER_CANCEL"?alert("Payment was cancelled. You can try again or continue with a different payment method."):V==="CONCLUDED"?a(`/payment/success?orderId=${P}&gateway=phonepe`):(console.warn("Unknown PhonePe callback response:",V),alert("Payment status unclear. Please check your email for confirmation."))},type:"IFRAME"}):(console.error("Ã¢ÂÅ’ PhonePe checkout script not loaded"),alert("Payment system not ready. Please refresh and try again."));else throw new Error(p.responseMessage||"Failed to initiate PhonePe payment")}else{const p=await t(Bs({orderId:P,email:s,mobile:n,amount:xe})).unwrap();if(p.ok&&p.redirectUrl)console.log("âœ… PayPhi payment initiated, redirecting to:",p.redirectUrl),window.location.href=p.redirectUrl;else throw new Error(p.responseMessage||"Failed to initiate PayPhi payment")}}catch(y){console.error("Ã¢ÂÅ’ Payment initiation failed:",y),alert(`Payment failed: ${(y==null?void 0:y.message)||y}`)}finally{Ze(!1),et(null)}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 to-white font-inter pt-20",children:[e.jsx("div",{className:"sticky top-[7rem] z-10 bg-gradient-to-b from-sky-50 to-white mb-8",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${l>=1?"bg-sky-600 text-white":"bg-gray-300 text-gray-600"}`,children:"1"}),e.jsx("span",{className:"text-xs mt-2 text-center",children:"Experience"})]}),e.jsx("div",{className:`h-0.5 w-12 ${l>=2?"bg-sky-600":"bg-gray-300"}`}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${l>=2?"bg-sky-600 text-white":"bg-gray-300 text-gray-600"}`,children:"2"}),e.jsx("span",{className:"text-xs mt-2 text-center",children:"Add-ons"})]}),e.jsx("div",{className:`h-0.5 w-12 ${l>=3?"bg-sky-600":"bg-gray-300"}`}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${l>=3?"bg-sky-600 text-white":"bg-gray-300 text-gray-600"}`,children:"3"}),e.jsx("span",{className:"text-xs mt-2 text-center",children:"Your Details"})]}),e.jsx("div",{className:`h-0.5 w-12 ${l>=4?"bg-sky-600":"bg-gray-300"}`}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${l>=4?"bg-sky-600 text-white":"bg-gray-300 text-gray-600"}`,children:"4"}),e.jsx("span",{className:"text-xs mt-2 text-center",children:"Payment"})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-3 lg:px-0 pb-24 lg:pb-20 pt-10",children:e.jsxs("div",{className:"mt-2 md:mt-4",children:[l===1&&e.jsx(hr,{sel:i,setSel:M,combos:ze,prioritizedAttractions:gs,cartItems:S,hasCartItems:$,finalTotal:xe,todayYMD:ve,handleToday:Yt,handleTomorrow:zt,onCalendarButtonClick:Ot,setCalendarAnchor:Lt,formatDateDisplay:qt,getAttrId:be,getComboId:je,getComboDisplayPrice:cs,getPrice:bt,getComboLabel:os,getComboPrimaryImage:He,getAttractionImage:Ve,idsMatch:Nt,onEditCartItem:$t,setDetailsMainImage:U,setDrawerMode:ie,setDrawerOpen:R,onRemoveCartItem:Dt,handleNext:Le,step:l,paymentLoading:ce}),l===2&&e.jsx(yr,{cartItems:S,activeItemKey:c,setActiveCartItem:Wt,dispatch:t,addonsState:_,getAddonId:Nr,getAddonPrice:vr,getAddonName:wr,getAddonImage:kr,currentItemAddons:ks,handleAddonQuantityChange:js,cartAddons:ae,onEditCartItem:$t,onRemoveCartItem:Dt,finalTotal:xe,handleNext:Le,handleBack:Oe,hasCartItems:$}),l===3&&e.jsx(gr,{hasToken:u,contact:b,dispatch:t,setContact:Be,contactErrors:we,setContactErrors:Q,countryCode:de,setCountryCode:me,COUNTRY_CODES:is,phoneLocal:oe,handlePhoneChange:bs,otp:B,sendOTP:Cs,otpCode:$e,setOtpCode:wt,verifyOTP:Ms,handleBack:Oe,handleNext:Le}),l===4&&e.jsx(br,{OfferSelector:Ss,paymentGateway:I,setPaymentGateway:A,couponApplied:ws,coupon:w,couponDiscount:ct,selectedOfferDiscount:It,finalTotal:xe,promoInput:Ye,setPromoInput:hs,dispatch:t,setCouponCode:Xt,applyPromo:Ps,promosLoading:Ct,availablePromos:kt,handleBack:Oe,onPlaceOrderAndPay:Ft,creating:D,paymentLoading:ce,hasCartItems:$,selectedOfferId:re,state:C,getOfferId:We,getOfferTitle:ds,getOfferSummary:yt,cartItems:S,cartAddons:ae,totalAddonsCost:At,grossTotal:Pe,formatCurrency:Vs,dayjs:F}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 md:px-0 py-3 md:py-3 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] z-[140] md:hidden",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex gap-3 items-center",children:[l>1&&e.jsx("button",{type:"button",onClick:Oe,className:"p-2.5 rounded-xl border border-gray-200 text-gray-700 hover:border-gray-300 active:scale-[0.98] transition-all flex items-center justify-center",title:"Go back",children:e.jsx(xs,{size:18})}),e.jsx("div",{className:`flex-1 ${o?"hidden":""}`,children:e.jsxs("div",{className:"text-base font-semibold text-gray-900 tabular-nums",children:["â‚¹",xe]})}),e.jsxs("button",{type:"button",onClick:l===4?Ft:Le,disabled:l===4?(D==null?void 0:D.status)==="loading"||ce||!$:l===3?!B.verified:l===2?!$:!$&&!ne,className:`ml-auto inline-flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${(l===4?(D==null?void 0:D.status)==="loading"||ce||!$:l===3?!B.verified:l===2?!$:!$&&!ne)?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-sky-600 text-white shadow-md hover:bg-sky-700"}`,children:[e.jsx("span",{children:l===4?ce?"Processing Payment...":`Pay â‚¹${xe}`:l===3?"Continue":"Next"}),l===4&&ce&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),l!==4||!ce?e.jsx(De,{size:16}):null]})]})}),!o&&E.totalQuantity>0&&e.jsx("div",{className:"fixed bottom-8 right-4 z-50",children:e.jsxs("button",{onClick:()=>{const s=document.getElementById("cart-section");s&&s.scrollIntoView({behavior:"smooth"})},className:"relative bg-sky-600 text-white rounded-full p-3 shadow-lg hover:bg-sky-700 transition-colors",children:[e.jsx(Zt,{size:20}),E.totalQuantity>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 font-bold",children:E.totalQuantity})]})}),ee&&K.title&&e.jsxs("div",{className:"fixed inset-0 z-[160] flex justify-end items-end md:items-stretch bg-black/40 backdrop-blur-[2px] md:bg-black/20",children:[e.jsx("div",{className:"flex-1 hidden md:block",onClick:()=>R(!1)}),e.jsxs("div",{className:"w-full md:w-1/3 bg-white rounded-2xl  md:rounded-l-3xl shadow-2xl flex flex-col transform translate-y-0 transition-all h-[66vh] md:h-screen max-h-[66vh] md:max-h-screen md:mt-0",children:[e.jsx("div",{className:"md:hidden flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"h-1.5 w-12 rounded-full bg-gray-300"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between px-4 sm:px-6 pt-4 pb-2 border-b border-gray-100 bg-white rounded-tl-2xl  md:rounded-tl-3xl sm:rounded-tl-3xl",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 pr-3 truncate",children:K.title}),e.jsx("button",{type:"button",onClick:()=>R(!1),className:"p-2 rounded-full hover:bg-gray-100 text-gray-500 flex-shrink-0",children:e.jsx(ut,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-4 py-4 space-y-4",children:fe==="details"?e.jsxs("div",{className:"space-y-4",children:[(()=>{const s=T||K.image||(i.itemType==="combo"?He(O):Ve(j));return s?e.jsxs("div",{className:"relative rounded-2xl overflow-hidden border border-gray-100 shadow-sm",children:[e.jsx("img",{src:s,alt:K.title,className:"w-full h-56 sm:h-64 object-cover"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 px-4 py-2 bg-gradient-to-t from-black/60 to-transparent text-white text-sm font-semibold",children:K.title})]}):null})(),e.jsx("div",{className:"text-sm text-gray-700",children:((i.itemType==="combo"?(O==null?void 0:O.description)||(O==null?void 0:O.short_description)||(O==null?void 0:O.summary)||"":(j==null?void 0:j.description)||(j==null?void 0:j.short_description)||(j==null?void 0:j.summary)||(j==null?void 0:j.about)||"")||"").split(`
`).map((n,r)=>e.jsx("p",{className:"mb-2",children:n},r))}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",onClick:()=>ie("booking"),className:"w-full px-4 py-3 rounded-xl bg-sky-600 text-white font-semibold",children:"Book this"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:Yt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${i.date===ve()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),e.jsx("button",{type:"button",onClick:zt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${i.date===F().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:Ot,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${i.date&&i.date!==""&&i.date!==ve()&&i.date!==F().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:qt(i.date)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Time slot"}),e.jsx("div",{className:"relative",children:he.status==="loading"?e.jsx("div",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-sky-600 rounded-full animate-spin"}),"Loading slots..."]})}):he.status==="failed"?e.jsx("div",{className:"w-full p-3.5 bg-red-50 border border-red-200 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-red-600 text-sm",children:"Failed to load slots"})}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none text-sm font-medium appearance-none cursor-pointer disabled:bg-gray-100 disabled:text-gray-400 transition-all hover:border-gray-300",value:i.slotKey,onChange:s=>M(n=>({...n,slotKey:s.target.value})),disabled:!i.attractionId&&!i.comboId,children:[e.jsx("option",{value:"",children:!i.attractionId&&!i.comboId?"Select a ticket above first":"Select a time slot"}),he.items.map((s,n)=>{const r=ht(s,n),f=Ar(s),y=Tr(s,i.date),h=!f||!y;return e.jsxs("option",{value:r,disabled:h,children:[ns(s)," ",f?y?"":"(Not Available)":"(Full)"]},r)})]}),e.jsx(vt,{size:16,className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 rotate-90"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 rounded-xl p-1.5 border border-gray-200 w-fit",children:[e.jsx("button",{onClick:()=>M(s=>({...s,qty:Math.max(1,s.qty-1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-white text-gray-600 shadow-sm hover:text-sky-700 active:scale-95 transition",children:e.jsx(ps,{size:16})}),e.jsx("span",{className:"font-bold text-lg w-8 text-center text-gray-800 tabular-nums",children:i.qty}),e.jsx("button",{onClick:()=>M(s=>({...s,qty:Math.max(1,s.qty+1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-95 transition",children:e.jsx(us,{size:16})})]})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-x-0 top-0 h-4 bg-gradient-to-t from-white via-white/70 to-transparent pointer-events-none"}),e.jsxs("div",{className:"px-4 sm:px-6 py-3 border-t border-gray-100 bg-white flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",children:"Subtotal"}),e.jsxs("div",{className:"text-lg font-bold text-sky-700 tabular-nums",children:["â‚¹",vs.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:Ee,disabled:!ne,className:"inline-flex items-center gap-2 px-4 py-2 rounded-full border border-gray-200 text-xs font-semibold text-gray-700 hover:border-sky-300 disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(Zt,{size:16}),e.jsx("span",{children:"Add to Cart"})]}),e.jsxs("button",{type:"button",onClick:_s,disabled:!ne,className:"flex items-center gap-2 px-4 py-2.5 rounded-full bg-sky-600 text-white text-sm font-semibold shadow-md hover:bg-sky-700 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(Ne,{size:18}),e.jsx("span",{children:"Buy"})]})]})]})]})]})]}),H&&e.jsx(pr,{onClose:()=>W(!1),onSignIn:()=>{W(!1),t(Z(3))},onContinueAsGuest:()=>{W(!1),t(Z(3))}}),ys&&e.jsx("div",{className:"fixed inset-0 z-[200] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl h-[80vh] max-h-[600px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 11 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Complete Payment"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Secure payment powered by PhonePe"})]})]}),e.jsx("button",{onClick:()=>{tt(!1),st(""),window.PhonePeCheckout&&window.PhonePeCheckout.closePage&&window.PhonePeCheckout.closePage()},className:"p-2 hover:bg-gray-100 rounded-lg text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ut,{size:20})})]}),e.jsx("div",{className:"flex-1 p-4",children:Pt?e.jsx("iframe",{src:Pt,className:"w-full h-full rounded-xl border border-gray-200",title:"PhonePe Payment",allow:"payment",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation"}):e.jsx("div",{className:"w-full h-full rounded-xl bg-gray-50 border border-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-purple-600 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading payment page..."})]})})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:"Secure payment processing â€¢ 256-bit SSL encryption"})]})})]})}),Et&&e.jsxs("div",{className:"fixed inset-0 z-[9999] flex",onClick:()=>qe(!1),children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"absolute bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 w-80 max-h-[70vh] overflow-y-auto",style:{top:Se?`${Se.top}px`:"50%",left:Se?`${Se.left-160}px`:"50%",transform:Se?"none":"translate(-50%, -50%)"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Select Date"}),e.jsx("button",{onClick:()=>qe(!1),className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 transition-colors",children:e.jsx(ut,{size:18})})]}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(s=>{const n=F().add(s,"month"),r=n.startOf("month"),f=n.endOf("month"),y=r.day(),h=f.date(),P=F();return e.jsxs("div",{className:"border border-gray-100 rounded-xl p-3 bg-white",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:n.format("MMMM YYYY")}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-xs",children:[["Su","Mo","Tu","We","Th","Fr","Sa"].map(p=>e.jsx("div",{className:"text-center text-gray-400 font-medium py-2",children:p},p)),Array.from({length:y}).map((p,V)=>e.jsx("div",{className:"p-2"},`empty-${V}`)),Array.from({length:h}).map((p,V)=>{const te=r.date(V+1),z=te.format("YYYY-MM-DD"),q=te.isBefore(P,"day"),Te=i.date===z,Fe=te.isSame(P,"day");return e.jsx("button",{onClick:()=>As(z),disabled:q,className:`
                                  p-2 rounded-lg text-sm font-medium transition-all duration-200
                                  ${q?"text-gray-300 cursor-not-allowed bg-gray-50":""}
                                  ${Te?"bg-sky-600 text-white shadow-md":""}
                                  ${!q&&!Te?"hover:bg-sky-50 text-gray-700":""}
                                  ${Fe?"ring-2 ring-sky-300":""}
                                `,children:te.date()},V)})]})]},s)})})]})]})]})})]})})}export{Zr as default};
