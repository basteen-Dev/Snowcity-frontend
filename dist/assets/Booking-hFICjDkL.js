import{j as e,h as ks,A as _s,u as fe,r as x,H as Cs,m as Ms,q as Ps,t as Ss,I as Ot,F as L,J as ae,K as As,i as De,k as Ye,M as Et,E as Ts,Q as zt,D as S,S as Lt,T as Is,U as Ds,V as Ys,W as $s,X as Os,Y as Es}from"./index-CmreT6x1.js";import{i as Ee}from"./media-DcknJ8BL.js";import{p as zs,U as Ls}from"./attractions-_HVo1AsH.js";import{a as qt,b as Ft,c as Rt,g as rt}from"./pricing-Df4qX4St.js";import{f as Bt}from"./formatters-CmiLqhJj.js";import{c as R}from"./createLucideIcon-CgZNF2TE.js";import{P as Kt,C as Ut}from"./plus-Bg96swes.js";import{M as qs}from"./mail-CP5R_p3Q.js";import{C as Vt}from"./circle-alert-B5yOgMhC.js";import{P as Fs}from"./phone-DIOmnULa.js";import{T as Rs}from"./ticket-hq6RMmhb.js";import{X as Je}from"./x-uvzjoDwd.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Gt=R("arrow-left",Bs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],be=R("arrow-right",Ks);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ze=R("check",Us);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],et=R("chevron-right",Vs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Hs=R("globe",Gs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Xs=R("log-in",Ws);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ht=R("minus",Qs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],re=R("shopping-bag",Js);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ea=R("triangle-alert",Zs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],sa=R("user-plus",ta);function aa({isOpen:t,onClose:i,onSignIn:c}){return t?e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl bg-white shadow-2xl dark:bg-neutral-900 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-8 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ea,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-lg font-bold",children:"Session Expired"})]}),e.jsx("p",{className:"mt-2 text-sm opacity-90",children:"Your login session has expired. Please sign in again to continue booking."})]}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mb-6",children:"Your booking information is saved. Sign in again to complete your purchase without losing your selections."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:c,className:"w-full flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3 text-white font-semibold transition-all duration-200 hover:shadow-lg hover:from-blue-700 hover:to-blue-800 active:scale-95",children:[e.jsx(Xs,{className:"h-5 w-5"}),"Sign In Again"]}),e.jsx("button",{onClick:i,className:"w-full rounded-lg border border-gray-300 px-4 py-2 text-gray-700 font-medium transition-all hover:bg-gray-50 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",children:"Continue as Guest"})]})]})]})}):null}const W=t=>S(t).format("YYYY-MM-DD"),V=()=>S().format("YYYY-MM-DD"),ne=t=>(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.attraction_id)??null,ie=t=>(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.combo_id)??null,tt=(t,i)=>String((t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.slot_id)??(t==null?void 0:t.combo_slot_id)??`${(t==null?void 0:t.start_time)||""}-${(t==null?void 0:t.end_time)||""}-${i}`),Wt=t=>{if(!t)return"";const[i,c]=t.split(":"),p=parseInt(i,10),h=p>=12?"PM":"AM";return`${p%12||12}:${c} ${h}`},Xt=t=>{if(t!=null&&t.label)return t.label;const i=Wt(t==null?void 0:t.start_time),c=Wt(t==null?void 0:t.end_time);return i&&c?`${i} - ${c}`:i||`Slot #${(t==null?void 0:t.id)||"?"}`},ra=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,Qt=[{code:"+91",label:"IN (+91)"},{code:"+1",label:"US (+1)"},{code:"+971",label:"AE (+971)"},{code:"+44",label:"UK (+44)"},{code:"+65",label:"SG (+65)"}],na=t=>Number((t==null?void 0:t.price)??(t==null?void 0:t.amount)??0),ia=t=>(t==null?void 0:t.id)??(t==null?void 0:t.addon_id)??(t==null?void 0:t._id)??null,la=t=>(t==null?void 0:t.name)??(t==null?void 0:t.title)??(t==null?void 0:t.label)??"Addon",oa=t=>{if(!t)return null;const i=[t,t==null?void 0:t.image_url,t==null?void 0:t.image,t==null?void 0:t.thumbnail,t==null?void 0:t.cover_image];for(const c of i){if(!c)continue;const p=typeof c=="string"?Ee(c):Ee(c);if(p)return p}return null};function ca(t){const i=()=>typeof window<"u"?window.matchMedia(t).matches:!1,[c,p]=x.useState(i);return x.useEffect(()=>{if(typeof window>"u")return;const h=window.matchMedia(t),b=_=>p(_.matches);return h.addEventListener("change",b),()=>h.removeEventListener("change",b)},[t]),c}const Jt=()=>({itemType:"attraction",attractionId:"",comboId:"",date:V(),slotKey:"",qty:1}),da=()=>`sel_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`,Zt=(t,i=null)=>{if(!t)return i?`Combo ${i}`:"Combo";const c=t.name??t.title??t.combo_name??t.label??null;return c||(i?`Combo ${i}`:"Combo")},je=t=>{if(!t)return null;if(typeof t=="string")return Ee(t);if(typeof t=="object"){const i=t.url||t.src||t.image_url||t.path;if(i)return Ee(i)}return null},$e=t=>{var c;if(!t)return null;const i=[t.desktop_image_url,t.hero_image,t.banner_image,t.image_url,t.cover_image,t.thumbnail,(c=t.media)==null?void 0:c[0]];for(const p of i){const h=je(p);if(h)return h}return null},Oe=t=>{var c;if(!t)return null;const i=[t.desktop_image_url,t.hero_image,t.banner_image,t.image_url,t.cover_image,(c=t.media)==null?void 0:c[0],t.attraction_1_image,t.attraction_2_image];for(const p of i){const h=je(p);if(h)return h}return null},ma=t=>{if(!t)return[];const i=[];return t.attraction_1_image&&i.push(je(t.attraction_1_image)),t.attraction_2_image&&i.push(je(t.attraction_2_image)),i.length<2&&Array.isArray(t.media)&&t.media.forEach(c=>{const p=je(c);p&&!i.includes(p)&&i.push(p)}),i.slice(0,2).filter(Boolean)},$=t=>{const i=Number(t);return Number.isFinite(i)?i:0},nt=t=>String(t||"").toLowerCase(),ze=(t,i)=>t==null||i==null?!1:String(t)===String(i),ua=t=>{if(typeof t=="boolean")return t;if(t==null)return!1;if(typeof t=="number")return t!==0;const i=String(t).trim().toLowerCase();return i?["true","1","yes","y"].includes(i)?!0:["false","0","no","n"].includes(i)?!1:!!t:!1},xa=t=>t?Array.isArray(t)?t.reduce((i,c)=>i+$(c),0):typeof t=="object"?Object.values(t).reduce((i,c)=>i+$(c),0):0:0,es=t=>{if(!t)return 0;const i=rt(t);if(i>0)return i;const c=(t==null?void 0:t.combo_price)??(t==null?void 0:t.price)??(t==null?void 0:t.amount)??(t==null?void 0:t.total_price)??(t==null?void 0:t.starting_price)??(t==null?void 0:t.min_price)??(t==null?void 0:t.base_price)??0;if($(c)>0)return $(c);const p=t==null?void 0:t.combo_attractions;if(Array.isArray(p)&&p.length){const _=p.reduce((P,g)=>P+$((g==null?void 0:g.attraction_price)??(g==null?void 0:g.price)),0);if(_>0)return _}const h=xa(t==null?void 0:t.attraction_prices);if(h>0)return h;const b=$(t==null?void 0:t.attraction_1_price)+$(t==null?void 0:t.attraction_2_price);return b>0?b:0},pa=(t,i)=>{if(!t)return!0;const c=S();if(S(i).format("YYYY-MM-DD")===c.format("YYYY-MM-DD")){const h=t.start_time||t.time||t.startTime;if(!h)return!0;const[b,_]=h.split(":"),P=parseInt(b)*60+parseInt(_),N=c.hour()*60+c.minute()+60;return P>=N}return!0},ya=t=>{if(!t)return!0;if(t.available===!1)return!1;const i=Number(t.capacity??t.available_capacity??t.available);if(Number.isNaN(i))return!0;if(t.booked!=null){const c=Number(t.booked);if(!Number.isNaN(c))return i-c>0}return i>0},it=t=>(t==null?void 0:t.id)??(t==null?void 0:t.offer_id)??(t==null?void 0:t.offerId)??(t==null?void 0:t.slug)??null,ts=t=>(t==null?void 0:t.title)||(t==null?void 0:t.name)||`Offer ${it(t)??""}`.trim(),st=t=>(t==null?void 0:t.short_description)||(t==null?void 0:t.subtitle)||(t==null?void 0:t.description)||"",lt=(t,i)=>{if(!t||!i)return 0;const c=String(t.discount_type||t.rule_discount_type||"").toLowerCase(),p=Number(t.discount_percent??t.discountPercent??(c==="percent"?t.discount_value??t.discountValue:0))||0,h=Number(t.discount_value??t.discountValue??t.flat_discount??0)||0;let b=0;c==="percent"&&p>0||p>0?b=i*p/100:b=h;const _=Number(t.max_discount??t.maxDiscount??0);return _>0&&(b=Math.min(b,_)),Math.max(0,Math.min(b,i))},at=t=>{if(!t||typeof t!="string")return null;const[i="0",c="0"]=t.split(":"),p=Number(i),h=Number(c);return!Number.isFinite(p)||!Number.isFinite(h)?null:p*60+h},ha=(t={},i)=>{if(!t.day_type)return!0;const c=S(i).day(),p=String(t.day_type).toLowerCase();return p==="weekday"?c>=1&&c<=5:p==="weekend"?c===0||c===6:p==="custom"&&Array.isArray(t.specific_days)?t.specific_days.map(Number).includes(c):!0},ga=(t={},i=null)=>{if(!i)return!(t.slot_id!=null||Array.isArray(t.slot_ids)&&t.slot_ids.length||t.specific_time||t.time_from&&t.time_to);const c=[];if(t.slot_id!=null&&c.push(t.slot_id),Array.isArray(t.slot_ids)&&c.push(...t.slot_ids),t.target_slot_id!=null&&c.push(t.target_slot_id),c.length){const b=[i.slot_id,i.id,i._id,i.combo_slot_id].filter(P=>P!=null);if(!c.some(P=>b.some(g=>ze(P,g))))return!1}if(!(t.specific_time||t.time_from&&t.time_to))return!0;const h=i.start_time||i.time||i.startTime||null;if(t.specific_time&&h&&h.slice(0,5)!==String(t.specific_time).slice(0,5))return!1;if(t.time_from&&t.time_to&&h){const b=at(h),_=at(t.time_from),P=at(t.time_to);if(b==null||_==null||P==null||b<_||b>P)return!1}return!0},as=({rule:t,selectedDate:i,selectedSlot:c,itemType:p,itemId:h})=>{if(!t||!i)return!1;const b=S(i).format("YYYY-MM-DD"),_=nt(t.target_type),P=nt(p);if(_&&P&&_!==P)return!1;if(!ua(t.applies_to_all)){const N=[];if(t.target_id!=null&&N.push(t.target_id),Array.isArray(t.target_ids)&&N.push(...t.target_ids),!N.length||!N.some(z=>ze(z,h)))return!1}return!(t.specific_date&&b!==t.specific_date||Array.isArray(t.specific_dates)&&t.specific_dates.length&&!t.specific_dates.some(N=>S(N).format("YYYY-MM-DD")===b)||t.date_from&&b<t.date_from||t.date_to&&b>t.date_to||!ha(t,b)||!ga(t,c))},ss=(t,i,c,p,h)=>!t||!i||!c?!1:(Array.isArray(t.rules)?t.rules:[]).filter(P=>as({rule:P,selectedDate:i,selectedSlot:c,itemType:p,itemId:h})).length>0,fa=(t,i,c)=>{const p=Number(i||0)*Number(c||1);if(!t||p<=0)return null;const h=lt(t,p)||0;return{total:p,totalDiscount:h,final:Math.max(0,p-h)}};function Ia(){var Tt,It,Dt,Yt,$t;const t=ks(),i=_s(),c=ca("(min-width: 768px)"),p=fe(s=>s.auth),h=!!(p!=null&&p.token),b=fe(s=>s.attractions),_=fe(s=>s.combos),P=fe(s=>s.addons),{step:g,contact:N,otp:E,coupon:z,creating:A,cart:X}=fe(s=>s.bookings),T=(X==null?void 0:X.items)||[],D=T.length>0,Le=X==null?void 0:X.activeKey,Y=x.useMemo(()=>{if(!T.length)return null;if(Le){const s=T.find(a=>a.key===Le);if(s)return s}return T[0]},[T,Le]),ve=(Y==null?void 0:Y.key)||null;x.useRef(null);const ot=x.useRef(!1),[n,O]=x.useState(()=>Jt()),[Ne,ct]=x.useState(null),[rs,we]=x.useState(!1),[ns,Q]=x.useState(!1),[is,ke]=x.useState("booking"),[ls,os]=x.useState(null),[q,dt]=x.useState("payphi"),[C,J]=x.useState({status:"idle",error:null,offers:[],offerRules:[],activeOffer:null,activeRule:null,selectedOffer:null,selectedRule:null,offerPreview:null,loadingOffers:!1}),[qe,mt]=x.useState("+91"),[le,_e]=x.useState(""),[U,Ce]=x.useState({}),[Z,oe]=x.useState({status:"idle",items:[],error:null}),[Me,ut]=x.useState(""),[ce,xt]=x.useState(""),[de,pt]=x.useState(""),[G,cs]=x.useState(new Map),[yt,ht]=x.useState([]),[Pe,gt]=x.useState(!1),[F,Fe]=x.useState(!1),[ba,Re]=x.useState(null),[ds,Be]=x.useState(!1),[ft,Ke]=x.useState(""),me=b.items||[],bt=x.useMemo(()=>zs(me),[me]),ue=_.items||[],ms=s=>{const a=s.target.value.replace(/\D/g,"");a.length<=10&&(_e(a),U.phone&&Ce(r=>({...r,phone:null})))},jt=x.useCallback(()=>{if(!Array.isArray(C.offers)||!Y)return null;const s=nt(Y.item_type||(Y.combo_id?"Combo":"Attraction")),a=Y.attraction_id||Y.combo_id||null,r=Y.date||"",o=Y.slot||{};let d=null;for(const l of C.offers){const y=Array.isArray(l.rules)?l.rules:[];for(const m of y)as({rule:m,selectedDate:r,selectedSlot:o,itemType:s,itemId:a})&&(!d||m.priority>d.rule.priority||m.priority===d.rule.priority&&m.rule_id<d.rule.rule_id)&&(d={offer:l,rule:m})}return d},[C.offers,Y]);x.useEffect(()=>{const s=jt();J(a=>({...a,activeOffer:(s==null?void 0:s.offer)||null,activeRule:(s==null?void 0:s.rule)||null}))},[jt]),x.useEffect(()=>{if(!C.activeOffer||!C.activeRule||!Y){J(l=>({...l,offerPreview:null}));return}const s=Number(Y.price||Y.unitPrice||0),a=C.activeRule.rule_discount_type||C.activeOffer.discount_type||"percent",r=Number(C.activeRule.rule_discount_value??C.activeOffer.discount_value??0);let o=s;a==="percent"?o=s*(1-r/100):a==="amount"&&(o=Math.max(0,s-r));const d=s-o;J(l=>({...l,offerPreview:{basePrice:s,newPrice:o,savings:d,discountType:a,discountValue:r,offerTitle:C.activeOffer.title,ruleId:C.activeRule.rule_id}}))},[C.activeOffer,C.activeRule,Y]),x.useEffect(()=>()=>{t(Cs())},[t]),x.useEffect(()=>{if(N!=null&&N.phone&&!le){const s=String(N.phone).replace(/\D/g,"");if(s.length>10){const a=Qt.find(r=>s.startsWith(r.code.replace("+","")));a?(mt(a.code),_e(s.slice(a.code.length-1))):_e(s.slice(-10))}else _e(s)}},[]),x.useEffect(()=>{if(C.status!=="idle")return;let s=!1;return(async()=>{J(r=>({...r,status:"loading",loadingOffers:!0}));try{const r=await De.get(Ye.offers.list(),{params:{active:!0,limit:20}});if(s)return;const o=Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[];J(d=>({...d,status:"succeeded",offers:o,loadingOffers:!1}))}catch{s||J(r=>({...r,status:"failed",loadingOffers:!1}))}})(),()=>{s=!0}},[C.status]),x.useEffect(()=>{if(Pe||yt.length>0)return;let s=!1;return(async()=>{gt(!0);try{const r=await De.get(Ye.coupons.list(),{params:{active:!0,limit:50}});if(s)return;const o=Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[];ht(o)}catch(r){console.error("Failed to fetch promos:",r),ht([])}finally{gt(!1)}})(),()=>{s=!0}},[]),x.useCallback(()=>{i("/")},[i]);const[H]=Ms(),xe=H.get("type"),ee=H.get("attraction_id"),te=H.get("combo_id"),Ue=H.get("date"),Ve=H.get("slot"),Ge=H.get("qty"),He=H.get("openDrawer");x.useEffect(()=>{b.status==="idle"&&t(Ps({active:!0,limit:100})),_.status==="idle"&&t(Ss({active:!0,limit:100})),P.status==="idle"&&t(Ot({active:!0,limit:100}))},[t,b.status,_.status,P.status]),x.useEffect(()=>{g===3&&h&&t(L(4))},[g,h,t]),x.useEffect(()=>{const s=localStorage.getItem("pendingOrderData");if(s)try{const a=JSON.parse(s);console.log(" Found pending order data:",a),a.email&&!N.email&&t(ae({email:a.email})),a.mobile&&!N.phone&&t(ae({phone:a.mobile})),localStorage.removeItem("pendingOrderData")}catch(a){console.error("Error parsing pending order data:",a),localStorage.removeItem("pendingOrderData")}},[t,N.email,N.phone]),x.useEffect(()=>{!ee&&!te&&t(As())},[t,ee||"",te||""]),x.useEffect(()=>{const s={};xe&&(s.itemType=xe),ee&&(b.items||[]).some(r=>String(ne(r))===String(ee))&&(s.attractionId=String(ee),xe||(s.itemType="attraction")),te&&(_.items||[]).some(r=>String(ie(r))===String(te))&&(s.comboId=String(te),xe||(s.itemType="combo")),Ue&&(s.date=Ue),Ve&&(s.slotKey=Ve),Ge&&(s.qty=Math.max(1,Number(Ge)||1)),Object.keys(s).length>0&&O(a=>({...a,...s}))},[xe||"",ee||"",te||"",Ue||"",Ve||"",Ge||"",He||"",b.items||[],_.items||[]]);const vt=x.useCallback(async({itemType:s,attractionId:a,comboId:r,date:o})=>{if(!o)return;const d=s==="combo"?r:a;if(d){oe({status:"loading",items:[],error:null});try{if(s==="combo"){const l=await De.get(Ye.combos.slots(d),{params:{date:W(o)}}),y=Array.isArray(l==null?void 0:l.data)?l.data:Array.isArray(l)?l:[];oe({status:"succeeded",items:y,error:null})}else{const l=await De.get(Ye.slots.list(),{params:{attraction_id:d,date:W(o)}}),y=Array.isArray(l==null?void 0:l.data)?l.data:Array.isArray(l)?l:[];oe({status:"succeeded",items:y,error:null})}}catch(l){oe({status:"failed",items:[],error:(l==null?void 0:l.message)||"Failed to load slots"})}}},[]);x.useEffect(()=>{const s=n.itemType,a=n.date,r=n.attractionId,o=n.comboId;(s==="combo"?o:r)&&a?(O(l=>({...l,slotKey:n.slotKey||""})),vt({itemType:s,attractionId:r,comboId:o,date:a})):oe({status:"idle",items:[],error:null})},[n.itemType||"",n.attractionId||"",n.comboId||"",n.date||"",vt]);const f=x.useMemo(()=>n.itemType==="attraction"?me.find(s=>String(ne(s))===String(n.attractionId)):null,[me||[],n.itemType||"",n.attractionId||""]),M=x.useMemo(()=>n.itemType==="combo"?ue.find(s=>String(ie(s))===String(n.comboId)):null,[ue||[],n.itemType||"",n.comboId||""]),u=x.useMemo(()=>{for(let s=0;s<Z.items.length;s+=1){const a=Z.items[s];if(tt(a,s)===n.slotKey)return a;const r=[a==null?void 0:a.slot_id,a==null?void 0:a.id,a==null?void 0:a._id,a==null?void 0:a.combo_slot_id].filter(Boolean);if(n.slotKey&&r.map(String).includes(String(n.slotKey)))return a}return null},[Z.items,n.slotKey]),I=x.useMemo(()=>{if(n.itemType==="combo"&&M){const s=$(es(M)),a=$(qt(M)||s),r=(u==null?void 0:u.pricing)||{},o=(u==null?void 0:u.offer)||null,d=u?Ft(u,a):a,l=u?Rt(u,s):s;let y=$(r.base_price??d),m=$(r.final_price??l);y||(y=d),m||(m=l);const k=W(n.date),j=ie(M);let w=o||null;if(!w&&(w=C.offers.find(v=>(v.rule_type==="happy_hour"||v.rule_type==="holiday"||v.rule_type==="special")&&ss(v,k,u,"combo",j)),w)){const v=lt(w,y||m);m=Math.max(0,(y||m)-v)}return{title:Zt(M,ie(M)),price:m,originalPrice:y||m,happyHourOffer:w,offerDescription:(w==null?void 0:w.description)||"",image:Oe(M),previewImages:ma(M)}}if(n.itemType==="attraction"&&f){const s=$(rt(f)||(f==null?void 0:f.price)||(f==null?void 0:f.base_price)||(f==null?void 0:f.amount)||0),a=$(qt(f)||s),r=(u==null?void 0:u.pricing)||{},o=(u==null?void 0:u.offer)||null,d=u?Ft(u,a):a,l=u?Rt(u,s):s;let y=$(r.base_price??d),m=$(r.final_price??l);y||(y=d),m||(m=l);const k=W(n.date),j=ne(f);let w=o||null;if(!w&&(w=C.offers.find(v=>(v.rule_type==="happy_hour"||v.rule_type==="holiday"||v.rule_type==="special")&&ss(v,k,u,"attraction",j)),w)){const v=lt(w,y||m);m=Math.max(0,(y||m)-v)}return{title:(f==null?void 0:f.name)||(f==null?void 0:f.title)||`Attraction #${ne(f)}`,price:m,originalPrice:y||m,happyHourOffer:w,offerDescription:(w==null?void 0:w.description)||"",image:$e(f)}}return{title:"",price:0,originalPrice:0,offerDescription:""}},[n.itemType||"",M||null,f||null,u||null,n.date||"",C.offers||[]]);x.useEffect(()=>{He==="true"&&(n.itemType==="attraction"||n.itemType==="combo")&&I.title&&!ot.current&&(ot.current=!0,Q(!0))},[He,n.itemType,I.title]);const pe=Math.max(1,Number(n.qty)||1),us=Number(I.price||0)*pe,B=!!(I.title&&n.date&&n.slotKey&&pe),xs=x.useMemo(()=>T.reduce((s,a)=>s+Number(a.unitPrice||0)*Number(a.quantity||0),0),[T||[]]),We=x.useMemo(()=>{let s=0;return G.forEach((a,r)=>{T.find(d=>d.key===r)&&a.forEach(d=>{s+=Number(d.price||0)*Number(d.quantity||0)})}),s},[G||new Map,T||[]]),Xe=xs+We,ye=Number(z.discount||0),Nt=ye>0&&(z.code||((Tt=z.data)==null?void 0:Tt.code)),K=Math.max(0,Xe-ye);I.image||$e(me[0])||Oe(ue[0]);const ps=x.useMemo(()=>ve?G.get(ve)||new Map:new Map,[G,ve]),Se=x.useCallback(()=>{if(!B)return!1;const s=n.itemType==="combo"?"Combo":"Attraction",a=n.itemType==="combo"?(u==null?void 0:u.combo_slot_id)??(u==null?void 0:u.id)??(u==null?void 0:u._id)??null:(u==null?void 0:u.slot_id)??(u==null?void 0:u.id)??(u==null?void 0:u._id)??null,r=(u==null?void 0:u.offer)||I.happyHourOffer||null,o={key:Ne||da(),merge:!1,item_type:s,title:I.title,slotLabel:u?Xt(u):"",quantity:pe,booking_date:W(n.date),booking_time:(u==null?void 0:u.start_time)||(u==null?void 0:u.startTime)||(u==null?void 0:u.slot_start_time)||null,unitPrice:I.price||0,dateLabel:W(n.date),slot_id:s==="Attraction"?a:null,combo_slot_id:s==="Combo"?a:null,attraction_id:s==="Attraction"?ne(f):null,combo_id:s==="Combo"?ie(M):null,slot:u||null,attraction:f||null,combo:M||null,pricing:(u==null?void 0:u.pricing)||null,originalPrice:I.originalPrice||null,offer:r,offerDescription:I.offerDescription||(r==null?void 0:r.description)||""};return Ne&&t(Et(Ne)),t(Ts(o)),t(zt(o.key)),ct(null),O(Jt()),cs(d=>{const l=new Map(d);return l.has(o.key)||l.set(o.key,new Map),l}),!0},[B,n||{},I||{},u||null,f||null,M||null,pe||1,Ne||null,t]),ys=x.useCallback(()=>{if(!B){alert("Please select a date, a time slot, and quantity first.");return}const a=[n.itemType==="combo"?"Combo":"Attraction",n.itemType==="combo"?n.comboId:n.attractionId||"na",(n.itemType==="attraction",n.slotKey||"na"),n.date||"na"].join(":");T.some(o=>o.fingerprint===a)||Se(),t(L(2))},[B,n,T,Se,t,h]),Ae=()=>{if(g===1)if(D)t(L(2));else{if(!B){alert("Please select date, time slot and quantity.");return}Se()&&t(L(2))}else g===2?t(L(h?4:3)):g===3&&(E.verified?t(L(4)):alert("Please verify OTP to continue."))},Te=()=>{g!==1&&(g===2?t(L(1)):g===3?t(L(2)):g===4&&t(L(h?2:3)))},hs=async()=>{const s={},a=(N.email||"").trim();if(ra.test(a)||(s.email="Please enter a valid email address"),le.length!==10&&(s.phone="Phone number must be exactly 10 digits"),Object.keys(s).length>0){Ce(s);return}Ce({});const r=`${qe}${le}`;t(ae({email:a,phone:r}));try{await t(Is({email:a,phone:r})).unwrap()}catch(o){alert((o==null?void 0:o.message)||"Failed to send OTP")}},gs=async()=>{if(!Me||Me.length<4)return alert("Enter the full OTP code");await t(Ds({otp:Me})).unwrap().then(()=>{ut(""),t(L(4))}).catch(s=>alert((s==null?void 0:s.message)||"OTP verification failed"))},fs=async()=>{ce&&await t(Ys({code:ce,total_amount:Math.max(0,Xe),onDate:n.date||W(new Date)})).unwrap().then(()=>t(Lt(ce))).catch(()=>{})},bs=()=>e.jsx("div",{className:"w-full bg-transparent",children:e.jsx("div",{className:"w-full flex items-center justify-between overflow-x-auto no-scrollbar border-t border-gray-100",children:[{n:1,l:"Experience"},{n:2,l:"Add-ons"},{n:3,l:"Your Details"},{n:4,l:"Payment"}].map(s=>{if(h&&s.n===3)return null;const a=g>s.n||h&&s.n===3,r=g===s.n;return e.jsxs("div",{className:"flex-1 flex items-center justify-center gap-2 sm:gap-3 shrink-0 py-1.5",children:[e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center text-xs sm:text-sm font-bold transition-all duration-300 ${a||r?"bg-sky-500 text-white shadow-[0_4px_12px_rgba(14,165,233,0.3)]":"bg-white border border-gray-100 text-gray-300"}`,children:a?e.jsx(Ze,{size:16,strokeWidth:3}):s.n}),e.jsxs("div",{className:"flex flex-col min-w-max",children:[e.jsxs("span",{className:`text-[9px] sm:text-[10px] font-bold uppercase tracking-wider ${r?"text-sky-500":"text-gray-400"}`,children:["STEP 0",s.n]}),e.jsx("span",{className:`text-xs sm:text-sm font-bold ${r?"text-gray-900":"text-gray-400"}`,children:s.l})]})]},s.n)})})}),wt=s=>{window.confirm("Are you sure you want to remove this item?")&&t(Et(s))},Qe=s=>{O({itemType:s.item_type==="Combo"?"combo":"attraction",attractionId:s.attraction_id?String(s.attraction_id):"",comboId:s.combo_id?String(s.combo_id):"",date:s.booking_date,slotKey:s.slot?tt(s.slot):s.slot_id||"",qty:s.quantity}),ct(s.key),ke("booking"),Q(!0)},js=()=>{const s=n.itemType,a=x.useMemo(()=>s!=="attraction"?ue:bt,[s,bt,ue]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-sky-50 p-1 rounded-xl inline-flex border border-sky-100",children:["attraction","combo"].map(r=>e.jsx("button",{onClick:()=>{O(o=>({...o,itemType:r,attractionId:"",comboId:"",slotKey:""}))},className:`px-6 py-2 text-sm font-semibold rounded-lg capitalize transition-all duration-200 ${n.itemType===r?"bg-white text-sky-700 shadow-sm ring-1 ring-black/5":"text-gray-600 hover:text-gray-900"}`,children:r==="attraction"?"Attractions":"Combos"},r))})}),a.length===0?e.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-dashed border-gray-200 px-4 py-6 text-center text-sm text-gray-500",children:n.itemType==="combo"?"No combos available":"No attractions available"}):a.map(r=>{const o=n.itemType==="attraction"?ne(r):ie(r),d=String(n.itemType==="attraction"?n.attractionId:n.comboId)===String(o),l=n.itemType==="combo"?Number(es(r)||0):Number(rt(r)||r.price||r.base_price||r.amount||0),y=n.itemType==="attraction"?r.title||r.name:Zt(r),m=n.itemType==="combo"?Oe(r):$e(r),k=()=>{const j=n.itemType==="combo",w=T.find(v=>j?v.item_type==="Combo"&&ze(v.combo_id,o):(v.item_type==="Attraction"||v.item_type===void 0)&&ze(v.attraction_id,o));if(w){Qe(w);return}O(v=>({...v,itemType:n.itemType,attractionId:n.itemType==="attraction"?String(o):"",comboId:n.itemType==="combo"?String(o):"",slotKey:""})),ke("booking"),Q(!0)};return e.jsxs("div",{className:`bg-white rounded-3xl shadow-sm border px-4 sm:px-6 py-4 sm:py-5 flex items-center justify-between gap-4 transition-all ${d?"border-sky-400 shadow-md":"border-gray-100 hover:border-sky-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-28 h-28 rounded-2xl overflow-hidden border border-gray-100 bg-sky-50 shrink-0",children:m?e.jsx("img",{src:m,alt:y,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sky-400",children:e.jsx(re,{})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1 truncate",children:y}),e.jsx("p",{className:"text-xs text-gray-500",children:"Great for families â€¢ Flexible slots â€¢ Instant confirmation"}),e.jsxs("button",{type:"button",onClick:()=>{O(j=>({...j,itemType:n.itemType,attractionId:n.itemType==="attraction"?String(o):"",comboId:n.itemType==="combo"?String(o):"",slotKey:""})),os(m||null),ke("details"),Q(!0)},className:"inline-flex items-center gap-1 text-xs sm:text-sm font-semibold text-sky-700 hover:text-sky-900 mt-2",children:["View details",e.jsx(et,{size:14})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 sm:gap-3",children:[e.jsx("div",{className:"text-right text-xs text-gray-500 uppercase tracking-wide",children:"From"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-sky-700 tabular-nums",children:["â‚¹",l||0]})}),e.jsx("button",{type:"button",onClick:k,className:`px-6 py-2 rounded-full text-white text-sm font-semibold shadow-md active:scale-[0.98] transition-all ${d?"bg-sky-700":"bg-sky-600 hover:bg-sky-700"}`,children:d?"Selected":"Select"})]})]},o)})]})},vs=()=>C.loadingOffers||!C.offers.length?null:e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"Available Offers"}),de&&e.jsx("button",{type:"button",onClick:()=>pt(""),className:"text-xs font-medium text-sky-700 hover:underline",children:"Remove"})]}),e.jsx("div",{className:"space-y-3",children:C.offers.map(s=>{const a=String(it(s));if(!a)return null;const r=fa(s,I.price||0,pe);return e.jsxs("label",{className:`flex items-start gap-3 rounded-2xl border px-3 py-3 cursor-pointer transition-all duration-200 ${String(de)===a?"border-sky-500 bg-sky-50 shadow-sm":"hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"selected-offer",className:"mt-1",checked:String(de)===a,onChange:()=>pt(a)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:ts(s)}),st(s)?e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 line-clamp-2",children:st(s)}):null]}),e.jsx("span",{className:"text-xs font-semibold text-sky-700 bg-sky-50 px-2 py-1 rounded-full",children:r?`Save â‚¹${r.totalDiscount.toFixed(0)}`:"No discount"})]}),r&&r.totalDiscount>0&&e.jsxs("p",{className:"text-xs text-emerald-600 mt-1",children:["Save up to â‚¹",r.totalDiscount.toFixed(0)," with this offer"]})]})]},`offer-${a}`)})})]}),kt=()=>{O(s=>({...s,date:V(),slotKey:""}))},_t=()=>{O(s=>({...s,date:S().add(1,"day").format("YYYY-MM-DD"),slotKey:""}))},[Ct,Ie]=x.useState(!1),[Ns,Mt]=x.useState(null),he=x.useMemo(()=>null,[Ns,Ct]),Pt=s=>{s.preventDefault(),s.stopPropagation(),Mt(s.currentTarget),Ie(!0)},ws=s=>{O(a=>({...a,date:s,slotKey:""})),Ie(!1)},St=s=>{if(!s)return"All Days";const a=S(s);return s===V()||s===S().add(1,"day").format("YYYY-MM-DD")?"All Days":a.format("D MMM")},At=async()=>{var r,o;if((A==null?void 0:A.status)==="loading"||F)return;if(!h){we(!0);return}if(!D)return;Fe(!0),Re(Date.now());const s=((N==null?void 0:N.email)||((r=p==null?void 0:p.user)==null?void 0:r.email)||"").trim(),a=((N==null?void 0:N.phone)||((o=p==null?void 0:p.user)==null?void 0:o.phone)||"").trim();if(!s||!a){Fe(!1),Re(null),alert("Email and mobile number are required for payment. Please complete your contact details.");return}try{const d=T.map(m=>{var v,ge;const k={item_type:m.item_type,attraction_id:m.attraction_id,combo_id:m.combo_id,slot_id:m.slot_id,combo_slot_id:m.combo_slot_id,booking_date:m.booking_date,quantity:m.quantity,slot_label:m.slotLabel,slot_start_time:(v=m.slot)==null?void 0:v.start_time,slot_end_time:(ge=m.slot)==null?void 0:ge.end_time},j=G.get(m.key)||new Map,w=Array.from(j.values()).filter(se=>Number(se.quantity)>0).map(se=>({addon_id:se.addon_id,quantity:Number(se.quantity)}));return w.length>0&&(k.addons=w),k});console.log("ðŸ“¦ Creating booking with payload:",d);const l=await t($s(d)).unwrap();console.log("âœ… Booking creation result:",l);const y=(l==null?void 0:l.order_id)||(l==null?void 0:l.orderId);if(console.log("ðŸ”¢ Order ID extracted:",y),!y)throw console.error("Ã¢ÂÅ’ No order ID in response:",l),new Error("Failed to create order - no order ID returned");if(q==="phonepe"){const m=await t(Os({orderId:y,email:s,mobile:a,amount:K})).unwrap();if(console.log("âœ… PhonePe payment initiated:",m),m.ok&&m.redirectUrl)Ke(m.redirectUrl),Be(!0),window.PhonePeCheckout&&window.PhonePeCheckout.transact?window.PhonePeCheckout.transact({tokenUrl:m.redirectUrl,callback:k=>{console.log("ðŸ“¡ PhonePe iframe callback:",k),Be(!1),Ke(""),k==="USER_CANCEL"?alert("Payment was cancelled. You can try again or continue with a different payment method."):k==="CONCLUDED"?i(`/payment/success?orderId=${y}&gateway=phonepe`):(console.warn("Unknown PhonePe callback response:",k),alert("Payment status unclear. Please check your email for confirmation."))},type:"IFRAME"}):(console.error("Ã¢ÂÅ’ PhonePe checkout script not loaded"),alert("Payment system not ready. Please refresh and try again."));else throw new Error(m.responseMessage||"Failed to initiate PhonePe payment")}else{const m=await t(Es({orderId:y,email:s,mobile:a,amount:K})).unwrap();if(m.ok&&m.redirectUrl)console.log("âœ… PayPhi payment initiated, redirecting to:",m.redirectUrl),window.location.href=m.redirectUrl;else throw new Error(m.responseMessage||"Failed to initiate PayPhi payment")}}catch(d){console.error("Ã¢ÂÅ’ Payment initiation failed:",d),alert(`Payment failed: ${(d==null?void 0:d.message)||d}`)}finally{Fe(!1),Re(null)}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 to-white font-inter pt-20",children:[e.jsx("div",{className:"sticky top-[calc(64px+20px)] z-40 bg-white/95 backdrop-blur-sm border-b border-gray-100 w-full",children:e.jsx(bs,{})}),e.jsx("div",{className:"max-w-7xl mx-auto px-3 lg:px-0 pb-24 lg:pb-20 pt-10",children:e.jsxs("div",{className:"mt-2 md:mt-4",children:[g===1&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mb-1",children:[e.jsx("button",{type:"button",onClick:kt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date===V()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),e.jsx("button",{type:"button",onClick:_t,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date===S().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:Pt,ref:Mt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date&&n.date!==""&&n.date!==V()&&n.date!==S().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:n.date&&n.date!==V()&&n.date!==S().add(1,"day").format("YYYY-MM-DD")?St(n.date):"All Days"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-500 ml-1",children:"Change date/time in details panel"})]}),e.jsx(js,{})]}),e.jsx("div",{className:"lg:sticky lg:top-[140px]",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),D?e.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:T.map(s=>{var a,r,o,d,l,y;return e.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((a=s.meta)==null?void 0:a.title)||(s.item_type==="combo"?((r=s.combo)==null?void 0:r.title)||((o=s.combo)==null?void 0:o.name)||((d=s.combo)==null?void 0:d.combo_name)||`Combo #${s.combo_id}`:((l=s.attraction)==null?void 0:l.title)||((y=s.attraction)==null?void 0:y.name)||`Attraction #${s.attraction_id}`)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) â€¢"," ",s.dateLabel||S(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` â€¢ ${s.slotLabel}`:""]}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>Qe(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>wt(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["â‚¹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:e.jsx(re,{className:"text-sky-600"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),e.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["â‚¹",K.toFixed(0)]})]}),e.jsxs("button",{type:"button",disabled:!D,onClick:Ae,className:`w-full flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${D?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[g===4?F?"Processing...":`Pay â‚¹${K}`:"Continue",g!==4&&e.jsx(be,{size:16})]})]})]})})]}),g===2&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start mt-4",children:[e.jsxs("div",{className:"space-y-6",children:[T.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:T.map(s=>{var a,r,o,d,l,y;return e.jsx("button",{onClick:()=>t(zt(s.key)),className:`px-4 py-2 rounded-full border text-sm font-medium transition-all ${s.key===ve?"bg-sky-600 text-white border-sky-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-sky-200"}`,children:s.title||((a=s.meta)==null?void 0:a.title)||(s.item_type==="combo"?((r=s.combo)==null?void 0:r.title)||((o=s.combo)==null?void 0:o.name)||((d=s.combo)==null?void 0:d.combo_name)||`Combo #${s.combo_id}`:((l=s.attraction)==null?void 0:l.title)||((y=s.attraction)==null?void 0:y.name)||`Attraction #${s.attraction_id}`)||"Item"},s.key)})}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Add-ons"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enhance your experience with optional extras"})]}),e.jsx("button",{onClick:()=>t(Ot({active:!0,limit:100})),className:"text-xs font-semibold text-sky-700 hover:underline",children:"Refresh"})]}),P.status==="loading"?e.jsx("div",{className:"text-center py-10 text-gray-500 text-sm",children:"Loading add-ons..."}):e.jsx("div",{className:"space-y-4",children:(P.items||[]).map(s=>{var y;const a=ia(s),r=na(s),o=la(s),d=oa(s),l=Number(((y=ps.get(a))==null?void 0:y.quantity)||0);return e.jsxs("div",{className:"flex gap-4 items-center border border-gray-200 rounded-2xl p-4 hover:border-sky-200 transition-all",children:[d?e.jsx("img",{src:d,alt:o,className:"w-16 h-16 rounded-xl object-cover border border-gray-100"}):e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center text-gray-400",children:e.jsx(re,{})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",children:o}),e.jsx("div",{className:"text-sm text-gray-500 tabular-nums",children:Bt(r)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>handleAddonQuantityChange(a,Math.max(0,l-1),s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 transition",children:e.jsx(Ht,{size:16})}),e.jsx("span",{className:"w-6 text-center font-semibold text-gray-800 tabular-nums",children:l}),e.jsx("button",{onClick:()=>handleAddonQuantityChange(a,l+1,s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 bg-sky-600 text-white shadow",children:e.jsx(Kt,{size:16})})]})]},a)})})]})]}),e.jsx("div",{className:"lg:sticky lg:top-[140px]",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),D?e.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:T.map(s=>{var o,d,l,y,m,k;const a=G.get(s.key)||new Map,r=Array.from(a.values()).filter(j=>Number(j.quantity)>0);return e.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((o=s.meta)==null?void 0:o.title)||(s.item_type==="combo"?((d=s.combo)==null?void 0:d.title)||((l=s.combo)==null?void 0:l.name)||((y=s.combo)==null?void 0:y.combo_name)||`Combo #${s.combo_id}`:((m=s.attraction)==null?void 0:m.title)||((k=s.attraction)==null?void 0:k.name)||`Attraction #${s.attraction_id}`)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) â€¢ ",s.dateLabel||S(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` â€¢ ${s.slotLabel}`:""]}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>Qe(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>wt(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]}),r.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Extras"}),e.jsx("div",{className:"space-y-1",children:r.map(j=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"truncate",children:[j.name," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["x",j.quantity]})]}),e.jsxs("div",{className:"tabular-nums",children:["â‚¹",(Number(j.price||0)*Number(j.quantity||0)).toFixed(0)]})]},j.addon_id))})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["â‚¹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:e.jsx(re,{className:"text-sky-600"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),e.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["â‚¹",K.toFixed(0)]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{type:"button",disabled:!D,onClick:Ae,className:`w-full flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${D?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx("span",{children:"Continue"}),e.jsx(be,{size:18})]}),e.jsxs("button",{type:"button",onClick:Te,className:"hidden lg:flex items-center justify-center gap-2 w-full rounded-xl px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-50 transition-all border border-gray-100",children:[e.jsx(Gt,{size:16}),"Back"]})]})]})]})})]}),g===3&&!h&&e.jsxs("div",{className:"space-y-6 max-w-md mx-auto animate-in fade-in slide-in-from-right-8 duration-300 mt-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-sky-50 text-sky-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(sa,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Guest Details"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Enter your details to receive tickets via Email & SMS."})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Full Name"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Ls,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"John Doe",className:"w-full pl-11 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 focus:bg-white outline-none transition-all font-medium",value:N.name,onChange:s=>t(ae({name:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative group",children:[e.jsx(qs,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"name@example.com",type:"email",className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium ${U.email?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:N.email,onChange:s=>{t(ae({email:s.target.value})),U.email&&Ce(a=>({...a,email:void 0}))}})]}),U.email&&e.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[e.jsx(Vt,{size:12})," ",U.email]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Mobile Number"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative w-32",children:[e.jsx("div",{className:"absolute left-3 top-3.5 z-10 pointer-events-none",children:e.jsx(Hs,{size:18,className:"text-gray-400"})}),e.jsx("select",{className:"w-full pl-10 pr-8 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none appearance-none font-medium text-sm",value:qe,onChange:s=>mt(s.target.value),children:Qt.map(s=>e.jsx("option",{value:s.code,children:s.code},s.code))}),e.jsx(et,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 rotate-90 pointer-events-none"})]}),e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Fs,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"98765 43210",type:"tel",maxLength:10,className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium tracking-wide ${U.phone?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:le,onChange:ms})]})]}),U.phone&&e.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[e.jsx(Vt,{size:12})," ",U.phone]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",required:!0,checked:N.whatsapp_consent||!1,onChange:s=>t(ae({whatsapp_consent:s.target.checked})),className:"w-4 h-4 text-sky-600 bg-gray-100 border-gray-300 rounded focus:ring-sky-500 focus:ring-2"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"I agree to receive WhatsApp notifications *"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"We'll send booking confirmations and updates via WhatsApp"})]}),E.sent?e.jsxs("div",{className:"mt-6 bg-sky-50 border border-sky-100 p-5 rounded-2xl animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("p",{className:"text-sm text-sky-800 mb-3 font-medium",children:["Enter OTP sent to ",qe," ",le]}),e.jsxs("div",{className:"flex gap-3 flex-col sm:flex-row",children:[e.jsx("input",{placeholder:"XXXXXX",className:"flex-1 p-3.5 text-center tracking-[0.5em] font-bold text-xl border-2 border-sky-200 rounded-xl focus:border-sky-600 focus:ring-4 focus:ring-sky-100 outline-none bg-white transition-all",maxLength:6,value:Me,onChange:s=>ut(s.target.value)}),e.jsx("button",{onClick:gs,disabled:E.status==="loading",className:"bg-sky-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-sky-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 w-full sm:w-auto text-sm sm:text-base",children:E.status==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):E.verified?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Verified"]}):"Verify"})]})]}):e.jsx("button",{onClick:hs,disabled:E.status==="loading",className:"w-full bg-sky-700 text-white py-3 rounded-xl font-bold text-base shadow-lg hover:bg-sky-800 transition-all disabled:opacity-70 flex items-center justify-center gap-2 mt-4",children:E.status==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Sending..."})]}):"Send OTP Verification"}),e.jsxs("div",{className:"hidden md:flex items-center gap-4 mt-8 pt-6 border-t border-gray-100",children:[e.jsx("button",{type:"button",onClick:Te,className:"px-8 py-3 rounded-xl border border-gray-200 text-gray-700 font-bold hover:bg-gray-50 transition-all",children:"Back"}),e.jsxs("button",{type:"button",onClick:Ae,disabled:!E.verified,className:`flex-1 flex items-center justify-center gap-2 rounded-xl px-8 py-3 text-base font-bold transition-all ${E.verified?"bg-sky-600 text-white shadow-lg hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:["Continue",e.jsx(be,{size:20})]})]})]})]}),g===4&&e.jsxs("div",{className:"space-y-6 max-w-lg mx-auto animate-in fade-in slide-in-from-right-8 duration-300 pb-20",children:[e.jsx(vs,{}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-bold text-gray-900 text-lg flex items-center gap-2",children:[e.jsx(Ut,{className:"text-sky-600",size:20}),"Select Payment Method"]}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:"Secure Payment"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:`relative flex flex-col p-5 rounded-xl border-2 cursor-pointer transition-all duration-200 ${q==="payphi"?"border-sky-600 bg-gradient-to-br from-sky-50 to-blue-50 shadow-md ring-2 ring-sky-200":"border-gray-200 bg-white hover:border-sky-300 hover:shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${q==="payphi"?"border-sky-600 bg-sky-600":"border-gray-300 bg-white"}`,children:q==="payphi"&&e.jsx(Ze,{size:12,className:"text-white",strokeWidth:3})}),e.jsx("input",{type:"radio",name:"paymentGateway",value:"payphi",checked:q==="payphi",onChange:()=>dt("payphi"),className:"sr-only"}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-sm",children:e.jsx(Ut,{size:20,className:"text-white"})})]}),q==="payphi"&&e.jsx("span",{className:"text-xs font-semibold text-sky-700 bg-sky-100 px-2 py-1 rounded-full",children:"Selected"})]}),e.jsxs("div",{className:"ml-8",children:[e.jsx("p",{className:"font-bold text-gray-900 text-base mb-1",children:"PayPhi"}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"All payment methods accepted"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"Cards"}),e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"UPI"}),e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"Netbanking"})]})]})]}),e.jsxs("label",{className:`relative flex flex-col p-5 rounded-xl border-2 cursor-pointer transition-all duration-200 ${q==="phonepe"?"border-purple-600 bg-gradient-to-br from-purple-50 to-indigo-50 shadow-md ring-2 ring-purple-200":"border-gray-200 bg-white hover:border-purple-300 hover:shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${q==="phonepe"?"border-purple-600 bg-purple-600":"border-gray-300 bg-white"}`,children:q==="phonepe"&&e.jsx(Ze,{size:12,className:"text-white",strokeWidth:3})}),e.jsx("input",{type:"radio",name:"paymentGateway",value:"phonepe",checked:q==="phonepe",onChange:()=>dt("phonepe"),className:"sr-only"}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-600 to-indigo-600 flex items-center justify-center shadow-sm",children:e.jsx("svg",{className:"w-6 h-6 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"})})})]}),q==="phonepe"&&e.jsx("span",{className:"text-xs font-semibold text-purple-700 bg-purple-100 px-2 py-1 rounded-full",children:"Selected"})]}),e.jsxs("div",{className:"ml-8",children:[e.jsx("p",{className:"font-bold text-gray-900 text-base mb-1",children:"PhonePe"}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Fast & secure payments"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"UPI"}),e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"Wallet"}),e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"Cards"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 pt-2 border-t border-gray-100",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"256-bit SSL Encrypted Payment"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-4 text-lg flex items-center gap-2",children:[e.jsx(re,{className:"text-sky-600",size:20}),"Booking Summary"]}),Nt&&e.jsxs("div",{className:"mb-4 rounded-xl bg-emerald-50 border border-emerald-100 p-3 text-sm text-emerald-700",children:[e.jsxs("div",{className:"font-semibold text-emerald-800",children:["Coupon ",String(z.code||((It=z.data)==null?void 0:It.code)).toUpperCase()," applied"]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 text-emerald-700",children:[e.jsx("span",{children:((Dt=z.data)==null?void 0:Dt.description)||"Discount applied successfully"}),e.jsxs("span",{className:"font-bold tabular-nums",children:["-â‚¹",ye.toFixed(0)]})]})]}),de&&(()=>{const s=C.offers.find(a=>String(it(a))===String(de));return s?e.jsxs("div",{className:"mb-4 rounded-xl bg-green-50 border border-green-100 p-3 text-sm text-green-700",children:[e.jsxs("div",{className:"font-semibold text-green-800",children:["Offer Applied: ",ts(s)]}),e.jsxs("div",{className:"mt-1 text-green-600",children:[st(s),s.rule_type==="buy_x_get_y"&&s.buy_qty&&s.get_qty&&e.jsxs("div",{className:"mt-1",children:["Buy ",s.buy_qty," Get ",s.get_qty,s.get_discount_type==="percent"&&s.get_discount_value&&e.jsxs("span",{children:[" (",s.get_discount_value,"% off)"]}),s.get_discount_type==="amount"&&s.get_discount_value&&e.jsxs("span",{children:[" (",Bt(s.get_discount_value)," off)"]}),!s.get_discount_value&&e.jsx("span",{children:" Free"})]})]})]}):null})(),e.jsxs("div",{className:"mb-4 space-y-2 max-h-40 overflow-y-auto custom-scrollbar pr-2",children:[T.map(s=>{var o,d,l,y,m,k;const a=G.get(s.key)||new Map,r=Array.from(a.values()).filter(j=>Number(j.quantity)>0);return e.jsxs("div",{className:"text-sm py-2 border-b border-dashed border-gray-100 last:border-0",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsxs("div",{className:"text-gray-700",children:[e.jsxs("span",{className:"font-bold text-gray-900",children:[s.quantity,"x"]})," ",s.title||((o=s.meta)==null?void 0:o.title)||(s.item_type==="combo"?((d=s.combo)==null?void 0:d.title)||((l=s.combo)==null?void 0:l.name)||((y=s.combo)==null?void 0:y.combo_name)||`Combo #${s.combo_id}`:((m=s.attraction)==null?void 0:m.title)||((k=s.attraction)==null?void 0:k.name)||`Attraction #${s.attraction_id}`),e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:[s.dateLabel||S(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` â€¢ ${s.slotLabel}`:""]})]}),e.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["â‚¹",s.unitPrice*s.quantity]})]}),r.length>0&&e.jsx("div",{className:"ml-1 mt-1.5 pl-2 border-l-2 border-sky-200 space-y-1",children:r.map(j=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{className:"text-gray-600",children:["â€¢ ",j.name," ",e.jsxs("span",{className:"text-gray-400",children:["x",j.quantity]})]}),e.jsxs("span",{className:"font-medium text-gray-700 tabular-nums",children:["â‚¹",(Number(j.price||0)*Number(j.quantity||0)).toFixed(0)]})]},j.addon_id))})]},s.key)}),We>0&&e.jsxs("div",{className:"flex justify-between text-sm py-2 border-t border-gray-100 pt-3",children:[e.jsx("div",{className:"text-gray-600 font-medium",children:"Extras / Add-ons"}),e.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["â‚¹",We]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl space-y-2 text-sm mt-2",children:[e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Subtotal (with offers)"})," ",e.jsxs("span",{className:"tabular-nums",children:["â‚¹",Xe]})]}),ye>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-medium",children:[e.jsxs("span",{children:["Coupon (",String(z.code||((Yt=z.data)==null?void 0:Yt.code)).toUpperCase(),")"]}),e.jsxs("span",{className:"tabular-nums",children:["-â‚¹",ye.toFixed(0)]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 flex justify-between items-center mt-2",children:[e.jsx("span",{className:"font-bold text-gray-800 text-lg",children:"Total Payable"}),e.jsxs("span",{className:"font-bold text-2xl text-sky-700 tabular-nums",children:["â‚¹",K]})]})]})]}),e.jsx("div",{className:"space-y-3 border-t border-gray-200 pt-4",children:Nt?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Current Promo Code"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex-1 px-4 py-3 border border-green-200 rounded-xl bg-green-50 text-sm font-bold text-green-700 uppercase tracking-wider",children:["âœ“ ",String(z.code||(($t=z.data)==null?void 0:$t.code)).toUpperCase()," Applied"]}),e.jsx("button",{onClick:()=>{xt(""),t(Lt(""))},className:"px-4 py-3 rounded-xl border border-red-200 bg-red-50 text-red-600 text-sm font-semibold hover:bg-red-100 transition-colors",title:"Remove promo code",children:"Remove"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Apply Promo Code"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Rs,{size:18,className:"absolute left-3 top-3 text-gray-400 pointer-events-none"}),e.jsxs("select",{className:"w-full pl-10 pr-20 p-3 border border-gray-200 rounded-xl text-sm uppercase focus:ring-2 focus:ring-sky-500 outline-none font-bold tracking-wider appearance-none bg-white cursor-pointer disabled:bg-gray-50 disabled:text-gray-400 transition-all hover:border-gray-300",value:ce,onChange:s=>xt(s.target.value),disabled:Pe,children:[e.jsx("option",{value:"",children:Pe?"Loading promos...":"Select a promo code"}),yt.map(s=>e.jsxs("option",{value:s.code,children:[s.code," ",s.discount?`(${s.discount}% off)`:""]},s.id||s.code))]}),e.jsx("button",{onClick:fs,disabled:!ce||Pe,className:"absolute right-1 top-1 bottom-1 px-4 rounded-lg bg-sky-600 text-white text-xs font-bold tracking-wide hover:bg-sky-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"APPLY"})]})})]})}),e.jsxs("div",{className:"hidden md:flex items-center gap-4 mt-8 pt-6 border-t border-gray-100",children:[e.jsx("button",{type:"button",onClick:Te,disabled:(A==null?void 0:A.status)==="loading"||F,className:"px-8 py-3 rounded-xl border border-gray-200 text-gray-700 font-bold hover:bg-gray-50 transition-all disabled:opacity-50",children:"Back"}),e.jsxs("button",{type:"button",onClick:At,disabled:(A==null?void 0:A.status)==="loading"||F||!D,className:`flex-1 flex items-center justify-center gap-2 rounded-xl px-8 py-3 text-base font-bold transition-all ${(A==null?void 0:A.status)==="loading"||F||!D?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-sky-600 text-white shadow-lg hover:bg-sky-700 active:scale-[0.98]"}`,children:[F?"Processing...":`Pay â‚¹${K}`,e.jsx(be,{size:20})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 md:px-0 py-3 md:py-3 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] z-[140] md:hidden",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex gap-3 items-center",children:[g>1&&e.jsx("button",{type:"button",onClick:Te,className:"p-2.5 rounded-xl border border-gray-200 text-gray-700 hover:border-gray-300 active:scale-[0.98] transition-all flex items-center justify-center",title:"Go back",children:e.jsx(Gt,{size:18})}),e.jsx("div",{className:`flex-1 ${c?"hidden":""}`,children:e.jsxs("div",{className:"text-base font-semibold text-gray-900 tabular-nums",children:["â‚¹",K]})}),e.jsxs("button",{type:"button",onClick:g===4?At:Ae,disabled:g===4?(A==null?void 0:A.status)==="loading"||F||!D:g===3?!E.verified:g===2?!D:!D&&!B,className:`ml-auto inline-flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${(g===4?(A==null?void 0:A.status)==="loading"||F||!D:g===3?!E.verified:g===2?!D:!D&&!B)?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-sky-600 text-white shadow-md hover:bg-sky-700"}`,children:[e.jsx("span",{children:g===4?F?"Processing Payment...":`Pay â‚¹${K}`:g===3?"Continue":"Next"}),g===4&&F&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),g!==4||!F?e.jsx(be,{size:16}):null]})]})}),ns&&I.title&&e.jsxs("div",{className:"fixed inset-0 z-[160] flex justify-end items-end md:items-stretch bg-black/40 backdrop-blur-[2px] md:bg-black/20",children:[e.jsx("div",{className:"flex-1 hidden md:block",onClick:()=>Q(!1)}),e.jsxs("div",{className:"w-full md:w-1/3 bg-white  md:rounded-l-3xl shadow-2xl flex flex-col transform translate-y-0 transition-all h-[66vh] md:h-screen max-h-[66vh] md:max-h-screen md:mt-0",children:[e.jsx("div",{className:"md:hidden flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"h-1.5 w-12 rounded-full bg-gray-300"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between px-4 sm:px-6 pt-4 pb-2 border-b border-gray-100 bg-white  md:rounded-tl-3xl sm:rounded-tl-3xl",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 pr-3 truncate",children:I.title}),e.jsx("button",{type:"button",onClick:()=>Q(!1),className:"p-2 rounded-full hover:bg-gray-100 text-gray-500 flex-shrink-0",children:e.jsx(Je,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-4 py-4 space-y-4",children:is==="details"?e.jsxs("div",{className:"space-y-4",children:[(()=>{const s=ls||I.image||(n.itemType==="combo"?Oe(M):$e(f));return s?e.jsxs("div",{className:"relative rounded-2xl overflow-hidden border border-gray-100 shadow-sm",children:[e.jsx("img",{src:s,alt:I.title,className:"w-full h-56 sm:h-64 object-cover"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 px-4 py-2 bg-gradient-to-t from-black/60 to-transparent text-white text-sm font-semibold",children:I.title})]}):null})(),e.jsx("div",{className:"text-sm text-gray-700",children:((n.itemType==="combo"?(M==null?void 0:M.description)||(M==null?void 0:M.short_description)||(M==null?void 0:M.summary)||"":(f==null?void 0:f.description)||(f==null?void 0:f.short_description)||(f==null?void 0:f.summary)||(f==null?void 0:f.about)||"")||"").split(`
`).map((a,r)=>e.jsx("p",{className:"mb-2",children:a},r))}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",onClick:()=>ke("booking"),className:"w-full px-4 py-3 rounded-xl bg-sky-600 text-white font-semibold",children:"Book this"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:kt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date===V()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),e.jsx("button",{type:"button",onClick:_t,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date===S().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:Pt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date&&n.date!==""&&n.date!==V()&&n.date!==S().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:St(n.date)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Time slot"}),e.jsx("div",{className:"relative",children:Z.status==="loading"?e.jsx("div",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-sky-600 rounded-full animate-spin"}),"Loading slots..."]})}):Z.status==="failed"?e.jsx("div",{className:"w-full p-3.5 bg-red-50 border border-red-200 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-red-600 text-sm",children:"Failed to load slots"})}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none text-sm font-medium appearance-none cursor-pointer disabled:bg-gray-100 disabled:text-gray-400 transition-all hover:border-gray-300",value:n.slotKey,onChange:s=>O(a=>({...a,slotKey:s.target.value})),disabled:!n.attractionId&&!n.comboId,children:[e.jsx("option",{value:"",children:!n.attractionId&&!n.comboId?"Select a ticket above first":"Select a time slot"}),Z.items.map((s,a)=>{const r=tt(s,a),o=ya(s),d=pa(s,n.date),l=!o||!d;return e.jsxs("option",{value:r,disabled:l,children:[Xt(s)," ",o?d?"":"(Not Available)":"(Full)"]},r)})]}),e.jsx(et,{size:16,className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 rotate-90"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 rounded-xl p-1.5 border border-gray-200 w-fit",children:[e.jsx("button",{onClick:()=>O(s=>({...s,qty:Math.max(1,s.qty-1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-white text-gray-600 shadow-sm hover:text-sky-700 active:scale-95 transition",children:e.jsx(Ht,{size:16})}),e.jsx("span",{className:"font-bold text-lg w-8 text-center text-gray-800 tabular-nums",children:n.qty}),e.jsx("button",{onClick:()=>O(s=>({...s,qty:Math.max(1,s.qty+1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-95 transition",children:e.jsx(Kt,{size:16})})]})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-x-0 top-0 h-4 bg-gradient-to-t from-white via-white/70 to-transparent pointer-events-none"}),e.jsxs("div",{className:"px-4 sm:px-6 py-3 border-t border-gray-100 bg-white flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",children:"Subtotal"}),e.jsxs("div",{className:"text-lg font-bold text-sky-700 tabular-nums",children:["â‚¹",us.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Se,disabled:!B,className:"inline-flex items-center px-4 py-2 rounded-full border border-gray-200 text-xs font-semibold text-gray-700 hover:border-sky-300 disabled:opacity-40 disabled:cursor-not-allowed",children:"Add to order"}),e.jsxs("button",{type:"button",onClick:ys,disabled:!B,className:"flex items-center gap-2 px-4 py-2.5 rounded-full bg-sky-600 text-white text-sm font-semibold shadow-md hover:bg-sky-700 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(re,{size:18}),e.jsx("span",{children:"Buy"})]})]})]})]})]})]}),rs&&e.jsx(aa,{onClose:()=>we(!1),onSignIn:()=>{we(!1),t(L(3))},onContinueAsGuest:()=>{we(!1),t(L(3))}}),ds&&e.jsx("div",{className:"fixed inset-0 z-[200] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl h-[80vh] max-h-[600px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 11 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Complete Payment"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Secure payment powered by PhonePe"})]})]}),e.jsx("button",{onClick:()=>{Be(!1),Ke(""),window.PhonePeCheckout&&window.PhonePeCheckout.closePage&&window.PhonePeCheckout.closePage()},className:"p-2 hover:bg-gray-100 rounded-lg text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Je,{size:20})})]}),e.jsx("div",{className:"flex-1 p-4",children:ft?e.jsx("iframe",{src:ft,className:"w-full h-full rounded-xl border border-gray-200",title:"PhonePe Payment",allow:"payment",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation"}):e.jsx("div",{className:"w-full h-full rounded-xl bg-gray-50 border border-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-purple-600 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading payment page..."})]})})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:"Secure payment processing â€¢ 256-bit SSL encryption"})]})})]})}),Ct&&e.jsxs("div",{className:"fixed inset-0 z-[9999] flex",onClick:()=>Ie(!1),children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"absolute bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 w-80 max-h-[70vh] overflow-y-auto",style:{top:he?`${he.top}px`:"50%",left:he?`${he.left-160}px`:"50%",transform:he?"none":"translate(-50%, -50%)"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Select Date"}),e.jsx("button",{onClick:()=>Ie(!1),className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 transition-colors",children:e.jsx(Je,{size:18})})]}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(s=>{const a=S().add(s,"month"),r=a.startOf("month"),o=a.endOf("month"),d=r.day(),l=o.date(),y=S();return e.jsxs("div",{className:"border border-gray-100 rounded-xl p-3 bg-white",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:a.format("MMMM YYYY")}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-xs",children:[["Su","Mo","Tu","We","Th","Fr","Sa"].map(m=>e.jsx("div",{className:"text-center text-gray-400 font-medium py-2",children:m},m)),Array.from({length:d}).map((m,k)=>e.jsx("div",{className:"p-2"},`empty-${k}`)),Array.from({length:l}).map((m,k)=>{const j=r.date(k+1),w=j.format("YYYY-MM-DD"),v=j.isBefore(y,"day"),ge=n.date===w,se=j.isSame(y,"day");return e.jsx("button",{onClick:()=>ws(w),disabled:v,className:`
                                  p-2 rounded-lg text-sm font-medium transition-all duration-200
                                  ${v?"text-gray-300 cursor-not-allowed bg-gray-50":""}
                                  ${ge?"bg-sky-600 text-white shadow-md":""}
                                  ${!v&&!ge?"hover:bg-sky-50 text-gray-700":""}
                                  ${se?"ring-2 ring-sky-300":""}
                                `,children:j.date()},k)})]})]},s)})})]})]})]})})]})})}export{Ia as default};
