import{A as w,R as v,j as l}from"./index-CmreT6x1.js";import{a as u,A as g}from"./AdminApp-BV7zANWg.js";import{A as C}from"./AdminTable-tpEZTVA3.js";import{i as $}from"./media-DcknJ8BL.js";import"./createLucideIcon-CgZNF2TE.js";import"./file-text-ButRzfWA.js";import"./newspaper-yOb_4zvd.js";import"./ticket-hq6RMmhb.js";import"./chevron-down-bqKWLlrR.js";const b={},P=(b==null?void 0:b.VITE_CLIENT_URL)||window.location.origin,f=a=>String(a||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"").slice(0,120),_=a=>Array.isArray(a)?a:a==null?[]:[],S=a=>a?Array.isArray(a)?{items:a,meta:null}:Array.isArray(a==null?void 0:a.data)?{items:a.data,meta:a.meta||null}:a!=null&&a.data&&typeof a.data=="object"&&Array.isArray(a.data.data)?{items:a.data.data,meta:a.data.meta||a.meta||null}:{items:_(a.items||a.list),meta:a.meta||null}:{items:[],meta:null};function U(){const a=w(),[o,r]=v.useState({status:"idle",items:[],error:null,q:"",active:"",page:1,limit:20,meta:null}),d=async(e=1)=>{const t=o.q||"",c=o.active||"",s=o.limit||20;r(i=>({...i,status:"loading",error:null,page:e}));try{const i=await u.get(g.blogs(),{params:{q:t||void 0,active:c||void 0,page:e,limit:s}}),{items:n,meta:p}=S(i);r(x=>({...x,status:"succeeded",items:n,meta:p||{page:e,limit:s,count:n.length},page:e}))}catch(i){r(n=>({...n,status:"failed",error:i}))}};v.useEffect(()=>{d(1)},[]);const j=(e,t)=>{var s;(s=t==null?void 0:t.stopPropagation)==null||s.call(t);const c=e.slug||f(e.title);if(!c)return alert("Missing slug");window.open(`${P}/blogs/${c}`,"_blank","noopener")},N=async(e,t)=>{var c;(c=t==null?void 0:t.stopPropagation)==null||c.call(t);try{const s=await u.get(`${g.blogs()}/${e.blog_id||e.id}`),i=(s==null?void 0:s.blog)||s||{},n=Date.now(),p=`${i.slug||f(i.title)||"blog"}-copy-${n}`,x={title:`${i.title} (Copy)`,slug:p,content:i.content||"",image_url:i.image_url||"",author:i.author||"",active:!1};await u.post(g.blogs(),x),alert("Duplicated as draft"),d(o.page)}catch(s){alert((s==null?void 0:s.message)||"Failed to duplicate")}},A=async(e,t)=>{var c;(c=t==null?void 0:t.stopPropagation)==null||c.call(t);try{const s=e.blog_id||e.id;await u.put(`${g.blogs()}/${s}`,{active:!e.active}),r(i=>({...i,items:i.items.map(n=>(n.blog_id||n.id)===s?{...n,active:!e.active}:n)}))}catch(s){alert((s==null?void 0:s.message)||"Failed to update")}},k=async(e,t)=>{var c;if((c=t==null?void 0:t.stopPropagation)==null||c.call(t),!!window.confirm(`Delete blog "${e.title}"? This cannot be undone.`))try{const s=e.blog_id||e.id;await u.delete(`${g.blogs()}/${s}`),r(i=>({...i,items:i.items.filter(n=>(n.blog_id||n.id)!==s)}))}catch(s){alert((s==null?void 0:s.message)||"Delete failed")}},m=o.meta||{},y=o.page>1,h=m.page?m.page<(m.totalPages||m.total_pages||1):!1;return l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsx("h1",{className:"text-xl font-semibold",children:"Blogs"}),l.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm",onClick:()=>a("/admin/catalog/blogs/new"),children:"New Blog"})]}),l.jsxs("div",{className:"mb-3 grid grid-cols-1 md:grid-cols-4 gap-2",children:[l.jsx("input",{className:"rounded-md border px-3 py-2",placeholder:"Search title/slug",value:o.q,onChange:e=>r(t=>({...t,q:e.target.value}))}),l.jsxs("select",{className:"rounded-md border px-3 py-2",value:o.active,onChange:e=>r(t=>({...t,active:e.target.value})),children:[l.jsx("option",{value:"",children:"Active: All"}),l.jsx("option",{value:"true",children:"Active"}),l.jsx("option",{value:"false",children:"Inactive"})]}),l.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>d(1),children:"Filter"})]}),l.jsx(C,{keyField:"blog_id",columns:[{key:"preview",title:"Cover",render:e=>{const t=$(e);return l.jsx("div",{className:"w-20 h-14 rounded-md overflow-hidden bg-gray-100 flex items-center justify-center",children:t?l.jsx("img",{src:t,alt:e.title||"Blog cover",className:"w-full h-full object-cover",loading:"lazy"}):l.jsx("span",{className:"text-[10px] text-gray-500",children:"No image"})})}},{key:"title",title:"Title"},{key:"slug",title:"Slug"},{key:"author",title:"Author"},{key:"active",title:"Status",render:e=>e.active?l.jsx("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-700 text-xs",children:"Published"}):l.jsx("span",{className:"px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 text-xs",children:"Draft"})},{key:"__actions",title:"Actions",render:e=>l.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.jsx("button",{className:"rounded-md border px-2 py-1 text-xs",onClick:t=>j(e,t),children:"Preview"}),l.jsx("button",{className:"rounded-md border px-2 py-1 text-xs",onClick:t=>N(e,t),children:"Duplicate"}),l.jsx("button",{className:`rounded-md px-2 py-1 text-xs ${e.active?"border text-red-600":"bg-blue-600 text-white"}`,onClick:t=>A(e,t),children:e.active?"Unpublish":"Publish"}),l.jsx("button",{className:"rounded-md border px-2 py-1 text-xs text-red-600",onClick:t=>k(e,t),children:"Delete"})]})}],rows:o.items,onRowClick:e=>a(`/admin/catalog/blogs/${e.blog_id||e.id}`),empty:o.status==="loading"?"Loadingâ€¦":"No blogs"}),l.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[l.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>y&&d(o.page-1),disabled:!y||o.status==="loading",children:"Prev"}),l.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",m.page||o.page]}),l.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>h&&d(o.page+1),disabled:!h||o.status==="loading",children:"Next"})]})]})}export{U as default};
