import{r as i,j as e}from"./index-uOjPOlE7.js";import{a as l,A as d}from"./AdminApp-BnGJaM53.js";import"./createLucideIcon-2KnKMZCN.js";import"./file-text-DGJyf1Ue.js";import"./ticket-dFPTzn5g.js";const B=()=>{const[p,x]=i.useState([]),[g,v]=i.useState([]),[h,f]=i.useState([]),[N,w]=i.useState(!0),[C,u]=i.useState(!1),[m,j]=i.useState(null),[a,r]=i.useState({name:"",description:"",target_type:"attraction",target_id:"",date_ranges:[{from:"",to:""}],price_adjustment_type:"fixed",price_adjustment_value:0,active:!0});i.useEffect(()=>{R()},[]);const R=async()=>{try{const[t,s,n]=await Promise.all([l.get(d.dynamicPricing()),l.get(d.attractions(),{params:{active:!0,limit:100}}),l.get(d.combos(),{params:{active:!0,limit:100}})]);x(t.data||[]),v(s.data||[]),f(n.data||[])}catch(t){console.error("Error loading data:",t)}finally{w(!1)}},b=async()=>{try{const t=await l.get(d.dynamicPricing());x(t.data||[])}catch(t){console.error("Error loading rules:",t)}},A=async t=>{t.preventDefault();try{m?await l.put(d.dynamicPricingById(m.rule_id),a):await l.post(d.dynamicPricing(),a),b(),y()}catch(s){console.error("Error saving rule:",s),alert("Error saving rule: "+s.message)}},D=t=>{j(t),r({name:t.name,description:t.description||"",target_type:t.target_type,target_id:t.target_id||"",date_ranges:t.date_ranges||[{from:"",to:""}],price_adjustment_type:t.price_adjustment_type,price_adjustment_value:t.price_adjustment_value,active:t.active}),u(!0)},k=async t=>{if(confirm("Are you sure you want to delete this rule?"))try{await l.delete(d.dynamicPricingById(t)),b()}catch(s){console.error("Error deleting rule:",s),alert("Error deleting rule: "+s.message)}},y=()=>{r({name:"",description:"",target_type:"attraction",target_id:"",date_ranges:[{from:"",to:""}],price_adjustment_type:"fixed",price_adjustment_value:0,active:!0}),j(null),u(!1)},S=()=>{r({...a,date_ranges:[...a.date_ranges,{from:"",to:""}]})},E=t=>{a.date_ranges.length>1&&r({...a,date_ranges:a.date_ranges.filter((s,n)=>n!==t)})},_=(t,s,n)=>{const o=[...a.date_ranges];o[t][s]=n,r({...a,date_ranges:o})},P=()=>a.target_type==="attraction"?g.map(t=>e.jsx("option",{value:t.attraction_id,children:t.title},t.attraction_id)):a.target_type==="combo"?h.map(t=>e.jsx("option",{value:t.combo_id,children:t.name},t.combo_id)):null;return N?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dynamic Pricing Rules"}),e.jsx("button",{onClick:()=>u(!0),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Add New Rule"})]}),C&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:m?"Edit Rule":"Add New Rule"}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rule Name"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>r({...a,name:t.target.value}),className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("input",{type:"text",value:a.description,onChange:t=>r({...a,description:t.target.value}),className:"w-full p-2 border rounded"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Type"}),e.jsxs("select",{value:a.target_type,onChange:t=>r({...a,target_type:t.target.value,target_id:""}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"attraction",children:"Attraction"}),e.jsx("option",{value:"combo",children:"Combo"}),e.jsx("option",{value:"all",children:"All"})]})]}),a.target_type!=="all"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:a.target_type==="attraction"?"Attraction":"Combo"}),e.jsxs("select",{value:a.target_id,onChange:t=>r({...a,target_id:t.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Select..."}),P()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Active"}),e.jsx("input",{type:"checkbox",checked:a.active,onChange:t=>r({...a,active:t.target.checked}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Date Ranges"}),e.jsx("button",{type:"button",onClick:S,className:"text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Range"})]}),a.date_ranges.map((t,s)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",value:t.from,onChange:n=>_(s,"from",n.target.value),className:"flex-1 p-2 border rounded",required:!0}),e.jsx("span",{className:"self-center",children:"to"}),e.jsx("input",{type:"date",value:t.to,onChange:n=>_(s,"to",n.target.value),className:"flex-1 p-2 border rounded",required:!0}),a.date_ranges.length>1&&e.jsx("button",{type:"button",onClick:()=>E(s),className:"text-red-600 hover:text-red-800 px-2",children:"×"})]},s))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Adjustment Type"}),e.jsxs("select",{value:a.price_adjustment_type,onChange:t=>r({...a,price_adjustment_type:t.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"fixed",children:"Fixed Amount"}),e.jsx("option",{value:"percentage",children:"Percentage"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Adjustment Value (",a.price_adjustment_type==="percentage"?"%":"₹",")"]}),e.jsx("input",{type:"number",step:"0.01",value:a.price_adjustment_value,onChange:t=>r({...a,price_adjustment_value:parseFloat(t.target.value)||0}),className:"w-full p-2 border rounded",required:!0})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:[m?"Update":"Create"," Rule"]}),e.jsx("button",{type:"button",onClick:y,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Cancel"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Target"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Date Range"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Adjustment"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[p.map(t=>{var s,n,o;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.name}),e.jsx("td",{className:"px-4 py-3",children:t.target_type==="all"?"All":t.target_type==="attraction"?((s=g.find(c=>c.attraction_id===t.target_id))==null?void 0:s.title)||`Attraction ${t.target_id}`:((n=h.find(c=>c.combo_id===t.target_id))==null?void 0:n.name)||`Combo ${t.target_id}`}),e.jsx("td",{className:"px-4 py-3",children:((o=t.date_ranges)==null?void 0:o.map((c,F)=>e.jsxs("div",{children:[new Date(c.from).toLocaleDateString()," - ",new Date(c.to).toLocaleDateString()]},F)))||"No ranges"}),e.jsxs("td",{className:"px-4 py-3",children:[t.price_adjustment_type==="fixed"?"₹":"",t.price_adjustment_value,t.price_adjustment_type==="percentage"?"%":""]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.active?"Active":"Inactive"})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("button",{onClick:()=>D(t),className:"text-blue-600 hover:text-blue-800 mr-2",children:"Edit"}),e.jsx("button",{onClick:()=>k(t.rule_id),className:"text-red-600 hover:text-red-800",children:"Delete"})]})]},t.rule_id)}),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"No dynamic pricing rules found. Create your first rule to get started."})})]})]})})]})};export{B as default};
