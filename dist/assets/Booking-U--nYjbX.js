import{j as e,h as Ns,C as ws,u as ge,r as x,E as S,m as ks,q as _s,v as Cs,t as At,G as z,H as ae,I as Ms,i as Se,k as Te,J as Ps,F as Ss,K as It,M as Dt,Q as Ts,S as As,T as Is,U as Ds,V as Ys,W as $s}from"./index-C5Mz9dTM.js";import{i as $e}from"./media-DDlhmRHE.js";import{p as Os}from"./attractions-DXue5tYx.js";import{a as Yt,c as $t,d as Ot,g as tt}from"./pricing-CIeFTiJd.js";import{f as zt}from"./formatters-CmiLqhJj.js";import{c as L}from"./createLucideIcon-DQ6FqzLt.js";import{X as Ae}from"./x-Dp3FxIE1.js";import{P as Et,C as Lt}from"./plus-D5Q8_bOm.js";import{M as zs,P as Es}from"./phone-CKtjEWfK.js";import{C as qt}from"./circle-alert-B_8ts0Q-.js";import{T as Ft}from"./ticket-C3bgGsni.js";import{C as Ls}from"./clock-m8MB6VK0.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Fs=L("arrow-left",qs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Qe=L("arrow-right",Rs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ie=L("check",Bs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Je=L("chevron-right",Ks);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Vs=L("globe",Us);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Hs=L("log-in",Gs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"M5 12h14",key:"1ays0h"}]],Rt=L("minus",Ws);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],H=L("shopping-bag",Xs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Js=L("triangle-alert",Qs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],ea=L("user-plus",Zs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],sa=L("user",ta);function aa({isOpen:t,onClose:i,onSignIn:c}){return t?e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl bg-white shadow-2xl dark:bg-neutral-900 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-8 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Js,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-lg font-bold",children:"Session Expired"})]}),e.jsx("p",{className:"mt-2 text-sm opacity-90",children:"Your login session has expired. Please sign in again to continue booking."})]}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mb-6",children:"Your booking information is saved. Sign in again to complete your purchase without losing your selections."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:c,className:"w-full flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3 text-white font-semibold transition-all duration-200 hover:shadow-lg hover:from-blue-700 hover:to-blue-800 active:scale-95",children:[e.jsx(Hs,{className:"h-5 w-5"}),"Sign In Again"]}),e.jsx("button",{onClick:i,className:"w-full rounded-lg border border-gray-300 px-4 py-2 text-gray-700 font-medium transition-all hover:bg-gray-50 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",children:"Continue as Guest"})]})]})]})}):null}const W=t=>S(t).format("YYYY-MM-DD"),K=()=>S().format("YYYY-MM-DD"),re=t=>(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.attraction_id)??null,ne=t=>(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.combo_id)??null,Bt=(t,i)=>String((t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.slot_id)??(t==null?void 0:t.combo_slot_id)??`${(t==null?void 0:t.start_time)||""}-${(t==null?void 0:t.end_time)||""}-${i}`),Kt=t=>{if(!t)return"";const[i,c]=t.split(":"),p=parseInt(i,10),y=p>=12?"PM":"AM";return`${p%12||12}:${c} ${y}`},Ut=t=>{if(t!=null&&t.label)return t.label;const i=Kt(t==null?void 0:t.start_time),c=Kt(t==null?void 0:t.end_time);return i&&c?`${i} - ${c}`:i||`Slot #${(t==null?void 0:t.id)||"?"}`},ra=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,Vt=[{code:"+91",label:"IN (+91)"},{code:"+1",label:"US (+1)"},{code:"+971",label:"AE (+971)"},{code:"+44",label:"UK (+44)"},{code:"+65",label:"SG (+65)"}],na=t=>Number((t==null?void 0:t.price)??(t==null?void 0:t.amount)??0),ia=t=>(t==null?void 0:t.id)??(t==null?void 0:t.addon_id)??(t==null?void 0:t._id)??null,la=t=>(t==null?void 0:t.name)??(t==null?void 0:t.title)??(t==null?void 0:t.label)??"Addon",oa=t=>{if(!t)return null;const i=[t,t==null?void 0:t.image_url,t==null?void 0:t.image,t==null?void 0:t.thumbnail,t==null?void 0:t.cover_image];for(const c of i){if(!c)continue;const p=typeof c=="string"?$e(c):$e(c);if(p)return p}return null};function ca(t){const i=()=>typeof window<"u"?window.matchMedia(t).matches:!1,[c,p]=x.useState(i);return x.useEffect(()=>{if(typeof window>"u")return;const y=window.matchMedia(t),b=_=>p(_.matches);return y.addEventListener("change",b),()=>y.removeEventListener("change",b)},[t]),c}const Gt=()=>({itemType:"attraction",attractionId:"",comboId:"",date:K(),slotKey:"",qty:1}),da=()=>`sel_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`,Ht=(t,i=null)=>{if(!t)return i?`Combo ${i}`:"Combo";const c=t.name??t.title??t.combo_name??t.label??null;return c||(i?`Combo ${i}`:"Combo")},be=t=>{if(!t)return null;if(typeof t=="string")return $e(t);if(typeof t=="object"){const i=t.url||t.src||t.image_url||t.path;if(i)return $e(i)}return null},De=t=>{var c;if(!t)return null;const i=[t.desktop_image_url,t.hero_image,t.banner_image,t.image_url,t.cover_image,t.thumbnail,(c=t.media)==null?void 0:c[0]];for(const p of i){const y=be(p);if(y)return y}return null},Ye=t=>{var c;if(!t)return null;const i=[t.desktop_image_url,t.hero_image,t.banner_image,t.image_url,t.cover_image,(c=t.media)==null?void 0:c[0],t.attraction_1_image,t.attraction_2_image];for(const p of i){const y=be(p);if(y)return y}return null},ma=t=>{if(!t)return[];const i=[];return t.attraction_1_image&&i.push(be(t.attraction_1_image)),t.attraction_2_image&&i.push(be(t.attraction_2_image)),i.length<2&&Array.isArray(t.media)&&t.media.forEach(c=>{const p=be(c);p&&!i.includes(p)&&i.push(p)}),i.slice(0,2).filter(Boolean)},D=t=>{const i=Number(t);return Number.isFinite(i)?i:0},st=t=>String(t||"").toLowerCase(),Oe=(t,i)=>t==null||i==null?!1:String(t)===String(i),ua=t=>{if(typeof t=="boolean")return t;if(t==null)return!1;if(typeof t=="number")return t!==0;const i=String(t).trim().toLowerCase();return i?["true","1","yes","y"].includes(i)?!0:["false","0","no","n"].includes(i)?!1:!!t:!1},xa=t=>t?Array.isArray(t)?t.reduce((i,c)=>i+D(c),0):typeof t=="object"?Object.values(t).reduce((i,c)=>i+D(c),0):0:0,Wt=t=>{if(!t)return 0;const i=tt(t);if(i>0)return i;const c=(t==null?void 0:t.combo_price)??(t==null?void 0:t.price)??(t==null?void 0:t.amount)??(t==null?void 0:t.total_price)??(t==null?void 0:t.starting_price)??(t==null?void 0:t.min_price)??(t==null?void 0:t.base_price)??0;if(D(c)>0)return D(c);const p=t==null?void 0:t.combo_attractions;if(Array.isArray(p)&&p.length){const _=p.reduce((P,f)=>P+D((f==null?void 0:f.attraction_price)??(f==null?void 0:f.price)),0);if(_>0)return _}const y=xa(t==null?void 0:t.attraction_prices);if(y>0)return y;const b=D(t==null?void 0:t.attraction_1_price)+D(t==null?void 0:t.attraction_2_price);return b>0?b:0},pa=(t,i)=>{if(!t)return!0;const c=S();if(S(i).format("YYYY-MM-DD")===c.format("YYYY-MM-DD")){const y=t.start_time||t.time||t.startTime;if(!y)return!0;const[b,_]=y.split(":"),P=parseInt(b)*60+parseInt(_),N=c.hour()*60+c.minute()+60;return P>=N}return!0},ya=t=>{if(!t)return!0;if(t.available===!1)return!1;const i=Number(t.capacity??t.available_capacity??t.available);if(Number.isNaN(i))return!0;if(t.booked!=null){const c=Number(t.booked);if(!Number.isNaN(c))return i-c>0}return i>0},at=t=>(t==null?void 0:t.id)??(t==null?void 0:t.offer_id)??(t==null?void 0:t.offerId)??(t==null?void 0:t.slug)??null,Xt=t=>(t==null?void 0:t.title)||(t==null?void 0:t.name)||`Offer ${at(t)??""}`.trim(),Ze=t=>(t==null?void 0:t.short_description)||(t==null?void 0:t.subtitle)||(t==null?void 0:t.description)||"",rt=(t,i)=>{if(!t||!i)return 0;const c=String(t.discount_type||t.rule_discount_type||"").toLowerCase(),p=Number(t.discount_percent??t.discountPercent??(c==="percent"?t.discount_value??t.discountValue:0))||0,y=Number(t.discount_value??t.discountValue??t.flat_discount??0)||0;let b=0;c==="percent"&&p>0||p>0?b=i*p/100:b=y;const _=Number(t.max_discount??t.maxDiscount??0);return _>0&&(b=Math.min(b,_)),Math.max(0,Math.min(b,i))},et=t=>{if(!t||typeof t!="string")return null;const[i="0",c="0"]=t.split(":"),p=Number(i),y=Number(c);return!Number.isFinite(p)||!Number.isFinite(y)?null:p*60+y},ha=(t={},i)=>{if(!t.day_type)return!0;const c=S(i).day(),p=String(t.day_type).toLowerCase();return p==="weekday"?c>=1&&c<=5:p==="weekend"?c===0||c===6:p==="custom"&&Array.isArray(t.specific_days)?t.specific_days.map(Number).includes(c):!0},fa=(t={},i=null)=>{if(!i)return!(t.slot_id!=null||Array.isArray(t.slot_ids)&&t.slot_ids.length||t.specific_time||t.time_from&&t.time_to);const c=[];if(t.slot_id!=null&&c.push(t.slot_id),Array.isArray(t.slot_ids)&&c.push(...t.slot_ids),t.target_slot_id!=null&&c.push(t.target_slot_id),c.length){const b=[i.slot_id,i.id,i._id,i.combo_slot_id].filter(P=>P!=null);if(!c.some(P=>b.some(f=>Oe(P,f))))return!1}if(!(t.specific_time||t.time_from&&t.time_to))return!0;const y=i.start_time||i.time||i.startTime||null;if(t.specific_time&&y&&y.slice(0,5)!==String(t.specific_time).slice(0,5))return!1;if(t.time_from&&t.time_to&&y){const b=et(y),_=et(t.time_from),P=et(t.time_to);if(b==null||_==null||P==null||b<_||b>P)return!1}return!0},Jt=({rule:t,selectedDate:i,selectedSlot:c,itemType:p,itemId:y})=>{if(!t||!i)return!1;const b=S(i).format("YYYY-MM-DD"),_=st(t.target_type),P=st(p);if(_&&P&&_!==P)return!1;if(!ua(t.applies_to_all)){const N=[];if(t.target_id!=null&&N.push(t.target_id),Array.isArray(t.target_ids)&&N.push(...t.target_ids),!N.length||!N.some($=>Oe($,y)))return!1}return!(t.specific_date&&b!==t.specific_date||Array.isArray(t.specific_dates)&&t.specific_dates.length&&!t.specific_dates.some(N=>S(N).format("YYYY-MM-DD")===b)||t.date_from&&b<t.date_from||t.date_to&&b>t.date_to||!ha(t,b)||!fa(t,c))},Qt=(t,i,c,p,y)=>!t||!i||!c?!1:(Array.isArray(t.rules)?t.rules:[]).filter(P=>Jt({rule:P,selectedDate:i,selectedSlot:c,itemType:p,itemId:y})).length>0,ga=(t,i,c)=>{const p=Number(i||0)*Number(c||1);if(!t||p<=0)return null;const y=rt(t,p)||0;return{total:p,totalDiscount:y,final:Math.max(0,p-y)}};function Ia(){var Ct,Mt,Pt,St,Tt;const t=Ns(),i=ws(),c=ca("(min-width: 768px)"),p=ge(s=>s.auth),y=!!(p!=null&&p.token),b=ge(s=>s.attractions),_=ge(s=>s.combos),P=ge(s=>s.addons),{step:f,contact:N,otp:q,coupon:$,creating:F,cart:X}=ge(s=>s.bookings),T=(X==null?void 0:X.items)||[],Y=T.length>0,ze=X==null?void 0:X.activeKey,I=x.useMemo(()=>{if(!T.length)return null;if(ze){const s=T.find(a=>a.key===ze);if(s)return s}return T[0]},[T,ze]),je=(I==null?void 0:I.key)||null;x.useRef(null);const nt=x.useRef(!1),[n,O]=x.useState(()=>Gt()),[ve,Zt]=x.useState(null),[es,Ne]=x.useState(!1),[ts,ie]=x.useState(!1),[ss,Ee]=x.useState("booking"),[as,rs]=x.useState(null),[E,it]=x.useState("payphi"),[C,Q]=x.useState({status:"idle",error:null,offers:[],offerRules:[],activeOffer:null,activeRule:null,selectedOffer:null,selectedRule:null,offerPreview:null,loadingOffers:!1}),[Le,lt]=x.useState("+91"),[le,we]=x.useState(""),[B,ke]=x.useState({}),[J,oe]=x.useState({status:"idle",items:[],error:null}),[_e,ot]=x.useState(""),[ce,ct]=x.useState(""),[de,dt]=x.useState(""),[U,ns]=x.useState(new Map),[mt,ut]=x.useState([]),[Ce,xt]=x.useState(!1),[Z,qe]=x.useState(!1),[ba,Fe]=x.useState(null),[is,Re]=x.useState(!1),[pt,Be]=x.useState(""),me=b.items||[],yt=x.useMemo(()=>Os(me),[me]),ue=_.items||[],ls=s=>{const a=s.target.value.replace(/\D/g,"");a.length<=10&&(we(a),B.phone&&ke(r=>({...r,phone:null})))},ht=x.useCallback(()=>{if(!Array.isArray(C.offers)||!I)return null;const s=st(I.item_type||(I.combo_id?"Combo":"Attraction")),a=I.attraction_id||I.combo_id||null,r=I.date||"",l=I.slot||{};let d=null;for(const o of C.offers){const h=Array.isArray(o.rules)?o.rules:[];for(const m of h)Jt({rule:m,selectedDate:r,selectedSlot:l,itemType:s,itemId:a})&&(!d||m.priority>d.rule.priority||m.priority===d.rule.priority&&m.rule_id<d.rule.rule_id)&&(d={offer:o,rule:m})}return d},[C.offers,I]);x.useEffect(()=>{const s=ht();Q(a=>({...a,activeOffer:(s==null?void 0:s.offer)||null,activeRule:(s==null?void 0:s.rule)||null}))},[ht]),x.useEffect(()=>{if(!C.activeOffer||!C.activeRule||!I){Q(o=>({...o,offerPreview:null}));return}const s=Number(I.price||I.unitPrice||0),a=C.activeRule.rule_discount_type||C.activeOffer.discount_type||"percent",r=Number(C.activeRule.rule_discount_value??C.activeOffer.discount_value??0);let l=s;a==="percent"?l=s*(1-r/100):a==="amount"&&(l=Math.max(0,s-r));const d=s-l;Q(o=>({...o,offerPreview:{basePrice:s,newPrice:l,savings:d,discountType:a,discountValue:r,offerTitle:C.activeOffer.title,ruleId:C.activeRule.rule_id}}))},[C.activeOffer,C.activeRule,I]),x.useEffect(()=>{if(N!=null&&N.phone&&!le){const s=String(N.phone).replace(/\D/g,"");if(s.length>10){const a=Vt.find(r=>s.startsWith(r.code.replace("+","")));a?(lt(a.code),we(s.slice(a.code.length-1))):we(s.slice(-10))}else we(s)}},[]),x.useEffect(()=>{if(C.status!=="idle")return;let s=!1;return(async()=>{Q(r=>({...r,status:"loading",loadingOffers:!0}));try{const r=await Se.get(Te.offers.list(),{params:{active:!0,limit:20}});if(s)return;const l=Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[];Q(d=>({...d,status:"succeeded",offers:l,loadingOffers:!1}))}catch{s||Q(r=>({...r,status:"failed",loadingOffers:!1}))}})(),()=>{s=!0}},[C.status]),x.useEffect(()=>{if(Ce||mt.length>0)return;let s=!1;return(async()=>{xt(!0);try{const r=await Se.get(Te.coupons.list(),{params:{active:!0,limit:50}});if(s)return;const l=Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[];ut(l)}catch(r){console.error("Failed to fetch promos:",r),ut([])}finally{xt(!1)}})(),()=>{s=!0}},[]);const os=x.useCallback(()=>{i("/")},[i]),[V]=ks(),xe=V.get("type"),ee=V.get("attraction_id"),te=V.get("combo_id"),Ke=V.get("date"),Ue=V.get("slot"),Ve=V.get("qty"),Ge=V.get("openDrawer");x.useEffect(()=>{b.status==="idle"&&t(_s({active:!0,limit:100})),_.status==="idle"&&t(Cs({active:!0,limit:100})),P.status==="idle"&&t(At({active:!0,limit:100}))},[t,b.status,_.status,P.status]),x.useEffect(()=>{f===3&&y&&t(z(4))},[f,y,t]),x.useEffect(()=>{const s=localStorage.getItem("pendingOrderData");if(s)try{const a=JSON.parse(s);console.log(" Found pending order data:",a),a.email&&!N.email&&t(ae({email:a.email})),a.mobile&&!N.phone&&t(ae({phone:a.mobile})),localStorage.removeItem("pendingOrderData")}catch(a){console.error("Error parsing pending order data:",a),localStorage.removeItem("pendingOrderData")}},[t,N.email,N.phone]),x.useEffect(()=>{!ee&&!te&&t(Ms())},[t,ee||"",te||""]),x.useEffect(()=>{const s={};xe&&(s.itemType=xe),ee&&(b.items||[]).some(r=>String(re(r))===String(ee))&&(s.attractionId=String(ee),xe||(s.itemType="attraction")),te&&(_.items||[]).some(r=>String(ne(r))===String(te))&&(s.comboId=String(te),xe||(s.itemType="combo")),Ke&&(s.date=Ke),Ue&&(s.slotKey=Ue),Ve&&(s.qty=Math.max(1,Number(Ve)||1)),Object.keys(s).length>0&&O(a=>({...a,...s}))},[xe||"",ee||"",te||"",Ke||"",Ue||"",Ve||"",Ge||"",b.items||[],_.items||[]]);const ft=x.useCallback(async({itemType:s,attractionId:a,comboId:r,date:l})=>{if(!l)return;const d=s==="combo"?r:a;if(d){oe({status:"loading",items:[],error:null});try{if(s==="combo"){const o=await Se.get(Te.combos.slots(d),{params:{date:W(l)}}),h=Array.isArray(o==null?void 0:o.data)?o.data:Array.isArray(o)?o:[];oe({status:"succeeded",items:h,error:null})}else{const o=await Se.get(Te.slots.list(),{params:{attraction_id:d,date:W(l)}}),h=Array.isArray(o==null?void 0:o.data)?o.data:Array.isArray(o)?o:[];oe({status:"succeeded",items:h,error:null})}}catch(o){oe({status:"failed",items:[],error:(o==null?void 0:o.message)||"Failed to load slots"})}}},[]);x.useEffect(()=>{const s=n.itemType,a=n.date,r=n.attractionId,l=n.comboId;(s==="combo"?l:r)&&a?(O(o=>({...o,slotKey:n.slotKey||""})),ft({itemType:s,attractionId:r,comboId:l,date:a})):oe({status:"idle",items:[],error:null})},[n.itemType||"",n.attractionId||"",n.comboId||"",n.date||"",ft]);const g=x.useMemo(()=>n.itemType==="attraction"?me.find(s=>String(re(s))===String(n.attractionId)):null,[me||[],n.itemType||"",n.attractionId||""]),M=x.useMemo(()=>n.itemType==="combo"?ue.find(s=>String(ne(s))===String(n.comboId)):null,[ue||[],n.itemType||"",n.comboId||""]),u=x.useMemo(()=>{for(let s=0;s<J.items.length;s+=1){const a=J.items[s];if(Bt(a,s)===n.slotKey)return a;const r=[a==null?void 0:a.slot_id,a==null?void 0:a.id,a==null?void 0:a._id,a==null?void 0:a.combo_slot_id].filter(Boolean);if(n.slotKey&&r.map(String).includes(String(n.slotKey)))return a}return null},[J.items,n.slotKey]),A=x.useMemo(()=>{if(n.itemType==="combo"&&M){const s=D(Wt(M)),a=D(Yt(M)||s),r=(u==null?void 0:u.pricing)||{},l=(u==null?void 0:u.offer)||null,d=u?$t(u,a):a,o=u?Ot(u,s):s;let h=D(r.base_price??d),m=D(r.final_price??o);h||(h=d),m||(m=o);const k=W(n.date),j=ne(M);let w=l||null;if(!w&&(w=C.offers.find(v=>(v.rule_type==="happy_hour"||v.rule_type==="holiday"||v.rule_type==="special")&&Qt(v,k,u,"combo",j)),w)){const v=rt(w,h||m);m=Math.max(0,(h||m)-v)}return{title:Ht(M,ne(M)),price:m,originalPrice:h||m,happyHourOffer:w,offerDescription:(w==null?void 0:w.description)||"",image:Ye(M),previewImages:ma(M)}}if(n.itemType==="attraction"&&g){const s=D(tt(g)||(g==null?void 0:g.price)||(g==null?void 0:g.base_price)||(g==null?void 0:g.amount)||0),a=D(Yt(g)||s),r=(u==null?void 0:u.pricing)||{},l=(u==null?void 0:u.offer)||null,d=u?$t(u,a):a,o=u?Ot(u,s):s;let h=D(r.base_price??d),m=D(r.final_price??o);h||(h=d),m||(m=o);const k=W(n.date),j=re(g);let w=l||null;if(!w&&(w=C.offers.find(v=>(v.rule_type==="happy_hour"||v.rule_type==="holiday"||v.rule_type==="special")&&Qt(v,k,u,"attraction",j)),w)){const v=rt(w,h||m);m=Math.max(0,(h||m)-v)}return{title:(g==null?void 0:g.name)||(g==null?void 0:g.title)||`Attraction #${re(g)}`,price:m,originalPrice:h||m,happyHourOffer:w,offerDescription:(w==null?void 0:w.description)||"",image:De(g)}}return{title:"",price:0,originalPrice:0,offerDescription:""}},[n.itemType||"",M||null,g||null,u||null,n.date||"",C.offers||[]]);x.useEffect(()=>{Ge==="true"&&(n.itemType==="attraction"||n.itemType==="combo")&&A.title&&!nt.current&&(nt.current=!0,ie(!0))},[Ge,n.itemType,A.title]);const pe=Math.max(1,Number(n.qty)||1),cs=Number(A.price||0)*pe,R=!!(A.title&&n.date&&n.slotKey&&pe),ds=x.useMemo(()=>T.reduce((s,a)=>s+Number(a.unitPrice||0)*Number(a.quantity||0),0),[T||[]]),He=x.useMemo(()=>{let s=0;return U.forEach((a,r)=>{T.find(d=>d.key===r)&&a.forEach(d=>{s+=Number(d.price||0)*Number(d.quantity||0)})}),s},[U||new Map,T||[]]),We=ds+He,ye=Number($.discount||0),gt=ye>0&&($.code||((Ct=$.data)==null?void 0:Ct.code)),G=Math.max(0,We-ye);A.image||De(me[0])||Ye(ue[0]);const ms=x.useMemo(()=>je?U.get(je)||new Map:new Map,[U,je]),Me=x.useCallback(()=>{if(!R)return!1;const s=n.itemType==="combo"?"Combo":"Attraction",a=n.itemType==="combo"?(u==null?void 0:u.combo_slot_id)??(u==null?void 0:u.id)??(u==null?void 0:u._id)??null:(u==null?void 0:u.slot_id)??(u==null?void 0:u.id)??(u==null?void 0:u._id)??null,r=(u==null?void 0:u.offer)||A.happyHourOffer||null,l={key:ve||da(),merge:!1,item_type:s,title:A.title,slotLabel:u?Ut(u):"",quantity:pe,booking_date:W(n.date),booking_time:(u==null?void 0:u.start_time)||(u==null?void 0:u.startTime)||(u==null?void 0:u.slot_start_time)||null,unitPrice:A.price||0,dateLabel:W(n.date),slot_id:s==="Attraction"?a:null,combo_slot_id:s==="Combo"?a:null,attraction_id:s==="Attraction"?re(g):null,combo_id:s==="Combo"?ne(M):null,slot:u||null,attraction:g||null,combo:M||null,pricing:(u==null?void 0:u.pricing)||null,originalPrice:A.originalPrice||null,offer:r,offerDescription:A.offerDescription||(r==null?void 0:r.description)||""};return ve&&t(Ps(ve)),t(Ss(l)),t(It(l.key)),Zt(null),O(Gt()),ns(d=>{const o=new Map(d);return o.has(l.key)||o.set(l.key,new Map),o}),!0},[R,n||{},A||{},u||null,g||null,M||null,pe||1,ve||null,t]),us=x.useCallback(()=>{if(!R){alert("Please select a date, a time slot, and quantity first.");return}const a=[n.itemType==="combo"?"Combo":"Attraction",n.itemType==="combo"?n.comboId:n.attractionId||"na",(n.itemType==="attraction",n.slotKey||"na"),n.date||"na"].join(":");T.some(l=>l.fingerprint===a)||Me(),t(z(2))},[R,n,T,Me,t,y]),Xe=()=>{if(f===1)if(Y)t(z(2));else{if(!R){alert("Please select date, time slot and quantity.");return}Me()&&t(z(2))}else f===2?t(z(y?4:3)):f===3&&(q.verified?t(z(4)):alert("Please verify OTP to continue."))},xs=()=>{f!==1&&(f===2?t(z(1)):f===3?t(z(2)):f===4&&t(z(y?2:3)))},bt=async()=>{const s={},a=(N.email||"").trim();if(ra.test(a)||(s.email="Please enter a valid email address"),le.length!==10&&(s.phone="Phone number must be exactly 10 digits"),Object.keys(s).length>0){ke(s);return}ke({});const r=`${Le}${le}`;t(ae({email:a,phone:r}));try{await t(Ts({email:a,phone:r})).unwrap()}catch(l){alert((l==null?void 0:l.message)||"Failed to send OTP")}},ps=async()=>{if(!_e||_e.length<4)return alert("Enter the full OTP code");await t(As({otp:_e})).unwrap().then(()=>{ot(""),t(z(4))}).catch(s=>alert((s==null?void 0:s.message)||"OTP verification failed"))},ys=async()=>{ce&&await t(Is({code:ce,total_amount:Math.max(0,We),onDate:n.date||W(new Date)})).unwrap().then(()=>t(Dt(ce))).catch(()=>{})},hs=()=>e.jsxs("div",{className:"flex items-center justify-between mb-0.5 px-3 sm:px-6 w-full sm:w-1/2 mx-auto",children:[[{n:1,l:"Select",icon:H},{n:2,l:"Extras",icon:Ft},{n:3,l:"Verify",icon:Ls},{n:4,l:"Pay",icon:Ie}].map(s=>{if(y&&s.n===3)return null;const a=f>s.n||y&&s.n===3,r=f===s.n,l=a||y&&s.n===3,d=s.icon;return e.jsxs("div",{className:"flex flex-col items-center relative z-10 group",children:[e.jsx("div",{className:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300 border-2 shadow-sm ${r?"bg-gradient-to-br from-sky-600 to-sky-700 border-sky-600 text-white scale-110 ring-4 ring-sky-100":l?"bg-gradient-to-br from-emerald-600 to-emerald-700 border-emerald-600 text-white shadow-md":"bg-white border-gray-200 text-gray-300 shadow-sm"}`,children:l&&!r?e.jsx(Ie,{size:16,strokeWidth:3}):e.jsx(d,{size:16})}),e.jsx("span",{className:`text-[10px] mt-2 font-bold uppercase tracking-widest ${r?"text-sky-600":l?"text-emerald-600":"text-gray-400"}`,children:s.l})]},s.n)}),e.jsx("div",{className:"absolute left-8 right-8 top-[18px] h-0.5 bg-gradient-to-r from-sky-100 to-sky-200 -z-0 overflow-hidden rounded-full",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-sky-600 to-sky-500 transition-all duration-500 ease-out shadow-sm",style:{width:`${(f-1)/(y?2:3)*100}%`}})})]}),fs=()=>{const s=n.itemType,a=x.useMemo(()=>s!=="attraction"?ue:yt,[s,yt,ue]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-sky-50 p-1 rounded-xl inline-flex border border-sky-100",children:["attraction","combo"].map(r=>e.jsx("button",{onClick:()=>{O(l=>({...l,itemType:r,attractionId:"",comboId:"",slotKey:""}))},className:`px-6 py-2 text-sm font-semibold rounded-lg capitalize transition-all duration-200 ${n.itemType===r?"bg-white text-sky-700 shadow-sm ring-1 ring-black/5":"text-gray-600 hover:text-gray-900"}`,children:r==="attraction"?"Attractions":"Combos"},r))})}),a.length===0?e.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-dashed border-gray-200 px-4 py-6 text-center text-sm text-gray-500",children:n.itemType==="combo"?"No combos available":"No attractions available"}):a.map(r=>{const l=n.itemType==="attraction"?re(r):ne(r),d=String(n.itemType==="attraction"?n.attractionId:n.comboId)===String(l),o=n.itemType==="combo"?Number(Wt(r)||0):Number(tt(r)||r.price||r.base_price||r.amount||0),h=n.itemType==="attraction"?r.title||r.name:Ht(r),m=n.itemType==="combo"?Ye(r):De(r),k=()=>{const j=n.itemType==="combo",w=T.find(v=>j?v.item_type==="Combo"&&Oe(v.combo_id,l):(v.item_type==="Attraction"||v.item_type===void 0)&&Oe(v.attraction_id,l));if(w){onEditCartItem(w);return}O(v=>({...v,itemType:n.itemType,attractionId:n.itemType==="attraction"?String(l):"",comboId:n.itemType==="combo"?String(l):"",slotKey:""})),Ee("booking"),ie(!0)};return e.jsxs("div",{className:`bg-white rounded-3xl shadow-sm border px-4 sm:px-6 py-4 sm:py-5 flex items-center justify-between gap-4 transition-all ${d?"border-sky-400 shadow-md":"border-gray-100 hover:border-sky-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-28 h-28 rounded-2xl overflow-hidden border border-gray-100 bg-sky-50 shrink-0",children:m?e.jsx("img",{src:m,alt:h,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sky-400",children:e.jsx(H,{})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1 truncate",children:h}),e.jsx("p",{className:"text-xs text-gray-500",children:"Great for families â€¢ Flexible slots â€¢ Instant confirmation"}),e.jsxs("button",{type:"button",onClick:()=>{O(j=>({...j,itemType:n.itemType,attractionId:n.itemType==="attraction"?String(l):"",comboId:n.itemType==="combo"?String(l):"",slotKey:""})),rs(m||null),Ee("details"),ie(!0)},className:"inline-flex items-center gap-1 text-xs sm:text-sm font-semibold text-sky-700 hover:text-sky-900 mt-2",children:["View details",e.jsx(Je,{size:14})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 sm:gap-3",children:[e.jsx("div",{className:"text-right text-xs text-gray-500 uppercase tracking-wide",children:"From"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-sky-700 tabular-nums",children:["â‚¹",o||0]})}),e.jsx("button",{type:"button",onClick:k,className:`px-6 py-2 rounded-full text-white text-sm font-semibold shadow-md active:scale-[0.98] transition-all ${d?"bg-sky-700":"bg-sky-600 hover:bg-sky-700"}`,children:d?"Selected":"Select"})]})]},l)})]})},gs=()=>C.loadingOffers||!C.offers.length?null:e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"Available Offers"}),de&&e.jsx("button",{type:"button",onClick:()=>dt(""),className:"text-xs font-medium text-sky-700 hover:underline",children:"Remove"})]}),e.jsx("div",{className:"space-y-3",children:C.offers.map(s=>{const a=String(at(s));if(!a)return null;const r=ga(s,A.price||0,pe);return e.jsxs("label",{className:`flex items-start gap-3 rounded-2xl border px-3 py-3 cursor-pointer transition-all duration-200 ${String(de)===a?"border-sky-500 bg-sky-50 shadow-sm":"hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"selected-offer",className:"mt-1",checked:String(de)===a,onChange:()=>dt(a)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:Xt(s)}),Ze(s)?e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 line-clamp-2",children:Ze(s)}):null]}),e.jsx("span",{className:"text-xs font-semibold text-sky-700 bg-sky-50 px-2 py-1 rounded-full",children:r?`Save â‚¹${r.totalDiscount.toFixed(0)}`:"No discount"})]}),r&&r.totalDiscount>0&&e.jsxs("p",{className:"text-xs text-emerald-600 mt-1",children:["Save up to â‚¹",r.totalDiscount.toFixed(0)," with this offer"]})]})]},`offer-${a}`)})})]}),jt=()=>{O(s=>({...s,date:K(),slotKey:""}))},vt=()=>{O(s=>({...s,date:S().add(1,"day").format("YYYY-MM-DD"),slotKey:""}))},[Nt,Pe]=x.useState(!1),[bs,wt]=x.useState(null),he=x.useMemo(()=>null,[bs,Nt]),kt=s=>{s.preventDefault(),s.stopPropagation(),wt(s.currentTarget),Pe(!0)},js=s=>{O(a=>({...a,date:s,slotKey:""})),Pe(!1)},_t=s=>{if(!s)return"All Days";const a=S(s);return s===K()||s===S().add(1,"day").format("YYYY-MM-DD")?"All Days":a.format("D MMM")},vs=async()=>{var r,l;if((F==null?void 0:F.status)==="loading"||Z)return;if(!y){Ne(!0);return}if(!Y)return;qe(!0),Fe(Date.now());const s=((N==null?void 0:N.email)||((r=p==null?void 0:p.user)==null?void 0:r.email)||"").trim(),a=((N==null?void 0:N.phone)||((l=p==null?void 0:p.user)==null?void 0:l.phone)||"").trim();if(!s||!a){qe(!1),Fe(null),alert("Email and mobile number are required for payment. Please complete your contact details.");return}try{const d=T.map(m=>{var v,fe;const k={item_type:m.item_type,attraction_id:m.attraction_id,combo_id:m.combo_id,slot_id:m.slot_id,combo_slot_id:m.combo_slot_id,booking_date:m.booking_date,quantity:m.quantity,slot_label:m.slotLabel,slot_start_time:(v=m.slot)==null?void 0:v.start_time,slot_end_time:(fe=m.slot)==null?void 0:fe.end_time},j=U.get(m.key)||new Map,w=Array.from(j.values()).filter(se=>Number(se.quantity)>0).map(se=>({addon_id:se.addon_id,quantity:Number(se.quantity)}));return w.length>0&&(k.addons=w),k});console.log("ðŸ“¦ Creating booking with payload:",d);const o=await t(Ds(d)).unwrap();console.log("âœ… Booking creation result:",o);const h=(o==null?void 0:o.order_id)||(o==null?void 0:o.orderId);if(console.log("ðŸ”¢ Order ID extracted:",h),!h)throw console.error("âŒ No order ID in response:",o),new Error("Failed to create order - no order ID returned");if(E==="phonepe"){const m=await t(Ys({orderId:h,email:s,mobile:a,amount:G})).unwrap();if(console.log("âœ… PhonePe payment initiated:",m),m.ok&&m.redirectUrl)Be(m.redirectUrl),Re(!0),window.PhonePeCheckout&&window.PhonePeCheckout.transact?window.PhonePeCheckout.transact({tokenUrl:m.redirectUrl,callback:k=>{console.log("ðŸ“¡ PhonePe iframe callback:",k),Re(!1),Be(""),k==="USER_CANCEL"?alert("Payment was cancelled. You can try again or continue with a different payment method."):k==="CONCLUDED"?i(`/payment/success?orderId=${h}&gateway=phonepe`):(console.warn("Unknown PhonePe callback response:",k),alert("Payment status unclear. Please check your email for confirmation."))},type:"IFRAME"}):(console.error("âŒ PhonePe checkout script not loaded"),alert("Payment system not ready. Please refresh and try again."));else throw new Error(m.responseMessage||"Failed to initiate PhonePe payment")}else{const m=await t($s({orderId:h,email:s,mobile:a,amount:G})).unwrap();if(m.ok&&m.redirectUrl)console.log("âœ… PayPhi payment initiated, redirecting to:",m.redirectUrl),window.location.href=m.redirectUrl;else throw new Error(m.responseMessage||"Failed to initiate PayPhi payment")}}catch(d){console.error("âŒ Payment initiation failed:",d),alert(`Payment failed: ${(d==null?void 0:d.message)||d}`)}finally{qe(!1),Fe(null)}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 to-white font-inter",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-3 lg:px-0 pb-24 lg:pb-20 pt-20 md:pt-24",children:[e.jsxs("div",{className:"sticky top-[calc(64px+1px)] z-40 mt-px bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-sky-100 w-1/2 mx-auto",children:[e.jsxs("div",{className:"px-2 md:px-2 pt-1 md:pt-1 pb-0 md:pb-0 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900",children:f===1?"Select tickets":f===2?"Customize Add-ons":f===3?"Verify OTP":"Checkout"}),e.jsx("button",{onClick:os,className:"p-2 hover:bg-sky-50 rounded-full text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Ae,{size:22})})]}),e.jsx("div",{className:"relative pb-1",children:e.jsx(hs,{})})]}),e.jsxs("div",{className:"mt-2 md:mt-4",children:[f===1&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center mb-1",children:[e.jsx("button",{type:"button",onClick:jt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date===K()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),e.jsx("button",{type:"button",onClick:vt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date===S().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:kt,ref:wt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date&&n.date!==""&&n.date!==K()&&n.date!==S().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:n.date&&n.date!==K()&&n.date!==S().add(1,"day").format("YYYY-MM-DD")?_t(n.date):"All Days"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-500 ml-1",children:"Change date/time in details panel"})]}),e.jsx(fs,{})]}),e.jsx("div",{className:"lg:sticky lg:top-28",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),Y?e.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:T.map(s=>{var a,r,l,d,o,h;return e.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((a=s.meta)==null?void 0:a.title)||(s.item_type==="combo"?((r=s.combo)==null?void 0:r.title)||((l=s.combo)==null?void 0:l.name)||((d=s.combo)==null?void 0:d.combo_name)||`Combo #${s.combo_id}`:((o=s.attraction)==null?void 0:o.title)||((h=s.attraction)==null?void 0:h.name)||`Attraction #${s.attraction_id}`)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) â€¢"," ",s.dateLabel||S(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` â€¢ ${s.slotLabel}`:""]}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>onEditCartItem(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>onRemoveCartItem(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["â‚¹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:e.jsx(H,{className:"text-sky-600"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),e.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["â‚¹",G.toFixed(0)]})]}),e.jsxs("button",{type:"button",disabled:!Y,onClick:Xe,className:`w-full flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${Y?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx("span",{children:"Continue"}),e.jsx(Qe,{size:18})]})]})]})})]}),f===2&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start mt-4",children:[e.jsxs("div",{className:"space-y-6",children:[T.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:T.map(s=>{var a,r,l,d,o,h;return e.jsx("button",{onClick:()=>t(It(s.key)),className:`px-4 py-2 rounded-full border text-sm font-medium transition-all ${s.key===je?"bg-sky-600 text-white border-sky-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-sky-200"}`,children:s.title||((a=s.meta)==null?void 0:a.title)||(s.item_type==="combo"?((r=s.combo)==null?void 0:r.title)||((l=s.combo)==null?void 0:l.name)||((d=s.combo)==null?void 0:d.combo_name)||`Combo #${s.combo_id}`:((o=s.attraction)==null?void 0:o.title)||((h=s.attraction)==null?void 0:h.name)||`Attraction #${s.attraction_id}`)||"Item"},s.key)})}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Add-ons"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enhance your experience with optional extras"})]}),e.jsx("button",{onClick:()=>t(At({active:!0,limit:100})),className:"text-xs font-semibold text-sky-700 hover:underline",children:"Refresh"})]}),P.status==="loading"?e.jsx("div",{className:"text-center py-10 text-gray-500 text-sm",children:"Loading add-ons..."}):e.jsx("div",{className:"space-y-4",children:(P.items||[]).map(s=>{var h;const a=ia(s),r=na(s),l=la(s),d=oa(s),o=Number(((h=ms.get(a))==null?void 0:h.quantity)||0);return e.jsxs("div",{className:"flex gap-4 items-center border border-gray-200 rounded-2xl p-4 hover:border-sky-200 transition-all",children:[d?e.jsx("img",{src:d,alt:l,className:"w-16 h-16 rounded-xl object-cover border border-gray-100"}):e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center text-gray-400",children:e.jsx(H,{})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",children:l}),e.jsx("div",{className:"text-sm text-gray-500 tabular-nums",children:zt(r)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>handleAddonQuantityChange(a,Math.max(0,o-1),s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 transition",children:e.jsx(Rt,{size:16})}),e.jsx("span",{className:"w-6 text-center font-semibold text-gray-800 tabular-nums",children:o}),e.jsx("button",{onClick:()=>handleAddonQuantityChange(a,o+1,s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 bg-sky-600 text-white shadow",children:e.jsx(Et,{size:16})})]})]},a)})})]})]}),e.jsx("div",{className:"lg:sticky lg:top-28",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),Y?e.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:T.map(s=>{var l,d,o,h,m,k;const a=U.get(s.key)||new Map,r=Array.from(a.values()).filter(j=>Number(j.quantity)>0);return e.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((l=s.meta)==null?void 0:l.title)||(s.item_type==="combo"?((d=s.combo)==null?void 0:d.title)||((o=s.combo)==null?void 0:o.name)||((h=s.combo)==null?void 0:h.combo_name)||`Combo #${s.combo_id}`:((m=s.attraction)==null?void 0:m.title)||((k=s.attraction)==null?void 0:k.name)||`Attraction #${s.attraction_id}`)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) â€¢ ",s.dateLabel||S(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` â€¢ ${s.slotLabel}`:""]}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx("button",{type:"button",onClick:()=>onEditCartItem(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>onRemoveCartItem(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]}),r.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Extras"}),e.jsx("div",{className:"space-y-1",children:r.map(j=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"truncate",children:[j.name," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["x",j.quantity]})]}),e.jsxs("div",{className:"tabular-nums",children:["â‚¹",(Number(j.price||0)*Number(j.quantity||0)).toFixed(0)]})]},j.addon_id))})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["â‚¹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:e.jsx(H,{className:"text-sky-600"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),e.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["â‚¹",G.toFixed(0)]})]}),e.jsxs("button",{type:"button",disabled:!Y,onClick:Xe,className:`w-full flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${Y?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx("span",{children:"Continue"}),e.jsx(Qe,{size:18})]})]})]})})]}),f===3&&!y&&e.jsxs("div",{className:"space-y-6 max-w-md mx-auto animate-in fade-in slide-in-from-right-8 duration-300 mt-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-sky-50 text-sky-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ea,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Guest Details"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Enter your details to receive tickets via Email & SMS."})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Full Name"}),e.jsxs("div",{className:"relative group",children:[e.jsx(sa,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"John Doe",className:"w-full pl-11 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 focus:bg-white outline-none transition-all font-medium",value:N.name,onChange:s=>t(ae({name:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Email Address"}),e.jsxs("div",{className:"relative group",children:[e.jsx(zs,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"name@example.com",type:"email",className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium ${B.email?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:N.email,onChange:s=>{t(ae({email:s.target.value})),B.email&&ke(a=>({...a,email:void 0}))}})]}),B.email&&e.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[e.jsx(qt,{size:12})," ",B.email]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Mobile Number"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative w-32",children:[e.jsx("div",{className:"absolute left-3 top-3.5 z-10 pointer-events-none",children:e.jsx(Vs,{size:18,className:"text-gray-400"})}),e.jsx("select",{className:"w-full pl-10 pr-8 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none appearance-none font-medium text-sm",value:Le,onChange:s=>lt(s.target.value),children:Vt.map(s=>e.jsx("option",{value:s.code,children:s.code},s.code))}),e.jsx(Je,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 rotate-90 pointer-events-none"})]}),e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Es,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),e.jsx("input",{placeholder:"98765 43210",type:"tel",maxLength:10,className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium tracking-wide ${B.phone?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:le,onChange:ls})]})]}),B.phone&&e.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[e.jsx(qt,{size:12})," ",B.phone]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",required:!0,checked:N.whatsapp_consent||!1,onChange:s=>t(ae({whatsapp_consent:s.target.checked})),className:"w-4 h-4 text-sky-600 bg-gray-100 border-gray-300 rounded focus:ring-sky-500 focus:ring-2"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"I agree to receive WhatsApp notifications *"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"We'll send booking confirmations and updates via WhatsApp"})]}),q.sent?e.jsxs("div",{className:"mt-6 bg-sky-50 border border-sky-100 p-5 rounded-2xl animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("p",{className:"text-sm text-sky-800 mb-3 font-medium",children:["Enter OTP sent to ",Le," ",le]}),e.jsxs("div",{className:"flex gap-3 flex-col sm:flex-row",children:[e.jsx("input",{placeholder:"XXXXXX",className:"flex-1 p-3.5 text-center tracking-[0.5em] font-bold text-xl border-2 border-sky-200 rounded-xl focus:border-sky-600 focus:ring-4 focus:ring-sky-100 outline-none bg-white transition-all",maxLength:6,value:_e,onChange:s=>ot(s.target.value)}),e.jsx("button",{onClick:ps,disabled:q.status==="loading",className:"bg-sky-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-sky-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 w-full sm:w-auto text-sm sm:text-base",children:q.status==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):q.verified?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Verified"]}):"Verify"})]}),e.jsx("button",{onClick:bt,className:"text-xs text-sky-700 font-medium mt-3 hover:underline",children:"Resend Code"})]}):e.jsx("button",{onClick:bt,disabled:q.status==="loading",className:"w-full bg-sky-700 text-white py-3 rounded-xl font-bold text-base shadow-lg hover:bg-sky-800 transition-all disabled:opacity-70 flex items-center justify-center gap-2 mt-4",children:q.status==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Sending..."})]}):"Send OTP Verification"})]})]}),f===4&&e.jsxs("div",{className:"space-y-6 max-w-lg mx-auto animate-in fade-in slide-in-from-right-8 duration-300 pb-20",children:[e.jsx(gs,{}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-bold text-gray-900 text-lg flex items-center gap-2",children:[e.jsx(Lt,{className:"text-sky-600",size:20}),"Select Payment Method"]}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:"Secure Payment"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:`relative flex flex-col p-5 rounded-xl border-2 cursor-pointer transition-all duration-200 ${E==="payphi"?"border-sky-600 bg-gradient-to-br from-sky-50 to-blue-50 shadow-md ring-2 ring-sky-200":"border-gray-200 bg-white hover:border-sky-300 hover:shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${E==="payphi"?"border-sky-600 bg-sky-600":"border-gray-300 bg-white"}`,children:E==="payphi"&&e.jsx(Ie,{size:12,className:"text-white",strokeWidth:3})}),e.jsx("input",{type:"radio",name:"paymentGateway",value:"payphi",checked:E==="payphi",onChange:()=>it("payphi"),className:"sr-only"}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-sm",children:e.jsx(Lt,{size:20,className:"text-white"})})]}),E==="payphi"&&e.jsx("span",{className:"text-xs font-semibold text-sky-700 bg-sky-100 px-2 py-1 rounded-full",children:"Selected"})]}),e.jsxs("div",{className:"ml-8",children:[e.jsx("p",{className:"font-bold text-gray-900 text-base mb-1",children:"PayPhi"}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"All payment methods accepted"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"Cards"}),e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"UPI"}),e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"Netbanking"})]})]})]}),e.jsxs("label",{className:`relative flex flex-col p-5 rounded-xl border-2 cursor-pointer transition-all duration-200 ${E==="phonepe"?"border-purple-600 bg-gradient-to-br from-purple-50 to-indigo-50 shadow-md ring-2 ring-purple-200":"border-gray-200 bg-white hover:border-purple-300 hover:shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${E==="phonepe"?"border-purple-600 bg-purple-600":"border-gray-300 bg-white"}`,children:E==="phonepe"&&e.jsx(Ie,{size:12,className:"text-white",strokeWidth:3})}),e.jsx("input",{type:"radio",name:"paymentGateway",value:"phonepe",checked:E==="phonepe",onChange:()=>it("phonepe"),className:"sr-only"}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-600 to-indigo-600 flex items-center justify-center shadow-sm",children:e.jsx("svg",{className:"w-6 h-6 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"})})})]}),E==="phonepe"&&e.jsx("span",{className:"text-xs font-semibold text-purple-700 bg-purple-100 px-2 py-1 rounded-full",children:"Selected"})]}),e.jsxs("div",{className:"ml-8",children:[e.jsx("p",{className:"font-bold text-gray-900 text-base mb-1",children:"PhonePe"}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Fast & secure payments"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"UPI"}),e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"Wallet"}),e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full font-medium",children:"Cards"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 pt-2 border-t border-gray-100",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"256-bit SSL Encrypted Payment"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-4 text-lg flex items-center gap-2",children:[e.jsx(H,{className:"text-sky-600",size:20}),"Booking Summary"]}),gt&&e.jsxs("div",{className:"mb-4 rounded-xl bg-emerald-50 border border-emerald-100 p-3 text-sm text-emerald-700",children:[e.jsxs("div",{className:"font-semibold text-emerald-800",children:["Coupon ",String($.code||((Mt=$.data)==null?void 0:Mt.code)).toUpperCase()," applied"]}),e.jsxs("div",{className:"flex items-center justify-between mt-1 text-emerald-700",children:[e.jsx("span",{children:((Pt=$.data)==null?void 0:Pt.description)||"Discount applied successfully"}),e.jsxs("span",{className:"font-bold tabular-nums",children:["-â‚¹",ye.toFixed(0)]})]})]}),de&&(()=>{const s=C.offers.find(a=>String(at(a))===String(de));return s?e.jsxs("div",{className:"mb-4 rounded-xl bg-green-50 border border-green-100 p-3 text-sm text-green-700",children:[e.jsxs("div",{className:"font-semibold text-green-800",children:["Offer Applied: ",Xt(s)]}),e.jsxs("div",{className:"mt-1 text-green-600",children:[Ze(s),s.rule_type==="buy_x_get_y"&&s.buy_qty&&s.get_qty&&e.jsxs("div",{className:"mt-1",children:["Buy ",s.buy_qty," Get ",s.get_qty,s.get_discount_type==="percent"&&s.get_discount_value&&e.jsxs("span",{children:[" (",s.get_discount_value,"% off)"]}),s.get_discount_type==="amount"&&s.get_discount_value&&e.jsxs("span",{children:[" (",zt(s.get_discount_value)," off)"]}),!s.get_discount_value&&e.jsx("span",{children:" Free"})]})]})]}):null})(),e.jsxs("div",{className:"mb-4 space-y-2 max-h-40 overflow-y-auto custom-scrollbar pr-2",children:[T.map(s=>{var l,d,o,h,m,k;const a=U.get(s.key)||new Map,r=Array.from(a.values()).filter(j=>Number(j.quantity)>0);return e.jsxs("div",{className:"text-sm py-2 border-b border-dashed border-gray-100 last:border-0",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsxs("div",{className:"text-gray-700",children:[e.jsxs("span",{className:"font-bold text-gray-900",children:[s.quantity,"x"]})," ",s.title||((l=s.meta)==null?void 0:l.title)||(s.item_type==="combo"?((d=s.combo)==null?void 0:d.title)||((o=s.combo)==null?void 0:o.name)||((h=s.combo)==null?void 0:h.combo_name)||`Combo #${s.combo_id}`:((m=s.attraction)==null?void 0:m.title)||((k=s.attraction)==null?void 0:k.name)||`Attraction #${s.attraction_id}`),e.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:[s.dateLabel||S(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` â€¢ ${s.slotLabel}`:""]})]}),e.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["â‚¹",s.unitPrice*s.quantity]})]}),r.length>0&&e.jsx("div",{className:"ml-1 mt-1.5 pl-2 border-l-2 border-sky-200 space-y-1",children:r.map(j=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{className:"text-gray-600",children:["â€¢ ",j.name," ",e.jsxs("span",{className:"text-gray-400",children:["x",j.quantity]})]}),e.jsxs("span",{className:"font-medium text-gray-700 tabular-nums",children:["â‚¹",(Number(j.price||0)*Number(j.quantity||0)).toFixed(0)]})]},j.addon_id))})]},s.key)}),He>0&&e.jsxs("div",{className:"flex justify-between text-sm py-2 border-t border-gray-100 pt-3",children:[e.jsx("div",{className:"text-gray-600 font-medium",children:"Extras / Add-ons"}),e.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["â‚¹",He]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl space-y-2 text-sm mt-2",children:[e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Subtotal (with offers)"})," ",e.jsxs("span",{className:"tabular-nums",children:["â‚¹",We]})]}),ye>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-medium",children:[e.jsxs("span",{children:["Coupon (",String($.code||((St=$.data)==null?void 0:St.code)).toUpperCase(),")"]}),e.jsxs("span",{className:"tabular-nums",children:["-â‚¹",ye.toFixed(0)]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 flex justify-between items-center mt-2",children:[e.jsx("span",{className:"font-bold text-gray-800 text-lg",children:"Total Payable"}),e.jsxs("span",{className:"font-bold text-2xl text-sky-700 tabular-nums",children:["â‚¹",G]})]})]})]}),e.jsx("div",{className:"space-y-3 border-t border-gray-200 pt-4",children:gt?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Current Promo Code"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex-1 px-4 py-3 border border-green-200 rounded-xl bg-green-50 text-sm font-bold text-green-700 uppercase tracking-wider",children:["âœ“ ",String($.code||((Tt=$.data)==null?void 0:Tt.code)).toUpperCase()," Applied"]}),e.jsx("button",{onClick:()=>{ct(""),t(Dt(""))},className:"px-4 py-3 rounded-xl border border-red-200 bg-red-50 text-red-600 text-sm font-semibold hover:bg-red-100 transition-colors",title:"Remove promo code",children:"Remove"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Apply Promo Code"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ft,{size:18,className:"absolute left-3 top-3 text-gray-400 pointer-events-none"}),e.jsxs("select",{className:"w-full pl-10 pr-20 p-3 border border-gray-200 rounded-xl text-sm uppercase focus:ring-2 focus:ring-sky-500 outline-none font-bold tracking-wider appearance-none bg-white cursor-pointer disabled:bg-gray-50 disabled:text-gray-400 transition-all hover:border-gray-300",value:ce,onChange:s=>ct(s.target.value),disabled:Ce,children:[e.jsx("option",{value:"",children:Ce?"Loading promos...":"Select a promo code"}),mt.map(s=>e.jsxs("option",{value:s.code,children:[s.code," ",s.discount?`(${s.discount}% off)`:""]},s.id||s.code))]}),e.jsx("button",{onClick:ys,disabled:!ce||Ce,className:"absolute right-1 top-1 bottom-1 px-4 rounded-lg bg-sky-600 text-white text-xs font-bold tracking-wide hover:bg-sky-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"APPLY"})]})})]})})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 md:px-0 py-3 md:py-3 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] z-[140]",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex gap-3 items-center",children:[f>1&&e.jsx("button",{type:"button",onClick:xs,className:"p-2.5 rounded-xl border border-gray-200 text-gray-700 hover:border-gray-300 active:scale-[0.98] transition-all flex items-center justify-center",title:"Go back",children:e.jsx(Fs,{size:18})}),e.jsx("div",{className:`flex-1 ${c?"hidden":""}`,children:e.jsxs("div",{className:"text-base font-semibold text-gray-900 tabular-nums",children:["â‚¹",G]})}),e.jsxs("button",{type:"button",onClick:f===4?vs:Xe,disabled:f===4?(F==null?void 0:F.status)==="loading"||Z||!Y:f===3?!q.verified:f===2?!Y:!Y&&!R,className:`ml-auto inline-flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${(f===4?(F==null?void 0:F.status)==="loading"||Z||!Y:f===3?!q.verified:f===2?!Y:!Y&&!R)?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-sky-600 text-white shadow-md hover:bg-sky-700"}`,children:[e.jsx("span",{children:f===4?Z?"Processing Payment...":`Pay â‚¹${G}`:f===3?"Continue":"Next"}),f===4&&Z&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),f!==4||!Z?e.jsx(Qe,{size:16}):null]})]})}),ts&&A.title&&e.jsxs("div",{className:"fixed inset-0 z-[160] flex justify-end items-end md:items-stretch bg-black/40 backdrop-blur-[2px] md:bg-black/20",children:[e.jsx("div",{className:"flex-1 hidden md:block",onClick:()=>ie(!1)}),e.jsxs("div",{className:"w-full md:w-1/3 bg-white rounded-t-3xl md:rounded-l-3xl shadow-2xl flex flex-col transform translate-y-0 transition-all h-[66vh] md:h-screen max-h-[66vh] md:max-h-screen md:mt-0",children:[e.jsx("div",{className:"md:hidden flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"h-1.5 w-12 rounded-full bg-gray-300"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between px-4 sm:px-6 pt-4 pb-2 border-b border-gray-100 bg-white rounded-t-3xl md:rounded-tl-3xl sm:rounded-tl-3xl",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 pr-3 truncate",children:A.title}),e.jsx("button",{type:"button",onClick:()=>ie(!1),className:"p-2 rounded-full hover:bg-gray-100 text-gray-500 flex-shrink-0",children:e.jsx(Ae,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-4 py-4 space-y-4",children:ss==="details"?e.jsxs("div",{className:"space-y-4",children:[(()=>{const s=as||A.image||(n.itemType==="combo"?Ye(M):De(g));return s?e.jsxs("div",{className:"relative rounded-2xl overflow-hidden border border-gray-100 shadow-sm",children:[e.jsx("img",{src:s,alt:A.title,className:"w-full h-56 sm:h-64 object-cover"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 px-4 py-2 bg-gradient-to-t from-black/60 to-transparent text-white text-sm font-semibold",children:A.title})]}):null})(),e.jsx("div",{className:"text-sm text-gray-700",children:((n.itemType==="combo"?(M==null?void 0:M.description)||(M==null?void 0:M.short_description)||(M==null?void 0:M.summary)||"":(g==null?void 0:g.description)||(g==null?void 0:g.short_description)||(g==null?void 0:g.summary)||(g==null?void 0:g.about)||"")||"").split(`
`).map((a,r)=>e.jsx("p",{className:"mb-2",children:a},r))}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",onClick:()=>Ee("booking"),className:"w-full px-4 py-3 rounded-xl bg-sky-600 text-white font-semibold",children:"Book this"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:jt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date===K()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),e.jsx("button",{type:"button",onClick:vt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date===S().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:kt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date&&n.date!==""&&n.date!==K()&&n.date!==S().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:_t(n.date)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Time slot"}),e.jsx("div",{className:"relative",children:J.status==="loading"?e.jsx("div",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-sky-600 rounded-full animate-spin"}),"Loading slots..."]})}):J.status==="failed"?e.jsx("div",{className:"w-full p-3.5 bg-red-50 border border-red-200 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-red-600 text-sm",children:"Failed to load slots"})}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none text-sm font-medium appearance-none cursor-pointer disabled:bg-gray-100 disabled:text-gray-400 transition-all hover:border-gray-300",value:n.slotKey,onChange:s=>O(a=>({...a,slotKey:s.target.value})),disabled:!n.attractionId&&!n.comboId,children:[e.jsx("option",{value:"",children:!n.attractionId&&!n.comboId?"Select a ticket above first":"Select a time slot"}),J.items.map((s,a)=>{const r=Bt(s,a),l=ya(s),d=pa(s,n.date),o=!l||!d;return e.jsxs("option",{value:r,disabled:o,children:[Ut(s)," ",l?d?"":"(Not Available)":"(Full)"]},r)})]}),e.jsx(Je,{size:16,className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 rotate-90"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 rounded-xl p-1.5 border border-gray-200 w-fit",children:[e.jsx("button",{onClick:()=>O(s=>({...s,qty:Math.max(1,s.qty-1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-white text-gray-600 shadow-sm hover:text-sky-700 active:scale-95 transition",children:e.jsx(Rt,{size:16})}),e.jsx("span",{className:"font-bold text-lg w-8 text-center text-gray-800 tabular-nums",children:n.qty}),e.jsx("button",{onClick:()=>O(s=>({...s,qty:Math.max(1,s.qty+1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-95 transition",children:e.jsx(Et,{size:16})})]})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-x-0 top-0 h-4 bg-gradient-to-t from-white via-white/70 to-transparent pointer-events-none"}),e.jsxs("div",{className:"px-4 sm:px-6 py-3 border-t border-gray-100 bg-white flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",children:"Subtotal"}),e.jsxs("div",{className:"text-lg font-bold text-sky-700 tabular-nums",children:["â‚¹",cs.toFixed(0)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Me,disabled:!R,className:"inline-flex items-center px-4 py-2 rounded-full border border-gray-200 text-xs font-semibold text-gray-700 hover:border-sky-300 disabled:opacity-40 disabled:cursor-not-allowed",children:"Add to order"}),e.jsxs("button",{type:"button",onClick:us,disabled:!R,className:"flex items-center gap-2 px-4 py-2.5 rounded-full bg-sky-600 text-white text-sm font-semibold shadow-md hover:bg-sky-700 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed",children:[e.jsx(H,{size:18}),e.jsx("span",{children:"Buy"})]})]})]})]})]})]}),es&&e.jsx(aa,{onClose:()=>Ne(!1),onSignIn:()=>{Ne(!1),t(z(3))},onContinueAsGuest:()=>{Ne(!1),t(z(3))}}),is&&e.jsx("div",{className:"fixed inset-0 z-[200] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl h-[80vh] max-h-[600px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 11 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Complete Payment"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Secure payment powered by PhonePe"})]})]}),e.jsx("button",{onClick:()=>{Re(!1),Be(""),window.PhonePeCheckout&&window.PhonePeCheckout.closePage&&window.PhonePeCheckout.closePage()},className:"p-2 hover:bg-gray-100 rounded-lg text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Ae,{size:20})})]}),e.jsx("div",{className:"flex-1 p-4",children:pt?e.jsx("iframe",{src:pt,className:"w-full h-full rounded-xl border border-gray-200",title:"PhonePe Payment",allow:"payment",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation"}):e.jsx("div",{className:"w-full h-full rounded-xl bg-gray-50 border border-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-purple-600 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading payment page..."})]})})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50 rounded-b-2xl",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:"Secure payment processing â€¢ 256-bit SSL encryption"})]})})]})}),Nt&&e.jsxs("div",{className:"fixed inset-0 z-[150] flex",onClick:()=>Pe(!1),children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"absolute bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 w-80 max-h-[70vh] overflow-y-auto",style:{top:he?`${he.top}px`:"50%",left:he?`${he.left-160}px`:"50%",transform:he?"none":"translate(-50%, -50%)"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Select Date"}),e.jsx("button",{onClick:()=>Pe(!1),className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 transition-colors",children:e.jsx(Ae,{size:18})})]}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(s=>{const a=S().add(s,"month"),r=a.startOf("month"),l=a.endOf("month"),d=r.day(),o=l.date(),h=S();return e.jsxs("div",{className:"border border-gray-100 rounded-xl p-3 bg-white",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:a.format("MMMM YYYY")}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-xs",children:[["Su","Mo","Tu","We","Th","Fr","Sa"].map(m=>e.jsx("div",{className:"text-center text-gray-400 font-medium py-2",children:m},m)),Array.from({length:d}).map((m,k)=>e.jsx("div",{className:"p-2"},`empty-${k}`)),Array.from({length:o}).map((m,k)=>{const j=r.date(k+1),w=j.format("YYYY-MM-DD"),v=j.isBefore(h,"day"),fe=n.date===w,se=j.isSame(h,"day");return e.jsx("button",{onClick:()=>js(w),disabled:v,className:`
                                  p-2 rounded-lg text-sm font-medium transition-all duration-200
                                  ${v?"text-gray-300 cursor-not-allowed bg-gray-50":""}
                                  ${fe?"bg-sky-600 text-white shadow-md":""}
                                  ${!v&&!fe?"hover:bg-sky-50 text-gray-700":""}
                                  ${se?"ring-2 ring-sky-300":""}
                                `,children:j.date()},k)})]})]},s)})})]})]})]})})})}export{Ia as default};
