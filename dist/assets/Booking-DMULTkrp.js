import{j as t,h as cs,B as ds,u as ye,r as p,D as $,G as ms,p as us,t as xs,q as jt,F as Y,H as ps,i as Ce,k as Me,I as vt,E as ys,J as Re,K as Te,M as hs,Q as fs,S as gs,T as bs,U as js,V as vs}from"./index-Buz5vlJT.js";import{i as Ae}from"./media-DTTax9V0.js";import{a as Nt,c as wt,d as kt,g as Qe}from"./pricing-CIeFTiJd.js";import{f as Ns}from"./formatters-CmiLqhJj.js";import{c as I}from"./createLucideIcon-BEwYts5j.js";import{C as _t,T as Be}from"./ticket-B65mU2v0.js";import{C as Ct}from"./circle-alert-C1JkuNI_.js";import{C as ws}from"./clock-B80K0lJn.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],_s=I("arrow-left",ks);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Se=I("arrow-right",Cs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Mt=I("check",Ms);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ve=I("chevron-right",Ts);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],As=I("globe",Ss);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Is=I("log-in",Ps);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],$s=I("mail",Ds);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M5 12h14",key:"1ays0h"}]],Tt=I("minus",Os);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],zs=I("phone",Ys);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],St=I("plus",Es);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],V=I("shopping-bag",qs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Fs=I("triangle-alert",Ls);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Rs=I("user-plus",Ks);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Vs=I("user",Bs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],At=I("x",Hs);function Us({isOpen:e,onClose:i,onSignIn:l}){return e?t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"relative w-full max-w-md rounded-2xl bg-white shadow-2xl dark:bg-neutral-900 overflow-hidden",children:[t.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-8 text-white",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Fs,{className:"h-6 w-6"}),t.jsx("h2",{className:"text-lg font-bold",children:"Session Expired"})]}),t.jsx("p",{className:"mt-2 text-sm opacity-90",children:"Your login session has expired. Please sign in again to continue booking."})]}),t.jsxs("div",{className:"px-6 py-8",children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mb-6",children:"Your booking information is saved. Sign in again to complete your purchase without losing your selections."}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3 text-white font-semibold transition-all duration-200 hover:shadow-lg hover:from-blue-700 hover:to-blue-800 active:scale-95",children:[t.jsx(Is,{className:"h-5 w-5"}),"Sign In Again"]}),t.jsx("button",{onClick:i,className:"w-full rounded-lg border border-gray-300 px-4 py-2 text-gray-700 font-medium transition-all hover:bg-gray-50 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",children:"Continue as Guest"})]})]})]})}):null}const H=e=>$(e).format("YYYY-MM-DD"),ae=()=>$().format("YYYY-MM-DD"),te=e=>(e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.attraction_id)??null,se=e=>(e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.combo_id)??null,Pt=(e,i)=>String((e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.slot_id)??(e==null?void 0:e.combo_slot_id)??`${(e==null?void 0:e.start_time)||""}-${(e==null?void 0:e.end_time)||""}-${i}`),It=e=>{if(!e)return"";const[i,l]=e.split(":"),u=parseInt(i,10),x=u>=12?"PM":"AM";return`${u%12||12}:${l} ${x}`},Dt=e=>{if(e!=null&&e.label)return e.label;const i=It(e==null?void 0:e.start_time),l=It(e==null?void 0:e.end_time);return i&&l?`${i} - ${l}`:i||`Slot #${(e==null?void 0:e.id)||"?"}`},Gs=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,$t=[{code:"+91",label:"IN (+91)"},{code:"+1",label:"US (+1)"},{code:"+971",label:"AE (+971)"},{code:"+44",label:"UK (+44)"},{code:"+65",label:"SG (+65)"}],Ot=e=>Number((e==null?void 0:e.price)??(e==null?void 0:e.amount)??0),Xs=e=>(e==null?void 0:e.id)??(e==null?void 0:e.addon_id)??(e==null?void 0:e._id)??null,Yt=e=>(e==null?void 0:e.name)??(e==null?void 0:e.title)??(e==null?void 0:e.label)??"Addon",Qs=e=>{if(!e)return null;const i=[e,e==null?void 0:e.image_url,e==null?void 0:e.image,e==null?void 0:e.thumbnail,e==null?void 0:e.cover_image];for(const l of i){if(!l)continue;const u=typeof l=="string"?Ae(l):Ae(l);if(u)return u}return null};function Js(e){const i=()=>typeof window<"u"?window.matchMedia(e).matches:!1,[l,u]=p.useState(i);return p.useEffect(()=>{if(typeof window>"u")return;const x=window.matchMedia(e),b=v=>u(v.matches);return x.addEventListener("change",b),()=>x.removeEventListener("change",b)},[e]),l}const He=()=>({itemType:"attraction",attractionId:"",comboId:"",date:ae(),slotKey:"",qty:1}),Ws=()=>`sel_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`,zt=(e,i=null)=>{if(!e)return i?`Combo ${i}`:"Combo";const l=e.name??e.title??e.combo_name??e.label??null;return l||(i?`Combo ${i}`:"Combo")},re=e=>{if(!e)return null;if(typeof e=="string")return Ae(e);if(typeof e=="object"){const i=e.url||e.src||e.image_url||e.path;if(i)return Ae(i)}return null},Ue=e=>{var l;if(!e)return null;const i=[e.desktop_image_url,e.hero_image,e.banner_image,e.image_url,e.cover_image,e.thumbnail,(l=e.media)==null?void 0:l[0]];for(const u of i){const x=re(u);if(x)return x}return null},Ge=e=>{var l;if(!e)return null;const i=[e.desktop_image_url,e.hero_image,e.banner_image,e.image_url,e.cover_image,(l=e.media)==null?void 0:l[0],e.attraction_1_image,e.attraction_2_image];for(const u of i){const x=re(u);if(x)return x}return null},Zs=e=>{if(!e)return[];const i=[];return e.attraction_1_image&&i.push(re(e.attraction_1_image)),e.attraction_2_image&&i.push(re(e.attraction_2_image)),i.length<2&&Array.isArray(e.media)&&e.media.forEach(l=>{const u=re(l);u&&!i.includes(u)&&i.push(u)}),i.slice(0,2).filter(Boolean)},P=e=>{const i=Number(e);return Number.isFinite(i)?i:0},Je=e=>String(e||"").toLowerCase(),Pe=(e,i)=>e==null||i==null?!1:String(e)===String(i),ea=e=>{if(typeof e=="boolean")return e;if(e==null)return!1;if(typeof e=="number")return e!==0;const i=String(e).trim().toLowerCase();return i?["true","1","yes","y"].includes(i)?!0:["false","0","no","n"].includes(i)?!1:!!e:!1},ta=e=>e?Array.isArray(e)?e.reduce((i,l)=>i+P(l),0):typeof e=="object"?Object.values(e).reduce((i,l)=>i+P(l),0):0:0,Et=e=>{if(!e)return 0;const i=Qe(e);if(i>0)return i;const l=(e==null?void 0:e.combo_price)??(e==null?void 0:e.price)??(e==null?void 0:e.amount)??(e==null?void 0:e.total_price)??(e==null?void 0:e.starting_price)??(e==null?void 0:e.min_price)??(e==null?void 0:e.base_price)??0;if(P(l)>0)return P(l);const u=e==null?void 0:e.combo_attractions;if(Array.isArray(u)&&u.length){const v=u.reduce((C,f)=>C+P((f==null?void 0:f.attraction_price)??(f==null?void 0:f.price)),0);if(v>0)return v}const x=ta(e==null?void 0:e.attraction_prices);if(x>0)return x;const b=P(e==null?void 0:e.attraction_1_price)+P(e==null?void 0:e.attraction_2_price);return b>0?b:0},sa=e=>{const i=String(e||"").replace(/\D/g,"");return i.length>=10?i.slice(-10):i},aa=(e,i)=>{if(!e)return!0;const l=$();if($(i).format("YYYY-MM-DD")===l.format("YYYY-MM-DD")){const x=e.start_time||e.time||e.startTime;if(!x)return!0;const[b,v]=x.split(":"),C=parseInt(b)*60+parseInt(v),M=l.hour()*60+l.minute()+60;return C>=M}return!0},ra=e=>{if(!e)return!0;if(e.available===!1)return!1;const i=Number(e.capacity??e.available_capacity??e.available);if(Number.isNaN(i))return!0;if(e.booked!=null){const l=Number(e.booked);if(!Number.isNaN(l))return i-l>0}return i>0},Ft=e=>(e==null?void 0:e.id)??(e==null?void 0:e.offer_id)??(e==null?void 0:e.offerId)??(e==null?void 0:e.slug)??null,ia=e=>(e==null?void 0:e.title)||(e==null?void 0:e.name)||`Offer ${Ft(e)??""}`.trim(),qt=e=>(e==null?void 0:e.short_description)||(e==null?void 0:e.subtitle)||(e==null?void 0:e.description)||"",We=(e,i)=>{if(!e||!i)return 0;const l=String(e.discount_type||e.rule_discount_type||"").toLowerCase(),u=Number(e.discount_percent??e.discountPercent??(l==="percent"?e.discount_value??e.discountValue:0))||0,x=Number(e.discount_value??e.discountValue??e.flat_discount??0)||0;let b=0;l==="percent"&&u>0||u>0?b=i*u/100:b=x;const v=Number(e.max_discount??e.maxDiscount??0);return v>0&&(b=Math.min(b,v)),Math.max(0,Math.min(b,i))},Xe=e=>{if(!e||typeof e!="string")return null;const[i="0",l="0"]=e.split(":"),u=Number(i),x=Number(l);return!Number.isFinite(u)||!Number.isFinite(x)?null:u*60+x},na=(e={},i)=>{if(!e.day_type)return!0;const l=$(i).day(),u=String(e.day_type).toLowerCase();return u==="weekday"?l>=1&&l<=5:u==="weekend"?l===0||l===6:u==="custom"&&Array.isArray(e.specific_days)?e.specific_days.map(Number).includes(l):!0},oa=(e={},i=null)=>{if(!i)return!(e.slot_id!=null||Array.isArray(e.slot_ids)&&e.slot_ids.length||e.specific_time||e.time_from&&e.time_to);const l=[];if(e.slot_id!=null&&l.push(e.slot_id),Array.isArray(e.slot_ids)&&l.push(...e.slot_ids),e.target_slot_id!=null&&l.push(e.target_slot_id),l.length){const b=[i.slot_id,i.id,i._id,i.combo_slot_id].filter(C=>C!=null);if(!l.some(C=>b.some(f=>Pe(C,f))))return!1}if(!(e.specific_time||e.time_from&&e.time_to))return!0;const x=i.start_time||i.time||i.startTime||null;if(e.specific_time&&x&&x.slice(0,5)!==String(e.specific_time).slice(0,5))return!1;if(e.time_from&&e.time_to&&x){const b=Xe(x),v=Xe(e.time_from),C=Xe(e.time_to);if(b==null||v==null||C==null||b<v||b>C)return!1}return!0},Kt=({rule:e,selectedDate:i,selectedSlot:l,itemType:u,itemId:x})=>{if(!e||!i)return!1;const b=$(i).format("YYYY-MM-DD"),v=Je(e.target_type),C=Je(u);if(v&&C&&v!==C)return!1;if(!ea(e.applies_to_all)){const M=[];if(e.target_id!=null&&M.push(e.target_id),Array.isArray(e.target_ids)&&M.push(...e.target_ids),!M.length||!M.some(O=>Pe(O,x)))return!1}return!(e.specific_date&&b!==e.specific_date||Array.isArray(e.specific_dates)&&e.specific_dates.length&&!e.specific_dates.some(M=>$(M).format("YYYY-MM-DD")===b)||e.date_from&&b<e.date_from||e.date_to&&b>e.date_to||!na(e,b)||!oa(e,l))},Lt=(e,i,l,u,x)=>!e||!i||!l?!1:(Array.isArray(e.rules)?e.rules:[]).filter(C=>Kt({rule:C,selectedDate:i,selectedSlot:l,itemType:u,itemId:x})).length>0,la=(e,i,l)=>{const u=Number(i||0)*Number(l||1);if(!e||u<=0)return null;const x=We(e,u)||0;return{total:u,totalDiscount:x,final:Math.max(0,u-x)}};function fa(){var yt,ht,ft,gt;const e=cs(),i=ds(),l=Js("(min-width: 768px)"),u=ye(s=>s.auth),x=!!(u!=null&&u.token),b=ye(s=>s.attractions),v=ye(s=>s.combos),C=ye(s=>s.addons),{step:f,contact:M,otp:E,coupon:O,creating:F,cart:U}=ye(s=>s.bookings),S=(U==null?void 0:U.items)||[],q=S.length>0,Ie=U==null?void 0:U.activeKey,A=p.useMemo(()=>{if(!S.length)return null;if(Ie){const s=S.find(r=>r.key===Ie);if(s)return s}return S[0]},[S,Ie]),G=(A==null?void 0:A.key)||null,[o,D]=p.useState(()=>He()),[ie,De]=p.useState(null),[Rt,ne]=p.useState(!1),[Bt,K]=p.useState(!1),[Vt,$e]=p.useState("booking"),[Ze,et]=p.useState(null),[w,X]=p.useState({status:"idle",error:null,offers:[],offerRules:[],activeOffer:null,activeRule:null,selectedOffer:null,selectedRule:null,offerPreview:null,loadingOffers:!1}),[he,tt]=p.useState("+91"),[oe,fe]=p.useState(""),[R,ge]=p.useState({}),[be,le]=p.useState({status:"idle",items:[],error:null}),[je,Ht]=p.useState(""),[ce,Ut]=p.useState(""),[de,st]=p.useState(""),[Q,Oe]=p.useState(new Map),[at,rt]=p.useState([]),[ve,it]=p.useState(!1),Ne=b.items||[],we=v.items||[],nt=p.useCallback(()=>{if(!Array.isArray(w.offers)||!A)return null;const s=Je(A.item_type||(A.combo_id?"Combo":"Attraction")),r=A.attraction_id||A.combo_id||null,a=A.date||"",n=A.slot||{};let c=null;for(const d of w.offers){const h=Array.isArray(d.rules)?d.rules:[];for(const g of h)Kt({rule:g,selectedDate:a,selectedSlot:n,itemType:s,itemId:r})&&(!c||g.priority>c.rule.priority||g.priority===c.rule.priority&&g.rule_id<c.rule.rule_id)&&(c={offer:d,rule:g})}return c},[w.offers,A]);p.useEffect(()=>{const s=nt();X(r=>({...r,activeOffer:(s==null?void 0:s.offer)||null,activeRule:(s==null?void 0:s.rule)||null}))},[nt]),p.useEffect(()=>{if(!w.activeOffer||!w.activeRule||!A){X(d=>({...d,offerPreview:null}));return}const s=Number(A.price||A.unitPrice||0),r=w.activeRule.rule_discount_type||w.activeOffer.discount_type||"percent",a=Number(w.activeRule.rule_discount_value??w.activeOffer.discount_value??0);let n=s;r==="percent"?n=s*(1-a/100):r==="amount"&&(n=Math.max(0,s-a));const c=s-n;X(d=>({...d,offerPreview:{basePrice:s,newPrice:n,savings:c,discountType:r,discountValue:a,offerTitle:w.activeOffer.title,ruleId:w.activeRule.rule_id}}))},[w.activeOffer,w.activeRule,A]),p.useEffect(()=>{if(M!=null&&M.phone&&!oe){const s=String(M.phone).replace(/\D/g,"");if(s.length>10){const r=$t.find(a=>s.startsWith(a.code.replace("+","")));r?(tt(r.code),fe(s.slice(r.code.length-1))):fe(s.slice(-10))}else fe(s)}},[]),p.useEffect(()=>{if(w.status!=="idle")return;let s=!1;return(async()=>{X(a=>({...a,status:"loading",loadingOffers:!0}));try{const a=await Ce.get(Me.offers.list(),{params:{active:!0,limit:20}});if(s)return;const n=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];X(c=>({...c,status:"succeeded",offers:n,loadingOffers:!1}))}catch{s||X(a=>({...a,status:"failed",loadingOffers:!1}))}})(),()=>{s=!0}},[w.status]),p.useEffect(()=>{if(ve||at.length>0)return;let s=!1;return(async()=>{it(!0);try{const a=await Ce.get(Me.coupons.list(),{params:{active:!0,limit:50}});if(s)return;const n=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];rt(n)}catch(a){console.error("Failed to fetch promos:",a),rt([])}finally{it(!1)}})(),()=>{s=!0}},[]);const Gt=p.useCallback(()=>{i("/")},[i]),[J]=ms(),me=J.get("type"),W=J.get("attraction_id"),Z=J.get("combo_id"),Ye=J.get("date"),ze=J.get("slot"),Ee=J.get("qty");p.useEffect(()=>{b.status==="idle"&&e(us({active:!0,limit:100})),v.status==="idle"&&e(xs({active:!0,limit:100})),C.status==="idle"&&e(jt({active:!0,limit:100}))},[e,b.status,v.status,C.status]),p.useEffect(()=>{f===3&&x&&e(Y(4))},[f,x,e]),p.useEffect(()=>{const s=typeof document<"u"&&document.querySelector("footer"),r=s?s.style.display:null;return s&&(s.style.display="none"),()=>{s&&(s.style.display=r||"")}},[]),p.useEffect(()=>{!W&&!Z&&e(ps())},[e,W||"",Z||""]),p.useEffect(()=>{const s={};me&&(s.itemType=me),W&&(b.items||[]).some(a=>String(te(a))===String(W))&&(s.attractionId=String(W),me||(s.itemType="attraction")),Z&&(v.items||[]).some(a=>String(se(a))===String(Z))&&(s.comboId=String(Z),me||(s.itemType="combo")),Ye&&(s.date=Ye),ze&&(s.slotKey=ze),Ee&&(s.qty=Math.max(1,Number(Ee)||1)),Object.keys(s).length>0&&(D(r=>({...r,...s})),K(!0))},[me||"",W||"",Z||"",Ye||"",ze||"",Ee||"",b.items||[],v.items||[]]);const ot=p.useCallback(async({itemType:s,attractionId:r,comboId:a,date:n})=>{if(!n)return;const c=s==="combo"?a:r;if(c){le({status:"loading",items:[],error:null});try{if(s==="combo"){const d=await Ce.get(Me.combos.slots(c),{params:{date:H(n)}}),h=Array.isArray(d==null?void 0:d.data)?d.data:Array.isArray(d)?d:[];le({status:"succeeded",items:h,error:null})}else{const d=await Ce.get(Me.slots.list(),{params:{attraction_id:c,date:H(n)}}),h=Array.isArray(d==null?void 0:d.data)?d.data:Array.isArray(d)?d:[];le({status:"succeeded",items:h,error:null})}}catch(d){le({status:"failed",items:[],error:(d==null?void 0:d.message)||"Failed to load slots"})}}},[]);p.useEffect(()=>{const s=o.itemType,r=o.date,a=o.attractionId,n=o.comboId;(s==="combo"?n:a)&&r?(D(d=>({...d,slotKey:o.slotKey||""})),ot({itemType:s,attractionId:a,comboId:n,date:r})):le({status:"idle",items:[],error:null})},[o.itemType||"",o.attractionId||"",o.comboId||"",o.date||"",ot]);const y=p.useMemo(()=>o.itemType==="attraction"?Ne.find(s=>String(te(s))===String(o.attractionId)):null,[Ne||[],o.itemType||"",o.attractionId||""]),k=p.useMemo(()=>o.itemType==="combo"?we.find(s=>String(se(s))===String(o.comboId)):null,[we||[],o.itemType||"",o.comboId||""]),m=p.useMemo(()=>{for(let s=0;s<be.items.length;s+=1){const r=be.items[s];if(Pt(r,s)===o.slotKey)return r;const a=[r==null?void 0:r.slot_id,r==null?void 0:r.id,r==null?void 0:r._id,r==null?void 0:r.combo_slot_id].filter(Boolean);if(o.slotKey&&a.map(String).includes(String(o.slotKey)))return r}return null},[be.items,o.slotKey]),_=p.useMemo(()=>{if(o.itemType==="combo"&&k){const s=P(Et(k)),r=P(Nt(k)||s),a=(m==null?void 0:m.pricing)||{},n=(m==null?void 0:m.offer)||null,c=m?wt(m,r):r,d=m?kt(m,s):s;let h=P(a.base_price??c),g=P(a.final_price??d);h||(h=c),g||(g=d);const z=H(o.date),T=se(k);let N=n||null;if(!N&&(N=w.offers.find(j=>(j.rule_type==="happy_hour"||j.rule_type==="holiday"||j.rule_type==="special")&&Lt(j,z,m,"combo",T)),N)){const j=We(N,h||g);g=Math.max(0,(h||g)-j)}return{title:zt(k,se(k)),price:g,originalPrice:h||g,happyHourOffer:N,offerDescription:(N==null?void 0:N.description)||"",image:Ge(k),previewImages:Zs(k)}}if(o.itemType==="attraction"&&y){const s=P(Qe(y)||(y==null?void 0:y.price)||(y==null?void 0:y.base_price)||(y==null?void 0:y.amount)||0),r=P(Nt(y)||s),a=(m==null?void 0:m.pricing)||{},n=(m==null?void 0:m.offer)||null,c=m?wt(m,r):r,d=m?kt(m,s):s;let h=P(a.base_price??c),g=P(a.final_price??d);h||(h=c),g||(g=d);const z=H(o.date),T=te(y);let N=n||null;if(!N&&(N=w.offers.find(j=>(j.rule_type==="happy_hour"||j.rule_type==="holiday"||j.rule_type==="special")&&Lt(j,z,m,"attraction",T)),N)){const j=We(N,h||g);g=Math.max(0,(h||g)-j)}return{title:(y==null?void 0:y.name)||(y==null?void 0:y.title)||`Attraction #${te(y)}`,price:g,originalPrice:h||g,happyHourOffer:N,offerDescription:(N==null?void 0:N.description)||"",image:Ue(y)}}return{title:"",price:0,originalPrice:0,offerDescription:""}},[o.itemType||"",k||null,y||null,m||null,o.date||"",w.offers||[]]),ue=Math.max(1,Number(o.qty)||1),Xt=Number(_.price||0)*ue,B=!!(_.title&&o.date&&o.slotKey&&ue),Qt=p.useMemo(()=>S.reduce((s,r)=>s+Number(r.unitPrice||0)*Number(r.quantity||0),0),[S||[]]),qe=p.useMemo(()=>{let s=0;return Q.forEach((r,a)=>{S.find(c=>c.key===a)&&r.forEach(c=>{s+=Number(c.price||0)*Number(c.quantity||0)})}),s},[Q||new Map,S||[]]),Le=Qt+qe,xe=Number(O.discount||0),lt=xe>0&&(O.code||((yt=O.data)==null?void 0:yt.code)),ee=Math.max(0,Le-xe),Jt=_.image||Ue(Ne[0])||Ge(we[0])||"https://images.pexels.com/photos/338515/pexels-photo-338515.jpeg?auto=compress&cs=tinysrgb&w=1200",Wt=p.useMemo(()=>G?Q.get(G)||new Map:new Map,[Q,G]),ke=p.useCallback(()=>{if(!B)return!1;const s=o.itemType==="combo"?"Combo":"Attraction",r=o.itemType==="combo"?(m==null?void 0:m.combo_slot_id)??(m==null?void 0:m.id)??(m==null?void 0:m._id)??null:(m==null?void 0:m.slot_id)??(m==null?void 0:m.id)??(m==null?void 0:m._id)??null,a=(m==null?void 0:m.offer)||_.happyHourOffer||null,n={key:ie||Ws(),merge:!1,item_type:s,title:_.title,slotLabel:m?Dt(m):"",quantity:ue,booking_date:H(o.date),booking_time:(m==null?void 0:m.start_time)||(m==null?void 0:m.startTime)||(m==null?void 0:m.slot_start_time)||null,unitPrice:_.price||0,dateLabel:H(o.date),slot_id:s==="Attraction"?r:null,combo_slot_id:s==="Combo"?r:null,attraction_id:s==="Attraction"?te(y):null,combo_id:s==="Combo"?se(k):null,slot:m||null,attraction:y||null,combo:k||null,pricing:(m==null?void 0:m.pricing)||null,originalPrice:_.originalPrice||null,offer:a,offerDescription:_.offerDescription||(a==null?void 0:a.description)||""};return ie&&e(vt(ie)),e(ys(n)),e(Re(n.key)),De(null),D(He()),Oe(c=>{const d=new Map(c);return d.has(n.key)||d.set(n.key,new Map),d}),!0},[B,o||{},_||{},m||null,y||null,k||null,ue||1,ie||null,e]),Zt=p.useCallback(()=>{if(!B){alert("Please select a date, a time slot, and quantity first.");return}ke()&&e(Y(2))},[B,ke,e,x]),Fe=()=>{if(f===1)if(q)e(Y(2));else{if(!B){alert("Please select date, time slot and quantity.");return}ke()&&e(Y(2))}else f===2?e(Y(x?4:3)):f===3&&(E.verified?e(Y(4)):alert("Please verify OTP to continue."))},ct=()=>{f!==1&&(f===2?e(Y(1)):f===3?e(Y(2)):f===4&&e(Y(x?2:3)))},dt=(s,r,a)=>{Oe(n=>{const c=new Map(n),d=c.get(G)||new Map;return r<=0?d.delete(s):d.set(s,{addon_id:s,name:Yt(a),price:Ot(a),quantity:r}),c.set(G,d),c})},es=async()=>{var s,r,a,n;if((F==null?void 0:F.status)!=="loading"){if(!x){ne(!0);return}if(q)try{const c=((O==null?void 0:O.code)||"").trim()||void 0,d=de?Number(de):void 0,h=S.map(L=>{const pe=L.item_type==="Combo",bt=Q.get(L.key),ls=bt?Array.from(bt.values()).filter(_e=>Number(_e.quantity)>0).map(_e=>({addon_id:_e.addon_id,quantity:Number(_e.quantity)})):[];return{item_type:pe?"Combo":"Attraction",combo_id:pe?L.combo_id:void 0,combo_slot_id:pe?L.combo_slot_id:void 0,attraction_id:pe?void 0:L.attraction_id,slot_id:pe?void 0:L.slot_id,booking_date:L.booking_date,quantity:L.quantity,addons:ls,coupon_code:c,offer_id:d}}),g=await e(hs(h)).unwrap(),z=((s=g==null?void 0:g.data)==null?void 0:s.order_id)||(g==null?void 0:g.order_id);if(!z)throw new Error("Order ID missing");const T=(M.email||((r=u==null?void 0:u.user)==null?void 0:r.email)||"").trim(),N=sa(M.phone||((a=u==null?void 0:u.user)==null?void 0:a.phone)||""),j=await e(fs({bookingId:z,email:T,mobile:N,amount:ee})).unwrap();j!=null&&j.redirectUrl?window.location.assign(j.redirectUrl):alert("Payment initiation failed.")}catch(c){(c==null?void 0:c.status)===401||((n=c==null?void 0:c.response)==null?void 0:n.status)===401?ne(!0):alert(`Payment failed: ${c.message}`)}}},mt=s=>{e(vt(s)),Oe(r=>{const a=new Map(r);return a.delete(s),a}),ie===s&&(De(null),D(He()))},Ke=s=>{const r=s.item_type==="Combo"?"combo":"attraction";D({itemType:r,attractionId:s.attraction_id?String(s.attraction_id):"",comboId:s.combo_id?String(s.combo_id):"",date:s.booking_date||ae(),slotKey:"",qty:Number(s.quantity||1)}),De(s.key),e(Re(s.key)),e(Y(1)),K(!0)},ts=s=>{const a=s.target.value.replace(/\D/g,"").slice(0,10);fe(a),a.length===10&&(ge(n=>({...n,phone:void 0})),e(Te({phone:`${he}${a}`})))},ut=async()=>{const s={},r=(M.email||"").trim();if(Gs.test(r)||(s.email="Please enter a valid email address"),oe.length!==10&&(s.phone="Phone number must be exactly 10 digits"),Object.keys(s).length>0){ge(s);return}ge({});const a=`${he}${oe}`;e(Te({email:r,phone:a}));try{await e(gs({email:r,phone:a})).unwrap()}catch(n){alert((n==null?void 0:n.message)||"Failed to send OTP")}},ss=async()=>{if(!je||je.length<4)return alert("Enter the full OTP code");await e(bs({otp:je})).unwrap().then(()=>e(Y(3))).catch(s=>alert((s==null?void 0:s.message)||"OTP verification failed"))},as=async()=>{ce&&await e(js({code:ce,total_amount:Math.max(0,Le),onDate:o.date||H(new Date)})).unwrap().then(()=>e(vs(ce))).catch(()=>{})},rs=()=>t.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6 px-4",children:[[{n:1,l:"Select",icon:V},{n:2,l:"Extras",icon:Be},{n:3,l:"Verify",icon:ws},{n:4,l:"Pay",icon:Mt}].map(s=>{if(x&&s.n===3)return null;const r=f>s.n||x&&s.n===3,a=f===s.n,n=r||x&&s.n===3,c=s.icon;return t.jsxs("div",{className:"flex flex-col items-center relative z-10 group",children:[t.jsx("div",{className:`w-11 h-11 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300 border-2 shadow-sm ${a?"bg-gradient-to-br from-sky-600 to-sky-700 border-sky-600 text-white scale-110 ring-4 ring-sky-100":n?"bg-gradient-to-br from-emerald-600 to-emerald-700 border-emerald-600 text-white shadow-md":"bg-white border-gray-200 text-gray-300 shadow-sm"}`,children:n&&!a?t.jsx(Mt,{size:18,strokeWidth:3}):t.jsx(c,{size:18})}),t.jsx("span",{className:`text-[10px] mt-2 font-bold uppercase tracking-widest ${a?"text-sky-600":n?"text-emerald-600":"text-gray-400"}`,children:s.l})]},s.n)}),t.jsx("div",{className:"absolute left-8 right-8 top-[22px] h-[3px] bg-gradient-to-r from-sky-100 to-sky-200 -z-0 overflow-hidden rounded-full",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-sky-600 to-sky-500 transition-all duration-500 ease-out shadow-sm",style:{width:`${(f-1)/(x?2:3)*100}%`}})})]}),is=()=>{const r=o.itemType==="attraction"?Ne:we;return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"mb-2",children:t.jsx("div",{className:"bg-sky-50 p-1 rounded-xl inline-flex border border-sky-100",children:["attraction","combo"].map(a=>t.jsx("button",{onClick:()=>{D(n=>({...n,itemType:a,attractionId:"",comboId:"",slotKey:""}))},className:`px-6 py-2 text-sm font-semibold rounded-lg capitalize transition-all duration-200 ${o.itemType===a?"bg-white text-sky-700 shadow-sm ring-1 ring-black/5":"text-gray-600 hover:text-gray-900"}`,children:a==="attraction"?"Attractions":"Combos"},a))})}),r.length===0?t.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-dashed border-gray-200 px-4 py-6 text-center text-sm text-gray-500",children:o.itemType==="combo"?"No combos available":"No attractions available"}):r.map(a=>{const n=o.itemType==="attraction"?te(a):se(a),c=String(o.itemType==="attraction"?o.attractionId:o.comboId)===String(n),d=o.itemType==="combo"?Number(Et(a)||0):Number(Qe(a)||a.price||a.base_price||a.amount||0),h=o.itemType==="attraction"?a.title||a.name:zt(a),g=o.itemType==="combo"?Ge(a):Ue(a),z=()=>{const T=o.itemType==="combo",N=S.find(j=>T?j.item_type==="Combo"&&Pe(j.combo_id,n):(j.item_type==="Attraction"||j.item_type===void 0)&&Pe(j.attraction_id,n));if(N){Ke(N);return}D(j=>({...j,itemType:o.itemType,attractionId:o.itemType==="attraction"?String(n):"",comboId:o.itemType==="combo"?String(n):"",slotKey:""})),$e("booking"),K(!0)};return t.jsxs("div",{className:`bg-white rounded-3xl shadow-sm border px-4 sm:px-6 py-4 sm:py-5 flex items-center justify-between gap-4 transition-all ${c?"border-sky-400 shadow-md":"border-gray-100 hover:border-sky-200"}`,children:[t.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[t.jsx("div",{className:"w-20 h-20 rounded-2xl overflow-hidden border border-gray-100 bg-sky-50 shrink-0",children:g?t.jsx("img",{src:g,alt:h,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center text-sky-400",children:t.jsx(V,{})})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1 truncate",children:h}),t.jsx("p",{className:"text-xs text-gray-500",children:"Great for families • Flexible slots • Instant confirmation"}),t.jsxs("button",{type:"button",onClick:()=>{D(T=>({...T,itemType:o.itemType,attractionId:o.itemType==="attraction"?String(n):"",comboId:o.itemType==="combo"?String(n):"",slotKey:""})),et(g||null),$e("details"),K(!0)},className:"inline-flex items-center gap-1 text-xs sm:text-sm font-semibold text-sky-700 hover:text-sky-900 mt-2",children:["View details",t.jsx(Ve,{size:14})]})]})]}),t.jsxs("div",{className:"flex flex-col items-end gap-2 sm:gap-3",children:[t.jsx("div",{className:"text-right text-xs text-gray-500 uppercase tracking-wide",children:"From"}),t.jsx("div",{className:"flex items-baseline gap-2",children:t.jsxs("span",{className:"text-lg sm:text-xl font-bold text-sky-700 tabular-nums",children:["₹",d||0]})}),t.jsx("button",{type:"button",onClick:z,className:`px-6 py-2.5 sm:py-3 rounded-full text-white text-sm font-semibold shadow-md active:scale-[0.98] transition-all ${c?"bg-sky-700":"bg-sky-600 hover:bg-sky-700"}`,children:c?"Selected":"Select"})]})]},n)})]})},ns=()=>w.loadingOffers?t.jsx("div",{className:"bg-white p-4 rounded-2xl border border-gray-200 shadow-sm text-sm text-gray-500",children:"Loading offers..."}):w.offers.length?t.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-200 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"Available Offers"}),de&&t.jsx("button",{type:"button",onClick:()=>st(""),className:"text-xs font-medium text-sky-700 hover:underline",children:"Remove"})]}),t.jsx("div",{className:"space-y-3",children:w.offers.map(s=>{const r=String(Ft(s));if(!r)return null;const a=la(s,_.price||0,ue);return t.jsxs("label",{className:`flex items-start gap-3 rounded-2xl border px-3 py-3 cursor-pointer transition-all duration-200 ${String(de)===r?"border-sky-500 bg-sky-50 shadow-sm":"hover:border-gray-300"}`,children:[t.jsx("input",{type:"radio",name:"selected-offer",className:"mt-1",checked:String(de)===r,onChange:()=>st(r)}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:ia(s)}),qt(s)?t.jsx("p",{className:"text-xs text-gray-500 mt-0.5 line-clamp-2",children:qt(s)}):null]}),t.jsx("span",{className:"text-xs font-semibold text-sky-700 bg-sky-50 px-2 py-1 rounded-full",children:a?`Save ₹${a.totalDiscount.toFixed(0)}`:"No discount"})]}),a&&a.totalDiscount>0&&t.jsxs("p",{className:"text-xs text-emerald-600 mt-1",children:["Save up to ₹",a.totalDiscount.toFixed(0)," with this offer"]})]})]},`offer-${r}`)})})]}):null,xt=()=>{D(s=>({...s,date:ae(),slotKey:""}))},pt=()=>{D(s=>({...s,date:$().add(1,"day").format("YYYY-MM-DD"),slotKey:""}))},os=()=>{_.title&&K(!0)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 to-white font-inter",children:[t.jsx("div",{className:"max-w-6xl mx-auto pt-20 md:pt-24 px-3 lg:px-0",children:t.jsx("div",{className:"rounded-3xl overflow-hidden shadow-xl bg-sky-100",children:t.jsx("img",{src:Jt,alt:_.title||"Experience",className:"w-full h-56 sm:h-72 lg:h-80 object-cover"})})}),t.jsxs("div",{className:"max-w-6xl mx-auto px-3 lg:px-0 pb-24 lg:pb-20",children:[t.jsxs("div",{className:"mt-4 md:mt-6 bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-sky-100",children:[t.jsxs("div",{className:"px-4 md:px-6 pt-3 md:pt-4 pb-2 md:pb-3 border-b border-gray-100 flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900",children:f===1?"Select tickets":f===2?"Customize Add-ons":f===3?"Verify OTP":"Checkout"}),t.jsx("button",{onClick:Gt,className:"p-2 hover:bg-sky-50 rounded-full text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(At,{size:22})})]}),t.jsx("div",{className:"relative pb-3",children:t.jsx(rs,{})})]}),t.jsxs("div",{className:"mt-4 md:mt-6",children:[f===1&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-wrap gap-2 items-center mb-1",children:[t.jsx("button",{type:"button",onClick:xt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${o.date===ae()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),t.jsx("button",{type:"button",onClick:pt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${o.date===$().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),t.jsxs("button",{type:"button",onClick:os,className:"flex items-center gap-2 px-4 py-2 rounded-full text-xs sm:text-sm font-medium bg-white text-gray-800 border border-gray-200 hover:border-sky-300",children:[t.jsx(_t,{size:14,className:"text-gray-500"}),t.jsx("span",{children:o.date?$(o.date).format("DD/MM/YYYY"):"Choose Date"})]}),t.jsx("span",{className:"text-xs sm:text-sm text-gray-500 ml-1",children:"Change date/time in details panel"})]}),t.jsx(is,{})]}),t.jsx("div",{className:"lg:sticky lg:top-28",children:t.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),q?t.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:S.map(s=>{var r,a,n,c,d,h;return t.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((r=s.meta)==null?void 0:r.title)||(s.item_type==="combo"?((a=s.combo)==null?void 0:a.title)||((n=s.combo)==null?void 0:n.name)||((c=s.combo)==null?void 0:c.combo_name)||`Combo #${s.combo_id}`:((d=s.attraction)==null?void 0:d.title)||((h=s.attraction)==null?void 0:h.name)||`Attraction #${s.attraction_id}`)}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) •"," ",s.dateLabel||$(s.booking_date).format("DD MMM YYYY")||s.booking_date,s.slotLabel?` • ${s.slotLabel}`:""]}),t.jsxs("div",{className:"flex gap-3 mt-1",children:[t.jsx("button",{type:"button",onClick:()=>Ke(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),t.jsx("button",{type:"button",onClick:()=>mt(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["₹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):t.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:t.jsx(V,{className:"text-sky-600"})}),t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),t.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),t.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),t.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["₹",ee.toFixed(0)]})]}),t.jsxs("button",{type:"button",disabled:!q,onClick:Fe,className:`w-full flex items-center justify-center gap-2 rounded-full px-6 py-3 text-sm font-semibold transition-all ${q?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[t.jsx("span",{children:"Continue"}),t.jsx(Se,{size:18})]})]})]})})]}),f===2&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start mt-4",children:[t.jsxs("div",{className:"space-y-6",children:[S.length>1&&t.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:S.map(s=>{var r,a,n,c,d,h;return t.jsx("button",{onClick:()=>e(Re(s.key)),className:`px-4 py-2 rounded-full border text-sm font-medium transition-all ${s.key===G?"bg-sky-600 text-white border-sky-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-sky-200"}`,children:s.title||((r=s.meta)==null?void 0:r.title)||(s.item_type==="combo"?((a=s.combo)==null?void 0:a.title)||((n=s.combo)==null?void 0:n.name)||((c=s.combo)==null?void 0:c.combo_name)||`Combo #${s.combo_id}`:((d=s.attraction)==null?void 0:d.title)||((h=s.attraction)==null?void 0:h.name)||`Attraction #${s.attraction_id}`)||"Item"},s.key)})}),t.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Add-ons"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Enhance your experience with optional extras"})]}),t.jsx("button",{onClick:()=>e(jt({active:!0,limit:100})),className:"text-xs font-semibold text-sky-700 hover:underline",children:"Refresh"})]}),C.status==="loading"?t.jsx("div",{className:"text-center py-10 text-gray-500 text-sm",children:"Loading add-ons..."}):t.jsx("div",{className:"space-y-4",children:(C.items||[]).map(s=>{var h;const r=Xs(s),a=Ot(s),n=Yt(s),c=Qs(s),d=Number(((h=Wt.get(r))==null?void 0:h.quantity)||0);return t.jsxs("div",{className:"flex gap-4 items-center border border-gray-200 rounded-2xl p-4 hover:border-sky-200 transition-all",children:[c?t.jsx("img",{src:c,alt:n,className:"w-16 h-16 rounded-xl object-cover border border-gray-100"}):t.jsx("div",{className:"w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center text-gray-400",children:t.jsx(V,{})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold text-gray-900 truncate",children:n}),t.jsx("div",{className:"text-sm text-gray-500 tabular-nums",children:Ns(a)})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>dt(r,Math.max(0,d-1),s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 transition",children:t.jsx(Tt,{size:16})}),t.jsx("span",{className:"w-6 text-center font-semibold text-gray-800 tabular-nums",children:d}),t.jsx("button",{onClick:()=>dt(r,d+1,s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 bg-sky-600 text-white shadow",children:t.jsx(St,{size:16})})]})]},r)})})]})]}),t.jsx("div",{className:"lg:sticky lg:top-28",children:t.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),q?t.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:S.map(s=>{var n,c,d,h,g,z;const r=Q.get(s.key)||new Map,a=Array.from(r.values()).filter(T=>Number(T.quantity)>0);return t.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((n=s.meta)==null?void 0:n.title)||(s.item_type==="combo"?((c=s.combo)==null?void 0:c.title)||((d=s.combo)==null?void 0:d.name)||((h=s.combo)==null?void 0:h.combo_name)||`Combo #${s.combo_id}`:((g=s.attraction)==null?void 0:g.title)||((z=s.attraction)==null?void 0:z.name)||`Attraction #${s.attraction_id}`)}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) • ",s.dateLabel||$(s.booking_date).format("DD MMM YYYY")||s.booking_date,s.slotLabel?` • ${s.slotLabel}`:""]}),t.jsxs("div",{className:"flex gap-3 mt-1",children:[t.jsx("button",{type:"button",onClick:()=>Ke(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),t.jsx("button",{type:"button",onClick:()=>mt(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]}),a.length>0&&t.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[t.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Extras"}),t.jsx("div",{className:"space-y-1",children:a.map(T=>t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[t.jsxs("div",{className:"truncate",children:[T.name," ",t.jsxs("span",{className:"text-xs text-gray-400",children:["x",T.quantity]})]}),t.jsxs("div",{className:"tabular-nums",children:["₹",(Number(T.price||0)*Number(T.quantity||0)).toFixed(0)]})]},T.addon_id))})]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["₹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):t.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:t.jsx(V,{className:"text-sky-600"})}),t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),t.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),t.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),t.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["₹",ee.toFixed(0)]})]}),t.jsxs("button",{type:"button",disabled:!q,onClick:Fe,className:`w-full flex items-center justify-center gap-2 rounded-full px-6 py-3 text-sm font-semibold transition-all ${q?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[t.jsx("span",{children:"Continue"}),t.jsx(Se,{size:18})]})]})]})})]}),f===3&&!x&&t.jsxs("div",{className:"space-y-6 max-w-md mx-auto animate-in fade-in slide-in-from-right-8 duration-300 mt-4",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"w-16 h-16 bg-sky-50 text-sky-700 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(Rs,{size:32})}),t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Guest Details"}),t.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Enter your details to receive tickets via Email & SMS."})]}),t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Full Name"}),t.jsxs("div",{className:"relative group",children:[t.jsx(Vs,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),t.jsx("input",{placeholder:"John Doe",className:"w-full pl-11 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 focus:bg-white outline-none transition-all font-medium",value:M.name,onChange:s=>e(Te({name:s.target.value}))})]})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Email Address"}),t.jsxs("div",{className:"relative group",children:[t.jsx($s,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),t.jsx("input",{placeholder:"name@example.com",type:"email",className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium ${R.email?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:M.email,onChange:s=>{e(Te({email:s.target.value})),R.email&&ge(r=>({...r,email:void 0}))}})]}),R.email&&t.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[t.jsx(Ct,{size:12})," ",R.email]})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Mobile Number"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"relative w-32",children:[t.jsx("div",{className:"absolute left-3 top-3.5 z-10 pointer-events-none",children:t.jsx(As,{size:18,className:"text-gray-400"})}),t.jsx("select",{className:"w-full pl-10 pr-8 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none appearance-none font-medium text-sm",value:he,onChange:s=>tt(s.target.value),children:$t.map(s=>t.jsx("option",{value:s.code,children:s.code},s.code))}),t.jsx(Ve,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 rotate-90 pointer-events-none"})]}),t.jsxs("div",{className:"relative flex-1 group",children:[t.jsx(zs,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),t.jsx("input",{placeholder:"98765 43210",type:"tel",maxLength:10,className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium tracking-wide ${R.phone?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:oe,onChange:ts})]})]}),R.phone&&t.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[t.jsx(Ct,{size:12})," ",R.phone]})]}),E.sent?t.jsxs("div",{className:"mt-6 bg-sky-50 border border-sky-100 p-5 rounded-2xl animate-in fade-in slide-in-from-bottom-2",children:[t.jsxs("p",{className:"text-sm text-sky-800 mb-3 font-medium",children:["Enter OTP sent to ",he," ",oe]}),t.jsxs("div",{className:"flex gap-3 flex-col sm:flex-row",children:[t.jsx("input",{placeholder:"XXXXXX",className:"flex-1 p-3.5 text-center tracking-[0.5em] font-bold text-xl border-2 border-sky-200 rounded-xl focus:border-sky-600 focus:ring-4 focus:ring-sky-100 outline-none bg-white transition-all",maxLength:6,value:je,onChange:s=>Ht(s.target.value)}),t.jsx("button",{onClick:ss,disabled:E.status==="loading",className:"bg-sky-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-sky-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 w-full sm:w-auto text-sm sm:text-base",children:E.status==="loading"?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Verifying..."})]}):E.verified?t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Verified"]}):"Verify"})]}),t.jsx("button",{onClick:ut,className:"text-xs text-sky-700 font-medium mt-3 hover:underline",children:"Resend Code"})]}):t.jsx("button",{onClick:ut,disabled:E.status==="loading",className:"w-full bg-sky-700 text-white py-3 rounded-xl font-bold text-base shadow-lg hover:bg-sky-800 transition-all disabled:opacity-70 flex items-center justify-center gap-2 mt-4",children:E.status==="loading"?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Sending..."})]}):"Send OTP Verification"})]})]}),f===4&&t.jsxs("div",{className:"space-y-6 max-w-lg mx-auto animate-in fade-in slide-in-from-right-8 duration-300 mt-4 pb-20",children:[t.jsx(ns,{}),t.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[t.jsxs("h3",{className:"font-bold text-gray-900 mb-4 text-lg flex items-center gap-2",children:[t.jsx(V,{className:"text-sky-600",size:20}),"Order Summary"]}),lt&&t.jsxs("div",{className:"mb-4 rounded-xl bg-emerald-50 border border-emerald-100 p-3 text-sm text-emerald-700",children:[t.jsxs("div",{className:"font-semibold text-emerald-800",children:["Coupon ",String(O.code||((ht=O.data)==null?void 0:ht.code)).toUpperCase()," applied"]}),t.jsxs("div",{className:"flex items-center justify-between mt-1 text-emerald-700",children:[t.jsx("span",{children:((ft=O.data)==null?void 0:ft.description)||"Discount applied successfully"}),t.jsxs("span",{className:"font-bold tabular-nums",children:["-₹",xe.toFixed(0)]})]})]}),t.jsxs("div",{className:"mb-4 space-y-2 max-h-40 overflow-y-auto custom-scrollbar pr-2",children:[S.map(s=>{var r,a,n,c,d,h;return t.jsxs("div",{className:"flex justify-between text-sm py-2 border-b border-dashed border-gray-100 last:border-0",children:[t.jsxs("div",{className:"text-gray-700",children:[t.jsxs("span",{className:"font-bold text-gray-900",children:[s.quantity,"x"]})," ",s.title||((r=s.meta)==null?void 0:r.title)||(s.item_type==="combo"?((a=s.combo)==null?void 0:a.title)||((n=s.combo)==null?void 0:n.name)||((c=s.combo)==null?void 0:c.combo_name)||`Combo #${s.combo_id}`:((d=s.attraction)==null?void 0:d.title)||((h=s.attraction)==null?void 0:h.name)||`Attraction #${s.attraction_id}`),t.jsxs("div",{className:"text-xs text-gray-400",children:[s.dateLabel||$(s.booking_date).format("DD MMM YYYY")||s.booking_date,s.slotLabel?` • ${s.slotLabel}`:""]})]}),t.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["₹",s.unitPrice*s.quantity]})]},s.key)}),qe>0&&t.jsxs("div",{className:"flex justify-between text-sm py-2 border-t border-gray-100 pt-3",children:[t.jsx("div",{className:"text-gray-600 font-medium",children:"Extras / Add-ons"}),t.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["₹",qe]})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl space-y-2 text-sm mt-2",children:[t.jsxs("div",{className:"flex justify-between text-gray-500",children:[t.jsx("span",{children:"Subtotal (with offers)"})," ",t.jsxs("span",{className:"tabular-nums",children:["₹",Le]})]}),xe>0&&t.jsxs("div",{className:"flex justify-between text-green-600 font-medium",children:[t.jsxs("span",{children:["Coupon (",String(O.code||((gt=O.data)==null?void 0:gt.code)).toUpperCase(),")"]}),t.jsxs("span",{className:"tabular-nums",children:["-₹",xe.toFixed(0)]})]}),t.jsxs("div",{className:"border-t border-gray-200 pt-3 flex justify-between items-center mt-2",children:[t.jsx("span",{className:"font-bold text-gray-800 text-lg",children:"Total Payable"}),t.jsxs("span",{className:"font-bold text-2xl text-sky-700 tabular-nums",children:["₹",ee]})]})]})]}),t.jsx("div",{className:"space-y-3 border-t border-gray-200 pt-4",children:!lt&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Apply Promo Code"}),t.jsx("div",{className:"flex gap-2",children:t.jsxs("div",{className:"relative flex-1",children:[t.jsx(Be,{size:18,className:"absolute left-3 top-3 text-gray-400 pointer-events-none"}),t.jsxs("select",{className:"w-full pl-10 pr-20 p-3 border border-gray-200 rounded-xl text-sm uppercase focus:ring-2 focus:ring-sky-500 outline-none font-bold tracking-wider appearance-none bg-white cursor-pointer disabled:bg-gray-50 disabled:text-gray-400",value:ce,onChange:s=>Ut(s.target.value),disabled:ve,children:[t.jsx("option",{value:"",children:ve?"Loading promos...":"Select a promo code"}),at.map(s=>t.jsxs("option",{value:s.code,children:[s.code," ",s.discount?`(${s.discount}% off)`:""]},s.id||s.code))]}),t.jsx("button",{onClick:as,disabled:!ce||ve,className:"absolute right-1 top-1 bottom-1 px-4 rounded-lg bg-sky-600 text-white text-xs font-bold tracking-wide hover:bg-sky-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"APPLY"})]})})]})})]})]}),(f!==1||!l)&&t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 md:px-0 py-3 md:py-4 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] z-30",children:t.jsxs("div",{className:"max-w-6xl mx-auto flex gap-3 items-center",children:[!l&&f>1&&t.jsx("button",{onClick:ct,className:"md:hidden p-3 rounded-xl border border-gray-200 text-gray-700 hover:border-gray-300 active:scale-[0.95] transition-all flex items-center justify-center",title:"Go back",children:t.jsx(_s,{size:20})}),t.jsxs("div",{className:`flex-1 ${l?"hidden":""}`,children:[t.jsx("div",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Total"}),t.jsxs("div",{className:"text-xl font-bold text-gray-900 tabular-nums",children:["₹",ee]})]}),f>1&&t.jsx("button",{onClick:ct,className:`px-6 py-3 rounded-xl border border-gray-200 text-gray-700 font-semibold hover:border-gray-300 active:scale-[0.98] transition-all ${l?"":"hidden md:block"}`,children:"Back"}),t.jsx("button",{onClick:f===4?es:Fe,disabled:f===3&&!x&&!E.verified||(F==null?void 0:F.status)==="loading",className:`flex-1 bg-gradient-to-r from-sky-600 to-sky-700 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-xl active:scale-[0.98] transition-all flex items-center justify-center gap-3 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed text-base md:text-lg ${l?"":"md:w-full"}`,children:f===4?F.status==="loading"?t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("div",{className:"absolute inset-0 w-5 h-5 border-2 border-transparent border-b-white/50 rounded-full animate-spin animation-delay-150"})]}),t.jsx("span",{className:"animate-pulse",children:"Processing..."})]}):t.jsxs("div",{className:"flex items-center justify-center gap-2 group",children:[t.jsx("div",{className:"p-1.5 bg-white/20 rounded-lg transition-all duration-300 group-hover:bg-white/30",children:t.jsx(Be,{size:18,className:"text-white"})}),t.jsxs("span",{className:"font-semibold",children:["Pay ₹",ee]}),t.jsx("div",{className:"w-0 group-hover:w-5 overflow-hidden transition-all duration-300",children:t.jsx(Se,{size:16,className:"text-white"})})]}):t.jsxs("div",{className:"flex items-center justify-center gap-2 group",children:[t.jsx("span",{className:"font-semibold",children:"Continue"}),t.jsx(Se,{size:20,className:"transition-transform duration-300 group-hover:translate-x-1"})]})})]})})]})]}),Bt&&_.title&&t.jsxs("div",{className:"fixed inset-0 z-50 flex justify-center sm:justify-end items-end sm:items-start bg-black/40 backdrop-blur-[2px]",children:[t.jsx("div",{className:"flex-1 sm:hidden",onClick:()=>K(!1)}),t.jsxs("div",{className:"w-full sm:w-1/2 lg:w-[480px] max-w-full bg-white rounded-t-3xl sm:rounded-none sm:rounded-l-3xl shadow-2xl flex flex-col transform translate-y-0 sm:translate-x-0 transition-all h-full sm:h-screen sm:mt-0",children:[t.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between px-4 sm:px-6 pt-4 pb-2 border-b border-gray-100 bg-white rounded-t-3xl sm:rounded-none sm:rounded-tl-3xl",children:[t.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 pr-3 truncate",children:_.title}),t.jsx("button",{type:"button",onClick:()=>K(!1),className:"p-2 rounded-full hover:bg-gray-100 text-gray-500 flex-shrink-0",children:t.jsx(At,{size:20})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-4 sm:px-6 py-4 space-y-4",children:Vt==="details"?t.jsxs("div",{className:"space-y-4",children:[(Ze||_.image)&&t.jsx("div",{className:"rounded-2xl overflow-hidden border border-gray-100",children:t.jsx("img",{src:Ze||_.image,alt:_.title,className:"w-full h-52 object-cover"})}),(()=>{const s=o.itemType==="combo"?_.previewImages||[]:((y==null?void 0:y.media)||[]).map(re).filter(Boolean);return!s||!s.length?null:t.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:s.map((r,a)=>t.jsx("button",{type:"button",onClick:()=>et(r),className:"w-24 h-16 rounded-xl overflow-hidden border border-gray-100 flex-shrink-0",children:t.jsx("img",{src:r,alt:`thumb-${a}`,className:"w-full h-full object-cover"})},a))})})(),t.jsx("div",{className:"text-sm text-gray-700",children:((o.itemType==="combo"?(k==null?void 0:k.description)||(k==null?void 0:k.short_description)||(k==null?void 0:k.summary)||"":(y==null?void 0:y.description)||(y==null?void 0:y.short_description)||(y==null?void 0:y.summary)||(y==null?void 0:y.about)||"")||"").split(`
`).map((r,a)=>t.jsx("p",{className:"mb-2",children:r},a))}),t.jsx("div",{className:"pt-2",children:t.jsx("button",{type:"button",onClick:()=>$e("booking"),className:"w-full px-4 py-3 rounded-xl bg-sky-600 text-white font-semibold",children:"Book this"})})]}):t.jsxs(t.Fragment,{children:[_.image&&t.jsx("div",{className:"rounded-2xl overflow-hidden border border-gray-100",children:t.jsx("img",{src:_.image,alt:_.title,className:"w-full h-40 sm:h-52 object-cover"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Date"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:xt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${o.date===ae()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),t.jsx("button",{type:"button",onClick:pt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${o.date===$().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute left-3 top-2.5 pointer-events-none",children:t.jsx(_t,{size:14,className:"text-gray-500"})}),t.jsx("input",{type:"date",min:ae(),value:o.date,onChange:s=>D(r=>({...r,date:s.target.value,slotKey:""})),className:"pl-8 pr-3 py-2 rounded-full text-xs sm:text-sm font-medium border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-sky-300"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Time slot"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none text-sm font-medium appearance-none cursor-pointer disabled:bg-gray-100 disabled:text-gray-400 transition-all hover:border-gray-300",value:o.slotKey,onChange:s=>D(r=>({...r,slotKey:s.target.value})),disabled:!o.attractionId&&!o.comboId,children:[t.jsx("option",{value:"",children:!o.attractionId&&!o.comboId?"Select a ticket above first":"Select a time slot"}),be.items.map((s,r)=>{const a=Pt(s,r),n=ra(s),c=aa(s,o.date),d=!n||!c;return t.jsxs("option",{value:a,disabled:d,children:[Dt(s)," ",n?c?"":"(Not Available)":"(Full)"]},a)})]}),t.jsx(Ve,{size:16,className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 rotate-90"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Quantity"}),t.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 rounded-xl p-1.5 border border-gray-200 w-fit",children:[t.jsx("button",{onClick:()=>D(s=>({...s,qty:Math.max(1,s.qty-1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-white text-gray-600 shadow-sm hover:text-sky-700 active:scale-95 transition",children:t.jsx(Tt,{size:16})}),t.jsx("span",{className:"font-bold text-lg w-8 text-center text-gray-800 tabular-nums",children:o.qty}),t.jsx("button",{onClick:()=>D(s=>({...s,qty:Math.max(1,s.qty+1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-95 transition",children:t.jsx(St,{size:16})})]})]})]})}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-4 bg-gradient-to-t from-white via-white/70 to-transparent pointer-events-none"}),t.jsxs("div",{className:"px-4 sm:px-6 py-3 border-t border-gray-100 bg-white flex items-center justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",children:"Subtotal"}),t.jsxs("div",{className:"text-lg font-bold text-sky-700 tabular-nums",children:["₹",Xt.toFixed(0)]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:ke,disabled:!B,className:"inline-flex items-center px-4 py-2 rounded-full border border-gray-200 text-xs font-semibold text-gray-700 hover:border-sky-300 disabled:opacity-40 disabled:cursor-not-allowed",children:"Add to order"}),t.jsxs("button",{type:"button",onClick:Zt,disabled:!B,className:"flex items-center gap-2 px-6 py-2.5 rounded-full bg-sky-600 text-white text-sm font-semibold shadow-md hover:bg-sky-700 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed",children:[t.jsx(V,{size:18}),t.jsx("span",{children:"Buy now"})]})]})]})]})]})]}),Rt&&t.jsx(Us,{onClose:()=>ne(!1),onSignIn:()=>{ne(!1),e(Y(3))},onContinueAsGuest:()=>{ne(!1),e(Y(3))}})]})}export{fa as default};
