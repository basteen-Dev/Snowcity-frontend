import{R as i,D as o,j as e}from"./index-DpUnVvi7.js";import{a as j}from"./AdminApp-DElutmvv.js";import{R as v,T as S}from"./CategoricalChart-C8vF6RGu.js";import{L as N,a as D}from"./LineChart-4ly3mrh-.js";import{C as Y,X as M,Y as O,L as C}from"./CartesianChart-1RJQhyYa.js";import"./createLucideIcon-DlloiUI2.js";import"./file-text-BcxeLTgw.js";import"./users-Dj4zQjFo.js";import"./newspaper-D6LH_a5a.js";import"./ticket-DJwTfedz.js";import"./chevron-down-BM4ufvPU.js";import"./clsx-B-dksMZM.js";import"./index-DTIaNHTc.js";const g=[{key:"7d",label:"7 days",from:()=>o().subtract(7,"day"),to:()=>o()},{key:"30d",label:"30 days",from:()=>o().subtract(30,"day"),to:()=>o()},{key:"thisMonth",label:"MTD",from:()=>o().startOf("month"),to:()=>o()},{key:"year",label:"YTD",from:()=>o().startOf("year"),to:()=>o()}],x=({title:a,subtitle:r,children:n})=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm dark:bg-neutral-900 dark:border-neutral-800",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-neutral-100",children:a}),r?e.jsx("p",{className:"text-xs text-gray-500",children:r}):null]}),n]}),m=({label:a,value:r})=>e.jsxs("div",{className:"rounded-xl border border-gray-100 bg-gray-50 px-4 py-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:a}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:r})]});function $(){const[a,r]=i.useState(o().subtract(30,"day").startOf("day").toISOString()),[n,c]=i.useState(o().endOf("day").toISOString()),[p,y]=i.useState([]),[b,u]=i.useState("30d");i.useEffect(()=>{(async()=>{const s=(await j.get("/api/admin/analytics/daily",{from:a,to:n})||[]).map(l=>({...l,avg_people_per_booking:l.bookings?(l.people||0)/l.bookings:0}));y(s)})()},[a,n]);const f=`/api/admin/analytics/report.csv?type=daily&from=${encodeURIComponent(a)}&to=${encodeURIComponent(n)}`,d=i.useMemo(()=>p.reduce((t,s)=>(t.people+=Number(s.people||0),t.bookings+=Number(s.bookings||0),t),{bookings:0,people:0}),[p]),h=d.bookings?(d.people/d.bookings).toFixed(2):"0.00",k=t=>{const s=g.find(l=>l.key===t);s&&(u(t),r(s.from().startOf("day").toISOString()),c(s.to().endOf("day").toISOString()))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{title:"People Metrics",subtitle:"Understand per-booking crowd sizes",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:g.map(t=>e.jsx("button",{onClick:()=>k(t.key),className:`rounded-full border px-3 py-1 text-xs font-semibold ${b===t.key?"bg-gray-900 text-white border-gray-900":"border-gray-200 text-gray-600"}`,children:t.label},t.key))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{type:"datetime-local",className:"rounded-lg border px-3 py-2 text-sm",value:o(a).format("YYYY-MM-DDTHH:mm"),onChange:t=>r(o(t.target.value).toISOString())}),e.jsx("input",{type:"datetime-local",className:"rounded-lg border px-3 py-2 text-sm",value:o(n).format("YYYY-MM-DDTHH:mm"),onChange:t=>c(o(t.target.value).toISOString())}),e.jsx("a",{href:f,className:"rounded-lg border px-3 py-2 text-sm text-center",children:"Download CSV"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(m,{label:"Total People",value:d.people.toLocaleString()}),e.jsx(m,{label:"Total Bookings",value:d.bookings.toLocaleString()}),e.jsx(m,{label:"Avg People / Booking",value:h})]}),e.jsx(x,{title:"Average People per Booking",subtitle:"Daily trend",children:e.jsx("div",{style:{height:360},children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(N,{data:p,children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(M,{dataKey:"bucket",tickFormatter:t=>o(t).format("MM-DD")}),e.jsx(O,{}),e.jsx(S,{labelFormatter:t=>o(t).format("YYYY-MM-DD")}),e.jsx(C,{}),e.jsx(D,{type:"monotone",dataKey:"avg_people_per_booking",stroke:"#10b981",name:"Avg People/Booking",strokeWidth:2,dot:!1})]})})})})]})}export{$ as default};
