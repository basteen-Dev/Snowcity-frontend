import{R as d,j as e}from"./index-CNdOvwUA.js";import{a as T}from"./AdminApp-sxxeVGC_.js";import{i as A}from"./media-Ct2xuz47.js";const p={},U="/api/admin/uploads",D=(p==null?void 0:p.VITE_CLOUDINARY_UPLOAD_PRESET)||"";function $({label:P="Image",value:c,onChange:n,fieldName:R="file",extra:S={},accept:E="image/*,video/*,.pdf",requiredPerm:M=null,folder:f=""}){const g=d.useId(),[s,u]=d.useState(null),[b,h]=d.useState(""),[m,y]=d.useState(""),[j,x]=d.useState("idle"),[v,i]=d.useState(""),o=d.useMemo(()=>A(c||""),[c]);d.useEffect(()=>{if(!s)return;const t=URL.createObjectURL(s);return y(t),h(s.name||""),()=>URL.revokeObjectURL(t)},[s]);const N=t=>t?t.type.startsWith("image/")?"image":t.type.startsWith("video/")?"video":t.type==="application/pdf"?"pdf":"unknown":"unknown",I=t=>{var a;const l=((a=t.target.files)==null?void 0:a[0])||null;i(""),u(l)},L=t=>{var a,r;t.preventDefault(),t.stopPropagation();const l=((r=(a=t.dataTransfer)==null?void 0:a.files)==null?void 0:r[0])||null;l&&(i(""),u(l))},O=t=>{t.preventDefault(),t.stopPropagation()},k=()=>{u(null),y(""),h("")},F=async()=>{var t;if(s){x("loading"),i("");try{const l=/cloudinary\.com/i.test(U),a={...S||{}};l&&D&&!a.upload_preset&&(a.upload_preset=D),f&&!l&&(a.folder=f);const r=await T.upload(U,s,{fieldName:R,data:a}),w=(r==null?void 0:r.url)||(r==null?void 0:r.url_path)||(r==null?void 0:r.secure_url)||(r==null?void 0:r.location)||((t=r==null?void 0:r.data)==null?void 0:t.url)||"";if(!w)throw new Error((r==null?void 0:r.message)||"Upload response missing URL");n==null||n(w),x("done"),k()}catch(l){x("error"),i((l==null?void 0:l.message)||"Upload failed")}}};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:P}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"text",className:"flex-1 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",placeholder:"https://...",value:c||"",onChange:t=>n==null?void 0:n(t.target.value)})}),e.jsxs("div",{className:"mt-2 rounded-md border border-dashed px-3 py-3 text-sm text-gray-600 dark:text-neutral-300 dark:border-neutral-700",onDrop:L,onDragOver:O,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{id:g,type:"file",accept:E,onChange:I,className:"sr-only"}),e.jsx("label",{htmlFor:g,className:"inline-flex items-center rounded-md border px-3 py-2 text-sm cursor-pointer dark:border-neutral-700 dark:text-neutral-200",role:"button",children:"Choose"}),e.jsx("button",{className:"inline-flex items-center rounded-md bg-gray-900 text-white px-3 py-2 text-sm disabled:opacity-50",onClick:F,disabled:!s||j==="loading",type:"button",children:j==="loading"?"Uploadingâ€¦":"Upload"}),b?e.jsxs("span",{className:"text-xs text-gray-500 dark:text-neutral-400",children:["Selected: ",b]}):null,s?e.jsx("button",{className:"inline-flex items-center rounded-md border px-2 py-1 text-xs dark:border-neutral-700 dark:text-neutral-200",onClick:k,type:"button",children:"Clear"}):null]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 dark:text-neutral-400",children:"Drag a file here, or click Choose to select."})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[m?e.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:N(s)==="video"?e.jsx("video",{src:m,className:"w-full h-full object-cover",muted:!0}):N(s)==="pdf"?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):e.jsx("img",{src:m,alt:"snowcity",loading:"lazy",className:"w-full h-full object-cover"})}):null,o?e.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:o.match(/\.(mp4|webm|ogg)$/i)?e.jsx("video",{src:o,className:"w-full h-full object-cover",muted:!0}):o.match(/\.pdf$/i)?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):e.jsx("img",{src:o,alt:"snowcity",loading:"lazy",className:"w-full h-full object-cover"})}):null]}),v?e.jsx("div",{className:"text-xs text-red-600 mt-2",children:v}):null]})}export{$ as I};
