import{r as o,j as e,D as d}from"./index-DpUnVvi7.js";import{a as h,A as f,D as T,T as L}from"./AdminApp-DElutmvv.js";import{f as A}from"./formatters-CmiLqhJj.js";import{R as F,S as B}from"./shopping-cart-Bm7tXnuc.js";import{L as P}from"./loader-circle-2fTFtA91.js";import{U as V}from"./users-Dj4zQjFo.js";import{R as O,T as R}from"./CategoricalChart-C8vF6RGu.js";import{B as Y,a as G}from"./BarChart-2oIEB0QF.js";import{C as K,X as E,Y as U,L as q}from"./CartesianChart-1RJQhyYa.js";import{P as z,a as X}from"./PieChart-zRVOrLmW.js";import{C as H}from"./tooltipContext-UWJEGs02.js";import{c as J}from"./createLucideIcon-DlloiUI2.js";import{P as Q}from"./plus-BPthzweF.js";import"./file-text-BcxeLTgw.js";import"./newspaper-D6LH_a5a.js";import"./ticket-DJwTfedz.js";import"./chevron-down-BM4ufvPU.js";import"./clsx-B-dksMZM.js";import"./index-DTIaNHTc.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Z=J("trash-2",W),D=[{label:"Today",get:()=>({from:d().startOf("day").toISOString(),to:d().endOf("day").toISOString()})},{label:"7 Days",get:()=>({from:d().subtract(7,"day").startOf("day").toISOString(),to:d().endOf("day").toISOString()})},{label:"30 Days",get:()=>({from:d().subtract(30,"day").startOf("day").toISOString(),to:d().endOf("day").toISOString()})},{label:"90 Days",get:()=>({from:d().subtract(90,"day").startOf("day").toISOString(),to:d().endOf("day").toISOString()})},{label:"All Time",get:()=>({from:null,to:null})}],y=["#6366f1","#22c55e","#f59e0b","#ef4444","#8b5cf6","#14b8a6","#e11d48","#3b82f6","#f97316","#06b6d4"];function j({icon:n,label:x,value:a,note:i,accent:g="blue"}){const v={blue:"from-blue-500 to-indigo-600",green:"from-emerald-500 to-teal-600",amber:"from-amber-500 to-orange-600",purple:"from-purple-500 to-violet-600"};return e.jsx("div",{className:"relative overflow-hidden rounded-2xl bg-white dark:bg-neutral-900 border border-gray-200/60 dark:border-neutral-800 shadow-sm p-5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`flex h-12 w-12 shrink-0 items-center justify-center rounded-xl bg-gradient-to-br ${v[g]} text-white shadow-lg`,children:e.jsx(n,{className:"h-6 w-6"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-neutral-400 uppercase tracking-wide",children:x}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-gray-900 dark:text-white truncate",children:a}),i&&e.jsx("p",{className:"mt-0.5 text-xs text-gray-400 dark:text-neutral-500",children:i})]})]})})}function k({title:n,children:x,action:a,className:i=""}){return e.jsxs("div",{className:`rounded-2xl bg-white dark:bg-neutral-900 border border-gray-200/60 dark:border-neutral-800 shadow-sm ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-6 pt-5 pb-3",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:n}),a]}),e.jsx("div",{className:"px-6 pb-6",children:x})]})}function ye(){const[n,x]=o.useState(2),[a,i]=o.useState(null),[g,v]=o.useState([]),[N,S]=o.useState(!0),[w,C]=o.useState(!1),[s,b]=o.useState({source:"",campaign:"",spend:""}),m=o.useCallback(async()=>{S(!0);try{const t=D[n].get(),r={};t.from&&(r.from=t.from),t.to&&(r.to=t.to);const[$,M]=await Promise.all([h.get(f.conversionSummary(),{params:r}),h.get(f.conversionAdSpend())]);i($),v(M)}catch(t){console.error("Failed to load conversion data:",t)}finally{S(!1)}},[n]);o.useEffect(()=>{m()},[m]);const _=async t=>{if(t.preventDefault(),!(!s.source||!s.spend))try{await h.post(f.conversionAdSpend(),{source:s.source,campaign:s.campaign||null,spend:Number(s.spend)}),b({source:"",campaign:"",spend:""}),C(!1),m()}catch(r){console.error("Failed to add spend:",r)}},I=async t=>{if(window.confirm("Delete this ad spend entry?"))try{await h.delete(f.conversionAdSpendById(t)),m()}catch(r){console.error("Failed to delete spend:",r)}},l=(a==null?void 0:a.totals)||{},c=(a==null?void 0:a.sources)||[],u=t=>Number(t||0).toLocaleString("en-IN"),p=t=>A?A(t):`₹${Number(t||0).toLocaleString("en-IN")}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Conversion Tracking"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-neutral-400 mt-1",children:"Traffic sources, booking attribution & ROAS"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[D.map((t,r)=>e.jsx("button",{onClick:()=>x(r),className:["px-3 py-1.5 rounded-full text-xs font-semibold transition-all",r===n?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/30":"bg-gray-100 dark:bg-neutral-800 text-gray-600 dark:text-neutral-300 hover:bg-gray-200 dark:hover:bg-neutral-700"].join(" "),children:t.label},t.label)),e.jsx("button",{onClick:m,className:"p-2 rounded-full bg-gray-100 dark:bg-neutral-800 text-gray-600 dark:text-neutral-300 hover:bg-gray-200 dark:hover:bg-neutral-700",title:"Refresh",children:e.jsx(F,{className:`h-4 w-4 ${N?"animate-spin":""}`})})]})]}),N&&!a?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(j,{icon:V,label:"Total Visitors",value:u(l.total_visitors),accent:"blue"}),e.jsx(j,{icon:B,label:"Total Bookings",value:u(l.total_bookings),accent:"green"}),e.jsx(j,{icon:T,label:"Total Revenue",value:p(l.total_revenue),accent:"amber"}),e.jsx(j,{icon:L,label:"Conversion Rate",value:`${l.conversion_rate||0}%`,accent:"purple",note:l.total_visitors>0?`${l.total_bookings} of ${l.total_visitors} visitors`:"No data yet"})]}),c.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(k,{title:"Revenue by Source",children:e.jsx("div",{className:"h-72",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(Y,{data:c,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(E,{dataKey:"source",tick:{fontSize:12}}),e.jsx(U,{tick:{fontSize:12},tickFormatter:t=>`₹${(t/1e3).toFixed(0)}K`}),e.jsx(R,{formatter:t=>p(t),contentStyle:{borderRadius:"12px",border:"1px solid #e5e7eb",boxShadow:"0 4px 12px rgba(0,0,0,0.08)"}}),e.jsx(G,{dataKey:"revenue",fill:"url(#revenueGrad)",radius:[6,6,0,0]}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"revenueGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#6366f1"}),e.jsx("stop",{offset:"100%",stopColor:"#818cf8"})]})})]})})})}),e.jsx(k,{title:"Visitor Distribution",children:e.jsx("div",{className:"h-72",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(z,{children:[e.jsx(X,{data:c,dataKey:"visitors",nameKey:"source",cx:"50%",cy:"50%",outerRadius:90,innerRadius:50,paddingAngle:3,label:({source:t,percent:r})=>`${t} ${(r*100).toFixed(0)}%`,children:c.map((t,r)=>e.jsx(H,{fill:y[r%y.length]},r))}),e.jsx(R,{formatter:t=>u(t)}),e.jsx(q,{})]})})})})]}),e.jsx(k,{title:"Source Breakdown",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 dark:border-neutral-800",children:["Source","Visitors","Bookings","Revenue","Conv %","Ad Spend","ROAS"].map(t=>e.jsx("th",{className:"py-3 px-4 text-left font-semibold text-gray-500 dark:text-neutral-400 uppercase tracking-wide text-xs",children:t},t))})}),e.jsx("tbody",{children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-12 text-center text-gray-400 dark:text-neutral-500",children:"No conversion data yet. Visits with UTM params will appear here."})}):c.map((t,r)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-neutral-800/50 hover:bg-gray-50 dark:hover:bg-neutral-800/30 transition-colors",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-gray-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-2.5 w-2.5 rounded-full shrink-0",style:{backgroundColor:y[r%y.length]}}),t.source||"direct"]})}),e.jsx("td",{className:"py-3 px-4 text-gray-700 dark:text-neutral-300",children:u(t.visitors)}),e.jsx("td",{className:"py-3 px-4 text-gray-700 dark:text-neutral-300",children:u(t.bookings)}),e.jsx("td",{className:"py-3 px-4 font-semibold text-gray-900 dark:text-white",children:p(t.revenue)}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("span",{className:`inline-flex px-2 py-0.5 rounded-full text-xs font-bold ${t.conversion_rate>=10?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400":t.conversion_rate>=5?"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400":"bg-gray-100 text-gray-700 dark:bg-neutral-800 dark:text-neutral-400"}`,children:[t.conversion_rate,"%"]})}),e.jsx("td",{className:"py-3 px-4 text-gray-700 dark:text-neutral-300",children:t.spend>0?p(t.spend):"—"}),e.jsx("td",{className:"py-3 px-4",children:t.roas!=null?e.jsxs("span",{className:`inline-flex px-2 py-0.5 rounded-full text-xs font-bold ${t.roas>=3?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400":t.roas>=1?"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:[t.roas,"x"]}):e.jsx("span",{className:"text-gray-400 dark:text-neutral-500",children:"—"})})]},t.source))})]})})}),e.jsxs(k,{title:"Ad Spend",action:e.jsxs("button",{onClick:()=>C(!w),className:"flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-semibold bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/30 hover:shadow-xl transition-all",children:[e.jsx(Q,{className:"h-3.5 w-3.5"}),"Add Spend"]}),children:[w&&e.jsx("form",{onSubmit:_,className:"mb-4 p-4 rounded-xl bg-gray-50 dark:bg-neutral-800/50 border border-gray-200 dark:border-neutral-700",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:"Source (e.g. facebook)",value:s.source,onChange:t=>b({...s,source:t.target.value}),className:"rounded-xl border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-900 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500/40 focus:outline-none",required:!0}),e.jsx("input",{type:"text",placeholder:"Campaign (optional)",value:s.campaign,onChange:t=>b({...s,campaign:t.target.value}),className:"rounded-xl border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-900 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500/40 focus:outline-none"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Spend (₹)",value:s.spend,onChange:t=>b({...s,spend:t.target.value}),className:"flex-1 rounded-xl border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-900 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500/40 focus:outline-none",required:!0}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white text-sm font-semibold shadow-lg shadow-blue-500/30",children:"Save"})]})]})}),g.length===0?e.jsx("p",{className:"text-sm text-gray-400 dark:text-neutral-500 text-center py-6",children:"No ad spend entries yet. Add your ad spend to calculate ROAS."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 dark:border-neutral-800",children:["Source","Campaign","Spend","Period",""].map(t=>e.jsx("th",{className:"py-3 px-4 text-left font-semibold text-gray-500 dark:text-neutral-400 uppercase tracking-wide text-xs",children:t},t))})}),e.jsx("tbody",{children:g.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-neutral-800/50 hover:bg-gray-50 dark:hover:bg-neutral-800/30 transition-colors",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-gray-900 dark:text-white",children:t.source}),e.jsx("td",{className:"py-3 px-4 text-gray-700 dark:text-neutral-300",children:t.campaign||"—"}),e.jsx("td",{className:"py-3 px-4 font-semibold text-gray-900 dark:text-white",children:p(t.spend)}),e.jsx("td",{className:"py-3 px-4 text-gray-500 dark:text-neutral-400 text-xs",children:t.period_start&&t.period_end?`${d(t.period_start).format("DD MMM")} – ${d(t.period_end).format("DD MMM YYYY")}`:"—"}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("button",{onClick:()=>I(t.id),className:"p-1.5 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",title:"Delete",children:e.jsx(Z,{className:"h-4 w-4"})})})]},t.id))})]})})]})]})]})}export{ye as default};
