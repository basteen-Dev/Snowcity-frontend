import{A as N,R as h,j as t}from"./index-DpUnVvi7.js";import{a as m,A as x}from"./AdminApp-DElutmvv.js";import{A as k}from"./AdminTable-C9C_doBs.js";import{D as _,c as A,S,v as C,a as w}from"./sortable.esm-IF2FNsid.js";import"./createLucideIcon-DlloiUI2.js";import"./file-text-BcxeLTgw.js";import"./users-Dj4zQjFo.js";import"./newspaper-D6LH_a5a.js";import"./ticket-DJwTfedz.js";import"./chevron-down-BM4ufvPU.js";function L(){const g=N(),[s,i]=h.useState({status:"idle",items:[],error:null,active:"",page:1,limit:20,meta:null,reorder:!1,saving:!1}),d=async(a=1)=>{i(e=>({...e,status:"loading",error:null,page:a}));try{const e=await m.get(x.banners(),{params:{active:s.active||void 0,page:a,limit:s.limit}}),n=Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e)?e:[];i(r=>({...r,status:"succeeded",items:n,meta:(e==null?void 0:e.meta)||null,page:a}))}catch(e){i(n=>({...n,status:"failed",error:e}))}};h.useEffect(()=>{d(1)},[]);const y=async(a,e)=>{var n;if((n=e==null?void 0:e.stopPropagation)==null||n.call(e),!!window.confirm(`Delete banner "${a.title||""}"? This cannot be undone.`))try{const r=a.banner_id||a.id;await m.delete(`${x.banners()}/${r}`),i(c=>({...c,items:c.items.filter(o=>(o.banner_id||o.id)!==r)}))}catch(r){alert((r==null?void 0:r.message)||"Delete failed")}},v=a=>{const{active:e,over:n}=a;!n||e.id===n.id||i(r=>{const c=r.items.findIndex(p=>String(p.banner_id)===String(e.id)),o=r.items.findIndex(p=>String(p.banner_id)===String(n.id)),j=w(r.items,c,o);return{...r,items:j}})},f=async()=>{const a=s.items.map(e=>e.banner_id);i(e=>({...e,saving:!0}));try{try{await m.post(x.bannersReorder(),{ids:a})}catch{await Promise.all(a.map((e,n)=>m.put(`${x.banners()}/${e}`,{sort_order:n})))}alert("Order saved")}catch(e){alert((e==null?void 0:e.message)||"Failed to save order")}finally{i(e=>({...e,saving:!1,reorder:!1})),d(s.page)}},l=s.meta||{},u=s.page>1,b=l.page?l.page<(l.totalPages||l.total_pages||1):!1;return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h1",{className:"text-xl font-semibold",children:"Banners"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>i(a=>({...a,reorder:!a.reorder})),children:s.reorder?"Exit Reorder":"Reorder"}),s.reorder?t.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm disabled:opacity-50",onClick:f,disabled:s.saving,children:s.saving?"Saving…":"Save Order"}):t.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm",onClick:()=>g("/admin/catalog/banners/new"),children:"New Banner"})]})]}),s.reorder?t.jsx("div",{className:"overflow-x-auto rounded-lg border bg-white dark:bg-neutral-900",children:t.jsx(_,{collisionDetection:A,onDragEnd:v,children:t.jsx(S,{items:s.items.map(a=>String(a.banner_id)),strategy:C,children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-neutral-800 text-gray-600 dark:text-neutral-300",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 py-2 text-left",children:"Drag"}),t.jsx("th",{className:"px-3 py-2 text-left",children:"Title"}),t.jsx("th",{className:"px-3 py-2 text-left",children:"Attraction"}),t.jsx("th",{className:"px-3 py-2 text-left",children:"Offer"})]})}),t.jsx("tbody",{className:"text-gray-800 dark:text-neutral-200",children:s.items.map(a=>t.jsxs("tr",{id:String(a.banner_id),className:"border-t border-gray-200 dark:border-neutral-800",children:[t.jsx("td",{className:"px-3 py-2 cursor-grab",children:"⋮⋮"}),t.jsx("td",{className:"px-3 py-2",children:a.title||"—"}),t.jsx("td",{className:"px-3 py-2",children:a.linked_attraction_id||"—"}),t.jsx("td",{className:"px-3 py-2",children:a.linked_offer_id||"—"})]},a.banner_id))})]})})})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-3 flex gap-2",children:[t.jsxs("select",{className:"rounded-md border px-3 py-2",value:s.active,onChange:a=>i(e=>({...e,active:a.target.value})),children:[t.jsx("option",{value:"",children:"Active: All"}),t.jsx("option",{value:"true",children:"Active"}),t.jsx("option",{value:"false",children:"Inactive"})]}),t.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>d(1),children:"Filter"})]}),t.jsx(k,{keyField:"banner_id",columns:[{key:"title",title:"Title"},{key:"linked_attraction_id",title:"Attraction"},{key:"linked_offer_id",title:"Offer"},{key:"active",title:"Active",render:a=>String(a==null?void 0:a.active)},{key:"__actions",title:"Actions",render:a=>t.jsx("div",{className:"flex flex-wrap gap-2",children:t.jsx("button",{className:"rounded-md border px-2 py-1 text-xs text-red-600",onClick:e=>y(a,e),children:"Delete"})})}],rows:s.items,onRowClick:a=>g(`/admin/catalog/banners/${a.banner_id||a.id}`),empty:s.status==="loading"?"Loading…":"No banners"}),t.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[t.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>u&&d(s.page-1),disabled:!u||s.status==="loading",children:"Prev"}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",l.page||s.page]}),t.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>b&&d(s.page+1),disabled:!b||s.status==="loading",children:"Next"})]})]})]})}export{L as default};
