import{u as A,R as l,j as t}from"./index-C5Mz9dTM.js";import{a as j,A as f}from"./AdminApp-C7IcGGGV.js";import{F as R}from"./file-spreadsheet-CvOIwlYL.js";import{F as C}from"./file-text-CQ7rExmv.js";import"./createLucideIcon-DQ6FqzLt.js";import"./ticket-C3bgGsni.js";const N=({title:r,subtitle:d,children:c,className:i=""})=>t.jsxs("div",{className:`rounded-2xl border border-gray-200 bg-white p-5 shadow-sm dark:bg-neutral-900 dark:border-neutral-800 ${i}`,children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-neutral-100",children:r}),d?t.jsx("p",{className:"text-xs text-gray-500",children:d}):null]})}),c]}),h=({icon:r,label:d,value:c,note:i,accent:m="from-blue-500 to-indigo-600"})=>t.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white shadow-sm p-4 dark:bg-neutral-900 dark:border-neutral-800",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:d}),t.jsx("div",{className:`mt-2 text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r ${m}`,children:c})]}),r]}),i?t.jsx("div",{className:"text-xs text-gray-500 mt-2",children:i}):null]}),k=r=>`â‚¹${Number(r||0).toLocaleString()}`,F=r=>Number(r||0).toLocaleString();function U(){const{user:r}=A(e=>e.adminAuth),[d,c]=l.useState([]),[i,m]=l.useState("idle"),[s,S]=l.useState(null),[y,p]=l.useState("idle"),[a,x]=l.useState({attraction_id:"",from:"",to:""});l.useEffect(()=>{let e=!1;return(async()=>{m("loading");try{const o=await j.get(f.attractions(),{params:{limit:1e3}});if(e)return;let n=Array.isArray(o.data)?o.data:Array.isArray(o)?o:[];const b=Array.isArray(r==null?void 0:r.roles)?r.roles.map(u=>String(u).toLowerCase()):[],_=(r==null?void 0:r.scopes)||{};if(b.includes("subadmin")&&!b.includes("admin")&&!b.includes("root")){const u=_.attraction||[];u.length>0&&(n=n.filter(g=>u.includes(g.attraction_id)||u.includes(g.id)),!a.attraction_id&&n.length>0&&x(g=>({...g,attraction_id:n[0].attraction_id||n[0].id})))}c(n),m("succeeded")}catch(o){if(e)return;console.error("Error loading attractions:",o),m("failed")}})(),()=>{e=!0}},[r]);const w=l.useCallback(async()=>{p("loading");try{const e={};a.attraction_id&&(e.attraction_id=a.attraction_id),a.from&&(e.from=a.from),a.to&&(e.to=a.to);const o=await j.get(f.analyticsAttractionRevenue(),{params:e});S(o||{}),p("succeeded")}catch(e){console.error("Error loading revenue data:",e),p("failed")}},[a]),v=l.useCallback(e=>{try{const o={type:"attraction-revenue",...a.attraction_id&&{attraction_id:a.attraction_id},...a.from&&{from:a.from},...a.to&&{to:a.to}},n=`${f.analyticsReport(e)}?${new URLSearchParams(o).toString()}`;window.open(n,"_blank")}catch(o){console.error("Download failed:",o),alert("Failed to download report")}},[a]);return t.jsxs("div",{className:"space-y-4 p-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-neutral-100",children:"Attraction Revenue"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400",children:"Track revenue from attraction bookings"})]}),t.jsx(N,{title:"Filters",subtitle:"Slice data by attraction and date range",className:"p-4",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-4",children:[t.jsxs("select",{className:"rounded-lg border px-3 py-2 disabled:opacity-50",value:a.attraction_id,onChange:e=>x({...a,attraction_id:e.target.value}),disabled:i==="loading",children:[t.jsx("option",{value:"",children:i==="loading"?"Loading...":"All Attractions"}),i==="succeeded"&&d.map(e=>t.jsx("option",{value:e.attraction_id||e.id,children:e.title||e.name||`#${e.attraction_id||e.id}`},e.attraction_id||e.id))]}),t.jsx("input",{type:"date",className:"rounded-lg border px-3 py-2",value:a.from,onChange:e=>x({...a,from:e.target.value}),placeholder:"From date"}),t.jsx("input",{type:"date",className:"rounded-lg border px-3 py-2",value:a.to,onChange:e=>x({...a,to:e.target.value}),placeholder:"To date"}),t.jsx("div",{className:"flex gap-2",children:t.jsx("button",{className:"flex-1 rounded-lg bg-gray-900 text-white px-3 py-2 text-sm",onClick:w,children:"Apply Filters"})})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx(h,{label:"Total Bookings",value:F(s==null?void 0:s.attraction_bookings),accent:"from-blue-500 to-indigo-600"}),t.jsx(h,{label:"Total Revenue",value:k(s==null?void 0:s.attraction_revenue),accent:"from-green-500 to-emerald-600"}),t.jsx(h,{label:"Average Per Booking",value:k(((s==null?void 0:s.attraction_revenue)||0)/((s==null?void 0:s.attraction_bookings)||1)),accent:"from-purple-500 to-pink-600"})]}),t.jsx(N,{title:"Revenue Report",subtitle:"Download detailed reports",className:"p-4",children:t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-neutral-800",onClick:()=>v("csv"),children:[t.jsx(R,{className:"h-4 w-4"}),"CSV"]}),t.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-neutral-800",onClick:()=>v("pdf"),children:[t.jsx(C,{className:"h-4 w-4"}),"PDF"]})]})}),y==="loading"&&t.jsx("div",{className:"text-sm text-gray-500 text-center py-8",children:"Loading revenue data..."}),y==="failed"&&t.jsx("div",{className:"text-sm text-red-600 text-center py-8",children:"Failed to load revenue data"})]})}export{U as default};
