import{R as n,D as a,j as e}from"./index-DpUnVvi7.js";import{a as S}from"./AdminApp-DElutmvv.js";import{R as N,T as Y}from"./CategoricalChart-C8vF6RGu.js";import{L as D,a as c}from"./LineChart-4ly3mrh-.js";import{C,X as M,Y as O,L as R}from"./CartesianChart-1RJQhyYa.js";import"./createLucideIcon-DlloiUI2.js";import"./file-text-BcxeLTgw.js";import"./users-Dj4zQjFo.js";import"./newspaper-D6LH_a5a.js";import"./ticket-DJwTfedz.js";import"./chevron-down-BM4ufvPU.js";import"./clsx-B-dksMZM.js";import"./index-DTIaNHTc.js";const u=[{key:"7d",label:"7D",from:()=>a().subtract(7,"day"),to:()=>a()},{key:"30d",label:"30D",from:()=>a().subtract(30,"day"),to:()=>a()},{key:"thisMonth",label:"MTD",from:()=>a().startOf("month"),to:()=>a()},{key:"year",label:"YTD",from:()=>a().startOf("year"),to:()=>a()}],g=({title:r,subtitle:s,children:l})=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm dark:bg-neutral-900 dark:border-neutral-800",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-neutral-100",children:r}),s?e.jsx("p",{className:"text-xs text-gray-500",children:s}):null]}),l]}),p=({label:r,value:s})=>e.jsxs("div",{className:"rounded-xl border border-gray-100 px-4 py-3 bg-gray-50",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:r}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s})]});function E(){const[r,s]=n.useState(a().subtract(30,"day").startOf("day").toISOString()),[l,x]=n.useState(a().endOf("day").toISOString()),[i,y]=n.useState("day"),[d,b]=n.useState([]),[h,f]=n.useState("30d");n.useEffect(()=>{(async()=>{const t=await S.get("/api/admin/analytics/trend",{from:r,to:l,granularity:i});b(Array.isArray(t)?t:[])})()},[r,l,i]);const j=`/api/admin/analytics/report.csv?type=trend&from=${encodeURIComponent(r)}&to=${encodeURIComponent(l)}`,m=n.useMemo(()=>d.reduce((t,o)=>(t.bookings+=Number(o.bookings||0),t.people+=Number(o.people||0),t.revenue+=Number(o.revenue||0),t),{bookings:0,people:0,revenue:0}),[d]),k=t=>{const o=u.find(v=>v.key===t);o&&(f(t),s(o.from().startOf(i).toISOString()),x(o.to().endOf("day").toISOString()))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{title:"Custom Trend Filters",subtitle:"Compare bookings, people, revenue for any period",children:[e.jsx("div",{className:"flex flex-wrap gap-3 mb-3",children:u.map(t=>e.jsx("button",{onClick:()=>k(t.key),className:`rounded-full border px-3 py-1 text-xs font-semibold ${h===t.key?"bg-gray-900 text-white border-gray-900":"border-gray-200 text-gray-600"}`,children:t.label},t.key))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx("input",{type:"datetime-local",className:"rounded-lg border px-3 py-2 text-sm",value:a(r).format("YYYY-MM-DDTHH:mm"),onChange:t=>s(a(t.target.value).toISOString())}),e.jsx("input",{type:"datetime-local",className:"rounded-lg border px-3 py-2 text-sm",value:a(l).format("YYYY-MM-DDTHH:mm"),onChange:t=>x(a(t.target.value).toISOString())}),e.jsxs("select",{className:"rounded-lg border px-3 py-2 text-sm",value:i,onChange:t=>y(t.target.value),children:[e.jsx("option",{value:"day",children:"Day"}),e.jsx("option",{value:"week",children:"Week"}),e.jsx("option",{value:"month",children:"Month"})]}),e.jsx("a",{href:j,className:"rounded-lg border px-3 py-2 text-sm text-center",children:"Download CSV"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(p,{label:"Total Bookings",value:m.bookings.toLocaleString()}),e.jsx(p,{label:"People",value:m.people.toLocaleString()}),e.jsx(p,{label:"Revenue",value:`â‚¹${m.revenue.toLocaleString()}`})]}),e.jsx(g,{title:"Custom Period Trend",subtitle:"Multi-series view",children:e.jsx("div",{style:{height:360},children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(D,{data:d,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(M,{dataKey:"bucket",tickFormatter:t=>a(t).format(i==="month"?"YYYY-MM":"MM-DD")}),e.jsx(O,{}),e.jsx(Y,{labelFormatter:t=>a(t).format("YYYY-MM-DD")}),e.jsx(R,{}),e.jsx(c,{type:"monotone",dataKey:"bookings",stroke:"#2563eb",name:"Bookings",strokeWidth:2,dot:!1}),e.jsx(c,{type:"monotone",dataKey:"people",stroke:"#10b981",name:"People",strokeWidth:2,dot:!1}),e.jsx(c,{type:"monotone",dataKey:"revenue",stroke:"#f59e0b",name:"Revenue",strokeWidth:2,dot:!1})]})})})})]})}export{E as default};
