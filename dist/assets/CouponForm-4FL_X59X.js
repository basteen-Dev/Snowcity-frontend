import{C as f,B as v,R as m,j as a}from"./index-LUC8W6HM.js";import{a as d,A as c}from"./AdminApp-BAIHpeWj.js";import"./createLucideIcon-BY9DOx5Q.js";import"./file-text-Bc3jcJvJ.js";import"./ticket-xkTq38T-.js";const b=["flat","percent","bogo","specific"];function _(){var x;const{id:n}=f(),u=v(),l=!!n,[o,r]=m.useState({status:l?"loading":"idle",error:null,attractions:[],form:{code:"",description:"",type:"flat",value:0,attraction_id:"",min_amount:0,valid_from:"",valid_to:"",active:!0}});m.useEffect(()=>{(async()=>{try{const t=await d.get(c.attractions()),e=Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t)?t:[];r(i=>({...i,attractions:e}))}catch{}})()},[]),m.useEffect(()=>{l&&(async()=>{try{const t=await d.get(`${c.coupons()}/${n}`),e=(t==null?void 0:t.coupon)||t||{};r(i=>({...i,status:"idle",form:{code:e.code||"",description:e.description||"",type:e.type||"flat",value:Number(e.value||0),attraction_id:e.attraction_id||"",min_amount:Number(e.min_amount||0),valid_from:e.valid_from||"",valid_to:e.valid_to||"",active:!!e.active}}))}catch(t){r(e=>({...e,status:"failed",error:t}))}})()},[n,l]);const p=async t=>{t.preventDefault();try{const e={...o.form,value:Number(o.form.value||0),min_amount:Number(o.form.min_amount||0),attraction_id:o.form.attraction_id||null};l?await d.put(`${c.coupons()}/${n}`,e):await d.post(c.coupons(),e),u("/admin/catalog/coupons")}catch(e){r(i=>({...i,error:e}))}};if(o.status==="loading")return a.jsx("div",{children:"Loadingâ€¦"});if(o.status==="failed")return a.jsx("div",{className:"text-red-600",children:((x=o.error)==null?void 0:x.message)||"Failed to load"});const s=o.form;return a.jsxs("form",{onSubmit:p,className:"max-w-2xl bg-white border rounded-xl p-4",children:[a.jsxs("h1",{className:"text-xl font-semibold mb-4",children:[l?"Edit":"New"," Coupon"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Code"}),a.jsx("input",{className:"w-full rounded-md border px-3 py-2",value:s.code,onChange:t=>r(e=>({...e,form:{...e.form,code:t.target.value.toUpperCase()}})),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Type"}),a.jsx("select",{className:"w-full rounded-md border px-3 py-2",value:s.type,onChange:t=>r(e=>({...e,form:{...e.form,type:t.target.value}})),children:b.map(t=>a.jsx("option",{value:t,children:t},t))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Value"}),a.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2",value:s.value,onChange:t=>r(e=>({...e,form:{...e.form,value:Number(t.target.value||0)}}))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Min Amount"}),a.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2",value:s.min_amount,onChange:t=>r(e=>({...e,form:{...e.form,min_amount:Number(t.target.value||0)}}))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Attraction (optional)"}),a.jsxs("select",{className:"w-full rounded-md border px-3 py-2",value:s.attraction_id||"",onChange:t=>r(e=>({...e,form:{...e.form,attraction_id:t.target.value}})),children:[a.jsx("option",{value:"",children:"All attractions"}),(o.attractions||[]).map(t=>a.jsx("option",{value:t.attraction_id,children:t.title},t.attraction_id))]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{id:"active",type:"checkbox",checked:!!s.active,onChange:t=>r(e=>({...e,form:{...e.form,active:t.target.checked}}))}),a.jsx("label",{htmlFor:"active",className:"text-sm text-gray-700",children:"Active"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Valid From"}),a.jsx("input",{type:"date",className:"w-full rounded-md border px-3 py-2",value:s.valid_from||"",onChange:t=>r(e=>({...e,form:{...e.form,valid_from:t.target.value}}))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Valid To"}),a.jsx("input",{type:"date",className:"w-full rounded-md border px-3 py-2",value:s.valid_to||"",onChange:t=>r(e=>({...e,form:{...e.form,valid_to:t.target.value}}))})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Description"}),a.jsx("textarea",{rows:4,className:"w-full rounded-md border px-3 py-2",value:s.description,onChange:t=>r(e=>({...e,form:{...e.form,description:t.target.value}}))})]})]}),a.jsxs("div",{className:"mt-4 flex gap-2",children:[a.jsx("button",{type:"submit",className:"rounded-md bg-gray-900 text-white px-4 py-2 text-sm",children:"Save"}),a.jsx("button",{type:"button",className:"rounded-md border px-4 py-2 text-sm",onClick:()=>u(-1),children:"Cancel"})]})]})}export{_ as default};
