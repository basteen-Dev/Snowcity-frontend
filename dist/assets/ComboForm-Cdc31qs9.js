import{C as U,A as V,R as j,j as e}from"./index-DpUnVvi7.js";import{a as b,A as g}from"./AdminApp-DElutmvv.js";import{I as D}from"./ImageUploader-8sQNEsRz.js";import"./createLucideIcon-DlloiUI2.js";import"./file-text-BcxeLTgw.js";import"./users-Dj4zQjFo.js";import"./newspaper-D6LH_a5a.js";import"./ticket-DJwTfedz.js";import"./chevron-down-BM4ufvPU.js";import"./media-CQLQFIy8.js";function X(){var k,N,y,w,C,A,S,E,P;const{id:u}=U(),_=V(),m=!!u,[o,i]=j.useState({status:m?"loading":"idle",error:null,attractions:[],form:{name:"",slug:"",attraction_ids:m?[]:["",""],attraction_prices:{},total_price:0,image_url:"",image_alt:"",desktop_image_url:"",desktop_image_alt:"",discount_percent:0,active:!0,meta_title:"",short_description:""}});j.useEffect(()=>{(async()=>{try{const a=await b.get(g.attractions()),t=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];i(r=>({...r,attractions:t}))}catch{}})()},[]),j.useEffect(()=>{m&&(async()=>{try{const a=await b.get(g.comboById(u)),t=(a==null?void 0:a.combo)||a||{};let r={name:t.name||"",slug:t.slug||"",attraction_ids:[],attraction_prices:{},total_price:0,image_url:t.image_url||"",image_alt:t.image_alt||"",desktop_image_url:t.desktop_image_url||"",desktop_image_alt:t.desktop_image_alt||"",discount_percent:t.discount_percent||0,active:!!t.active,meta_title:t.meta_title||"",short_description:t.short_description||""};t.attraction_1_id&&t.attraction_2_id?(r.attraction_ids=[t.attraction_1_id,t.attraction_2_id],r.attraction_prices={[t.attraction_1_id]:(t.combo_price||0)/2,[t.attraction_2_id]:(t.combo_price||0)/2},r.total_price=t.combo_price||0):(r.attraction_ids=t.attraction_ids||[],r.attraction_prices=t.attraction_prices||{},r.total_price=Number(t.total_price||0)),i(n=>({...n,status:"idle",form:r}))}catch(a){i(t=>({...t,status:"failed",error:a}))}})()},[u,m]);const F=async a=>{var t,r,n,d,c,x;a.preventDefault();try{const s=o.form;if(!s.name||s.name.trim()===""){alert("Please enter a combo name");return}if(!s.attraction_ids||s.attraction_ids.length<2){alert("Select at least two attractions");return}for(const f of s.attraction_ids)if(!s.attraction_prices[f]||s.attraction_prices[f]<=0){const v=o.attractions.find(L=>L.attraction_id===f);alert(`Please set a valid price for ${(v==null?void 0:v.title)||"attraction"}`);return}const p={name:s.name.trim(),slug:((t=s.slug)==null?void 0:t.trim())||null,attraction_ids:s.attraction_ids,attraction_prices:s.attraction_prices,total_price:Number(s.total_price||0),image_url:((r=s.image_url)==null?void 0:r.trim())||null,desktop_image_url:((n=s.desktop_image_url)==null?void 0:n.trim())||null,discount_percent:Number(s.discount_percent||0),active:!!s.active,meta_title:((d=s.meta_title)==null?void 0:d.trim())||null,short_description:((c=s.short_description)==null?void 0:c.trim())||null};m?await b.put(g.comboById(u),p):await b.post(g.combos(),p),_("/admin/catalog/combos")}catch(s){console.error("Combo save error:",s),console.error("Error data:",s==null?void 0:s.data),console.error("Error status:",s==null?void 0:s.status),console.error("Error details:",(x=s==null?void 0:s.data)==null?void 0:x.details),i(p=>({...p,error:s}))}};if(o.status==="loading")return e.jsx("div",{children:"Loading…"});if(o.status==="failed")return e.jsx("div",{className:"text-red-600",children:((k=o.error)==null?void 0:k.message)||"Failed to load"});if(o.error&&o.error!=="Failed to load")return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error"}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsx("div",{className:"text-red-800 font-semibold mb-2",children:((y=(N=o.error)==null?void 0:N.data)==null?void 0:y.error)||"Save Failed"}),e.jsx("div",{className:"text-red-700 text-sm mb-2",children:((C=(w=o.error)==null?void 0:w.data)==null?void 0:C.message)||((A=o.error)==null?void 0:A.message)}),((E=(S=o.error)==null?void 0:S.data)==null?void 0:E.details)&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-red-800 font-medium text-sm mb-1",children:"Validation Details:"}),e.jsx("ul",{className:"text-red-700 text-sm list-disc list-inside",children:o.error.data.details.map((a,t)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[a.field,":"]})," ",a.message,a.value!==void 0&&e.jsxs("span",{className:"text-red-600 ml-1",children:["(value: ",JSON.stringify(a.value),")"]})]},t))})]}),e.jsx("button",{onClick:()=>i(a=>({...a,error:null})),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Dismiss"})]})]});const l=o.form,I=o.attractions||[],R=()=>{i(a=>({...a,form:{...a.form,attraction_ids:[...a.form.attraction_ids,""]}}))},T=a=>{const t=o.form.attraction_ids.filter((n,d)=>d!==a),r={...o.form.attraction_prices};delete r[o.form.attraction_ids[a]],i(n=>({...n,form:{...n.form,attraction_ids:t,attraction_prices:r}})),h(t,r)},O=(a,t)=>{const r=o.form.attraction_ids[a],n=[...o.form.attraction_ids];n[a]=t;const d={...o.form.attraction_prices};if(r&&r!==t&&delete d[r],t&&!d[t]){const c=o.attractions.find(x=>x.attraction_id===t);d[t]=(c==null?void 0:c.price)||0}i(c=>({...c,form:{...c.form,attraction_ids:n,attraction_prices:d}})),h(n,d)},B=(a,t)=>{const r={...o.form.attraction_prices,[a]:Number(t||0)};i(n=>({...n,form:{...n.form,attraction_prices:r}})),h(o.form.attraction_ids,r)},h=(a,t)=>{const r=a.reduce((n,d)=>n+(Number(t[d])||0),0);i(n=>({...n,form:{...n.form,total_price:r}}))};return e.jsxs("form",{onSubmit:F,className:"max-w-4xl bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-4",children:[e.jsxs("h1",{className:"text-xl font-semibold mb-4",children:[m?"Edit":"New"," Combo"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Combo Name *"}),e.jsx("input",{type:"text",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.name,onChange:a=>i(t=>({...t,form:{...t.form,name:a.target.value}})),placeholder:"Enter combo name",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Slug (URL-friendly identifier)"}),e.jsx("input",{type:"text",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.slug,onChange:a=>i(t=>({...t,form:{...t.form,slug:a.target.value}})),placeholder:"auto-generated-from-name"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:"Leave empty to auto-generate from name. Used in URLs like /combo-your-slug-here"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Short Description (for lists/previews)"}),e.jsx("textarea",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",rows:2,value:l.short_description,onChange:a=>i(t=>({...t,form:{...t.form,short_description:a.target.value}})),placeholder:"Brief summary of the combo"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Meta Title (SEO title)"}),e.jsx("input",{type:"text",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.meta_title,onChange:a=>i(t=>({...t,form:{...t.form,meta_title:a.target.value}})),placeholder:"Custom page title for SEO (leave empty to use default)"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:"Optional custom title for search engines and browser tabs"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300",children:"Attractions *"}),e.jsx("button",{type:"button",onClick:R,className:"text-sm bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700",children:"+ Add Attraction"})]}),l.attraction_ids.length===0&&e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"No attractions selected. Add at least 2 attractions."}),l.attraction_ids.map((a,t)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("select",{className:"flex-1 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:a,onChange:r=>O(t,r.target.value),children:[e.jsx("option",{value:"",children:"— Select attraction —"}),I.map(r=>e.jsx("option",{value:r.attraction_id,disabled:l.attraction_ids.includes(String(r.attraction_id))&&String(r.attraction_id)!==a,children:r.title},r.attraction_id))]}),a&&e.jsx("input",{type:"number",className:"w-32 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.attraction_prices[a]||"",onChange:r=>B(a,r.target.value),placeholder:"Price",min:"0",step:"0.01"}),l.attraction_ids.length>2&&e.jsx("button",{type:"button",onClick:()=>T(t),className:"px-2 py-1 text-red-600 border border-red-300 rounded-md hover:bg-red-50",children:"Remove"})]},t)),l.attraction_ids.length>0&&l.attraction_ids.length<2&&e.jsx("div",{className:"text-orange-600 text-sm mt-1",children:"Please select at least 2 attractions"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-neutral-800 rounded-md",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-neutral-300",children:"Total Combo Price"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["₹",Number(l.total_price||0).toFixed(2)]}),l.attraction_ids.length>0&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:["Based on ",l.attraction_ids.length," attraction(s)"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(D,{label:"Combo Image",value:l.image_url,onChange:a=>i(t=>({...t,form:{...t.form,image_url:a}})),altText:l.image_alt,onAltChange:a=>i(t=>({...t,form:{...t.form,image_alt:a}})),folder:"combos"})}),e.jsx("div",{className:"mb-4",children:e.jsx(D,{label:"Desktop Image (optional)",value:l.desktop_image_url,onChange:a=>i(t=>({...t,form:{...t.form,desktop_image_url:a}})),altText:l.desktop_image_alt,onAltChange:a=>i(t=>({...t,form:{...t.form,desktop_image_alt:a}})),folder:"combos"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Discount %"}),e.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.discount_percent,onChange:a=>i(t=>({...t,form:{...t.form,discount_percent:Number(a.target.value||0)}})),min:"0",max:"100"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"active",type:"checkbox",checked:!!l.active,onChange:a=>i(t=>({...t,form:{...t.form,active:a.target.checked}}))}),e.jsx("label",{htmlFor:"active",className:"text-sm text-gray-700 dark:text-neutral-200",children:"Active"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Override Total Price (optional)"}),e.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.total_price,onChange:a=>i(t=>({...t,form:{...t.form,total_price:Number(a.target.value||0)}})),min:"0",step:"0.01"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:"Automatically sums attraction prices; adjust if needed."})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{type:"submit",className:"rounded-md bg-gray-900 text-white px-4 py-2 text-sm",children:"Save"}),m&&e.jsx("button",{type:"button",className:"rounded-md bg-blue-600 text-white px-4 py-2 text-sm hover:bg-blue-700",onClick:()=>_(`/admin/catalog/combo-slots?combo_id=${u}`),children:"View Slots"}),e.jsx("button",{type:"button",className:"rounded-md border px-4 py-2 text-sm",onClick:()=>_(-1),children:"Cancel"})]}),o.error?e.jsx("div",{className:"mt-2 text-sm text-red-600",children:((P=o.error)==null?void 0:P.message)||"Error"}):null]})}export{X as default};
