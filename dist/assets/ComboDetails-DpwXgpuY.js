import{r as Pe,j as e,C as mt,A as xt,h as ft,R as u,u as Te,t as ht,q as gt,k as W,i as re,D as p,z as ne,L as pt,E as yt,F as bt,G as jt}from"./index-DpUnVvi7.js";import{E as Q}from"./ErrorState-maGIkZl4.js";import{G as He}from"./GalleryViewer-zY-4gTil.js";import{i as O}from"./media-CQLQFIy8.js";import{f as w}from"./formatters-CmiLqhJj.js";import{g as _t,a as Nt,d as vt,c as Le,b as wt}from"./pricing-Df4qX4St.js";import{X as Mt}from"./x-DjnihLtx.js";import"./createLucideIcon-DlloiUI2.js";function kt({items:t=[],className:i=""}){const[c,o]=Pe.useState(!1),[d,f]=Pe.useState(0),m=g=>{f(g),o(!0)},j=()=>{o(!1)};return t.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 ${i}`,children:t.map((g,b)=>{const _=String(g.media_type||"").toLowerCase()==="video",D=_?O(g.media_url||g.url||g):O(g.image_url||g.url||g),N=O(g.thumbnail||g.poster_url||null);return D?e.jsx("div",{className:"group relative overflow-hidden rounded-lg cursor-pointer",onClick:()=>m(b),children:e.jsxs("div",{className:"aspect-square relative",children:[_?e.jsxs(e.Fragment,{children:[e.jsx("video",{className:"w-full h-full object-cover",src:D,poster:N||void 0,muted:!0,preload:"metadata"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/90 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-gray-800 ml-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})})})})]}):e.jsx("img",{src:D,alt:g.image_alt||g.title||"Gallery item",className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy",decoding:"async"}),e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 rounded-full bg-black/50 text-white text-xs flex items-center justify-center font-medium",children:b+1}),g.title&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:e.jsx("div",{className:"text-white text-xs font-medium truncate",children:g.title})})]})},g.gallery_item_id||g.id||b):null})}),c&&e.jsx(He,{items:t,initialIndex:d,onClose:j})]}):e.jsx("div",{className:"py-8 text-center text-gray-500",children:"No gallery items available."})}const be="https://picsum.photos/seed/combo-hero/1920/800",Oe="https://picsum.photos/seed/combo-hero/800/600",Yt=be,ze=(t,i=!1)=>i?`https://picsum.photos/seed/${t}/1920/800`:`https://picsum.photos/seed/${t}/640/400`,Ct=t=>p(t).format("YYYY-MM-DD"),Dt=t=>(t==null?void 0:t.id)??(t==null?void 0:t._id)??(t==null?void 0:t.attraction_id)??null,Ge=t=>{if(!t)return"";const[i="0",c="0"]=String(t).split(":"),o=Number(i),d=Number(c);if(!Number.isFinite(o)||!Number.isFinite(d))return"";const f=o>=12?"PM":"AM",m=o%12||12,j=d.toString().padStart(2,"0");return`${m}:${j} ${f}`},Re=t=>t?String(t).slice(0,5):"",ie=t=>{const i=Ge(t==null?void 0:t.start_time),c=Ge(t==null?void 0:t.end_time);if(i&&c)return`${i} → ${c}`;const o=Re(t==null?void 0:t.start_time),d=Re(t==null?void 0:t.end_time);return o&&d?`${o} → ${d}`:""},ge=t=>{if(!t||typeof t!="string")return null;const[i="0",c="0"]=t.split(":"),o=Number(i),d=Number(c);return!Number.isFinite(o)||!Number.isFinite(d)?null:o*60+d},St=(t={},i)=>{if(!t.day_type)return!0;const c=p(i).day(),o=String(t.day_type).toLowerCase();return o==="weekday"?c>=1&&c<=5:o==="weekend"?c===0||c===6:o==="custom"&&Array.isArray(t.specific_days)?t.specific_days.map(Number).includes(c):!0},Ve=t=>String(t||"").toLowerCase(),Ke=(t,i)=>t==null||i==null?!1:String(t)===String(i),It=t=>{if(typeof t=="boolean")return t;if(t==null)return!1;if(typeof t=="number")return t!==0;const i=String(t).trim().toLowerCase();return i?["true","1","yes","y"].includes(i)?!0:["false","0","no","n"].includes(i)?!1:!!t:!1},At=(t={},i=null)=>{if(!i)return!(t.slot_id!=null||Array.isArray(t.slot_ids)&&t.slot_ids.length||t.specific_time||t.time_from&&t.time_to);const c=[];if(t.slot_id!=null&&c.push(t.slot_id),Array.isArray(t.slot_ids)&&c.push(...t.slot_ids),t.target_slot_id!=null&&c.push(t.target_slot_id),c.length){const d=[i.slot_id,i.id,i._id,i.combo_slot_id].filter(m=>m!=null);if(!c.some(m=>d.some(j=>Ke(m,j))))return!1}const o=i.start_time||i.time||i.startTime||null;if(t.specific_time&&o&&o.slice(0,5)!==String(t.specific_time).slice(0,5))return!1;if(t.time_from&&t.time_to&&o){const d=ge(o),f=ge(t.time_from),m=ge(t.time_to);if(d==null||f==null||m==null||d<f||d>m)return!1}return!0},Et=(t,{targetType:i,targetId:c,date:o,slot:d})=>{if(!t||!i||!c)return!1;const f=p(o).format("YYYY-MM-DD"),m=Ve(t.target_type),j=Ve(i);if(m&&j&&m!==j)return!1;if(!It(t.applies_to_all)){const b=[];if(t.target_id!=null&&b.push(t.target_id),Array.isArray(t.target_ids)&&b.push(...t.target_ids),!b.length||!b.some(_=>Ke(_,c)))return!1}return!(t.specific_date&&f!==t.specific_date||Array.isArray(t.specific_dates)&&t.specific_dates.length&&!t.specific_dates.some(b=>p(b).format("YYYY-MM-DD")===f)||t.date_from&&f<t.date_from||t.date_to&&f>t.date_to||!St(t,f)||!At(t,d))},Ft=(t={},i=null,c=0)=>{const o=Number(c);if(!o||o<=0)return 0;let d=(i==null?void 0:i.rule_discount_type)||t.discount_type||(t.discount_percent?"percent":null),f=(i==null?void 0:i.rule_discount_value)??t.discount_value??t.discount_percent??0;if(!d||!f)return 0;d=String(d).toLowerCase();let m=d==="amount"?Number(f):Number(f)/100*o;return Number.isFinite(Number(t.max_discount))&&(m=Math.min(m,Number(t.max_discount))),m=Math.min(m,o),Math.max(0,m)},$t=(t=[],{targetType:i,targetId:c,date:o,slot:d,basePrice:f})=>{if(!Array.isArray(t)||!t.length||!f||!c)return null;let m=null;return t.forEach(j=>{(Array.isArray(j.rules)&&j.rules.length?j.rules:[null]).forEach(b=>{if(b&&!Et(b,{targetType:i,targetId:c,date:o,slot:d}))return;const _=Ft(j,b,f);if(!_)return;const D=Math.max(0,f-_);(!m||D<m.price)&&(m={offer:j,rule:b,price:D,discount:_})})}),m},pe=(t,i,c)=>{if(!t||typeof t!="object")return{title:i,image_url:ze(c),slug:null,price:0,attraction_id:null};const o=t.title||t.name||i,d=t.desktop_image_url??t.hero_desktop_image??t.hero_image??t.image_media_id??t.media_id??t.cover_media_id??t.banner_media_id??t.url_path??t.image_url??t.cover_image??t.web_image??t.mobile_image??t.image??null,f=O(d,ze(c)),m=t.slug||t.id||t.attraction_id||null,j=Number(t.base_price||t.price||t.amount||0),g=t.attraction_id??t.id??m;return{title:o,image_url:f,slug:m,price:j,attraction_id:g}};function Bt(t,i,c,o=!1){if(i!=null&&i.image_url)return i.image_url;const f=(t==null?void 0:t.banner_media_id)??(t==null?void 0:t.image_media_id)??(t==null?void 0:t.cover_media_id)??(t==null?void 0:t.banner_image)??(t==null?void 0:t.hero_image)??(t==null?void 0:t.image_web)??(t==null?void 0:t.image_url)??(t==null?void 0:t.image)??null,m=O(f,o?be:Oe);return m||(i==null?void 0:i.image_url)||(c==null?void 0:c.image_url)||(o?be:Oe)}const ye=(t,i)=>{if(!t)return!1;const c=p().format("YYYY-MM-DD");if(i===c){const o=p(),d=t.start_time||t.time||null;if(!d)return!0;const[f,m]=d.split(":").map(Number),j=(f||0)*60+(m||0),g=o.hour()*60+o.minute();return j>=g+60}return!0},le=t=>t?String(t.combo_slot_id??t.id??t._id??t.slot_id??`${t.start_time||""}-${t.end_time||""}`):"";function Kt(){var Ee,Fe,$e,Be;const t=mt(),i=(t==null?void 0:t.slug)??(t==null?void 0:t.id)??(t==null?void 0:t.comboId)??(t==null?void 0:t.combo_id)??null,c=xt(),o=ft(),d=u.useMemo(()=>{if(!i||i==="undefined"||i==="null")return null;let s=i;return String(s).startsWith("combo-")&&(s=String(s).substring(6)),s},[i]),{items:f=[],status:m}=Te(s=>s.combos||{items:[],status:"idle"}),{items:j=[],status:g}=Te(s=>s.attractions||{items:[],status:"idle"});u.useEffect(()=>{m==="idle"&&o(ht({active:!0,limit:100})),g==="idle"&&o(gt({active:!0,limit:200}))},[g,m,o]);const b=u.useMemo(()=>{if(!d)return null;const s=Number(d);return Number.isFinite(s)?s:null},[d]),_=u.useMemo(()=>!d||!f.length?null:f.find(s=>String((s==null?void 0:s.combo_id)??(s==null?void 0:s.id)??"")===d)||f.find(s=>d&&(s==null?void 0:s.slug)&&String(s.slug)===d)||null,[f,d]),D=u.useMemo(()=>b??(_!=null&&_.combo_id?Number(_.combo_id):_!=null&&_.id?Number(_.id):null),[_,b]),[N,L]=u.useState({status:"idle",data:null,error:null}),[k,oe]=u.useState({status:"idle",items:[],error:null}),[je,de]=u.useState(null),[_e,X]=u.useState({status:"idle",items:[],error:null}),[Ue,qe]=u.useState(typeof window<"u"?window.innerWidth>=1024:!1);u.useEffect(()=>{if(typeof window>"u")return;const s=()=>qe(window.innerWidth>=1024);return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),u.useEffect(()=>{d?D==null&&(b==null&&(m==="loading"||m==="idle")?L(s=>s.status==="loading"?s:{status:"loading",data:null,error:null}):b==null&&m==="failed"&&L({status:"failed",data:null,error:"Combo not found"})):L({status:"failed",data:null,error:"Combo not found"})},[d,D,b,m]),u.useEffect(()=>{let s=!0;const n=new AbortController;return d?(L({status:"loading",data:null,error:null}),(async()=>{var l;try{const r=b!=null?W.combos.byId(D):W.combos.bySlug(d),x=await re.get(r,{signal:n.signal});if(!s)return;L({status:"succeeded",data:x,error:null}),document.title=(x==null?void 0:x.meta_title)||(x==null?void 0:x.title)||(x==null?void 0:x.name)||"Combo Details"}catch(r){if(r!=null&&r.canceled||!s)return;if((r==null?void 0:r.status)===404||((l=r==null?void 0:r.response)==null?void 0:l.status)===404){c("/404",{replace:!0});return}L({status:"failed",data:null,error:(r==null?void 0:r.message)||"Failed to load combo"})}})()):L({status:"failed",data:null,error:"Combo not found"}),()=>{s=!1,n.abort()}},[d]);const[h,We]=u.useState(p().format("YYYY-MM-DD")),[I,ce]=u.useState(1),[z,Qe]=u.useState([]),[Ne,J]=u.useState(!1),[Xe,Je]=u.useState(null),H=u.useMemo(()=>null,[Xe,Ne]),[Z,ue]=u.useState(0),$=u.useCallback(s=>{We(s),K(n=>({...n,selectedKey:""}))},[]),Ze=u.useCallback(()=>{$(p().format("YYYY-MM-DD"))},[$]),et=u.useCallback(()=>{$(p().add(1,"day").format("YYYY-MM-DD"))},[$]);u.useCallback(()=>{$("")},[$]);const tt=u.useCallback(s=>{s.preventDefault(),s.stopPropagation(),Je(s.currentTarget),J(!0)},[]),st=u.useCallback(s=>{$(s),J(!1)},[$]);u.useMemo(()=>{const s=p().format("YYYY-MM-DD"),n=p().add(1,"day").format("YYYY-MM-DD");return l=>!l||l===s||l===n?"All Days":p(l).format("D MMM")},[]);const[A,K]=u.useState({status:"idle",selectedKey:""}),[ve,we]=u.useState(""),Me=u.useCallback(async()=>{var s;if((s=N.data)!=null&&s.combo_id)try{K(x=>({...x,status:"loading"})),we("");const n=await re.get(W.combos.slots(N.data.combo_id),{params:h?{date:h}:{}}),l=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:[];Qe(l);const r=l.find(x=>ye(x,h))||l[0]||null;K({status:"loaded",selectedKey:r?le(r):""})}catch(n){we((n==null?void 0:n.message)||"Failed to load slots"),K(l=>({...l,status:"failed",selectedKey:""}))}},[(Ee=N.data)==null?void 0:Ee.combo_id,h]);u.useEffect(()=>{var s;(s=N.data)!=null&&s.combo_id&&h&&Me()},[(Fe=N.data)==null?void 0:Fe.combo_id,h,Me]),u.useEffect(()=>{var n;if(!((n=N.data)!=null&&n.combo_id))return X({status:"idle",items:[],error:null}),()=>{};let s=!1;return X(l=>({...l,status:"loading",error:null})),(async()=>{var l;try{const r=await re.get(W.offers.list(),{params:{active:!0,target_type:"combo",target_id:(l=N.data)==null?void 0:l.combo_id}});if(s)return;const x=Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[];X({status:"succeeded",items:x,error:null})}catch(r){if(s)return;X({status:"failed",items:[],error:(r==null?void 0:r.message)||"Failed to load offers"})}})(),()=>{s=!0}},[($e=N.data)==null?void 0:$e.combo_id]),u.useEffect(()=>{var n;if(!((n=N.data)!=null&&n.combo_id))return;let s=!1;return oe(l=>({...l,status:"loading",error:null})),(async()=>{var l;try{const r=await re.get(W.gallery.list(),{params:{active:!0,target_type:"combo",target_ref_id:N.data.combo_id,limit:12}});if(s)return;const x=((l=r==null?void 0:r.data)==null?void 0:l.data)||(Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[]);oe({status:"succeeded",items:x,error:null})}catch(r){if(s)return;oe({status:"failed",items:[],error:(r==null?void 0:r.message)||"Failed to load gallery"})}})(),()=>{s=!0}},[(Be=N.data)==null?void 0:Be.combo_id]);const a=N.data||_,ke=u.useMemo(()=>{if(!a)return[];const s=[a.attraction_1||{title:a==null?void 0:a.attraction_1_title,image_url:a==null?void 0:a.attraction_1_image,slug:a==null?void 0:a.attraction_1_slug,base_price:a==null?void 0:a.attraction_1_price,attraction_id:a==null?void 0:a.attraction_1_id},a.attraction_2||{title:a==null?void 0:a.attraction_2_title,image_url:a==null?void 0:a.attraction_2_image,slug:a==null?void 0:a.attraction_2_slug,base_price:a==null?void 0:a.attraction_2_price,attraction_id:a==null?void 0:a.attraction_2_id}];return Array.isArray(s)?s.filter(Boolean):[]},[a]),S=u.useMemo(()=>{if(!a)return[];if(Array.isArray(a==null?void 0:a.attractions)&&a.attractions.length)return a.attractions.map((n,l)=>pe(n,`Experience ${l+1}`,`combo-${l}`));const s=Array.isArray(a==null?void 0:a.attraction_ids)?a.attraction_ids.filter(Boolean):[];return s.length&&j.length?s.map((n,l)=>{const r=j.find(x=>String(Dt(x))===String(n));return pe(r||{title:`Experience ${l+1}`},`combo-${l}`)}).filter(Boolean):ke.map((n,l)=>pe(n,`Experience ${l+1}`,`combo-${l}`)).filter(Boolean)},[a,j,ke]),[at,rt]=[S[0],S[1]],nt=N.status==="loading"&&!a,B=(a==null?void 0:a.combo_id)||(a==null?void 0:a.id)||D||null,ee=(a==null?void 0:a.name)||(a==null?void 0:a.title)||"Combo Deal",Ye=(a==null?void 0:a.short_description)||(a==null?void 0:a.subtitle)||"",Ce=(a==null?void 0:a.description)||(a==null?void 0:a.long_description)||"",te=Bt(a,at,rt,Ue),M=u.useMemo(()=>{const s=[];return te&&s.push({src:te,alt:"Snow City Banner",isBanner:!0}),k.items.forEach((n,l)=>{const r=n.image_url||n.url||"";r&&s.push({src:r,alt:n.title||`Gallery ${l+1}`,isBanner:!1,item:n,index:l})}),s},[te,k.items]),me=u.useCallback(()=>{ue(s=>(s+1)%M.length)},[M.length]),it=u.useCallback(()=>{ue(s=>(s-1+M.length)%M.length)},[M.length]);u.useEffect(()=>{if(M.length<=1)return;const s=setInterval(me,5e3);return()=>clearInterval(s)},[me,M.length]);const De=(S.length?S:[{title:ee,image_url:Yt}]).slice(0,Math.max(2,Math.min(3,S.length||2))).map(s=>s.title).join(" + "),Se=_t(a),Y=Se>0?Se:Number((a==null?void 0:a.combo_price)||(a==null?void 0:a.total_price)||0),xe=Nt(a),P=xe||S.reduce((s,n)=>s+Number((n==null?void 0:n.price)||0),0),fe=P>0,lt=fe&&Y>0?P-Y:0,se=fe&&Y>0&&Y<P?Math.max(0,Math.round(vt(a)||(P-Y)/P*100)):Number((a==null?void 0:a.discount_percent)||0),ae=u.useCallback(s=>{const n=Number(Y||0),l=Number(xe||P||n),r=Le(s,n),x=wt(s,l),E=r||x||0,F=B?$t(_e.items,{targetType:"combo",targetId:B,date:h,slot:s,basePrice:E}):null,v=F?F.price:r,T=x>v?x-v:0;return{finalPrice:v,originalPrice:x,savings:T,bestOffer:F}},[Y,xe,P,_e.items,B,h]),C=z.find(s=>le(s)===A.selectedKey)||null,y=C?ae(C):null,Ie=Math.max(1,Number(I)||1),G=(y==null?void 0:y.finalPrice)||0,R=(y==null?void 0:y.originalPrice)||Y||0,U=R>0&&G>0&&G<R,ot=U?Math.round((R-G)/R*100):0,dt=Number(G||0)*Ie,Ae=C&&G?G*Ie:null;if(nt)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center bg-white",children:e.jsx(ne,{})});if(N.status==="failed")return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center bg-white px-4",children:e.jsx("div",{className:"max-w-lg w-full",children:e.jsx(Q,{message:N.error||"Combo not found"})})});if(!a)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center bg-white px-4",children:e.jsx("div",{className:"max-w-lg w-full",children:e.jsx(Q,{message:"Combo not found"})})});const he=(s,n)=>{var v,T,q,V;const l=Math.max(1,Number(I)||1),r=n||ae(s),x=(r==null?void 0:r.finalPrice)??Le(s,Y),E=(s==null?void 0:s.combo_slot_id)??(s==null?void 0:s.id)??(s==null?void 0:s._id)??null;if(!E)return;o(yt({itemType:"combo",comboId:Number(B)||B,combo:a,date:h,booking_date:Ct(h),booking_time:(s==null?void 0:s.start_time)||(s==null?void 0:s.startTime)||(s==null?void 0:s.slot_start_time)||null,comboSlotId:E,slot:s,qty:l,unitPrice:x,title:(a==null?void 0:a.title)||(a==null?void 0:a.name)||(a==null?void 0:a.combo_name)||`Combo #${B}`,slotLabel:ie(s),dateLabel:p(h).format("DD MMM YYYY"),meta:{title:(a==null?void 0:a.title)||(a==null?void 0:a.name)||(a==null?void 0:a.combo_name)||`Combo #${B}`,start_time:s==null?void 0:s.start_time,end_time:s==null?void 0:s.end_time,capacity:s==null?void 0:s.capacity,available:s==null?void 0:s.available},offer_id:(T=(v=r==null?void 0:r.bestOffer)==null?void 0:v.offer)==null?void 0:T.offer_id,offer_rule_id:(V=(q=r==null?void 0:r.bestOffer)==null?void 0:q.rule)==null?void 0:V.rule_id})),bt.success("Added to your booking!"),o(jt(1));const F=new URLSearchParams({type:"combo",combo_id:String(B),date:h,slot:le(s),qty:String(l)});sessionStorage.removeItem("snowcity_booking_state"),c(`/booking?${F.toString()}`)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#e0f2fe] via-[#bae6fd] to-white font-sans",children:[e.jsxs("section",{className:"mt-0 bg-transparent",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-4 pt-6 space-y-4",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900",style:{fontFamily:"Inter, sans-serif"},children:ee}),e.jsx("div",{className:"overflow-hidden shadow-lg bg-gray-100 relative",children:M.length>0?e.jsxs("div",{className:"relative h-[420px] w-full overflow-hidden",children:[e.jsxs("button",{type:"button",className:"relative w-full h-full group",onClick:()=>{const s=M[Z];s.isBanner?k.items.length>0&&de(0):de(s.index)},children:[e.jsx("img",{src:M[Z].src,alt:M[Z].alt,className:"w-full h-full object-cover transition-opacity duration-500 brightness-[0.95]",loading:"lazy",draggable:"false"}),e.jsx("div",{className:"absolute inset-x-0 top-0 h-32 bg-gradient-to-b from-black/50 via-black/10 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 flex items-start justify-start p-6",children:e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white drop-shadow-lg",style:{fontFamily:"Inter, sans-serif",color:"#87CEEB",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:ee})})]}),M.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:it,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors","aria-label":"Previous image",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{type:"button",onClick:me,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors","aria-label":"Next image",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),M.length>1&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2",children:M.map((s,n)=>e.jsx("button",{type:"button",onClick:()=>ue(n),className:`w-2 h-2 rounded-full transition-colors ${n===Z?"bg-white":"bg-white/50"}`,"aria-label":`Go to image ${n+1}`},n))})]}):e.jsx("div",{className:"h-[420px] w-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500",children:"No images available"})})})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"}),e.jsx("div",{className:"absolute bottom-6 left-0 right-0 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur px-3 py-1 rounded-full text-xs uppercase tracking-wide text-gray-100 mb-2",children:[e.jsx("span",{children:"Combo Deal"}),se>0?e.jsxs("span",{children:["Save ",se,"%"]}):null]}),e.jsx("h1",{className:"text-3xl md:text-5xl font-bold text-white drop-shadow",style:{fontFamily:"Inter, sans-serif",color:"#87CEEB"},children:ee}),Ye?e.jsx("p",{className:"text-gray-200 text-sm md:text-base max-w-2xl mt-2",style:{fontFamily:"Inter, sans-serif"},children:Ye}):null,!te&&De?e.jsx("p",{className:"text-xs uppercase tracking-[0.25em] text-gray-200 mt-3 line-clamp-2",children:De}):null]})})]}),k.items.length>0?e.jsx("section",{className:"max-w-6xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 md:p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",style:{fontFamily:"Inter, sans-serif",color:"#87CEEB"},children:"Photo Gallery"}),k.status==="loading"?e.jsx("div",{className:"py-8 text-center",children:e.jsx(ne,{})}):k.status==="failed"?e.jsx("div",{className:"py-8 text-center",children:e.jsx(Q,{message:k.error})}):e.jsx(kt,{items:k.items})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 md:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",style:{fontFamily:"Inter, sans-serif"},children:"Gallery Preview"}),e.jsx("div",{className:"space-y-3",children:k.items.slice(0,3).map((s,n)=>{const l=String(s.media_type||"").toLowerCase()==="video",r=l?O(s.media_url||s.url||s):O(s.image_url||s.url||s);return e.jsxs("div",{className:"relative group",children:[l?e.jsx("video",{className:"w-full h-32 object-cover rounded-lg",src:r,muted:!0,preload:"metadata"}):e.jsx("img",{src:r,alt:s.title||"Gallery item",className:"w-full h-32 object-cover rounded-lg transition-transform duration-300 group-hover:scale-105",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsxs("span",{className:"text-white text-sm font-medium",children:["+",k.items.length-3," more"]})})]},s.gallery_item_id||s.id||n)})})]})})]})}):null,e.jsx("section",{className:"max-w-6xl mx-auto px-4 py-8 md:py-12",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-10 md:gap-12",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[S.length>0&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map((s,n)=>e.jsxs("figure",{className:"relative rounded-2xl overflow-hidden shadow-sm bg-white",children:[e.jsx("img",{src:s.image_url,alt:s.title,className:"w-full h-60 md:h-64 object-cover",loading:"lazy"}),e.jsxs("figcaption",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/75 to-transparent p-4 text-white",children:[e.jsxs("p",{className:"text-[11px] uppercase tracking-wide text-gray-300",children:["Experience ",n+1]}),e.jsx("h2",{className:"text-lg font-semibold line-clamp-2",style:{fontFamily:"Inter, sans-serif"},children:s.title}),s.price?e.jsxs("p",{className:"text-xs text-gray-200 mt-1",children:["Base price: ",w(s.price)]}):null]})]},`included-${n}`))}),Ce?e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 md:p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",style:{fontFamily:"Inter, sans-serif",color:"#87CEEB"},children:"About this combo"}),e.jsx("div",{className:"prose prose-sm md:prose max-w-none text-gray-700 leading-relaxed",style:{textAlign:"left",fontFamily:"Inter, sans-serif"},dangerouslySetInnerHTML:{__html:Ce}})]}):null,e.jsxs("div",{id:"availability",className:"rounded-2xl border shadow-sm p-4 md:p-5 bg-white",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-3",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-gray-900",children:"All time slots"}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:e.jsxs("span",{children:[p(h).format("DD MMM YYYY")," • ",I," ticket",I>1?"s":""]})})]}),A.status==="loading"?e.jsx("div",{className:"py-3",children:e.jsx(ne,{size:"sm"})}):null,A.status==="failed"?e.jsx("div",{className:"py-3",children:e.jsx(Q,{message:ve||"Failed to load slots"})}):null,A.status==="loaded"&&e.jsx(e.Fragment,{children:z.length?e.jsx("div",{className:"space-y-2",children:z.filter(s=>ye(s,h)).map(s=>{const n=ie(s),l=ae(s),r=l.finalPrice,x=l.originalPrice,E=x>0&&r>=0&&r<x,F=E&&x?Math.max(0,Math.round((x-r)/x*100)):null,v=(s==null?void 0:s.available)===0||(s==null?void 0:s.capacity)===0;return e.jsxs("div",{className:`flex items-center justify-between rounded-xl border px-4 py-3 shadow-sm ${v?"opacity-50 bg-gray-100 border-gray-200":"bg-white border-gray-200 hover:border-blue-300 hover:shadow-md transition-all"}`,children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"font-semibold text-base text-gray-900",children:n||"Time slot"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Capacity: ",s.capacity," •"," ",s.available?"Available":"Unavailable"]}),E?e.jsxs("span",{className:"text-sm text-emerald-600 font-medium mt-1",children:[w(r)," ",e.jsx("span",{className:"line-through text-gray-400 ml-1",children:w(x)})]}):e.jsx("span",{className:"text-sm text-gray-700 mt-1",children:w(r)}),E&&e.jsxs("span",{className:"text-[11px] font-semibold text-emerald-600 mt-0.5",children:["Save ",F,"%"]})]}),e.jsx("button",{type:"button",disabled:v,onClick:()=>he(s,l),className:`px-4 py-2 rounded-full border text-sm font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${v?"opacity-50 cursor-not-allowed bg-gray-100 border-gray-200 text-gray-400":"bg-[#003de6] text-white border-[#003de6] hover:bg-[#002db3]"}`,children:"Book this slot"})]},s.combo_slot_id||`${s.combo_id}-${s.start_time}-${s.end_time}`)})}):e.jsxs("div",{className:"text-sm text-gray-500",children:["No slots available for"," ",p(h).format("DD MMM YYYY"),"."]})})]})]}),e.jsx("aside",{className:"lg:col-span-1",children:e.jsxs("div",{className:"rounded-3xl border shadow-lg bg-white p-6 sticky top-24 space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:"Combo price"}),e.jsxs("div",{className:"flex items-baseline gap-2 mt-1",children:[e.jsx("span",{className:"text-3xl font-semibold text-gray-900",children:w(Y)}),e.jsx("span",{className:"text-sm text-gray-500",children:"per combo"})]}),fe&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("span",{className:"line-through mr-2",children:w(P)}),se>0?e.jsxs("span",{className:"text-emerald-600 font-medium",children:["Save ",se,"% (",w(lt),")"]}):e.jsxs("span",{children:["Special pricing across"," ",S.length||2," experiences"]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",style:{fontFamily:"Inter, sans-serif"},children:"Select Date"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:Ze,className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${h===p().format("YYYY-MM-DD")?"bg-[#003de6] text-white border-[#003de6]":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,style:{fontFamily:"Inter, sans-serif"},children:"Today"}),e.jsx("button",{type:"button",onClick:et,className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${h===p().add(1,"day").format("YYYY-MM-DD")?"bg-[#003de6] text-white border-[#003de6]":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,style:{fontFamily:"Inter, sans-serif"},children:"Tomorrow"}),e.jsx("button",{type:"button",onClick:tt,className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${h&&h!==""&&h!==p().format("YYYY-MM-DD")&&h!==p().add(1,"day").format("YYYY-MM-DD")?"bg-[#003de6] text-white border-[#003de6]":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,style:{fontFamily:"Inter, sans-serif"},children:h&&h!==""&&h!==p().format("YYYY-MM-DD")&&h!==p().add(1,"day").format("YYYY-MM-DD")?p(h).format("D MMM"):"All Days"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",style:{fontFamily:"Inter, sans-serif"},children:"Select Time Slot"}),A.status==="loading"?e.jsx("div",{className:"py-2",children:e.jsx(ne,{size:"sm"})}):A.status==="failed"?e.jsx(Q,{message:ve||"Failed to load slots"}):e.jsx("select",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2.5 text-sm font-medium text-gray-900 outline-none",value:A.selectedKey,onChange:s=>K(n=>({...n,selectedKey:s.target.value})),disabled:!z.length,style:{fontFamily:"Inter, sans-serif"},children:z.length?e.jsxs(e.Fragment,{children:[!A.selectedKey&&e.jsx("option",{value:"",children:"Select slot"}),z.filter(s=>ye(s,h)).map(s=>{const n=le(s),l=ae(s),r=ie(s)||"Slot",x=(l==null?void 0:l.finalPrice)!=null?` • ${w(l.finalPrice)}`:"";return e.jsxs("option",{value:n,children:[r,x]},n)})]}):e.jsx("option",{children:"No slots"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",style:{fontFamily:"Inter, sans-serif"},children:"Number of Tickets"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",className:"w-8 h-8 text-sm rounded-full border border-gray-300 flex items-center justify-center",onClick:()=>ce(s=>Math.max(1,Number(s||1)-1)),children:"-"}),e.jsx("input",{type:"number",min:1,value:I,onChange:s=>ce(Math.max(1,Number(s.target.value)||1)),className:"w-16 text-center border border-gray-300 rounded-lg px-2 py-1 text-sm",style:{fontFamily:"Inter, sans-serif"}}),e.jsx("button",{type:"button",className:"w-8 h-8 text-sm rounded-full border border-gray-300 flex items-center justify-center",onClick:()=>ce(s=>Math.max(1,Number(s||1)+1)),children:"+"})]})]}),h&&C&&e.jsxs("div",{className:"mt-4 rounded-2xl border border-sky-100 bg-sky-50 px-4 py-3 text-sm flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-gray-700",children:[e.jsx("span",{className:"font-semibold",style:{fontFamily:"Inter, sans-serif"},children:"Selection:"}),e.jsxs("span",{className:"font-medium text-right",children:[p(h).format("DD MMM YYYY")," ",e.jsx("br",{})," ",ie(C)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-gray-700 pt-2 border-t border-sky-200 border-dashed",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"rupee",children:[I," × ",w((y==null?void 0:y.finalPrice)||Y||0)]})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-gray-900 font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"rupee",children:w(((y==null?void 0:y.finalPrice)||Y||0)*I)})]})]}),!h||!C?e.jsx("div",{className:"mt-4 rounded-2xl border bg-gray-50 px-3 py-2 text-sm text-center text-gray-500",children:"Please select a date and time slot to book."}):null,e.jsx("button",{type:"button",className:"w-full inline-flex items-center justify-center rounded-xl bg-[#003de6] text-white px-6 py-2.5 text-sm font-semibold shadow-md hover:bg-[#002db3] disabled:opacity-60 disabled:cursor-not-allowed",disabled:!C||A.status==="loading",onClick:()=>{C&&he(C,y)},style:{fontFamily:"Inter, sans-serif"},children:y!=null&&y.finalPrice?`Book Now • ${w(y.finalPrice*I)}`:"Book Now"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("p",{children:["Includes admission for"," ",S.length||2," attraction(s). Book together to lock in bundled savings."]}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:S.map((s,n)=>e.jsx("li",{children:s.title},`sidebar-attr-${n}`))})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("a",{href:"#availability",className:"inline-flex items-center justify-center rounded-full bg-[#003de6] text-white px-6 py-3 text-sm font-medium hover:bg-[#002db3]",children:"View all time slots"}),e.jsx(pt,{to:"/combos",className:"inline-flex items-center justify-center rounded-full border border-blue-100 text-blue-600 px-6 py-3 text-sm font-medium hover:bg-blue-50",children:"Explore other combos"})]})]})})]})}),e.jsx("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-[70] border-t border-gray-200 bg-white/95 backdrop-blur",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-3 pb-[calc(env(safe-area-inset-bottom)+12px)]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",children:U?"Offer price":"Base price"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900 rupee",children:w(U?(y==null?void 0:y.finalPrice)||0:R||(y==null?void 0:y.finalPrice)||0)}),U?e.jsx("div",{className:"text-sm text-gray-400 line-through rupee",children:w(R||0)}):null,U?e.jsxs("div",{className:"text-xs font-semibold text-emerald-600",children:["Save ",ot,"%"]}):null]}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[I," ticket",I>1?"s":""," • Total"," ",e.jsx("span",{className:"rupee font-semibold text-gray-800",children:w(dt||0)})]})]}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-xl bg-[#003de6] text-white px-6 py-2.5 text-sm font-semibold shadow-md hover:bg-[#002db3] disabled:opacity-60 disabled:cursor-not-allowed",disabled:!C||A.status==="loading",onClick:()=>{C&&he(C,y)},children:Ae?e.jsxs(e.Fragment,{children:["Book •"," ",e.jsx("span",{className:"ml-1 rupee",children:w(Ae)})]}):"Book Now"})]})})}),Ne&&e.jsxs("div",{className:"fixed inset-0 z-[80] flex",onClick:()=>J(!1),children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"absolute bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 w-80 max-h-[70vh] overflow-y-auto",style:{top:H?`${H.top}px`:"50%",left:H?`${H.left-160}px`:"50%",transform:H?"none":"translate(-50%, -50%)"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Select Date"}),e.jsx("button",{type:"button",onClick:()=>J(!1),className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 transition-colors",children:e.jsx(Mt,{size:18})})]}),e.jsx("div",{className:"space-y-3",children:[0,1,2].map(s=>{const n=p().add(s,"month"),l=n.startOf("month"),r=n.endOf("month"),x=l.day(),E=r.date(),F=p();return e.jsxs("div",{className:"border border-gray-100 rounded-xl p-3 bg-white",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:n.format("MMMM YYYY")})}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-xs text-gray-500 mb-2",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(v=>e.jsx("div",{className:"py-1 font-medium",children:v},v))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-sm",children:[Array.from({length:x}).map((v,T)=>e.jsx("div",{},`pad-${T}`)),Array.from({length:E}).map((v,T)=>{const q=T+1,V=l.date(q).format("YYYY-MM-DD"),ct=!1,ut=F.format("YYYY-MM-DD")===V;return e.jsx("button",{type:"button",onClick:()=>{st(V)},disabled:ct,className:`w-full h-8 rounded-lg flex items-center justify-center transition-colors ${ut?"bg-sky-100 text-sky-700 font-semibold":"hover:bg-gray-100"}`,children:q},V)})]})]},s)})})]})]}),je!==null&&k.items.length>0?e.jsx(He,{items:k.items,initialIndex:je,onClose:()=>de(null)}):null]})}export{Kt as default};
