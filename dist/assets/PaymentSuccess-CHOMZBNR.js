import{m as D,A as U,u as L,R as c,j as e,i as p,k as y,a1 as T}from"./index-DpUnVvi7.js";import{t as P}from"./media-CQLQFIy8.js";import{C as R}from"./circle-check-big-BJecLgfZ.js";import{L as W}from"./loader-circle-2fTFtA91.js";import{c as B}from"./createLucideIcon-DlloiUI2.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],F=B("file-down",E);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],q=B("phone-call",V);function K({value:r,currency:h="INR"}){try{typeof window.fbq=="function"&&window.fbq("track","Purchase",{value:r,currency:h})}catch{}try{if(typeof window.gtag=="function"){const d="",l=""}}catch{}}const Y={processing:{title:"Verifying Payment…",desc:"Please stay on this page while we generate your ticket."},success:{title:"Payment Successful",desc:"Your booking is confirmed. Download your ticket below or visit My Bookings anytime."}};function X(){const[r]=D(),h=U(),d=L(s=>{var i;return(i=s.auth)==null?void 0:i.token}),l=r.get("booking")||r.get("booking_id")||r.get("id")||r.get("orderId")||"",b=r.get("cart")||"",k=r.get("tx")||r.get("tranCtx")||"",A=r.get("ticket")||"",[g,C]=c.useState(null),[S,j]=c.useState(!1),M=s=>{if(!s)return null;let i=s.ticket_pdf_url||s.ticket_url||s.pdf_url||s.ticket_pdf;if(!i&&Array.isArray(s.items)&&s.items.length>0){const o=s.items.find(n=>n.ticket_pdf||n.ticket_pdf_url);o&&(i=o.ticket_pdf||o.ticket_pdf_url)}if(!i&&Array.isArray(s)&&s.length>0){const o=s.find(n=>n.ticket_pdf||n.ticket_pdf_url);o&&(i=o.ticket_pdf||o.ticket_pdf_url)}return P(i)},u=P(A),[f,w]=c.useState(u),m=c.useRef(null),v=c.useRef(!1);if(c.useEffect(()=>{if(u){w(u);return}if(!d||!l)return;j(!0);const s=async()=>{var i,o;try{const n=await p.get(y.users.myBookingById(l)),t=(n==null?void 0:n.booking)||n||null;C(t);const _=M(t);if(_){if(w(_),j(!1),m.current&&clearInterval(m.current),!v.current){v.current=!0;const x=(t==null?void 0:t.order_id)||(t==null?void 0:t.items)&&((i=t.items[0])==null?void 0:i.order_id),a=Number((t==null?void 0:t.total_amount)||(t==null?void 0:t.final_amount)||0);T({order_id:x,amount:a}),a>0&&K({value:a,currency:"INR"})}}else{const x=(t==null?void 0:t.order_id)||(t==null?void 0:t.items)&&((o=t.items[0])==null?void 0:o.order_id),a=t==null?void 0:t.payment_mode,I=r.get("gateway");if(x)try{a==="PhonePe"||I==="phonepe"?await p.get(y.bookings.phonepe.status(x)):(a==="PayPhi"||I==="payphi")&&await p.get(y.bookings.payphi.status(x))}catch(z){console.warn("[PaymentSuccess] Status check failed",z)}}}catch(n){console.error("Unable to fetch booking",n)}};return s(),m.current=setInterval(s,3e3),()=>{m.current&&clearInterval(m.current)}},[d,l,u]),!d&&!f)return e.jsx("div",{className:"min-h-[70vh] flex items-center justify-center bg-gradient-to-b from-[#e0f2fe] via-[#bae6fd] to-white px-4 pt-20 pb-12",children:e.jsxs("div",{className:"w-full max-w-2xl bg-white rounded-3xl shadow-xl border border-slate-100 px-6 sm:px-10 py-10 text-center",children:[e.jsx("div",{className:"mx-auto w-20 h-20 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-600 shadow-inner",children:e.jsx(R,{size:42,strokeWidth:2.2})}),e.jsx("h1",{className:"text-3xl font-semibold text-slate-900 mt-6",children:"Payment Successful"}),e.jsxs("p",{className:"text-slate-600 mt-2 text-base",children:["Your booking ID is ",e.jsx("strong",{children:l||b}),".",e.jsx("br",{}),"We are generating your tickets and will send them to your email shortly."]}),e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx("a",{href:"/login",className:"text-blue-600 font-medium hover:underline",children:"Log in to view your bookings"})})]})});const N=Y[f?"success":"processing"];return e.jsx("div",{className:"min-h-[70vh] flex items-center justify-center bg-gradient-to-b from-[#e0f2fe] via-[#bae6fd] to-white px-4 pt-20 pb-12",children:e.jsxs("div",{className:"w-full max-w-2xl bg-white rounded-3xl shadow-xl border border-slate-100 px-6 sm:px-10 py-10 text-center",children:[e.jsx("div",{className:"mx-auto w-20 h-20 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-600 shadow-inner",children:f?e.jsx(R,{size:42,strokeWidth:2.2}):e.jsx(W,{size:40,className:"animate-spin"})}),e.jsx("h1",{className:"text-3xl font-semibold text-slate-900 mt-6",children:N.title}),e.jsx("p",{className:"text-slate-600 mt-2 text-base",children:N.desc}),e.jsxs("div",{className:"mt-6 grid gap-4",children:[f?e.jsxs("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center gap-2 rounded-2xl bg-blue-600 text-white px-6 py-3.5 text-lg font-semibold shadow-lg shadow-blue-200 hover:bg-blue-700 transition-colors",children:[e.jsx(F,{size:22})," Download Ticket (PDF)"]}):e.jsxs("div",{className:"rounded-2xl border border-dashed border-slate-300 px-5 py-4 text-sm text-slate-500 bg-slate-50",children:["Tickets are being generated. We will send them to your registered email and WhatsApp shortly.",S&&e.jsx("div",{className:"mt-2 text-xs text-slate-400",children:"Refreshing booking status…"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 mt-4",children:[e.jsx("a",{href:"/my-bookings",className:"flex-1 inline-flex items-center justify-center rounded-2xl border border-slate-200 px-5 py-3 font-medium text-slate-700 hover:border-slate-300",children:"View My Bookings"}),e.jsx("button",{type:"button",onClick:()=>h("/"),className:"flex-1 inline-flex items-center justify-center rounded-2xl bg-slate-900 text-white px-5 py-3 font-semibold hover:bg-slate-800",children:"Back to Home"})]})]}),e.jsxs("div",{className:"mt-8 p-4 rounded-2xl bg-slate-50 text-left flex flex-col gap-3 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs uppercase tracking-wide text-slate-400",children:[e.jsxs("span",{children:["Order Ref: ",e.jsx("strong",{className:"text-slate-700",children:b||(g==null?void 0:g.order_ref)||"—"})]}),l&&e.jsxs("span",{children:["Booking ID: ",e.jsx("strong",{className:"text-slate-700",children:l})]}),k&&e.jsxs("span",{children:["Txn ID: ",e.jsx("strong",{className:"text-slate-700",children:k})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(q,{size:18,className:"text-blue-500"}),e.jsxs("div",{children:["Need help? Reach us at ",e.jsx("a",{href:"tel:+919159520237",className:"text-blue-600 font-medium",children:"+91 91595 20237"})," or write to ",e.jsx("a",{href:"mailto:bookings@snowcity.com",className:"text-blue-600 font-medium",children:"bookings@snowcity.com"}),"."]})]})]})]})})}export{X as default};
