import{C as w,D as N,R as s,j as e}from"./index-C5Mz9dTM.js";import{a as u}from"./AdminApp-C7IcGGGV.js";import{R as C,a as S,G as P}from"./GalleryField-FcQIb-ma.js";import{u as $}from"./useCatalogTargets-DhWrb5ei.js";import"./createLucideIcon-DQ6FqzLt.js";import"./file-text-CQ7rExmv.js";import"./ticket-C3bgGsni.js";import"./ImageUploader-DAvc2Cys.js";import"./media-DDlhmRHE.js";const E=[{key:"",label:"No nav"},{key:"visitors_guide",label:"Visitors Guide"}],R=[{key:"none",label:"No special placement"},{key:"home_bottom",label:"Home - Bottom section"},{key:"attraction_details",label:"Attraction - Details section (select attraction)"}];function q(){const m=w(),{id:o}=N(),d=!!o,[t,b]=s.useState({title:"",slug:"",active:!0,editor_mode:"rich",content:"",raw_html:"",raw_css:"",raw_js:"",meta_title:"",meta_description:"",meta_keywords:"",section_type:"none",section_ref_id:null,gallery:[],bulk_images:[],nav_group:"",nav_order:0,placement:"none",placement_ref_id:null}),[A,g]=s.useState(""),[i,p]=s.useState(!1);s.useEffect(()=>{d&&(async()=>{try{const a=await u.get(`/api/admin/pages/${o}`);b(n=>({...n,...a,editor_mode:a.editor_mode||"rich",nav_group:a.nav_group||"",nav_order:a.nav_order??0,placement:a.placement||"none",placement_ref_id:a.placement_ref_id||null}))}catch(a){g(a.message||"Failed to load page")}})()},[o,d]);const r=a=>b(n=>({...n,...a})),_=async a=>{a.preventDefault(),g(""),p(!0);try{const n=f=>{const k=Number(f);return Number.isFinite(k)?k:null},l={...t};l.section_type=t.section_type||"none",l.section_ref_id=l.section_type==="none"?null:n(t.section_ref_id),l.placement_ref_id=t.placement==="attraction_details"?n(t.placement_ref_id):null,l.nav_order=Number.isFinite(Number(t.nav_order))?Number(t.nav_order):0,l.editor_mode==="raw"&&(l.content=l.content||""),d?await u.put(`/api/admin/pages/${o}`,l):await u.post("/api/admin/pages",l),m("/admin/catalog/pages")}catch(n){g(n.message||"Save failed")}finally{p(!1)}},{attractions:x=[],combos:h=[],status:c}=$(),v=s.useMemo(()=>x.map(a=>({value:a.attraction_id||a.id,label:a.title||a.name||`Attraction #${a.attraction_id||a.id}`})),[x]),j=s.useMemo(()=>h.map(a=>({value:a.combo_id||a.id,label:a.title||a.name||`Combo #${a.combo_id||a.id}`})),[h]),y=async()=>{try{const a=await u.post("/api/admin/pages/preview",t),n=window.open("","_blank");if(!n)return;let l="";t.editor_mode==="raw"?l=`
<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>${t.raw_css||""}</style>
<title>${t.title||""}</title>
</head><body>
${t.raw_html||""}
<script>${t.raw_js||""}<\/script>
</body></html>`:l=`
<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>${t.title||""}</title>
</head><body>${t.content||""}</body></html>`,n.document.open(),n.document.write(l),n.document.close()}catch(a){alert(a.message||"Preview failed")}};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-neutral-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-gray-200 dark:border-neutral-700 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-neutral-100",children:d?"Edit Page":"Create New Page"}),e.jsx("p",{className:"text-gray-600 dark:text-neutral-400 mt-1",children:d?"Update your page content and settings":"Create custom pages for your website"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:y,className:"px-4 py-2 bg-gray-100 dark:bg-neutral-700 text-gray-700 dark:text-neutral-300 rounded-lg hover:bg-gray-200 dark:hover:bg-neutral-600 transition-colors",children:"Preview"}),e.jsx("button",{type:"button",onClick:()=>m("/admin/catalog/pages"),className:"px-4 py-2 border border-gray-300 dark:border-neutral-600 text-gray-700 dark:text-neutral-300 rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-700 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",form:"page-form",disabled:i,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?"Saving...":"Save Page"})]})]})}),e.jsxs("form",{id:"page-form",onSubmit:_,children:[e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-gray-200 dark:border-neutral-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-neutral-100 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-neutral-300 mb-2",children:"Title *"}),e.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-neutral-700 dark:text-neutral-100",value:t.title,onChange:a=>r({title:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-neutral-300 mb-2",children:"Slug *"}),e.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-neutral-700 dark:text-neutral-100",value:t.slug,onChange:a=>r({slug:a.target.value}),placeholder:"my-custom-page"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:!!t.active,onChange:a=>r({active:a.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-neutral-300",children:"Publish page"})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-gray-200 dark:border-neutral-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-neutral-100 mb-4",children:"Navigation & Placement"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-neutral-300 mb-2",children:"Navigation Group"}),e.jsx("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-neutral-700 dark:text-neutral-100",value:t.nav_group||"",onChange:a=>r({nav_group:a.target.value}),children:E.map(a=>e.jsx("option",{value:a.key,children:a.label},a.key))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-neutral-300 mb-2",children:"Navigation Order"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-neutral-700 dark:text-neutral-100",value:t.nav_order??0,onChange:a=>r({nav_order:Number(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-neutral-300 mb-2",children:"Special Placement"}),e.jsx("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-neutral-700 dark:text-neutral-100",value:t.placement,onChange:a=>r({placement:a.target.value}),children:R.map(a=>e.jsx("option",{value:a.key,children:a.label},a.key))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-neutral-300 mb-2",children:"Section Type"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-neutral-700 dark:text-neutral-100",value:t.section_type||"none",onChange:a=>r({section_type:a.target.value,section_ref_id:null}),children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"attraction",children:"Attraction"}),e.jsx("option",{value:"combo",children:"Combo"})]})]}),t.section_type!=="none"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:t.section_type==="attraction"?"Select attraction":"Select combo"}),e.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.section_ref_id||"",onChange:a=>r({section_ref_id:a.target.value?Number(a.target.value):null}),disabled:c==="loading",children:[e.jsx("option",{value:"",children:c==="loading"?"Loading…":"Choose option"}),(t.section_type==="attraction"?v:j).map(a=>e.jsx("option",{value:a.value||"",children:a.label},`section-${a.value}`))]})]})]})]}),t.placement==="attraction_details"&&e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-gray-200 dark:border-neutral-700 p-6",children:[e.jsx("label",{className:"block text-sm",children:"Attraction (for placement)"}),e.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.placement_ref_id||"",onChange:a=>r({placement_ref_id:a.target.value?Number(a.target.value):null}),disabled:c==="loading",children:[e.jsx("option",{value:"",children:c==="loading"?"Loading…":"Select attraction"}),v.map(a=>e.jsx("option",{value:a.value||"",children:a.label},`placement-${a.value}`))]})]}),e.jsx("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-gray-200 dark:border-neutral-700 p-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:t.editor_mode==="rich",onChange:()=>r({editor_mode:"rich"})}),"Visual editor"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:t.editor_mode==="raw",onChange:()=>r({editor_mode:"raw"})}),"Raw (HTML/CSS/JS)"]}),e.jsx("button",{type:"button",className:"ml-auto px-3 py-1 rounded-md border text-sm",onClick:y,children:"Preview"})]})}),t.editor_mode==="raw"?e.jsx(C,{value:{raw_html:t.raw_html,raw_css:t.raw_css,raw_js:t.raw_js},onChange:a=>r(a)}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-gray-200 dark:border-neutral-700 p-6",children:[e.jsx("label",{className:"block text-sm",children:"Content"}),e.jsx(S,{value:t.content||"",onChange:a=>r({content:a}),gallery:t.bulk_images&&t.bulk_images.length?t.bulk_images:t.gallery})]}),e.jsx(P,{label:"Content gallery",helper:"Upload multiple inline assets to reuse inside the visual editor or elsewhere in the page.",value:t.gallery||[],onChange:a=>r({gallery:a})})]}),e.jsx("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-gray-200 dark:border-neutral-700 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Meta title"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.meta_title||"",onChange:a=>r({meta_title:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Meta description"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.meta_description||"",onChange:a=>r({meta_description:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Meta keywords"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.meta_keywords||"",onChange:a=>r({meta_keywords:a.target.value})})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"px-3 py-2 rounded-md bg-gray-900 text-white",disabled:i,children:i?"Saving…":"Save"}),e.jsx("button",{className:"px-3 py-2 rounded-md border",type:"button",onClick:()=>m("/admin/catalog/pages"),children:"Cancel"})]})]})]})})}export{q as default};
