import{R as u,E as x,j as e}from"./index-C5Mz9dTM.js";import{a as A}from"./AdminApp-C7IcGGGV.js";import"./createLucideIcon-DQ6FqzLt.js";import"./file-text-CQ7rExmv.js";import"./ticket-C3bgGsni.js";function F(r){if(!r)return NaN;const[s,a]=String(r).split(":").map(m=>Number(m));return!Number.isFinite(s)||!Number.isFinite(a)?NaN:s*60+a}function $(r){const s=Math.floor(r/60),a=r%60;return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`}function E(r){const[s,a]=String(r).split(":").map(Number),m=s>=12?"pm":"am";let c=s%12;return c===0&&(c=12),`${String(c).padStart(2,"0")}.${String(a).padStart(2,"0")}${m}`}function G(){var k;const[r,s]=u.useState([]),[a,m]=u.useState({combo_id:"",start_date:x().format("YYYY-MM-DD"),end_date:x().add(7,"day").format("YYYY-MM-DD"),start_time:"10:00",end_time:"18:00",duration_minutes:60,capacity:10,price:"",available:!0}),[c,y]=u.useState(!1),[n,N]=u.useState(null),[_,l]=u.useState("");u.useEffect(()=>{(async()=>{try{const t=await A.get("/api/admin/combos",{active:!0}),d=Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t)?t:[];s(d)}catch{}})()},[]);const i=(t,d)=>m(o=>({...o,[t]:d})),R=async t=>{t.preventDefault(),l(""),N(null);const d=Number(a.combo_id),o=Number(a.duration_minutes),g=Number(a.capacity),B=a.price===""||a.price==null?null:Number(a.price),S=F(a.start_time),C=F(a.end_time);if(!d)return l("Please select a combo.");if(!a.start_date||!a.end_date)return l("Start and end date are required.");if(!Number.isFinite(o)||o<=0)return l("Duration must be a positive number of minutes.");if(!Number.isFinite(g)||g<=0)return l("Capacity must be a positive integer.");if(!(S<C))return l("Start time must be earlier than end time.");const h=x(a.start_date),f=x(a.end_date);if(!h.isValid()||!f.isValid()||h.isAfter(f,"day"))return l("Invalid date range.");y(!0);try{let w=0,Y=0;const M=[];for(let p=h;!p.isAfter(f,"day");p=p.add(1,"day")){const v=p.format("YYYY-MM-DD");for(let b=S;b+o<=C;b+=o){const D=$(b),q=$(b+o),P=E(D),V=E(q);try{await A.post("/api/admin/combo-slots",{combo_id:d,start_date:v,end_date:v,start_time:P,end_time:V,capacity:g,price:B,available:!!a.available}),w+=1}catch(j){Y+=1,M.push({date:v,start_time:D,end_time:q,error:(j==null?void 0:j.message)||"Unprocessable"})}}}N({created:w,skipped:Y,conflicts:M})}finally{y(!1)}};return e.jsxs("form",{onSubmit:R,className:"max-w-xl space-y-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Bulk Create Combo Slots"}),_?e.jsx("div",{className:"text-sm text-red-600",children:_}):null,e.jsx("label",{className:"block text-sm",children:"Combo"}),e.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:a.combo_id,onChange:t=>i("combo_id",t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select combo"}),r.map(t=>e.jsx("option",{value:t.combo_id,children:t.title||`Combo #${t.combo_id}`},t.combo_id))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Start date"}),e.jsx("input",{type:"date",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:a.start_date,onChange:t=>i("start_date",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"End date"}),e.jsx("input",{type:"date",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:a.end_date,onChange:t=>i("end_date",t.target.value),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"From"}),e.jsx("input",{type:"time",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:a.start_time,onChange:t=>i("start_time",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"To"}),e.jsx("input",{type:"time",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:a.end_time,onChange:t=>i("end_time",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Duration (minutes)"}),e.jsx("input",{type:"number",min:"1",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:a.duration_minutes,onChange:t=>i("duration_minutes",t.target.value),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Capacity"}),e.jsx("input",{type:"number",min:"1",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:a.capacity,onChange:t=>i("capacity",t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Price (optional)"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:a.price,onChange:t=>i("price",t.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!a.available,onChange:t=>i("available",t.target.checked)}),"Available"]})})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{className:"px-3 py-2 rounded-md bg-gray-900 text-white",type:"submit",disabled:c,children:c?"Creating…":"Create Slots"}),n?e.jsxs("div",{className:"text-sm text-gray-700 dark:text-neutral-300",children:["Created: ",n.created," • Skipped: ",n.skipped]}):null]}),(k=n==null?void 0:n.conflicts)!=null&&k.length?e.jsxs("div",{className:"rounded-md border p-3 mt-2 text-sm dark:border-neutral-800 dark:bg-neutral-900",children:[e.jsx("div",{className:"font-medium mb-1",children:"Conflicts"}),e.jsx("ul",{className:"list-disc pl-5",children:n.conflicts.map((t,d)=>e.jsxs("li",{children:[t.date," ",t.start_time,"→",t.end_time,": ",t.error]},d))})]}):null]})}export{G as default};
