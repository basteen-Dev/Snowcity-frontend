const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CVaiWXUE.js","assets/CategoricalChart-hAUv2vPj.js","assets/index-Buz5vlJT.js","assets/index-CFhrggJf.css","assets/clsx-B-dksMZM.js","assets/index-6DYJ-02T.js","assets/CartesianChart-DlQcQi6Y.js","assets/tooltipContext-DwbZ6AUR.js","assets/LineChart-bJFXiFr0.js","assets/PieChart-DAxnZrC4.js","assets/BarChart-qC60N5N5.js"])))=>i.map(i=>d[i]);
import{R as f,j as e,aa as C,D as A,_}from"./index-Buz5vlJT.js";import{a as N,A as w}from"./AdminApp-DjyjDDmt.js";import{f as j}from"./formatters-CmiLqhJj.js";import"./createLucideIcon-BEwYts5j.js";import"./file-text-CuRCFKVY.js";import"./ticket-B65mU2v0.js";const v=({title:a,subtitle:s,children:i,className:o=""})=>e.jsxs("div",{className:`rounded-2xl border border-gray-200 bg-white p-5 shadow-sm dark:bg-neutral-900 dark:border-neutral-800 ${o}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-neutral-100",children:a}),s?e.jsx("p",{className:"text-xs text-gray-500",children:s}):null]})}),i]}),Y=({label:a,value:s,note:i,accent:o="from-gray-500 to-gray-700"})=>e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white shadow-sm p-4 dark:bg-neutral-900 dark:border-neutral-800",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:a}),e.jsx("div",{className:`mt-3 text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r ${o}`,children:s}),i?e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:i}):null]});function R({data:a}){const[s,i]=f.useState(null);if(f.useEffect(()=>{let c=!0;return(async()=>{try{const n=await _(()=>import("./index-CVaiWXUE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]));if(!c)return;i({ResponsiveContainer:n.ResponsiveContainer,AreaChart:n.AreaChart,Area:n.Area,CartesianGrid:n.CartesianGrid,XAxis:n.XAxis,YAxis:n.YAxis,Tooltip:n.Tooltip})}catch(n){console.warn("Recharts not available; showing fallback",n),c&&i(!1)}})(),()=>{c=!1}},[]),s===null)return e.jsx("div",{className:"h-60 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-3 animate-pulse"});if(s===!1)return e.jsx("div",{className:"h-60 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-3 text-sm text-gray-600 dark:text-neutral-300 flex items-center justify-center",children:"Charts unavailable (install: npm i recharts --legacy-peer-deps)"});const{ResponsiveContainer:o,AreaChart:m,Area:u,CartesianGrid:h,XAxis:b,YAxis:p,Tooltip:g}=s;return e.jsx("div",{className:"h-60 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-3",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs(m,{data:a,children:[e.jsx(h,{stroke:"#eee",strokeDasharray:"5 5"}),e.jsx(b,{dataKey:"bucket"}),e.jsx(p,{}),e.jsx(g,{}),e.jsx(u,{type:"monotone",dataKey:"bookings",stroke:"#2563eb",fill:"#93c5fd",name:"Bookings"}),e.jsx(u,{type:"monotone",dataKey:"revenue",stroke:"#16a34a",fill:"#86efac",name:"Revenue"})]})})})}function D({data:a}){const[s,i]=f.useState(null);if(f.useEffect(()=>{let n=!0;return(async()=>{try{const l=await _(()=>import("./index-CVaiWXUE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]));if(!n)return;i({ResponsiveContainer:l.ResponsiveContainer,PieChart:l.PieChart,Pie:l.Pie,Cell:l.Cell,Tooltip:l.Tooltip,Legend:l.Legend})}catch(l){console.warn("Recharts not available; showing fallback",l),n&&i(!1)}})(),()=>{n=!1}},[]),s===null)return e.jsx("div",{className:"h-60 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-3 animate-pulse"});if(s===!1)return e.jsx("div",{className:"h-60 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-3 text-sm text-gray-600 dark:text-neutral-300 flex items-center justify-center",children:"Charts unavailable (install: npm i recharts --legacy-peer-deps)"});const{ResponsiveContainer:o,PieChart:m,Pie:u,Cell:h,Tooltip:b,Legend:p}=s,g=["#60a5fa","#f59e0b","#10b981","#ef4444","#a78bfa","#f472b6"],c=Array.isArray(a)?a.map(n=>({name:String(n.booking_status||n.name),value:Number(n.count||n.value||0)})):[];return e.jsx("div",{className:"h-60 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-3",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs(m,{children:[e.jsx(u,{data:c,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:!0,children:c.map((n,l)=>e.jsx(h,{fill:g[l%g.length]},`cell-${l}`))}),e.jsx(b,{}),e.jsx(p,{})]})})})}function E(){var l;const[a,s]=f.useState({status:"idle",error:null,main:null,breakdown:[],attractions:[],attractionId:"",trend:[],from:"",to:""});f.useEffect(()=>{(async()=>{s(t=>({...t,status:"loading",error:null}));try{const[t,r]=await Promise.all([N.get(w.attractions(),{params:{limit:200}}).catch(()=>[]),N.get(w.analyticsOverview(),{params:{...a.from&&{from:a.from},...a.to&&{to:a.to},attraction_id:a.attractionId||void 0}})]),d=(r==null?void 0:r.summary)||r||null,x=(r==null?void 0:r.statusBreakdown)||[],y=(r==null?void 0:r.trend)||[];s(k=>({...k,status:"succeeded",main:d,breakdown:x,trend:y,attractions:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t)?t:[]}))}catch(t){s(r=>({...r,status:"failed",error:t}))}})()},[]);const i=async()=>{s(t=>({...t,status:"loading",error:null}));try{const t=await N.get(w.analyticsOverview(),{params:{...a.from&&{from:a.from},...a.to&&{to:a.to},attraction_id:a.attractionId||void 0}}),r=(t==null?void 0:t.summary)||t||null,d=(t==null?void 0:t.statusBreakdown)||[],x=(t==null?void 0:t.trend)||[];s(y=>({...y,status:"succeeded",main:r,breakdown:d,trend:x}))}catch(t){s(r=>({...r,status:"failed",error:t}))}},o=t=>{const r=A();if(t==="all")s(d=>({...d,from:"",to:""}));else if(t==="today")s(d=>({...d,from:r.format("YYYY-MM-DD"),to:r.format("YYYY-MM-DD")}));else if(t==="tomorrow"){const d=r.add(1,"day");s(x=>({...x,from:d.format("YYYY-MM-DD"),to:d.format("YYYY-MM-DD")}))}else if(t==="week"){const d=r.day(),x=r.subtract(d,"day"),y=x.add(6,"day");s(k=>({...k,from:x.format("YYYY-MM-DD"),to:y.format("YYYY-MM-DD")}))}};if(a.status==="loading"&&!a.main)return e.jsx("div",{children:"Loading…"});if(a.status==="failed")return e.jsx("div",{className:"text-red-600",children:((l=a.error)==null?void 0:l.message)||"Failed to load"});const m=a.main||{},u=a.breakdown||[],h=a.attractions||[],b=Number(m.total_revenue||0),p=Number(m.pending_revenue||0),g=b+p,c=g?Math.round(b/g*100):0,n=[{key:"total_bookings",label:"Confirmed",note:"Paid bookings",accent:"from-blue-500 to-indigo-600",formatter:t=>Number(t||0).toLocaleString()},{key:"pending_bookings",label:"Pending",note:"Awaiting payment",accent:"from-amber-400 to-orange-500",formatter:t=>Number(t||0).toLocaleString()},{key:"total_revenue",label:"Revenue (Paid)",accent:"from-emerald-500 to-green-600",formatter:t=>j(t||0)},{key:"pending_revenue",label:"Revenue (Pending)",accent:"from-rose-500 to-pink-500",formatter:t=>j(t||0)},{key:"total_people",label:"Tickets Sold",accent:"from-slate-500 to-slate-700",formatter:t=>Number(t||0).toLocaleString()},{key:"unique_users",label:"Unique Users",accent:"from-teal-500 to-cyan-500",formatter:t=>Number(t||0).toLocaleString()},{key:"today_bookings",label:"Today",note:"Paid bookings",accent:"from-purple-500 to-fuchsia-500",formatter:t=>Number(t||0).toLocaleString()}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{title:"Analytics Filters",subtitle:"Deep dive by attraction and timeframe",className:"p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Attraction"}),e.jsxs("select",{className:"rounded-md border px-3 py-2 min-w-[220px]",value:a.attractionId,onChange:t=>s(r=>({...r,attractionId:t.target.value})),children:[e.jsx("option",{value:"",children:"All attractions"}),h.map(t=>e.jsx("option",{value:t.attraction_id||t.id,children:t.title||t.name},t.attraction_id||t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"From"}),e.jsx("input",{type:"date",className:"rounded-md border px-3 py-2",value:a.from,onChange:t=>s(r=>({...r,from:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"To"}),e.jsx("input",{type:"date",className:"rounded-md border px-3 py-2",value:a.to,onChange:t=>s(r=>({...r,to:t.target.value}))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"rounded-full border px-3 py-1.5 text-sm",onClick:()=>o("all"),children:"All Time"}),e.jsx("button",{className:"rounded-full border px-3 py-1.5 text-sm",onClick:()=>o("today"),children:"Today"}),e.jsx("button",{className:"rounded-full border px-3 py-1.5 text-sm",onClick:()=>o("tomorrow"),children:"Tomorrow"}),e.jsx("button",{className:"rounded-full border px-3 py-1.5 text-sm",onClick:()=>o("week"),children:"This Week"}),e.jsx("button",{className:"rounded-full bg-gray-900 text-white px-4 py-1.5 text-sm",onClick:i,children:"Apply"})]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx("a",{className:"rounded-full border px-3 py-1.5 text-sm",href:C("/api/admin/analytics/report.csv",{type:"bookings",from:a.from,to:a.to,attraction_id:a.attractionId||void 0}),target:"_blank",rel:"noopener noreferrer",children:"Download CSV"}),e.jsx("a",{className:"rounded-full border px-3 py-1.5 text-sm",href:C("/api/admin/analytics/report.pdf",{type:"bookings",from:a.from,to:a.to,attraction_id:a.attractionId||void 0}),target:"_blank",rel:"noopener noreferrer",children:"PDF"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 xl:grid-cols-4 gap-4",children:n.map(t=>e.jsx(Y,{label:t.label,value:t.formatter?t.formatter(m[t.key]):m[t.key]??"—",note:t.note,accent:t.accent},t.key))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(v,{title:"Momentum",subtitle:"Bookings vs revenue trend",children:e.jsx(R,{data:a.trend})}),e.jsx(v,{title:"Booking Status",subtitle:"Distribution across payment statuses",children:e.jsx(D,{data:u})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(v,{title:"Revenue Mix",subtitle:"Paid vs pending collections",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Paid"}),e.jsx("span",{children:j(b)})]}),e.jsx("div",{className:"h-2 rounded-full bg-gray-100 mt-2",children:e.jsx("div",{className:"h-full rounded-full bg-emerald-500",style:{width:`${c}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Pending"}),e.jsx("span",{children:j(p)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"rounded-xl bg-emerald-50 p-3",children:[e.jsx("p",{className:"text-xs text-emerald-600 uppercase",children:"Conversion"}),e.jsxs("p",{className:"text-2xl font-semibold text-emerald-700",children:[c,"%"]})]}),e.jsxs("div",{className:"rounded-xl bg-amber-50 p-3",children:[e.jsx("p",{className:"text-xs text-amber-600 uppercase",children:"Open Value"}),e.jsx("p",{className:"text-2xl font-semibold text-amber-700",children:j(p)})]})]})]})}),e.jsx(v,{title:"Recent Status Breakdown",subtitle:"Top ticket states",children:e.jsxs("div",{className:"space-y-3",children:[u.length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"No records in range."}),u.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:t.booking_status}),e.jsxs("div",{className:"text-gray-500",children:[t.count," bookings"]})]},t.booking_status))]})})]})]})}export{E as default};
