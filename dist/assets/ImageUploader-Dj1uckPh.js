import{R as d,j as e}from"./index-Buz5vlJT.js";import{a as F}from"./AdminApp-DjyjDDmt.js";import{i as T}from"./media-DTTax9V0.js";const p={},w="/api/admin/uploads",U=(p==null?void 0:p.VITE_CLOUDINARY_UPLOAD_PRESET)||"";function W({label:D="Image",value:c,onChange:n,fieldName:P="file",extra:R={},accept:S="image/*,video/*,.pdf",requiredPerm:A=null}){const f=d.useId(),[l,u]=d.useState(null),[g,b]=d.useState(""),[m,h]=d.useState(""),[y,x]=d.useState("idle"),[j,i]=d.useState(""),o=d.useMemo(()=>T(c||""),[c]);d.useEffect(()=>{if(!l)return;const t=URL.createObjectURL(l);return h(t),b(l.name||""),()=>URL.revokeObjectURL(t)},[l]);const v=t=>t?t.type.startsWith("image/")?"image":t.type.startsWith("video/")?"video":t.type==="application/pdf"?"pdf":"unknown":"unknown",E=t=>{var a;const s=((a=t.target.files)==null?void 0:a[0])||null;i(""),u(s)},I=t=>{var a,r;t.preventDefault(),t.stopPropagation();const s=((r=(a=t.dataTransfer)==null?void 0:a.files)==null?void 0:r[0])||null;s&&(i(""),u(s))},L=t=>{t.preventDefault(),t.stopPropagation()},N=()=>{u(null),h(""),b("")},O=async()=>{var t;if(l){x("loading"),i("");try{const s=/cloudinary\.com/i.test(w),a={...R||{}};s&&U&&!a.upload_preset&&(a.upload_preset=U);const r=await F.upload(w,l,{fieldName:P,data:a}),k=(r==null?void 0:r.url)||(r==null?void 0:r.url_path)||(r==null?void 0:r.secure_url)||(r==null?void 0:r.location)||((t=r==null?void 0:r.data)==null?void 0:t.url)||"";if(!k)throw new Error((r==null?void 0:r.message)||"Upload response missing URL");n==null||n(k),x("done"),N()}catch(s){x("error"),i((s==null?void 0:s.message)||"Upload failed")}}};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:D}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"text",className:"flex-1 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",placeholder:"https://...",value:c||"",onChange:t=>n==null?void 0:n(t.target.value)})}),e.jsxs("div",{className:"mt-2 rounded-md border border-dashed px-3 py-3 text-sm text-gray-600 dark:text-neutral-300 dark:border-neutral-700",onDrop:I,onDragOver:L,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{id:f,type:"file",accept:S,onChange:E,className:"sr-only"}),e.jsx("label",{htmlFor:f,className:"inline-flex items-center rounded-md border px-3 py-2 text-sm cursor-pointer dark:border-neutral-700 dark:text-neutral-200",role:"button",children:"Choose"}),e.jsx("button",{className:"inline-flex items-center rounded-md bg-gray-900 text-white px-3 py-2 text-sm disabled:opacity-50",onClick:O,disabled:!l||y==="loading",type:"button",children:y==="loading"?"Uploadingâ€¦":"Upload"}),g?e.jsxs("span",{className:"text-xs text-gray-500 dark:text-neutral-400",children:["Selected: ",g]}):null,l?e.jsx("button",{className:"inline-flex items-center rounded-md border px-2 py-1 text-xs dark:border-neutral-700 dark:text-neutral-200",onClick:N,type:"button",children:"Clear"}):null]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 dark:text-neutral-400",children:"Drag a file here, or click Choose to select."})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[m?e.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:v(l)==="video"?e.jsx("video",{src:m,className:"w-full h-full object-cover",muted:!0}):v(l)==="pdf"?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):e.jsx("img",{src:m,alt:"snowcity",loading:"lazy",className:"w-full h-full object-cover"})}):null,o?e.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:o.match(/\.(mp4|webm|ogg)$/i)?e.jsx("video",{src:o,className:"w-full h-full object-cover",muted:!0}):o.match(/\.pdf$/i)?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):e.jsx("img",{src:o,alt:"snowcity",loading:"lazy",className:"w-full h-full object-cover"})}):null]}),j?e.jsx("div",{className:"text-xs text-red-600 mt-2",children:j}):null]})}export{W as I};
