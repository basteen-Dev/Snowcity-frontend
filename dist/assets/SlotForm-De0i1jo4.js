import{C as g,B as v,R as u,j as e}from"./index-CNdOvwUA.js";import{a as n,A as o}from"./AdminApp-sxxeVGC_.js";import"./createLucideIcon-D7GIchwo.js";import"./file-text-B3yKuaPb.js";import"./ticket-BYx_I3BZ.js";function S(){var x;const{id:c}=g(),p=v(),i=!!c,[d,r]=u.useState({status:i?"loading":"idle",error:null,form:{attraction_id:"",date:"",start_date:"",end_date:"",start_time:"",end_time:"",capacity:0,duration_minutes:60,price:"",available:!0}}),[_,h]=u.useState([]);u.useEffect(()=>{(async()=>{try{const a=await n.get(o.attractions()),t=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];h(t)}catch{}})(),i&&(async()=>{try{const t=await n.get(o.slotById(c))||{};r(l=>({...l,status:"idle",form:{attraction_id:t.attraction_id||"",date:t.start_date||"",start_date:t.start_date||"",end_date:t.end_date||"",start_time:t.start_time_12h||t.start_time||"",end_time:t.end_time_12h||t.end_time||"",capacity:t.capacity||0,duration_minutes:l.form.duration_minutes,price:t.price??l.form.price,available:!!t.available}}))}catch(a){r(t=>({...t,status:"failed",error:a}))}})()},[c,i]);const f=async a=>{a.preventDefault();try{if(i){const t={...d.form};!t.start_date&&t.date&&(t.start_date=t.date),!t.end_date&&t.start_date&&(t.end_date=t.start_date),await n.put(o.slotById(c),t)}else{const t=d.form,l=t.date&&t.start_time&&t.end_time,y=t.start_date&&t.end_date&&t.start_time&&t.end_time,b=Number(t.duration_minutes||0);if(y&&b>0){const m={attraction_id:t.attraction_id,start_date:t.start_date,end_date:t.end_date,start_time:t.start_time,end_time:t.end_time,duration_minutes:b,capacity:Number(t.capacity||0),price:t.price===""?null:Number(t.price),available:!!t.available};await n.post(o.slotsBulk(),m)}else if(l){const m={attraction_id:t.attraction_id,date:t.date,start_time:t.start_time,end_time:t.end_time,capacity:Number(t.capacity||0),price:t.price===""?null:Number(t.price),available:!!t.available};await n.post(o.slots(),m)}else{alert("Please fill Date, Start Time, End Time and Capacity");return}}p("/admin/catalog/slots")}catch(t){r(l=>({...l,error:t}))}};if(d.status==="loading")return e.jsx("div",{children:"Loading…"});if(d.status==="failed")return e.jsx("div",{className:"text-red-600",children:((x=d.error)==null?void 0:x.message)||"Failed to load"});const s=d.form;return e.jsxs("form",{onSubmit:f,className:"max-w-2xl bg-white border rounded-xl p-4",children:[e.jsxs("h1",{className:"text-xl font-semibold mb-4",children:[i?"Edit":"New"," Slot"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Attraction"}),e.jsxs("select",{className:"w-full rounded-md border px-3 py-2",value:s.attraction_id,onChange:a=>r(t=>({...t,form:{...t.form,attraction_id:a.target.value}})),required:!0,children:[e.jsx("option",{value:"",children:"— Select attraction —"}),_.map(a=>e.jsx("option",{value:a.attraction_id,children:a.title},a.attraction_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Capacity"}),e.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2",value:s.capacity,onChange:a=>r(t=>({...t,form:{...t.form,capacity:Number(a.target.value||0)}}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Price (optional)"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full rounded-md border px-3 py-2",value:s.price,onChange:a=>r(t=>({...t,form:{...t.form,price:a.target.value}}))})]}),i?null:e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Duration Minutes (for range bulk)"}),e.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2",value:s.duration_minutes,onChange:a=>r(t=>({...t,form:{...t.form,duration_minutes:Number(a.target.value||0)}}))})]})}),i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",className:"w-full rounded-md border px-3 py-2",value:s.start_date,onChange:a=>r(t=>({...t,form:{...t.form,start_date:a.target.value}}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"End Date"}),e.jsx("input",{type:"date",className:"w-full rounded-md border px-3 py-2",value:s.end_date,onChange:a=>r(t=>({...t,form:{...t.form,end_date:a.target.value}}))})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Date"}),e.jsx("input",{type:"date",className:"w-full rounded-md border px-3 py-2",value:s.date,onChange:a=>r(t=>({...t,form:{...t.form,date:a.target.value}}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Start Time"}),e.jsx("input",{type:"text",placeholder:"01.00pm",className:"w-full rounded-md border px-3 py-2",value:s.start_time,onChange:a=>r(t=>({...t,form:{...t.form,start_time:a.target.value}}))}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Use 12-hour (01.00pm) or 24-hour (13:00)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"End Time"}),e.jsx("input",{type:"text",placeholder:"02.00pm",className:"w-full rounded-md border px-3 py-2",value:s.end_time,onChange:a=>r(t=>({...t,form:{...t.form,end_time:a.target.value}}))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"available",type:"checkbox",checked:!!s.available,onChange:a=>r(t=>({...t,form:{...t.form,available:a.target.checked}}))}),e.jsx("label",{htmlFor:"available",className:"text-sm text-gray-700",children:"Available"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{type:"submit",className:"rounded-md bg-gray-900 text-white px-4 py-2 text-sm",children:"Save"}),e.jsx("button",{type:"button",className:"rounded-md border px-4 py-2 text-sm",onClick:()=>p(-1),children:"Cancel"})]})]})}export{S as default};
