import{C as k,A as j,R as c,j as t}from"./index-DpUnVvi7.js";import{a as d,A as o}from"./AdminApp-DElutmvv.js";import{I as _}from"./ImageUploader-8sQNEsRz.js";import{S as y}from"./SaveOverlay-YW_4J3BF.js";import"./createLucideIcon-DlloiUI2.js";import"./file-text-BcxeLTgw.js";import"./users-Dj4zQjFo.js";import"./newspaper-D6LH_a5a.js";import"./ticket-DJwTfedz.js";import"./chevron-down-BM4ufvPU.js";import"./media-CQLQFIy8.js";function R(){var x,g;const{id:m}=k(),u=j(),n=!!m,[i,r]=c.useState({status:n?"loading":"idle",error:null,attractions:[],offers:[],form:{title:"",description:"",web_image:"",web_image_alt:"",mobile_image:"",mobile_image_alt:"",linked_attraction_id:"",linked_offer_id:"",active:!0}});c.useEffect(()=>{(async()=>{try{const[a,e]=await Promise.all([d.get(o.attractions()),d.get(o.offers())]),s=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[],v=Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e)?e:[];r(h=>({...h,attractions:s,offers:v}))}catch{}})()},[]),c.useEffect(()=>{n&&(async()=>{try{const a=await d.get(`${o.banners()}/${m}`),e=(a==null?void 0:a.banner)||a||{};r(s=>({...s,status:"idle",form:{title:e.title||"",description:e.description||"",web_image:e.web_image||"",web_image_alt:e.web_image_alt||"",mobile_image:e.mobile_image||"",mobile_image_alt:e.mobile_image_alt||"",linked_attraction_id:e.linked_attraction_id||"",linked_offer_id:e.linked_offer_id||"",active:!!e.active}}))}catch(a){r(e=>({...e,status:"failed",error:a}))}})()},[m,n]);const[f,b]=c.useState(!1),p=async a=>{a.preventDefault(),b(!0),r(e=>({...e,error:null}));try{const e={...i.form};e.linked_attraction_id||delete e.linked_attraction_id,e.linked_offer_id||delete e.linked_offer_id,n?await d.put(`${o.banners()}/${m}`,e):await d.post(o.banners(),e),u("/admin/catalog/banners")}catch(e){r(s=>({...s,error:e}))}finally{b(!1)}};if(i.status==="loading")return t.jsx("div",{children:"Loading…"});if(i.status==="failed")return t.jsx("div",{className:"text-red-600",children:((x=i.error)==null?void 0:x.message)||"Failed to load"});const l=i.form;return t.jsxs("div",{className:"relative",children:[t.jsx(y,{visible:f,label:n?"Updating banner…":"Saving banner…"}),t.jsxs("form",{onSubmit:p,className:"max-w-2xl bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-4",children:[t.jsxs("h1",{className:"text-xl font-semibold mb-4",children:[n?"Edit":"New"," Banner"]}),i.error?t.jsx("div",{className:"mb-3 text-sm text-red-600",children:((g=i.error)==null?void 0:g.message)||"Save failed"}):null,t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Title"}),t.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.title,onChange:a=>r(e=>({...e,form:{...e.form,title:a.target.value}}))})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Description"}),t.jsx("textarea",{rows:3,className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.description,onChange:a=>r(e=>({...e,form:{...e.form,description:a.target.value}}))})]}),t.jsx("div",{className:"md:col-span-2",children:t.jsx(_,{label:"Web Image",value:l.web_image,onChange:a=>r(e=>({...e,form:{...e.form,web_image:a}})),altText:l.web_image_alt,onAltChange:a=>r(e=>({...e,form:{...e.form,web_image_alt:a}})),folder:"banners",requiredPerm:"uploads:write"})}),t.jsx("div",{className:"md:col-span-2",children:t.jsx(_,{label:"Mobile Image",value:l.mobile_image,onChange:a=>r(e=>({...e,form:{...e.form,mobile_image:a}})),altText:l.mobile_image_alt,onAltChange:a=>r(e=>({...e,form:{...e.form,mobile_image_alt:a}})),folder:"banners",requiredPerm:"uploads:write"})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Link Attraction"}),t.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.linked_attraction_id||"",onChange:a=>r(e=>({...e,form:{...e.form,linked_attraction_id:a.target.value,linked_offer_id:""}})),children:[t.jsx("option",{value:"",children:"—"}),(i.attractions||[]).map(a=>t.jsx("option",{value:a.attraction_id,children:a.title},a.attraction_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Link Offer"}),t.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:l.linked_offer_id||"",onChange:a=>r(e=>({...e,form:{...e.form,linked_offer_id:a.target.value,linked_attraction_id:""}})),children:[t.jsx("option",{value:"",children:"—"}),(i.offers||[]).map(a=>t.jsx("option",{value:a.offer_id,children:a.title},a.offer_id))]})]}),t.jsxs("div",{className:"flex items-center gap-2 md:col-span-2",children:[t.jsx("input",{id:"active",type:"checkbox",checked:!!l.active,onChange:a=>r(e=>({...e,form:{...e.form,active:a.target.checked}}))}),t.jsx("label",{htmlFor:"active",className:"text-sm text-gray-700 dark:text-neutral-200",children:"Active"})]})]}),t.jsxs("div",{className:"mt-4 flex gap-2",children:[t.jsx("button",{type:"submit",disabled:f,className:"rounded-md bg-gray-900 text-white px-4 py-2 text-sm disabled:opacity-60 disabled:cursor-not-allowed",children:f?"Saving…":"Save"}),t.jsx("button",{type:"button",className:"rounded-md border px-4 py-2 text-sm",onClick:()=>u(-1),children:"Cancel"})]})]})]})}export{R as default};
