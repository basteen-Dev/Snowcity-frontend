import{B as ie,g as de,h as ce,u as N,R as a,i as X,k as Y,$ as ue,j as e,L as l,a0 as J}from"./index-Buz5vlJT.js";import{g as Q}from"./ids-YExsbyMi.js";import{L as Z}from"./Logo-DteIHnLx.js";const me=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,he=[{code:"+91",label:"India (+91)"},{code:"+1",label:"USA (+1)"},{code:"+971",label:"UAE (+971)"},{code:"+44",label:"UK (+44)"},{code:"+65",label:"Singapore (+65)"}];function xe(h,b){a.useEffect(()=>{function x(p){!h.current||h.current.contains(p.target)||b==null||b()}return document.addEventListener("mousedown",x),document.addEventListener("touchstart",x,{passive:!0}),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("touchstart",x)}},[h,b])}function be(h){a.useEffect(()=>{const b=document.body.style.overflow;return h&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=b}},[h])}function ye(){const h=ie(),b=de(),x=ce(),p=b.pathname.startsWith("/booking"),ee=N(t=>t.attractions.items||[]);N(t=>t.offers.items||[]),N(t=>t.combos.items||[]);const te=N(t=>t.pages.items||[]),o=N(t=>{var s;return(s=t.auth)==null?void 0:s.user}),k=N(t=>{var s;return(s=t.auth)==null?void 0:s.token}),C=((o==null?void 0:o.name)||(o==null?void 0:o.full_name)||(o==null?void 0:o.email)||"Guest").trim(),z=(o==null?void 0:o.email)||"Not provided",R=(o==null?void 0:o.phone)||(o==null?void 0:o.mobile)||"Not provided",[P,g]=a.useState(null),[S,d]=a.useState(!1),[$,f]=a.useState(!1),[U,V]=a.useState(!1),[v,B]=a.useState({name:"",email:"",phone:""}),[I,F]=a.useState("+91"),[w,_]=a.useState(""),[u,A]=a.useState({}),[n,m]=a.useState({sent:!1,code:"",userId:null,debug:"",status:"idle",error:null}),D=((o==null?void 0:o.name)||(o==null?void 0:o.email)||"U").trim().charAt(0).toUpperCase(),G=a.useRef(null);xe(G,()=>{g(null),f(!1)}),a.useEffect(()=>{const t=()=>{window.innerWidth>=768&&d(!1)};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const M=t=>g(s=>s===t?null:t),q=ee.slice(0,12),H=te.slice(0,10);be(S||U);const y="px-4 py-2 rounded-full text-sm font-semibold tracking-wide transition-all duration-300 relative group text-white/85 hover:text-white hover:bg-white/15",se="inline-flex items-center rounded-full border-2 border-white/40 px-5 py-2.5 text-white font-semibold bg-white/5 hover:bg-white/15 hover:border-white/60 transition-all duration-300 backdrop-blur-sm",oe="inline-flex items-center rounded-full px-6 py-2.5 text-sm font-bold bg-gradient-to-r from-sky-500 to-cyan-500 text-white hover:from-sky-600 hover:to-cyan-600 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",L=a.useCallback(()=>{B({name:"",email:"",phone:""}),F("+91"),_(""),A({}),m({sent:!1,code:"",userId:null,debug:"",status:"idle",error:null})},[]),W=a.useCallback(()=>{L(),V(!0)},[L]),E=a.useCallback(()=>{V(!1),L()},[L]),K=(t="")=>t.replace(/[^\d+]/g,""),O=a.useMemo(()=>w?`${I}${w}`:"",[I,w]),le=a.useCallback(t=>{const s=t.replace(/\D/g,"").slice(0,10);_(s),A(i=>({...i,phone:void 0}))},[]),ae=a.useCallback(async()=>{const t=v.name.trim(),s=v.email.trim(),i={};if(s?me.test(s)||(i.email="Enter a valid email address"):i.email="Email is required",w?/^\d{10}$/.test(w)||(i.phone="Enter a valid 10-digit mobile number"):i.phone="Mobile number is required",Object.keys(i).length){A(i),m(r=>({...r,error:null}));return}const j=K(O);try{m(T=>({...T,status:"sending",error:null}));const r={channel:"sms",createIfNotExists:!0,email:s,phone:j,...t&&{name:t}},c=await X.post(Y.auth.otpSend(),r);m(T=>({...T,sent:!0,code:"",userId:(c==null?void 0:c.user_id)||null,debug:(c==null?void 0:c.otp)||"",status:"sent",error:null}))}catch(r){m(c=>({...c,status:"idle",error:(r==null?void 0:r.message)||"Failed to send OTP"}))}},[v,w,O]),ne=a.useCallback(async()=>{const t=(n.code||"").trim();if(!/^\d{6}$/.test(t)){m(s=>({...s,error:"Enter the 6-digit OTP"}));return}try{m(c=>({...c,status:"verifying",error:null}));const s={otp:t};n.userId&&(s.user_id=n.userId);const i=v.email.trim(),j=K(O);n.userId||(i&&(s.email=i),j&&(s.phone=j));const r=await X.post(Y.auth.otpVerify(),s);r!=null&&r.token?(x(ue({user:r.user||null,token:r.token,expires_at:(r==null?void 0:r.expires_at)||null})),E()):m(c=>({...c,status:"idle",error:"Verification failed"}))}catch(s){m(i=>({...i,status:"idle",error:(s==null?void 0:s.message)||"OTP verification failed"}))}},[n,v,O,E,x]),re=U?e.jsxs("div",{className:"fixed inset-0 z-[130] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:E}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 z-[140] max-h-[calc(100vh-4rem)] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sign in to SnowCity"}),e.jsx("button",{className:"p-2 rounded-full bg-gray-100 text-gray-500",onClick:E,children:"âœ•"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Enter your details once. We'll create or find your profile and send an OTP (testing code 123456)."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"w-full p-3 rounded-xl border border-gray-200 focus:border-blue-500 outline-none",placeholder:"Full Name (optional)",type:"text",value:v.name,onChange:t=>B(s=>({...s,name:t.target.value}))}),e.jsx("input",{className:`w-full p-3 rounded-xl border focus:border-blue-500 outline-none ${u!=null&&u.email?"border-red-300":"border-gray-200"}`,placeholder:"Email",type:"email",required:!0,autoComplete:"email",value:v.email,onChange:t=>{B(s=>({...s,email:t.target.value})),u.email&&A(s=>({...s,email:void 0}))}}),u.email&&e.jsx("p",{className:"text-xs text-red-500",children:u.email}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative w-32",children:[e.jsx("select",{className:"w-full pl-3 pr-8 p-3 rounded-xl bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none appearance-none text-sm font-medium",value:I,onChange:t=>F(t.target.value),children:he.map(t=>e.jsx("option",{value:t.code,children:t.code},t.code))}),e.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-500",children:"â–¾"})]}),e.jsx("input",{className:`flex-1 p-3 rounded-xl border focus:border-blue-500 outline-none tracking-wide ${u!=null&&u.phone?"border-red-300":"border-gray-200"}`,placeholder:"98765 43210",type:"tel",maxLength:10,required:!0,pattern:"[0-9]{10}",value:w,onChange:t=>le(t.target.value)})]}),u.phone&&e.jsx("p",{className:"text-xs text-red-500",children:u.phone}),e.jsx("button",{className:"w-full py-3 rounded-xl bg-gray-900 text-white font-semibold hover:bg-black disabled:opacity-60",onClick:ae,disabled:n.status==="sending",children:n.status==="sending"?"Sending...":n.sent?"Resend OTP":"Send OTP"}),n.sent&&e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("input",{className:"flex-1 p-3 rounded-xl border border-blue-200 focus:border-blue-500 outline-none text-center tracking-widest font-mono",maxLength:6,inputMode:"numeric",pattern:"[0-9]*",value:n.code,onChange:t=>m(s=>({...s,code:t.target.value}))}),e.jsx("button",{className:"px-5 py-3 rounded-xl bg-blue-600 text-white font-semibold hover:bg-blue-700",onClick:ne,disabled:n.status==="verifying",children:n.status==="verifying"?"Verifying...":"Verify"})]}),n.debug&&e.jsxs("div",{className:"text-xs text-green-700 bg-green-50 border border-green-100 rounded-xl p-2",children:["Testing OTP:"," ",e.jsx("span",{className:"font-mono font-semibold",children:n.debug})]}),n.error&&e.jsx("div",{className:"text-xs text-red-600 bg-red-50 border border-red-100 rounded-xl p-2",children:n.error})]})]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("nav",{ref:G,"data-floating-nav":!0,className:`fixed z-30 transition-all duration-300 ${p?"top-0 left-0 right-0 w-full translate-x-0":"top-4 left-1/2 -translate-x-1/2 w-[94%] max-w-[1400px]"}`,children:[e.jsxs("div",{className:`hidden md:flex items-center justify-between gap-6 px-8 py-4 transition-all duration-300 ${p?"rounded-none":"rounded-[30px]"} bg-gradient-to-r from-slate-900/60 via-slate-800/50 to-slate-900/60 text-white border border-white/20 backdrop-blur-3xl shadow-2xl`,style:{boxShadow:p?"none":"0 8px 32px rgba(15, 23, 42, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[e.jsx(l,{to:"/",className:"flex items-center gap-2",children:e.jsx("img",{src:Z,alt:"SnowCity Logo",className:"h-8 w-auto object-contain brightness-125"})}),e.jsxs("div",{className:"flex items-center gap-3 text-sm font-medium",children:[e.jsx(l,{to:"/",className:y,children:"Home"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:y,onClick:()=>M("attr"),children:"Attractions â–¾"}),P==="attr"&&e.jsx("div",{className:"absolute right-0 top-full mt-3 w-64 rounded-2xl border border-white/20 bg-white/10 backdrop-blur-2xl shadow-2xl p-3 z-[110]",style:{boxShadow:"0 25px 50px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:e.jsxs("div",{className:"max-h-72 overflow-y-auto",children:[q.map((t,s)=>{const i=Q(t),j=(t==null?void 0:t.name)||(t==null?void 0:t.title)||"Attraction";return e.jsx(l,{to:`/attractions/${i}`,className:"block px-4 py-2.5 text-sm text-gray-900 hover:bg-white/80 rounded-lg transition-all duration-200 font-medium",onClick:()=>g(null),children:j},s)}),e.jsx(l,{to:"/attractions",className:"block px-4 py-2.5 text-blue-600 text-sm hover:bg-blue-100 rounded-lg transition-all duration-200 font-semibold border-t border-white/20 mt-2 pt-3",onClick:()=>g(null),children:"View All â†’"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:y,onClick:()=>M("offers"),children:"Offers â–¾"}),P==="offers"&&e.jsxs("div",{className:"absolute right-0 top-full mt-3 w-56 rounded-2xl border border-white/20 bg-white/10 backdrop-blur-2xl shadow-2xl p-3 z-[110]",style:{boxShadow:"0 25px 50px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:[e.jsx(l,{to:"/offers",className:"block px-4 py-2.5 text-sm text-gray-900 hover:bg-white/80 rounded-lg transition-all duration-200 font-medium",onClick:()=>g(null),children:"All Offers"}),e.jsx(l,{to:"/combos",className:"block px-4 py-2.5 text-sm text-gray-900 hover:bg-white/80 rounded-lg transition-all duration-200 font-medium",onClick:()=>g(null),children:"Combo Deals"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:y,onClick:()=>M("guide"),children:"Visitor Guide â–¾"}),P==="guide"&&e.jsx("div",{className:"absolute right-0 top-full mt-3 w-64 rounded-2xl border border-white/20 bg-white/10 backdrop-blur-2xl shadow-2xl p-3 z-[110]",style:{boxShadow:"0 25px 50px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:H.map((t,s)=>e.jsx(l,{to:`/page/${t.slug||t.id}`,className:"block px-4 py-2.5 text-sm text-gray-900 hover:bg-white/80 rounded-lg transition-all duration-200 font-medium",onClick:()=>g(null),children:t.title||t.name},s))})]}),e.jsx(l,{to:"/contact",className:y,children:"Contact Us"}),e.jsx(l,{to:"/blogs",className:y,children:"Blogs"}),!k&&e.jsx("button",{className:se,onClick:W,children:"ğŸ” Sign In"}),e.jsx("button",{className:oe,onClick:()=>h("/booking"),children:"ğŸŸï¸ Book Tickets"}),k&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"h-10 w-10 rounded-full flex items-center justify-center text-sm font-bold bg-gradient-to-br from-sky-400 to-cyan-500 text-white hover:from-sky-500 hover:to-cyan-600 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-110",onClick:()=>f(t=>!t),title:C,children:D}),$&&e.jsxs("div",{className:"absolute right-0 top-full mt-3 w-56 rounded-2xl border border-white/20 bg-white/10 backdrop-blur-2xl shadow-2xl p-3 z-[110]",style:{boxShadow:"0 25px 50px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:[e.jsx(l,{to:"/my-bookings",className:"block px-4 py-2.5 text-gray-900 hover:bg-white/80 rounded-lg text-sm font-medium transition-all duration-200",onClick:()=>f(!1),children:"ğŸ“‹ My Bookings"}),e.jsxs("div",{className:"px-4 py-3 mt-2 rounded-lg bg-white/20 border border-white/20 text-xs text-gray-900",children:[e.jsx("p",{className:"font-bold text-gray-900 text-sm mb-2",children:"Account Details"}),e.jsxs("p",{className:"leading-relaxed mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",C||"Guest"]}),e.jsxs("p",{className:"leading-relaxed mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",R]}),e.jsxs("p",{className:"leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",z]})]}),e.jsx("button",{className:"w-full px-4 py-2.5 mt-3 text-red-500 hover:bg-red-100 rounded-lg text-sm font-semibold transition-all duration-200",onClick:()=>{x(J()),f(!1)},children:"ğŸšª Logout"})]})]})]})]}),e.jsxs("div",{className:`md:hidden px-4 py-3 flex items-center justify-between transition-all duration-300 ${p?"rounded-none":"rounded-[26px]"} bg-gradient-to-r from-slate-900/65 via-slate-800/55 to-slate-900/65 text-white border border-white/20 backdrop-blur-3xl shadow-2xl`,style:{boxShadow:p?"none":"0 8px 32px rgba(15, 23, 42, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[e.jsx("button",{className:"p-2.5 rounded-full bg-white/10 hover:bg-white/20 text-white transition-all duration-300 hover:scale-110",onClick:()=>d(t=>!t),"aria-expanded":S,"aria-label":"Open menu",children:S?"âœ•":"â˜°"}),e.jsx(l,{to:"/","aria-label":"Home",children:e.jsx("img",{src:Z,alt:"SnowCity Logo",className:"h-8 transition brightness-125"})}),e.jsx("div",{className:"relative",children:k?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-sky-400 to-cyan-500 text-white font-bold hover:from-sky-500 hover:to-cyan-600 transition-all duration-300 shadow-lg hover:scale-110",onClick:()=>f(t=>!t),"aria-expanded":$,"aria-label":"Account menu",title:C,children:D}),$&&e.jsxs("div",{className:"absolute right-0 top-full mt-3 w-56 rounded-2xl border border-white/20 bg-white/10 backdrop-blur-2xl shadow-2xl p-3 z-[110]",style:{boxShadow:"0 25px 50px rgba(0, 0, 0, 0.3)"},children:[e.jsx(l,{to:"/my-bookings",className:"block px-4 py-2.5 text-gray-900 text-sm hover:bg-white/80 rounded-lg font-medium transition-all duration-200",onClick:()=>{f(!1),d(!1)},children:"ğŸ“‹ My Bookings"}),e.jsxs("div",{className:"px-4 py-3 mt-2 rounded-lg bg-white/20 border border-white/20 text-xs text-gray-900",children:[e.jsx("p",{className:"font-bold text-gray-900 text-sm mb-2",children:"Account"}),e.jsxs("p",{className:"leading-relaxed mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",C||"Guest"]}),e.jsxs("p",{className:"leading-relaxed mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",R]}),e.jsxs("p",{className:"leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",z]})]}),e.jsx("button",{className:"w-full px-4 py-2.5 mt-3 text-red-500 hover:bg-red-100 rounded-lg text-sm font-semibold transition-all duration-200",onClick:()=>{x(J()),f(!1),d(!1)},children:"ğŸšª Logout"})]})]}):e.jsx("div",{className:"h-10 w-10"})})]}),S&&e.jsxs("div",{className:"md:hidden fixed left-2 right-2 top-[4.25rem] z-[120] rounded-2xl px-4 py-4 space-y-2 max-h-[calc(100vh-6rem)] overflow-y-auto border border-white/20 backdrop-blur-2xl shadow-2xl",style:{backgroundColor:"rgba(30, 41, 59, 0.7)",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[e.jsx(l,{to:"/",className:"block py-3 px-4 text-white hover:text-sky-300 font-semibold transition-all duration-200 rounded-lg hover:bg-white/10",onClick:()=>d(!1),children:"ğŸ  Home"}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer py-3 px-4 text-white hover:text-sky-300 font-semibold transition-all duration-200 rounded-lg hover:bg-white/10 list-none",children:"ğŸ¢ Attractions"}),e.jsxs("div",{className:"pl-4 space-y-1 mt-2 pb-3 border-t border-white/20 pt-3",children:[q.slice(0,8).map((t,s)=>e.jsxs(l,{to:`/attractions/${Q(t)}`,className:"block py-2 pl-4 text-white/80 hover:text-white font-medium hover:bg-white/10 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:["â€¢ ",t.name||t.title]},s)),e.jsx(l,{to:"/attractions",className:"block py-2 pl-4 text-sky-300 font-bold hover:bg-white/10 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:"â†’ View All"})]})]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer py-3 px-4 text-white hover:text-sky-300 font-semibold transition-all duration-200 rounded-lg hover:bg-white/10 list-none",children:"ğŸ Offers"}),e.jsxs("div",{className:"pl-4 space-y-1 mt-2 pb-3 border-t border-white/20 pt-3",children:[e.jsx(l,{to:"/offers",className:"block py-2 pl-4 text-white/80 hover:text-white font-medium hover:bg-white/10 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:"â€¢ All Offers"}),e.jsx(l,{to:"/combos",className:"block py-2 pl-4 text-white/80 hover:text-white font-medium hover:bg-white/10 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:"â€¢ Combo Deals"})]})]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer py-3 px-4 text-white hover:text-sky-300 font-semibold transition-all duration-200 rounded-lg hover:bg-white/10 list-none",children:"ğŸ“– Visitor Guide"}),e.jsx("div",{className:"pl-4 space-y-1 mt-2 pb-3 border-t border-white/20 pt-3",children:H.map((t,s)=>e.jsxs(l,{to:`/page/${t.slug||t.id}`,className:"block py-2 pl-4 text-white/80 hover:text-white font-medium hover:bg-white/10 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:["â€¢ ",t.title||t.name]},s))})]}),e.jsx(l,{to:"/contact",className:"block py-3 px-4 text-white hover:text-sky-300 font-semibold transition-all duration-200 rounded-lg hover:bg-white/10 border-t border-white/20 mt-3 pt-4",onClick:()=>d(!1),children:"ğŸ“ Contact Us"}),e.jsx(l,{to:"/blogs",className:"block py-3 px-4 text-white hover:text-sky-300 font-semibold transition-all duration-200 rounded-lg hover:bg-white/10",onClick:()=>d(!1),children:"ğŸ“° Blogs"}),e.jsxs("div",{className:"space-y-2 border-t border-white/20 mt-4 pt-4",children:[!k&&e.jsx("button",{className:"w-full py-3 border-2 border-sky-400 text-sky-300 font-bold rounded-full hover:bg-sky-500/20 transition-all duration-300",onClick:()=>{d(!1),W()},children:"ğŸ” Sign In"}),e.jsx("button",{className:"w-full py-3 bg-gradient-to-r from-sky-500 to-cyan-500 text-white font-bold rounded-full hover:from-sky-600 hover:to-cyan-600 shadow-lg transition-all duration-300 hover:scale-105",onClick:()=>{d(!1),h("/booking")},children:"ğŸŸï¸ Book Tickets"})]})]})]}),re]})}export{ye as default};
