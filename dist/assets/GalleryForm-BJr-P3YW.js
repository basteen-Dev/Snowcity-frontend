import{C as S,B as I,R as c,j as e}from"./index-Buz5vlJT.js";import{a as m,A as u}from"./AdminApp-DjyjDDmt.js";import{I as A}from"./ImageUploader-Dj1uckPh.js";import{u as E}from"./useCatalogTargets-cyje0ZQq.js";import"./createLucideIcon-BEwYts5j.js";import"./file-text-CuRCFKVY.js";import"./ticket-B65mU2v0.js";import"./media-DTTax9V0.js";function U(){var v,h;const{id:n}=S(),x=I(),i=!!n,[s,o]=c.useState({status:i?"loading":"idle",error:null,form:{media_type:"image",url:"",title:"",description:"",active:!0,target_type:"none",target_ref_id:null}});c.useEffect(()=>{i&&(async()=>{try{const t=await m.get(u.galleryById(n)),r=(t==null?void 0:t.gallery)||t||{};o(d=>({...d,status:"idle",form:{media_type:r.media_type||"image",url:r.url||"",title:r.title||"",description:r.description||"",active:r.active!==void 0?!!r.active:!0,target_type:r.target_type||"none",target_ref_id:r.target_ref_id||null}}))}catch(t){o(r=>({...r,status:"failed",error:t}))}})()},[n,i]);const l=t=>o(r=>({...r,form:{...r.form,...t}})),{attractions:g=[],combos:p=[],status:b}=E(),j=c.useMemo(()=>({attraction:g.map(t=>({value:t.attraction_id||t.id,label:t.title||t.name||`Attraction #${t.attraction_id||t.id}`})),combo:p.map(t=>({value:t.combo_id||t.id,label:t.title||t.name||`Combo #${t.combo_id||t.id}`}))}),[g,p]),k=async t=>{t.preventDefault();try{const{media_type:r,url:d,title:_,description:N,active:w,target_type:y,target_ref_id:C}=s.form;if(!r||!d)throw new Error("Media type and URL are required");const f={media_type:r,url:d,title:_,description:N,active:w,target_type:y,target_ref_id:y==="none"?null:C||null};i?await m.put(u.galleryById(n),f):await m.post(u.gallery(),f),x("/admin/catalog/gallery")}catch(r){o(d=>({...d,error:r}))}};if(s.status==="loading")return e.jsx("div",{children:"Loading…"});if(s.status==="failed")return e.jsx("div",{className:"text-red-600",children:((v=s.error)==null?void 0:v.message)||"Failed to load"});const a=s.form;return e.jsxs("form",{onSubmit:k,className:"max-w-2xl bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-4",children:[e.jsxs("h1",{className:"text-xl font-semibold mb-4",children:[i?"Edit":"New"," Gallery Item"]}),s.error?e.jsx("div",{className:"mb-3 text-sm text-red-600",children:((h=s.error)==null?void 0:h.message)||"Save failed"}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Media Type"}),e.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:a.media_type,onChange:t=>l({media_type:t.target.value}),children:[e.jsx("option",{value:"image",children:"Image"}),e.jsx("option",{value:"video",children:"Video"})]})]}),e.jsx("div",{className:"md:col-span-2",children:a.media_type==="image"?e.jsx(A,{label:"Image",value:a.url,onChange:t=>l({url:t}),requiredPerm:"uploads:write"}):e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Video URL"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",placeholder:"https://…",value:a.url,onChange:t=>l({url:t.target.value})})]})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Title"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:a.title,onChange:t=>l({title:t.target.value})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Description"}),e.jsx("textarea",{rows:3,className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:a.description,onChange:t=>l({description:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Link to"}),e.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:a.target_type,onChange:t=>l({target_type:t.target.value,target_ref_id:null}),children:[e.jsx("option",{value:"none",children:"No specific page"}),e.jsx("option",{value:"attraction",children:"Attraction"}),e.jsx("option",{value:"combo",children:"Combo"})]})]}),a.target_type!=="none"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:a.target_type==="attraction"?"Select attraction":"Select combo"}),e.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:a.target_ref_id||"",onChange:t=>l({target_ref_id:t.target.value?Number(t.target.value):null}),disabled:b==="loading",children:[e.jsx("option",{value:"",children:b==="loading"?"Loading…":"Select an option"}),(j[a.target_type]||[]).map(t=>e.jsx("option",{value:t.value||"",children:t.label},`${a.target_type}-${t.value}`))]})]}):null,e.jsxs("div",{className:"flex items-center gap-2 md:col-span-2",children:[e.jsx("input",{id:"active",type:"checkbox",checked:!!a.active,onChange:t=>l({active:t.target.checked})}),e.jsx("label",{htmlFor:"active",className:"text-sm text-gray-700 dark:text-neutral-200",children:"Active"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Preview"}),e.jsx("div",{className:"w-full h-48 rounded-md overflow-hidden bg-gray-100 flex items-center justify-center",children:a.url?a.media_type==="video"?e.jsx("video",{className:"w-full h-full object-cover",src:a.url,muted:!0,controls:!0,preload:"metadata"}):e.jsx("img",{className:"w-full h-full object-cover",src:a.url,alt:a.title||"Preview"}):e.jsx("div",{className:"text-sm text-gray-500",children:"No media selected"})})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{type:"submit",className:"rounded-md bg-gray-900 text-white px-4 py-2 text-sm",children:"Save"}),e.jsx("button",{type:"button",className:"rounded-md border px-4 py-2 text-sm",onClick:()=>x(-1),children:"Cancel"})]})]})}export{U as default};
