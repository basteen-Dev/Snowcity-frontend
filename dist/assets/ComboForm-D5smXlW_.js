import{D as L,C as T,R as f,j as e}from"./index-C5Mz9dTM.js";import{a as x,A as b}from"./AdminApp-C7IcGGGV.js";import{I as S}from"./ImageUploader-DAvc2Cys.js";import"./createLucideIcon-DQ6FqzLt.js";import"./file-text-CQ7rExmv.js";import"./ticket-C3bgGsni.js";import"./media-DDlhmRHE.js";function z(){var h,v,j,N,y,k,w,C,A;const{id:m}=L(),p=T(),d=!!m,[o,l]=f.useState({status:d?"loading":"idle",error:null,attractions:[],form:{name:"",slug:"",attraction_ids:d?[]:["",""],attraction_prices:{},total_price:0,image_url:"",desktop_image_url:"",discount_percent:0,active:!0,meta_title:""}});f.useEffect(()=>{(async()=>{try{const a=await x.get(b.attractions()),t=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];l(s=>({...s,attractions:t}))}catch{}})()},[]),f.useEffect(()=>{d&&(async()=>{try{const a=await x.get(b.comboById(m)),t=(a==null?void 0:a.combo)||a||{};let s={name:t.name||"",slug:t.slug||"",attraction_ids:[],attraction_prices:{},total_price:0,image_url:t.image_url||"",desktop_image_url:t.desktop_image_url||"",discount_percent:t.discount_percent||0,active:!!t.active,meta_title:t.meta_title||""};t.attraction_1_id&&t.attraction_2_id?(s.attraction_ids=[t.attraction_1_id,t.attraction_2_id],s.attraction_prices={[t.attraction_1_id]:(t.combo_price||0)/2,[t.attraction_2_id]:(t.combo_price||0)/2},s.total_price=t.combo_price||0):(s.attraction_ids=t.attraction_ids||[],s.attraction_prices=t.attraction_prices||{},s.total_price=Number(t.total_price||0)),l(i=>({...i,status:"idle",form:s}))}catch(a){l(t=>({...t,status:"failed",error:a}))}})()},[m,d]);const E=async a=>{var t,s,i;a.preventDefault();try{const r=o.form;if(!r.name||r.name.trim()===""){alert("Please enter a combo name");return}if(!r.attraction_ids||r.attraction_ids.length<2){alert("Select at least two attractions");return}for(const u of r.attraction_ids)if(!r.attraction_prices[u]||r.attraction_prices[u]<=0){const _=o.attractions.find(O=>O.attraction_id===u);alert(`Please set a valid price for ${(_==null?void 0:_.title)||"attraction"}`);return}const c={name:r.name.trim(),slug:((t=r.slug)==null?void 0:t.trim())||null,attraction_ids:r.attraction_ids,attraction_prices:r.attraction_prices,total_price:Number(r.total_price||0),image_url:((s=r.image_url)==null?void 0:s.trim())||null,discount_percent:Number(r.discount_percent||0),active:!!r.active};d?await x.put(b.comboById(m),c):await x.post(b.combos(),c),p("/admin/catalog/combos")}catch(r){console.error("Combo save error:",r),console.error("Error data:",r==null?void 0:r.data),console.error("Error status:",r==null?void 0:r.status),console.error("Error details:",(i=r==null?void 0:r.data)==null?void 0:i.details),l(c=>({...c,error:r}))}};if(o.status==="loading")return e.jsx("div",{children:"Loading…"});if(o.status==="failed")return e.jsx("div",{className:"text-red-600",children:((h=o.error)==null?void 0:h.message)||"Failed to load"});if(o.error&&o.error!=="Failed to load")return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error"}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsx("div",{className:"text-red-800 font-semibold mb-2",children:((j=(v=o.error)==null?void 0:v.data)==null?void 0:j.error)||"Save Failed"}),e.jsx("div",{className:"text-red-700 text-sm mb-2",children:((y=(N=o.error)==null?void 0:N.data)==null?void 0:y.message)||((k=o.error)==null?void 0:k.message)}),((C=(w=o.error)==null?void 0:w.data)==null?void 0:C.details)&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-red-800 font-medium text-sm mb-1",children:"Validation Details:"}),e.jsx("ul",{className:"text-red-700 text-sm list-disc list-inside",children:o.error.data.details.map((a,t)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[a.field,":"]})," ",a.message,a.value!==void 0&&e.jsxs("span",{className:"text-red-600 ml-1",children:["(value: ",JSON.stringify(a.value),")"]})]},t))})]}),e.jsx("button",{onClick:()=>l(a=>({...a,error:null})),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Dismiss"})]})]});const n=o.form,P=o.attractions||[],D=()=>{l(a=>({...a,form:{...a.form,attraction_ids:[...a.form.attraction_ids,""]}}))},F=a=>{const t=o.form.attraction_ids.filter((i,r)=>r!==a),s={...o.form.attraction_prices};delete s[o.form.attraction_ids[a]],l(i=>({...i,form:{...i.form,attraction_ids:t,attraction_prices:s}})),g(t,s)},I=(a,t)=>{const s=o.form.attraction_ids[a],i=[...o.form.attraction_ids];i[a]=t;const r={...o.form.attraction_prices};if(s&&s!==t&&delete r[s],t&&!r[t]){const c=o.attractions.find(u=>u.attraction_id===t);r[t]=(c==null?void 0:c.price)||0}l(c=>({...c,form:{...c.form,attraction_ids:i,attraction_prices:r}})),g(i,r)},R=(a,t)=>{const s={...o.form.attraction_prices,[a]:Number(t||0)};l(i=>({...i,form:{...i.form,attraction_prices:s}})),g(o.form.attraction_ids,s)},g=(a,t)=>{const s=a.reduce((i,r)=>i+(Number(t[r])||0),0);l(i=>({...i,form:{...i.form,total_price:s}}))};return e.jsxs("form",{onSubmit:E,className:"max-w-4xl bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-4",children:[e.jsxs("h1",{className:"text-xl font-semibold mb-4",children:[d?"Edit":"New"," Combo"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Combo Name *"}),e.jsx("input",{type:"text",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.name,onChange:a=>l(t=>({...t,form:{...t.form,name:a.target.value}})),placeholder:"Enter combo name",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Slug (URL-friendly identifier)"}),e.jsx("input",{type:"text",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.slug,onChange:a=>l(t=>({...t,form:{...t.form,slug:a.target.value}})),placeholder:"auto-generated-from-name"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:"Leave empty to auto-generate from name. Used in URLs like /combo-your-slug-here"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Meta Title (SEO title)"}),e.jsx("input",{type:"text",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.meta_title,onChange:a=>l(t=>({...t,form:{...t.form,meta_title:a.target.value}})),placeholder:"Custom page title for SEO (leave empty to use default)"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:"Optional custom title for search engines and browser tabs"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300",children:"Attractions *"}),e.jsx("button",{type:"button",onClick:D,className:"text-sm bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700",children:"+ Add Attraction"})]}),n.attraction_ids.length===0&&e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"No attractions selected. Add at least 2 attractions."}),n.attraction_ids.map((a,t)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("select",{className:"flex-1 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:a,onChange:s=>I(t,s.target.value),children:[e.jsx("option",{value:"",children:"— Select attraction —"}),P.map(s=>e.jsx("option",{value:s.attraction_id,disabled:n.attraction_ids.includes(String(s.attraction_id))&&String(s.attraction_id)!==a,children:s.title},s.attraction_id))]}),a&&e.jsx("input",{type:"number",className:"w-32 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.attraction_prices[a]||"",onChange:s=>R(a,s.target.value),placeholder:"Price",min:"0",step:"0.01"}),n.attraction_ids.length>2&&e.jsx("button",{type:"button",onClick:()=>F(t),className:"px-2 py-1 text-red-600 border border-red-300 rounded-md hover:bg-red-50",children:"Remove"})]},t)),n.attraction_ids.length>0&&n.attraction_ids.length<2&&e.jsx("div",{className:"text-orange-600 text-sm mt-1",children:"Please select at least 2 attractions"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-neutral-800 rounded-md",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-neutral-300",children:"Total Combo Price"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["₹",Number(n.total_price||0).toFixed(2)]}),n.attraction_ids.length>0&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:["Based on ",n.attraction_ids.length," attraction(s)"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(S,{label:"Combo Image",value:n.image_url,onChange:a=>l(t=>({...t,form:{...t.form,image_url:a}})),folder:"combos"})}),e.jsx("div",{className:"mb-4",children:e.jsx(S,{label:"Desktop Image (optional)",value:n.desktop_image_url,onChange:a=>l(t=>({...t,form:{...t.form,desktop_image_url:a}})),folder:"combos"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Discount %"}),e.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.discount_percent,onChange:a=>l(t=>({...t,form:{...t.form,discount_percent:Number(a.target.value||0)}})),min:"0",max:"100"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"active",type:"checkbox",checked:!!n.active,onChange:a=>l(t=>({...t,form:{...t.form,active:a.target.checked}}))}),e.jsx("label",{htmlFor:"active",className:"text-sm text-gray-700 dark:text-neutral-200",children:"Active"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Override Total Price (optional)"}),e.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.total_price,onChange:a=>l(t=>({...t,form:{...t.form,total_price:Number(a.target.value||0)}})),min:"0",step:"0.01"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:"Automatically sums attraction prices; adjust if needed."})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{type:"submit",className:"rounded-md bg-gray-900 text-white px-4 py-2 text-sm",children:"Save"}),d&&e.jsx("button",{type:"button",className:"rounded-md bg-blue-600 text-white px-4 py-2 text-sm hover:bg-blue-700",onClick:()=>p(`/admin/catalog/combo-slots?combo_id=${m}`),children:"View Slots"}),e.jsx("button",{type:"button",className:"rounded-md border px-4 py-2 text-sm",onClick:()=>p(-1),children:"Cancel"})]}),o.error?e.jsx("div",{className:"mt-2 text-sm text-red-600",children:((A=o.error)==null?void 0:A.message)||"Error"}):null]})}export{z as default};
