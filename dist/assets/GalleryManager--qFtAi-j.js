import{C as $,R as d,j as a}from"./index-C5Mz9dTM.js";import{a as m,A as u}from"./AdminApp-C7IcGGGV.js";import{A as G}from"./AdminTable-8G2GjJdl.js";import{i as R}from"./media-DDlhmRHE.js";import"./createLucideIcon-DQ6FqzLt.js";import"./file-text-CQ7rExmv.js";import"./ticket-C3bgGsni.js";const T=r=>Array.isArray(r)?r:[],q=r=>r?Array.isArray(r)?{items:r,meta:null}:Array.isArray(r==null?void 0:r.data)?{items:r.data,meta:r.meta||null}:r!=null&&r.data&&typeof r.data=="object"&&Array.isArray(r.data.data)?{items:r.data.data,meta:r.data.meta||r.meta||null}:{items:T(r.items||r.list),meta:r.meta||null}:{items:[],meta:null};function z(){var j,v;const r=$(),[c,p]=d.useState({status:"idle",items:[],error:null}),[i,s]=d.useState({q:"",type:"",category:"all",target_ref_id:""}),[f,A]=d.useState([]),[x,N]=d.useState([]),[h,_]=d.useState(!1),[n,b]=d.useState([]),[g,y]=d.useState({loading:!1,error:null}),o=d.useCallback(async(e=i)=>{p(t=>({...t,status:"loading",error:null}));try{const t={q:e.q||void 0,type:e.type||void 0};e.category==="attraction"&&e.target_ref_id?(t.target_type="attraction",t.target_ref_id=e.target_ref_id):e.category==="combo"&&e.target_ref_id?(t.target_type="combo",t.target_ref_id=e.target_ref_id):e.category==="common"&&(t.target_type="none");const l=await m.get(u.gallery(),{params:t}),{items:D}=q(l);p({status:"succeeded",items:D,error:null}),b([])}catch(t){p(l=>({...l,status:"failed",error:t}))}},[i]);d.useEffect(()=>{o(i)},[o,i]),d.useEffect(()=>{(async()=>{_(!0);try{const[t,l]=await Promise.all([m.get(u.attractions()),m.get(u.combos())]);A(Array.isArray(t)?t:[]),N(Array.isArray(l)?l:[])}catch(t){console.error("Failed to load targets:",t)}finally{_(!1)}})()},[]);const C=async e=>{if(window.confirm(`Are you sure you want to delete "${e.title||"this item"}"?`)){y({loading:!0,error:null});try{const l=(e==null?void 0:e.gallery_item_id)??(e==null?void 0:e.gallery_id)??(e==null?void 0:e.id);await m.delete(u.galleryDelete(l)),await o(i)}catch(l){y({loading:!1,error:l})}}},k=async()=>{if(!(n.length===0||!window.confirm(`Are you sure you want to delete ${n.length} selected items?`))){y({loading:!0,error:null});try{await m.post(u.galleryBulkDelete(),{ids:n}),await o(i)}catch(t){y({loading:!1,error:t})}}},S=[{key:"preview",title:"Preview",render:e=>{const t=e.media_type==="video"||e.url&&e.url.match(/\.(mp4|webm|ogg)$/i),l=e.media_type==="pdf"||e.url&&e.url.match(/\.pdf$/i);return a.jsx("div",{className:"w-20 h-14 rounded-md overflow-hidden bg-gray-100",children:t?a.jsx("video",{src:e.url,className:"w-full h-full object-cover",muted:!0}):l?a.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):a.jsx("img",{src:R(e)||e.url,alt:e.title||"Gallery media",className:"w-full h-full object-cover",loading:"lazy"})})}},{key:"title",title:"Title"},{key:"media_type",title:"Type"},{key:"target",title:"Linked To",render:e=>{if(!e.target_type||e.target_type==="none")return"Common Gallery";if(e.target_type==="attraction"){const t=f.find(l=>(l.attraction_id||l.id)===e.target_ref_id);return t?`Attraction: ${t.title||t.name}`:`Attraction #${e.target_ref_id}`}if(e.target_type==="combo"){const t=x.find(l=>(l.combo_id||l.id)===e.target_ref_id);return t?`Combo: ${t.title||t.name}`:`Combo #${e.target_ref_id}`}return e.target_type}},{key:"status",title:"Status"},{key:"priority",title:"Priority"},{key:"created_at",title:"Created"},{key:"updated_at",title:"Updated"}];return a.jsxs("div",{children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Gallery"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Manage homepage and gallery media assets."})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>r("/admin/catalog/banners"),children:"Manage Banners"}),a.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm",onClick:()=>r("/admin/catalog/gallery/new"),children:"Add Media"}),n.length>0&&a.jsx("button",{className:"rounded-md bg-red-600 text-white px-3 py-2 text-sm disabled:opacity-50",onClick:k,disabled:g.loading,children:g.loading?"Deleting...":`Delete Selected (${n.length})`})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 mb-4",children:[a.jsx("input",{className:"rounded-md border px-3 py-2",placeholder:"Search title",value:i.q,onChange:e=>s(t=>({...t,q:e.target.value}))}),a.jsxs("select",{className:"rounded-md border px-3 py-2",value:i.type,onChange:e=>s(t=>({...t,type:e.target.value})),children:[a.jsx("option",{value:"",children:"Type: All"}),a.jsx("option",{value:"image",children:"Images"}),a.jsx("option",{value:"video",children:"Videos"}),a.jsx("option",{value:"pdf",children:"PDFs"})]}),a.jsxs("select",{className:"rounded-md border px-3 py-2",value:i.category,onChange:e=>s(t=>({...t,category:e.target.value,target_ref_id:""})),children:[a.jsx("option",{value:"all",children:"All Gallery"}),a.jsx("option",{value:"common",children:"Common Gallery"}),a.jsx("option",{value:"attraction",children:"Attraction Gallery"}),a.jsx("option",{value:"combo",children:"Combo Gallery"})]}),i.category==="attraction"&&a.jsxs("select",{className:"rounded-md border px-3 py-2",value:i.target_ref_id,onChange:e=>s(t=>({...t,target_ref_id:e.target.value})),disabled:h,children:[a.jsx("option",{value:"",children:"Select attraction"}),f.map(e=>a.jsx("option",{value:e.attraction_id||e.id,children:e.title||e.name||`Attraction #${e.attraction_id||e.id}`},e.attraction_id||e.id))]}),i.category==="combo"&&a.jsxs("select",{className:"rounded-md border px-3 py-2",value:i.target_ref_id,onChange:e=>s(t=>({...t,target_ref_id:e.target.value})),disabled:h,children:[a.jsx("option",{value:"",children:"Select combo"}),x.map(e=>a.jsx("option",{value:e.combo_id||e.id,children:e.title||e.name||`Combo #${e.combo_id||e.id}`},e.combo_id||e.id))]})]}),a.jsxs("div",{className:"flex gap-2 mb-4",children:[a.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>o(i),disabled:c.status==="loading",children:"Apply"}),a.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>{s({q:"",type:"",category:"all",target_ref_id:""}),o({q:"",type:"",category:"all",target_ref_id:""})},children:"Reset"})]}),c.status==="failed"&&a.jsxs("div",{className:"mb-4 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-600",children:["Failed to load gallery items. ",((j=c.error)==null?void 0:j.message)||""]}),g.error&&a.jsxs("div",{className:"mb-4 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-600",children:["Delete failed. ",((v=g.error)==null?void 0:v.message)||""]}),a.jsx(G,{keyField:"gallery_item_id",columns:S,rows:c.items,showSelection:!0,selectedItems:n,onSelectionChange:b,actions:[{label:"Delete",onClick:C,className:"bg-red-100 hover:bg-red-200 text-red-700",title:"Delete this item"}],onRowClick:e=>{const t=(e==null?void 0:e.gallery_item_id)??(e==null?void 0:e.gallery_id)??(e==null?void 0:e.id);t!=null&&r(`/admin/catalog/gallery/${t}`)},empty:c.status==="loading"?"Loadingâ€¦":"No media found"})]})}export{z as default};
