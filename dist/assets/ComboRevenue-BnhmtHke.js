import{u as $,R as d,j as t}from"./index-D_x0VcQ4.js";import{a as N,A as h}from"./AdminApp-Ct7HyYhZ.js";import{F as T}from"./file-spreadsheet-CnCPFbD5.js";import{F as E}from"./file-text-B8djhIpu.js";import"./createLucideIcon-CDLCmtzs.js";import"./ticket-5vjBYnJB.js";const A=({title:o,subtitle:l,children:g,className:n=""})=>t.jsxs("div",{className:`rounded-2xl border border-gray-200 bg-white p-5 shadow-sm dark:bg-neutral-900 dark:border-neutral-800 ${n}`,children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-neutral-100",children:o}),l?t.jsx("p",{className:"text-xs text-gray-500",children:l}):null]})}),g]}),S=({icon:o,label:l,value:g,note:n,accent:f="from-blue-500 to-indigo-600"})=>t.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white shadow-sm p-4 dark:bg-neutral-900 dark:border-neutral-800",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:l}),t.jsx("div",{className:`mt-2 text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r ${f}`,children:g})]}),o]}),n?t.jsx("div",{className:"text-xs text-gray-500 mt-2",children:n}):null]}),R=o=>`â‚¹${Number(o||0).toLocaleString()}`,P=o=>Number(o||0).toLocaleString();function H(){const{user:o}=$(e=>e.adminAuth),[l,g]=d.useState([]),[n,f]=d.useState([]),[c,y]=d.useState("idle"),[r,F]=d.useState(null),[k,v]=d.useState("idle"),[a,m]=d.useState({attraction_id:"",combo_id:"",from:"",to:""});d.useEffect(()=>{let e=!1;return(async()=>{y("loading");try{const[s,u]=await Promise.all([N.get(h.attractions(),{params:{limit:1e3}}),N.get(h.combos(),{params:{limit:1e3}})]);if(e)return;let b=Array.isArray(s.data)?s.data:Array.isArray(s)?s:[],x=Array.isArray(u.data)?u.data:Array.isArray(u)?u:[];const j=Array.isArray(o==null?void 0:o.roles)?o.roles.map(p=>String(p).toLowerCase()):[],C=(o==null?void 0:o.scopes)||{};if(j.includes("subadmin")&&!j.includes("admin")&&!j.includes("root")){const p=C.attraction||[],_=C.combo||[];p.length>0&&(b=b.filter(i=>p.includes(i.attraction_id)||p.includes(i.id)),!a.attraction_id&&b.length>0&&m(i=>({...i,attraction_id:b[0].attraction_id||b[0].id}))),_.length>0&&(x=x.filter(i=>_.includes(i.combo_id)||_.includes(i.id)),!a.combo_id&&x.length>0&&m(i=>({...i,combo_id:x[0].combo_id||x[0].id})))}g(b),f(x),y("succeeded")}catch(s){if(e)return;console.error("Error loading data:",s),y("failed")}})(),()=>{e=!0}},[o]);const L=d.useCallback(async()=>{v("loading");try{const e={};a.attraction_id&&(e.attraction_id=a.attraction_id),a.combo_id&&(e.combo_id=a.combo_id),a.from&&(e.from=a.from),a.to&&(e.to=a.to);const s=await N.get(h.analyticsComboRevenue(),{params:e});F(s||{}),v("succeeded")}catch(e){console.error("Error loading revenue data:",e),v("failed")}},[a]),w=d.useCallback(e=>{try{const s={type:"combo-revenue",...a.attraction_id&&{attraction_id:a.attraction_id},...a.combo_id&&{combo_id:a.combo_id},...a.from&&{from:a.from},...a.to&&{to:a.to}},u=`${h.analyticsReport(e)}?${new URLSearchParams(s).toString()}`;window.open(u,"_blank")}catch(s){console.error("Download failed:",s),alert("Failed to download report")}},[a]);return t.jsxs("div",{className:"space-y-4 p-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-neutral-100",children:"Combo Revenue"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400",children:"Track revenue from combo bookings"})]}),t.jsx(A,{title:"Filters",subtitle:"Slice data by attraction, combo and date range",className:"p-4",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mb-4",children:[t.jsxs("select",{className:"rounded-lg border px-3 py-2 disabled:opacity-50",value:a.attraction_id,onChange:e=>m({...a,attraction_id:e.target.value}),disabled:c==="loading",children:[t.jsx("option",{value:"",children:c==="loading"?"Loading...":"All Attractions"}),c==="succeeded"&&l.map(e=>t.jsx("option",{value:e.attraction_id||e.id,children:e.title||e.name||`#${e.attraction_id||e.id}`},e.attraction_id||e.id))]}),t.jsxs("select",{className:"rounded-lg border px-3 py-2 disabled:opacity-50",value:a.combo_id,onChange:e=>m({...a,combo_id:e.target.value}),disabled:c==="loading",children:[t.jsx("option",{value:"",children:c==="loading"?"Loading...":"All Combos"}),c==="succeeded"&&n.map(e=>t.jsx("option",{value:e.combo_id||e.id,children:e.title||e.name||`Combo #${e.combo_id||e.id}`},e.combo_id||e.id))]}),t.jsx("input",{type:"date",className:"rounded-lg border px-3 py-2",value:a.from,onChange:e=>m({...a,from:e.target.value}),placeholder:"From date"}),t.jsx("input",{type:"date",className:"rounded-lg border px-3 py-2",value:a.to,onChange:e=>m({...a,to:e.target.value}),placeholder:"To date"}),t.jsx("button",{className:"rounded-lg bg-gray-900 text-white px-3 py-2 text-sm",onClick:L,children:"Apply"})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx(S,{label:"Total Bookings",value:P(r==null?void 0:r.combo_bookings),accent:"from-blue-500 to-indigo-600"}),t.jsx(S,{label:"Total Revenue",value:R(r==null?void 0:r.combo_revenue),accent:"from-green-500 to-emerald-600"}),t.jsx(S,{label:"Average Per Booking",value:R(((r==null?void 0:r.combo_revenue)||0)/((r==null?void 0:r.combo_bookings)||1)),accent:"from-purple-500 to-pink-600"})]}),t.jsx(A,{title:"Revenue Report",subtitle:"Download detailed reports",className:"p-4",children:t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-neutral-800",onClick:()=>w("csv"),children:[t.jsx(T,{className:"h-4 w-4"}),"CSV"]}),t.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-neutral-800",onClick:()=>w("pdf"),children:[t.jsx(E,{className:"h-4 w-4"}),"PDF"]})]})}),k==="loading"&&t.jsx("div",{className:"text-sm text-gray-500 text-center py-8",children:"Loading revenue data..."}),k==="failed"&&t.jsx("div",{className:"text-sm text-red-600 text-center py-8",children:"Failed to load revenue data"})]})}export{H as default};
