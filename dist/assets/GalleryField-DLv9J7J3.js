const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BWRSzi7k.js","assets/index-uOjPOlE7.js","assets/index-DIFl8NCP.css","assets/index-BWGHoYgO.js","assets/quill-4RyaA7S0.css"])))=>i.map(i=>d[i]);
import{R as l,j as e,_ as J}from"./index-uOjPOlE7.js";import{I as V}from"./ImageUploader-CcyHfiff.js";import{a as te}from"./AdminApp-BnGJaM53.js";function re(a,i,x){return`
<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>${i||""}</style>
</head>
<body>
${a||""}
<script>${x||""}<\/script>
</body>
</html>`}function ce({value:a={},onChange:i}){const[x,s]=l.useState(a.raw_html||""),[c,h]=l.useState(a.raw_css||""),[g,E]=l.useState(a.raw_js||""),[v,b]=l.useState("");return l.useEffect(()=>{s(a.raw_html||""),h(a.raw_css||""),E(a.raw_js||"")},[a.raw_html,a.raw_css,a.raw_js]),l.useEffect(()=>{const o=re(x,c,g);b(o),i==null||i({raw_html:x,raw_css:c,raw_js:g})},[x,c,g]),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Upload assets (images/videos) to use in your HTML/CSS"}),e.jsx(V,{label:"Upload",onChange:o=>{}}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:'Tip: After uploading, copy the returned URL and reference it in <img src="..."/> or CSS backgrounds.'})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:"HTML"}),e.jsx("textarea",{className:"w-full h-64 rounded-md border px-2 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:x,onChange:o=>s(o.target.value),placeholder:"<div>Hello</div>"})]}),e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:"CSS"}),e.jsx("textarea",{className:"w-full h-64 rounded-md border px-2 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:c,onChange:o=>h(o.target.value),placeholder:"body { font-family: system-ui; }"})]}),e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:"JS"}),e.jsx("textarea",{className:"w-full h-64 rounded-md border px-2 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:g,onChange:o=>E(o.target.value),placeholder:"console.log('ready');"})]})]}),e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Live Preview"}),e.jsx("iframe",{title:"preview",className:"w-full h-[360px] rounded-md border dark:border-neutral-800 bg-white",sandbox:"allow-scripts allow-same-origin",srcDoc:v})]})]})}const se="/api/admin/uploads";async function ae(a,{fieldName:i="file",extra:x={}}={}){var h;if(!a)throw new Error("No file selected");const s=await te.upload(se,a,{fieldName:i,...x}),c=(s==null?void 0:s.url)||(s==null?void 0:s.url_path)||(s==null?void 0:s.secure_url)||(s==null?void 0:s.location)||((h=s==null?void 0:s.data)==null?void 0:h.url)||"";if(!c)throw new Error((s==null?void 0:s.message)||"Upload response missing URL");return c}function ue({value:a,onChange:i,placeholder:x="Type here…",height:s=260,gallery:c=[]}){const h=l.useRef({Editor:null}),g=l.useRef(null),E=l.useRef(null),v=l.useRef(null),[,b]=l.useReducer(t=>t+1,0),[o,y]=l.useState(!1),[A,D]=l.useState(""),[C,P]=l.useState(null),[H,F]=l.useState(100),M=l.useRef({index:null,src:null}),[q,X]=l.useState(!1),[U,G]=l.useState(null);l.useEffect(()=>{let t=!0;return(async()=>{try{const r=await J(()=>import("./index-BWRSzi7k.js"),__vite__mapDeps([0,1,2,3]));try{await J(()=>Promise.resolve({}),__vite__mapDeps([4]))}catch{}if(t){h.current.Editor=r.default||r,b(),X(!0);return}}catch(r){console.warn("RichText: editor not available. Using textarea fallback.",r)}})(),()=>{t=!1}},[]);const $=l.useCallback(()=>{var t;D(""),(t=E.current)==null||t.click()},[]),Y=async t=>{var u,d,N;const r=(u=t.target.files)==null?void 0:u[0];if(r)try{y(!0),D("");const f=await ae(r),w=(N=(d=g.current)==null?void 0:d.getEditor)==null?void 0:N.call(d);if(!w)return;const _=w.getSelection(!0),k=_?_.index:w.getLength();w.insertEmbed(k,"image",f,"user"),w.setSelection(k+1)}catch(f){D((f==null?void 0:f.message)||"Upload failed")}finally{y(!1),t.target.value=""}},K=l.useCallback(async t=>{var r,u;try{const d=(u=(r=g.current)==null?void 0:r.getEditor)==null?void 0:u.call(r);if(!d)return;const N=d.getSelection(!0),f=N?N.index:d.getLength();d.insertEmbed(f,"image",t,"user"),d.setSelection(f+1)}catch(d){console.error("Insert image failed",d)}},[]),O=l.useCallback((t,r)=>{if(!t)return;const u=Math.min(100,Math.max(20,r));t.style.width=`${u}%`,t.style.maxWidth="100%",t.dataset.widthPct=String(u)},[]),Z=l.useCallback(t=>{var d,N;if(!t){P(null);return}const r=(N=(d=g.current)==null?void 0:d.getEditor)==null?void 0:N.call(d);if(!r)return;const[u]=r.getLeaf(t.index);if(u&&u.domNode&&u.domNode.tagName==="IMG"){P(u.domNode);const f=Number(u.domNode.dataset.widthPct||100);F(Number.isFinite(f)?f:100)}else P(null)},[]),W=t=>{F(t),O(C,t)};l.useEffect(()=>{var k,z;if(!q)return;const t=(z=(k=g.current)==null?void 0:k.getEditor)==null?void 0:z.call(k);if(!t)return;const r=t.root,u=n=>{if(document.caretRangeFromPoint)return document.caretRangeFromPoint(n.clientX,n.clientY);if(document.caretPositionFromPoint){const m=document.caretPositionFromPoint(n.clientX,n.clientY);if(m){const j=document.createRange();return j.setStart(m.offsetNode,m.offset),j.collapse(!0),j}}return null},d=n=>{var R,S,I,L;if(!(n.target instanceof HTMLElement)||n.target.tagName!=="IMG")return;const m=(S=(R=g.current)==null?void 0:R.getEditor)==null?void 0:S.call(R);if(!m)return;const p=m.constructor.find(n.target,!0);if(!p)return;const T=m.getIndex(p);M.current={index:T,src:n.target.getAttribute("src")},(I=n.dataTransfer)==null||I.setData("text/plain","drag-image"),(L=n.dataTransfer)==null||L.setDragImage(n.target,n.target.width/2,n.target.height/2)},N=n=>{M.current.src&&n.preventDefault()},f=n=>{var I,L;const{index:m,src:j}=M.current;if(m==null||!j)return;n.preventDefault();const p=(L=(I=g.current)==null?void 0:I.getEditor)==null?void 0:L.call(I);if(!p)return;const T=u(n);let R=p.getLength();if(T){const B=p.constructor.find(T.startContainer,!0);B&&(R=p.getIndex(B))}let S=R;S>m&&(S-=1),p.deleteText(m,1,"user"),p.insertEmbed(S,"image",j,"user"),p.setSelection(S+1,0,"user"),M.current={index:null,src:null}},w=n=>{var p;if(!(n.target instanceof HTMLElement)||n.target.tagName!=="IMG")return;n.target.setAttribute("draggable","true");const m=n.target.getBoundingClientRect(),j=(p=v.current)==null?void 0:p.getBoundingClientRect();j&&G({left:m.left-j.left+v.current.scrollLeft,top:m.top-j.top+v.current.scrollTop-30,width:m.width})},_=n=>{n.target instanceof HTMLElement&&n.target.tagName==="IMG"&&G(null)};return r.addEventListener("dragstart",d),r.addEventListener("dragover",N),r.addEventListener("drop",f),r.addEventListener("mouseover",w),r.addEventListener("mouseout",_),()=>{r.removeEventListener("dragstart",d),r.removeEventListener("dragover",N),r.removeEventListener("drop",f),r.removeEventListener("mouseover",w),r.removeEventListener("mouseout",_)}},[q]);const ee=l.useMemo(()=>({toolbar:{container:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["clean"]],handlers:{image:$}}}),[$]),Q=h.current.Editor;return Q?e.jsxs("div",{ref:v,className:"richtext space-y-2 relative",children:[Array.isArray(c)&&c.length?e.jsx("div",{className:"rounded-md border p-2 flex gap-2 overflow-x-auto mb-2 bg-white dark:bg-neutral-800",children:c.map((t,r)=>e.jsx("button",{type:"button",onClick:()=>K(t),className:"w-20 h-12 shrink-0 rounded-md overflow-hidden border hover:ring-2 hover:ring-blue-500",title:"Insert image into editor",children:e.jsx("img",{src:t,alt:`img-${r}`,className:"w-full h-full object-cover"})},`g-${r}`))}):null,e.jsx(Q,{ref:g,theme:"snow",value:a||"",onChange:t=>i==null?void 0:i(t),onChangeSelection:Z,placeholder:x,style:{minHeight:s},modules:ee}),e.jsx("input",{ref:E,type:"file",accept:"image/*",className:"hidden",onChange:Y}),o?e.jsx("div",{className:"text-xs text-gray-500",children:"Uploading image…"}):null,A?e.jsx("div",{className:"text-xs text-red-600",children:A}):null,C?e.jsxs("div",{className:"flex flex-col gap-2 rounded-md border border-dashed p-2 text-sm",children:[e.jsx("div",{className:"font-medium",children:"Selected image controls"}),e.jsxs("label",{className:"text-xs",children:["Width: ",H,"%"]}),e.jsx("input",{type:"range",min:20,max:100,value:H,onChange:t=>W(Number(t.target.value))}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("button",{type:"button",className:"px-2 py-1 rounded-md border",onClick:()=>W(100),children:"Reset width"}),e.jsx("button",{type:"button",className:"px-2 py-1 rounded-md border",onClick:()=>C&&O(C,50),children:"50%"})]})]}):null,U?e.jsx("div",{className:"pointer-events-none absolute z-10",style:{left:U.left,top:Math.max(0,U.top)},children:e.jsx("div",{className:"rounded-full bg-gray-900/80 text-white text-xs px-3 py-1 shadow",children:"Drag image to reposition"})}):null]}):e.jsx("textarea",{value:a||"",onChange:t=>i==null?void 0:i(t.target.value),placeholder:x,style:{minHeight:s},className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200"})}function ne(a){return Array.isArray(a)?a:a?Array.isArray(a==null?void 0:a.data)?a.data:[]:[]}function me({label:a="Gallery images",helper:i="Upload or paste multiple images to reuse across the page/blog.",value:x,onChange:s}){const c=ne(x),h=l.useCallback(b=>{const o=b.filter(y=>y&&typeof y=="string");s==null||s(o)},[s]),g=(b,o)=>{const y=[...c];y[b]=o,h(y)},E=b=>{const o=c.filter((y,A)=>A!==b);h(o)},v=()=>{h([...c,""])};return e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-neutral-100",children:a}),i?e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400",children:i}):null]}),c.length===0?e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400",children:'No images yet. Use "Add image" to upload multiple assets.'}):null,c.map((b,o)=>e.jsxs("div",{className:"rounded-md border border-dashed dark:border-neutral-700 p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-neutral-300",children:[e.jsxs("span",{children:["Image #",o+1]}),e.jsx("button",{type:"button",className:"text-red-600 hover:underline",onClick:()=>E(o),children:"Remove"})]}),e.jsx(V,{label:"",value:b,onChange:y=>g(o,y)})]},`gallery-${o}`)),e.jsx("button",{type:"button",className:"px-3 py-2 rounded-md border text-sm",onClick:v,children:"Add image"})]})}export{me as G,ce as R,ue as a};
