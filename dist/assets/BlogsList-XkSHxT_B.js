import{B as w,R as v,j as l}from"./index-LUC8W6HM.js";import{a as u,A as g}from"./AdminApp-BAIHpeWj.js";import{A as C}from"./AdminTable-BYWoXvnz.js";import{i as $}from"./media-Cid05Mxy.js";import"./createLucideIcon-BY9DOx5Q.js";import"./file-text-Bc3jcJvJ.js";import"./ticket-xkTq38T-.js";const b={},P=(b==null?void 0:b.VITE_CLIENT_URL)||window.location.origin,f=a=>String(a||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"").slice(0,120),_=a=>Array.isArray(a)?a:a==null?[]:[],S=a=>a?Array.isArray(a)?{items:a,meta:null}:Array.isArray(a==null?void 0:a.data)?{items:a.data,meta:a.meta||null}:a!=null&&a.data&&typeof a.data=="object"&&Array.isArray(a.data.data)?{items:a.data.data,meta:a.data.meta||a.meta||null}:{items:_(a.items||a.list),meta:a.meta||null}:{items:[],meta:null};function F(){const a=w(),[n,d]=v.useState({status:"idle",items:[],error:null,q:"",active:"",page:1,limit:20,meta:null}),r=async(e=1)=>{const t=n.q||"",c=n.active||"",s=n.limit||20;d(i=>({...i,status:"loading",error:null,page:e}));try{const i=await u.get(g.blogs(),{params:{q:t||void 0,active:c||void 0,page:e,limit:s}}),{items:o,meta:p}=S(i);d(x=>({...x,status:"succeeded",items:o,meta:p||{page:e,limit:s,count:o.length},page:e}))}catch(i){d(o=>({...o,status:"failed",error:i}))}};v.useEffect(()=>{r(1)},[]);const j=(e,t)=>{var s;(s=t==null?void 0:t.stopPropagation)==null||s.call(t);const c=e.slug||f(e.title);if(!c)return alert("Missing slug");window.open(`${P}/blogs/${c}`,"_blank","noopener")},N=async(e,t)=>{var c;(c=t==null?void 0:t.stopPropagation)==null||c.call(t);try{const s=await u.get(`${g.blogs()}/${e.blog_id||e.id}`),i=(s==null?void 0:s.blog)||s||{},o=Date.now(),p=`${i.slug||f(i.title)||"blog"}-copy-${o}`,x={title:`${i.title} (Copy)`,slug:p,content:i.content||"",image_url:i.image_url||"",author:i.author||"",active:!1};await u.post(g.blogs(),x),alert("Duplicated as draft"),r(n.page)}catch(s){alert((s==null?void 0:s.message)||"Failed to duplicate")}},A=async(e,t)=>{var c;(c=t==null?void 0:t.stopPropagation)==null||c.call(t);try{const s=e.blog_id||e.id;await u.put(`${g.blogs()}/${s}`,{active:!e.active}),d(i=>({...i,items:i.items.map(o=>(o.blog_id||o.id)===s?{...o,active:!e.active}:o)}))}catch(s){alert((s==null?void 0:s.message)||"Failed to update")}},k=async(e,t)=>{var c;if((c=t==null?void 0:t.stopPropagation)==null||c.call(t),!!window.confirm(`Delete blog "${e.title}"? This cannot be undone.`))try{const s=e.blog_id||e.id;await u.delete(`${g.blogs()}/${s}`),d(i=>({...i,items:i.items.filter(o=>(o.blog_id||o.id)!==s)}))}catch(s){alert((s==null?void 0:s.message)||"Delete failed")}},m=n.meta||{},y=n.page>1,h=m.page?m.page<(m.totalPages||m.total_pages||1):!1;return l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsx("h1",{className:"text-xl font-semibold",children:"Blogs"}),l.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm",onClick:()=>a("/admin/catalog/blogs/new"),children:"New Blog"})]}),l.jsxs("div",{className:"mb-3 grid grid-cols-1 md:grid-cols-4 gap-2",children:[l.jsx("input",{className:"rounded-md border px-3 py-2",placeholder:"Search title/slug",value:n.q,onChange:e=>d(t=>({...t,q:e.target.value}))}),l.jsxs("select",{className:"rounded-md border px-3 py-2",value:n.active,onChange:e=>d(t=>({...t,active:e.target.value})),children:[l.jsx("option",{value:"",children:"Active: All"}),l.jsx("option",{value:"true",children:"Active"}),l.jsx("option",{value:"false",children:"Inactive"})]}),l.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>r(1),children:"Filter"})]}),l.jsx(C,{keyField:"blog_id",columns:[{key:"preview",title:"Cover",render:e=>{const t=$(e);return l.jsx("div",{className:"w-20 h-14 rounded-md overflow-hidden bg-gray-100 flex items-center justify-center",children:t?l.jsx("img",{src:t,alt:e.title||"Blog cover",className:"w-full h-full object-cover",loading:"lazy"}):l.jsx("span",{className:"text-[10px] text-gray-500",children:"No image"})})}},{key:"title",title:"Title"},{key:"slug",title:"Slug"},{key:"author",title:"Author"},{key:"active",title:"Status",render:e=>e.active?l.jsx("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-700 text-xs",children:"Published"}):l.jsx("span",{className:"px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 text-xs",children:"Draft"})},{key:"__actions",title:"Actions",render:e=>l.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.jsx("button",{className:"rounded-md border px-2 py-1 text-xs",onClick:t=>j(e,t),children:"Preview"}),l.jsx("button",{className:"rounded-md border px-2 py-1 text-xs",onClick:t=>N(e,t),children:"Duplicate"}),l.jsx("button",{className:`rounded-md px-2 py-1 text-xs ${e.active?"border text-red-600":"bg-blue-600 text-white"}`,onClick:t=>A(e,t),children:e.active?"Unpublish":"Publish"}),l.jsx("button",{className:"rounded-md border px-2 py-1 text-xs text-red-600",onClick:t=>k(e,t),children:"Delete"})]})}],rows:n.items,onRowClick:e=>a(`/admin/catalog/blogs/${e.blog_id||e.id}`),empty:n.status==="loading"?"Loadingâ€¦":"No blogs"}),l.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[l.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>y&&r(n.page-1),disabled:!y||n.status==="loading",children:"Prev"}),l.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",m.page||n.page]}),l.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>h&&r(n.page+1),disabled:!h||n.status==="loading",children:"Next"})]})]})}export{F as default};
