import{C as k,h as _,u as C,R as m,j as t,D as w}from"./index-CNdOvwUA.js";import{g as p,p as S,b as B,c as P,d as R,u as A}from"./AdminApp-sxxeVGC_.js";import"./createLucideIcon-D7GIchwo.js";import"./file-text-B3yKuaPb.js";import"./ticket-BYx_I3BZ.js";const u=({title:s,subtitle:n,children:l,className:c=""})=>t.jsxs("div",{className:`rounded-2xl border border-gray-200 bg-white p-5 shadow-sm dark:bg-neutral-900 dark:border-neutral-800 ${c}`,children:[t.jsx("div",{className:"flex items-start justify-between mb-4",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-neutral-100",children:s}),n?t.jsx("p",{className:"text-xs text-gray-500",children:n}):null]})}),l]}),o=({label:s,value:n,muted:l})=>t.jsxs("div",{children:[t.jsx("div",{className:`text-xs font-semibold uppercase tracking-wide ${l?"text-gray-400":"text-gray-500"}`,children:s}),t.jsx("div",{className:"text-sm font-medium text-gray-900 break-words",children:n??"—"})]});function I(){var j,f,v,y,b;const{id:s}=k(),n=_(),{current:l,action:c}=C(a=>a.adminBookings),[r,x]=m.useState({payment_status:"",booking_status:"",payment_ref:""}),[d,g]=m.useState({amount:"",newMerchantTxnNo:""}),[i,h]=m.useState({email:"",mobile:""});m.useEffect(()=>{n(p({id:s}))},[s,n]);const e=l.data;if(l.status==="loading"&&!e)return t.jsx("div",{children:"Loading…"});if(l.status==="failed"){const a=((j=l.error)==null?void 0:j.status)===403||/forbidden/i.test(((f=l.error)==null?void 0:f.message)||"");return t.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 p-5 text-sm text-amber-800",children:a?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"font-semibold mb-1",children:"You don't have permission to view this booking."}),t.jsx("p",{className:"text-amber-700",children:"The attraction is outside your assigned scope. Please contact a super admin if you need access."})]}):((v=l.error)==null?void 0:v.message)||"Failed to load booking"})}const N=async()=>{await n(A({id:s,patch:r})).unwrap().catch(()=>{}),n(p({id:s}))};return t.jsxs("div",{className:"space-y-6",children:[t.jsx(u,{title:`Booking #${(e==null?void 0:e.booking_ref)||(e==null?void 0:e.booking_id)||s}`,subtitle:e!=null&&e.created_at?`Created ${w(e.created_at).format("DD MMM YYYY · h:mm A")}`:null,children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(o,{label:"User",value:((y=e==null?void 0:e.user)==null?void 0:y.email)||(e==null?void 0:e.user_email)||"—"}),t.jsx(o,{label:"Contact",value:((b=e==null?void 0:e.user)==null?void 0:b.phone)||(e==null?void 0:e.user_phone)||"—"}),t.jsx(o,{label:"Item",value:(e==null?void 0:e.item_title)||(e==null?void 0:e.attraction_title)||(e==null?void 0:e.combo_title)||"—"}),t.jsx(o,{label:"Amount",value:`₹${Number((e==null?void 0:e.final_amount)??(e==null?void 0:e.total_amount)??0).toLocaleString()}`}),t.jsx(o,{label:"Payment Status",value:e==null?void 0:e.payment_status}),t.jsx(o,{label:"Booking Status",value:e==null?void 0:e.booking_status}),t.jsx(o,{label:"Slot",value:(e==null?void 0:e.slot_label)||`${(e==null?void 0:e.slot_start_time)||""} ${e!=null&&e.slot_end_time?`- ${e.slot_end_time}`:""}`||"—"}),t.jsx(o,{label:"Offer",value:(e==null?void 0:e.offer_title)||"—",muted:!0})]})}),t.jsxs(u,{title:"Update Statuses",subtitle:"Manually reconcile payment and fulfilment",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[t.jsxs("select",{className:"rounded-lg border px-3 py-2",value:r.payment_status,onChange:a=>x({...r,payment_status:a.target.value}),children:[t.jsx("option",{value:"",children:"Payment status"}),t.jsx("option",{children:"Pending"}),t.jsx("option",{children:"Completed"}),t.jsx("option",{children:"Failed"}),t.jsx("option",{children:"Cancelled"})]}),t.jsxs("select",{className:"rounded-lg border px-3 py-2",value:r.booking_status,onChange:a=>x({...r,booking_status:a.target.value}),children:[t.jsx("option",{value:"",children:"Booking status"}),t.jsx("option",{children:"Booked"}),t.jsx("option",{children:"Redeemed"}),t.jsx("option",{children:"Expired"}),t.jsx("option",{children:"Cancelled"})]}),t.jsx("input",{className:"rounded-lg border px-3 py-2",placeholder:"Payment reference",value:r.payment_ref,onChange:a=>x({...r,payment_ref:a.target.value})})]}),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsx("button",{className:"rounded-lg bg-gray-900 text-white px-4 py-2 text-sm",onClick:N,disabled:c.status==="loading",children:c.status==="loading"?"Saving…":"Save changes"}),t.jsx("button",{className:"rounded-lg border px-4 py-2 text-sm",onClick:()=>n(p({id:s})),children:"Refresh data"})]})]}),t.jsxs(u,{title:"PayPhi",subtitle:"Payment gateway controls",children:[t.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[t.jsx("button",{className:"rounded-full border px-4 py-2 text-sm",onClick:()=>n(S({id:s})),children:"Check Status"}),t.jsx("input",{className:"rounded-full border px-3 py-2 text-sm",placeholder:"Customer email",value:i.email,onChange:a=>h({...i,email:a.target.value})}),t.jsx("input",{className:"rounded-full border px-3 py-2 text-sm",placeholder:"Customer mobile",value:i.mobile,onChange:a=>h({...i,mobile:a.target.value})}),t.jsx("button",{className:"rounded-full border px-4 py-2 text-sm",onClick:()=>n(B({id:s,email:i.email,mobile:i.mobile})),children:"Initiate Collection"})]}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 items-center",children:[t.jsx("input",{className:"rounded-lg border px-3 py-2 text-sm",placeholder:"Refund amount",value:d.amount,onChange:a=>g({...d,amount:a.target.value})}),t.jsx("input",{className:"rounded-lg border px-3 py-2 text-sm",placeholder:"New merchant Txn (optional)",value:d.newMerchantTxnNo,onChange:a=>g({...d,newMerchantTxnNo:a.target.value})}),t.jsx("button",{className:"rounded-lg border px-4 py-2 text-sm text-red-600",onClick:()=>n(P({id:s,...d})),children:"Trigger Refund"})]})]}),t.jsx(u,{title:"Danger Zone",subtitle:"Irreversible operations",className:"border-red-200",children:t.jsx("button",{className:"rounded-lg border px-4 py-2 text-sm text-red-600",onClick:()=>n(R({id:s})),children:"Cancel Booking"})})]})}export{I as default};
