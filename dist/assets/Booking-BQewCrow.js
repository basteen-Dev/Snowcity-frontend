import{j as t,h as _s,B as Cs,u as be,r as p,D as M,G as Ms,p as As,t as Ts,q as It,F as q,H as Ss,i as De,k as Ie,I as Yt,E as Ps,J as We,K as je,M as $t,Q as Ds,S as Is,T as Ys,U as $s,V as Os,W as Es}from"./index-LUC8W6HM.js";import{i as Oe}from"./media-Cid05Mxy.js";import{a as Ot,c as Et,d as qt,g as at}from"./pricing-CIeFTiJd.js";import{f as zt}from"./formatters-CmiLqhJj.js";import{c as E}from"./createLucideIcon-BY9DOx5Q.js";import{X as Qe}from"./x-DlRcpqTS.js";import{C as Lt}from"./circle-alert-DRzF3fff.js";import{T as Ft}from"./ticket-xkTq38T-.js";import{C as qs}from"./clock-BjWxH1MI.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ls=E("arrow-left",zs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Je=E("arrow-right",Fs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Rt=E("check",Rs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ze=E("chevron-right",Bs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Us=E("globe",Ks);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Hs=E("log-in",Vs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Xs=E("mail",Gs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"M5 12h14",key:"1ays0h"}]],Bt=E("minus",Ws);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Js=E("phone",Qs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Kt=E("plus",Zs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],X=E("shopping-bag",ea);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],sa=E("triangle-alert",ta);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],ra=E("user-plus",aa);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ia=E("user",na);function oa({isOpen:e,onClose:i,onSignIn:d}){return e?t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"relative w-full max-w-md rounded-2xl bg-white shadow-2xl dark:bg-neutral-900 overflow-hidden",children:[t.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-8 text-white",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(sa,{className:"h-6 w-6"}),t.jsx("h2",{className:"text-lg font-bold",children:"Session Expired"})]}),t.jsx("p",{className:"mt-2 text-sm opacity-90",children:"Your login session has expired. Please sign in again to continue booking."})]}),t.jsxs("div",{className:"px-6 py-8",children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mb-6",children:"Your booking information is saved. Sign in again to complete your purchase without losing your selections."}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("button",{onClick:d,className:"w-full flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3 text-white font-semibold transition-all duration-200 hover:shadow-lg hover:from-blue-700 hover:to-blue-800 active:scale-95",children:[t.jsx(Hs,{className:"h-5 w-5"}),"Sign In Again"]}),t.jsx("button",{onClick:i,className:"w-full rounded-lg border border-gray-300 px-4 py-2 text-gray-700 font-medium transition-all hover:bg-gray-50 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",children:"Continue as Guest"})]})]})]})}):null}const W=e=>M(e).format("YYYY-MM-DD"),B=()=>M().format("YYYY-MM-DD"),ie=e=>(e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.attraction_id)??null,oe=e=>(e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.combo_id)??null,Ut=(e,i)=>String((e==null?void 0:e.id)??(e==null?void 0:e._id)??(e==null?void 0:e.slot_id)??(e==null?void 0:e.combo_slot_id)??`${(e==null?void 0:e.start_time)||""}-${(e==null?void 0:e.end_time)||""}-${i}`),Vt=e=>{if(!e)return"";const[i,d]=e.split(":"),x=parseInt(i,10),f=x>=12?"PM":"AM";return`${x%12||12}:${d} ${f}`},Ht=e=>{if(e!=null&&e.label)return e.label;const i=Vt(e==null?void 0:e.start_time),d=Vt(e==null?void 0:e.end_time);return i&&d?`${i} - ${d}`:i||`Slot #${(e==null?void 0:e.id)||"?"}`},la=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,Gt=[{code:"+91",label:"IN (+91)"},{code:"+1",label:"US (+1)"},{code:"+971",label:"AE (+971)"},{code:"+44",label:"UK (+44)"},{code:"+65",label:"SG (+65)"}],Xt=e=>Number((e==null?void 0:e.price)??(e==null?void 0:e.amount)??0),ca=e=>(e==null?void 0:e.id)??(e==null?void 0:e.addon_id)??(e==null?void 0:e._id)??null,Wt=e=>(e==null?void 0:e.name)??(e==null?void 0:e.title)??(e==null?void 0:e.label)??"Addon",da=e=>{if(!e)return null;const i=[e,e==null?void 0:e.image_url,e==null?void 0:e.image,e==null?void 0:e.thumbnail,e==null?void 0:e.cover_image];for(const d of i){if(!d)continue;const x=typeof d=="string"?Oe(d):Oe(d);if(x)return x}return null};function ma(e){const i=()=>typeof window<"u"?window.matchMedia(e).matches:!1,[d,x]=p.useState(i);return p.useEffect(()=>{if(typeof window>"u")return;const f=window.matchMedia(e),j=k=>x(k.matches);return f.addEventListener("change",j),()=>f.removeEventListener("change",j)},[e]),d}const et=()=>({itemType:"attraction",attractionId:"",comboId:"",date:B(),slotKey:"",qty:1}),ua=()=>`sel_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`,Qt=(e,i=null)=>{if(!e)return i?`Combo ${i}`:"Combo";const d=e.name??e.title??e.combo_name??e.label??null;return d||(i?`Combo ${i}`:"Combo")},ve=e=>{if(!e)return null;if(typeof e=="string")return Oe(e);if(typeof e=="object"){const i=e.url||e.src||e.image_url||e.path;if(i)return Oe(i)}return null},Ye=e=>{var d;if(!e)return null;const i=[e.desktop_image_url,e.hero_image,e.banner_image,e.image_url,e.cover_image,e.thumbnail,(d=e.media)==null?void 0:d[0]];for(const x of i){const f=ve(x);if(f)return f}return null},$e=e=>{var d;if(!e)return null;const i=[e.desktop_image_url,e.hero_image,e.banner_image,e.image_url,e.cover_image,(d=e.media)==null?void 0:d[0],e.attraction_1_image,e.attraction_2_image];for(const x of i){const f=ve(x);if(f)return f}return null},xa=e=>{if(!e)return[];const i=[];return e.attraction_1_image&&i.push(ve(e.attraction_1_image)),e.attraction_2_image&&i.push(ve(e.attraction_2_image)),i.length<2&&Array.isArray(e.media)&&e.media.forEach(d=>{const x=ve(d);x&&!i.includes(x)&&i.push(x)}),i.slice(0,2).filter(Boolean)},Y=e=>{const i=Number(e);return Number.isFinite(i)?i:0},rt=e=>String(e||"").toLowerCase(),Ee=(e,i)=>e==null||i==null?!1:String(e)===String(i),pa=e=>{if(typeof e=="boolean")return e;if(e==null)return!1;if(typeof e=="number")return e!==0;const i=String(e).trim().toLowerCase();return i?["true","1","yes","y"].includes(i)?!0:["false","0","no","n"].includes(i)?!1:!!e:!1},ya=e=>e?Array.isArray(e)?e.reduce((i,d)=>i+Y(d),0):typeof e=="object"?Object.values(e).reduce((i,d)=>i+Y(d),0):0:0,Jt=e=>{if(!e)return 0;const i=at(e);if(i>0)return i;const d=(e==null?void 0:e.combo_price)??(e==null?void 0:e.price)??(e==null?void 0:e.amount)??(e==null?void 0:e.total_price)??(e==null?void 0:e.starting_price)??(e==null?void 0:e.min_price)??(e==null?void 0:e.base_price)??0;if(Y(d)>0)return Y(d);const x=e==null?void 0:e.combo_attractions;if(Array.isArray(x)&&x.length){const k=x.reduce((C,g)=>C+Y((g==null?void 0:g.attraction_price)??(g==null?void 0:g.price)),0);if(k>0)return k}const f=ya(e==null?void 0:e.attraction_prices);if(f>0)return f;const j=Y(e==null?void 0:e.attraction_1_price)+Y(e==null?void 0:e.attraction_2_price);return j>0?j:0},fa=e=>{const i=String(e||"").replace(/\D/g,"");return i.length>=10?i.slice(-10):i},ha=(e,i)=>{if(!e)return!0;const d=M();if(M(i).format("YYYY-MM-DD")===d.format("YYYY-MM-DD")){const f=e.start_time||e.time||e.startTime;if(!f)return!0;const[j,k]=f.split(":"),C=parseInt(j)*60+parseInt(k),A=d.hour()*60+d.minute()+60;return C>=A}return!0},ga=e=>{if(!e)return!0;if(e.available===!1)return!1;const i=Number(e.capacity??e.available_capacity??e.available);if(Number.isNaN(i))return!0;if(e.booked!=null){const d=Number(e.booked);if(!Number.isNaN(d))return i-d>0}return i>0},nt=e=>(e==null?void 0:e.id)??(e==null?void 0:e.offer_id)??(e==null?void 0:e.offerId)??(e==null?void 0:e.slug)??null,Zt=e=>(e==null?void 0:e.title)||(e==null?void 0:e.name)||`Offer ${nt(e)??""}`.trim(),tt=e=>(e==null?void 0:e.short_description)||(e==null?void 0:e.subtitle)||(e==null?void 0:e.description)||"",it=(e,i)=>{if(!e||!i)return 0;const d=String(e.discount_type||e.rule_discount_type||"").toLowerCase(),x=Number(e.discount_percent??e.discountPercent??(d==="percent"?e.discount_value??e.discountValue:0))||0,f=Number(e.discount_value??e.discountValue??e.flat_discount??0)||0;let j=0;d==="percent"&&x>0||x>0?j=i*x/100:j=f;const k=Number(e.max_discount??e.maxDiscount??0);return k>0&&(j=Math.min(j,k)),Math.max(0,Math.min(j,i))},st=e=>{if(!e||typeof e!="string")return null;const[i="0",d="0"]=e.split(":"),x=Number(i),f=Number(d);return!Number.isFinite(x)||!Number.isFinite(f)?null:x*60+f},ba=(e={},i)=>{if(!e.day_type)return!0;const d=M(i).day(),x=String(e.day_type).toLowerCase();return x==="weekday"?d>=1&&d<=5:x==="weekend"?d===0||d===6:x==="custom"&&Array.isArray(e.specific_days)?e.specific_days.map(Number).includes(d):!0},ja=(e={},i=null)=>{if(!i)return!(e.slot_id!=null||Array.isArray(e.slot_ids)&&e.slot_ids.length||e.specific_time||e.time_from&&e.time_to);const d=[];if(e.slot_id!=null&&d.push(e.slot_id),Array.isArray(e.slot_ids)&&d.push(...e.slot_ids),e.target_slot_id!=null&&d.push(e.target_slot_id),d.length){const j=[i.slot_id,i.id,i._id,i.combo_slot_id].filter(C=>C!=null);if(!d.some(C=>j.some(g=>Ee(C,g))))return!1}if(!(e.specific_time||e.time_from&&e.time_to))return!0;const f=i.start_time||i.time||i.startTime||null;if(e.specific_time&&f&&f.slice(0,5)!==String(e.specific_time).slice(0,5))return!1;if(e.time_from&&e.time_to&&f){const j=st(f),k=st(e.time_from),C=st(e.time_to);if(j==null||k==null||C==null||j<k||j>C)return!1}return!0},ts=({rule:e,selectedDate:i,selectedSlot:d,itemType:x,itemId:f})=>{if(!e||!i)return!1;const j=M(i).format("YYYY-MM-DD"),k=rt(e.target_type),C=rt(x);if(k&&C&&k!==C)return!1;if(!pa(e.applies_to_all)){const A=[];if(e.target_id!=null&&A.push(e.target_id),Array.isArray(e.target_ids)&&A.push(...e.target_ids),!A.length||!A.some(D=>Ee(D,f)))return!1}return!(e.specific_date&&j!==e.specific_date||Array.isArray(e.specific_dates)&&e.specific_dates.length&&!e.specific_dates.some(A=>M(A).format("YYYY-MM-DD")===j)||e.date_from&&j<e.date_from||e.date_to&&j>e.date_to||!ba(e,j)||!ja(e,d))},es=(e,i,d,x,f)=>!e||!i||!d?!1:(Array.isArray(e.rules)?e.rules:[]).filter(C=>ts({rule:C,selectedDate:i,selectedSlot:d,itemType:x,itemId:f})).length>0,va=(e,i,d)=>{const x=Number(i||0)*Number(d||1);if(!e||x<=0)return null;const f=it(e,x)||0;return{total:x,totalDiscount:f,final:Math.max(0,x-f)}};function Pa(){var Mt,At,Tt,St,Pt;const e=_s(),i=Cs(),d=ma("(min-width: 768px)"),x=be(s=>s.auth),f=!!(x!=null&&x.token),j=be(s=>s.attractions),k=be(s=>s.combos),C=be(s=>s.addons),{step:g,contact:A,otp:L,coupon:D,creating:F,cart:Q}=be(s=>s.bookings),S=(Q==null?void 0:Q.items)||[],$=S.length>0,qe=Q==null?void 0:Q.activeKey,I=p.useMemo(()=>{if(!S.length)return null;if(qe){const s=S.find(r=>r.key===qe);if(s)return s}return S[0]},[S,qe]),J=(I==null?void 0:I.key)||null;p.useRef(null);const ot=p.useRef(!1),[n,O]=p.useState(()=>et()),[le,ze]=p.useState(null),[ss,ce]=p.useState(!1),[as,Z]=p.useState(!1),[rs,Le]=p.useState("booking"),[ns,is]=p.useState(null),[w,ee]=p.useState({status:"idle",error:null,offers:[],offerRules:[],activeOffer:null,activeRule:null,selectedOffer:null,selectedRule:null,offerPreview:null,loadingOffers:!1}),[Ne,lt]=p.useState("+91"),[de,ke]=p.useState(""),[U,we]=p.useState({}),[te,me]=p.useState({status:"idle",items:[],error:null}),[_e,ct]=p.useState(""),[ue,dt]=p.useState(""),[V,mt]=p.useState(""),[H,Fe]=p.useState(new Map),[ut,xt]=p.useState([]),[Ce,pt]=p.useState(!1),se=j.items||[],xe=k.items||[],yt=p.useCallback(()=>{if(!Array.isArray(w.offers)||!I)return null;const s=rt(I.item_type||(I.combo_id?"Combo":"Attraction")),r=I.attraction_id||I.combo_id||null,a=I.date||"",o=I.slot||{};let c=null;for(const l of w.offers){const y=Array.isArray(l.rules)?l.rules:[];for(const h of y)ts({rule:h,selectedDate:a,selectedSlot:o,itemType:s,itemId:r})&&(!c||h.priority>c.rule.priority||h.priority===c.rule.priority&&h.rule_id<c.rule.rule_id)&&(c={offer:l,rule:h})}return c},[w.offers,I]);p.useEffect(()=>{const s=yt();ee(r=>({...r,activeOffer:(s==null?void 0:s.offer)||null,activeRule:(s==null?void 0:s.rule)||null}))},[yt]),p.useEffect(()=>{if(!w.activeOffer||!w.activeRule||!I){ee(l=>({...l,offerPreview:null}));return}const s=Number(I.price||I.unitPrice||0),r=w.activeRule.rule_discount_type||w.activeOffer.discount_type||"percent",a=Number(w.activeRule.rule_discount_value??w.activeOffer.discount_value??0);let o=s;r==="percent"?o=s*(1-a/100):r==="amount"&&(o=Math.max(0,s-a));const c=s-o;ee(l=>({...l,offerPreview:{basePrice:s,newPrice:o,savings:c,discountType:r,discountValue:a,offerTitle:w.activeOffer.title,ruleId:w.activeRule.rule_id}}))},[w.activeOffer,w.activeRule,I]),p.useEffect(()=>{if(A!=null&&A.phone&&!de){const s=String(A.phone).replace(/\D/g,"");if(s.length>10){const r=Gt.find(a=>s.startsWith(a.code.replace("+","")));r?(lt(r.code),ke(s.slice(r.code.length-1))):ke(s.slice(-10))}else ke(s)}},[]),p.useEffect(()=>{if(w.status!=="idle")return;let s=!1;return(async()=>{ee(a=>({...a,status:"loading",loadingOffers:!0}));try{const a=await De.get(Ie.offers.list(),{params:{active:!0,limit:20}});if(s)return;const o=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];ee(c=>({...c,status:"succeeded",offers:o,loadingOffers:!1}))}catch{s||ee(a=>({...a,status:"failed",loadingOffers:!1}))}})(),()=>{s=!0}},[w.status]),p.useEffect(()=>{if(Ce||ut.length>0)return;let s=!1;return(async()=>{pt(!0);try{const a=await De.get(Ie.coupons.list(),{params:{active:!0,limit:50}});if(s)return;const o=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];xt(o)}catch(a){console.error("Failed to fetch promos:",a),xt([])}finally{pt(!1)}})(),()=>{s=!0}},[]);const os=p.useCallback(()=>{i("/")},[i]),[G]=Ms(),pe=G.get("type"),ae=G.get("attraction_id"),re=G.get("combo_id"),Re=G.get("date"),Be=G.get("slot"),Ke=G.get("qty"),Ue=G.get("openDrawer");p.useEffect(()=>{j.status==="idle"&&e(As({active:!0,limit:100})),k.status==="idle"&&e(Ts({active:!0,limit:100})),C.status==="idle"&&e(It({active:!0,limit:100}))},[e,j.status,k.status,C.status]),p.useEffect(()=>{g===3&&f&&e(q(4))},[g,f,e]),p.useEffect(()=>{const s=typeof document<"u"&&document.querySelector("footer"),r=s?s.style.display:null;return s&&(s.style.display="none"),()=>{s&&(s.style.display=r||"")}},[]),p.useEffect(()=>{!ae&&!re&&e(Ss())},[e,ae||"",re||""]),p.useEffect(()=>{const s={};pe&&(s.itemType=pe),ae&&(j.items||[]).some(a=>String(ie(a))===String(ae))&&(s.attractionId=String(ae),pe||(s.itemType="attraction")),re&&(k.items||[]).some(a=>String(oe(a))===String(re))&&(s.comboId=String(re),pe||(s.itemType="combo")),Re&&(s.date=Re),Be&&(s.slotKey=Be),Ke&&(s.qty=Math.max(1,Number(Ke)||1)),Object.keys(s).length>0&&O(r=>({...r,...s}))},[pe||"",ae||"",re||"",Re||"",Be||"",Ke||"",Ue||"",j.items||[],k.items||[]]);const ft=p.useCallback(async({itemType:s,attractionId:r,comboId:a,date:o})=>{if(!o)return;const c=s==="combo"?a:r;if(c){me({status:"loading",items:[],error:null});try{if(s==="combo"){const l=await De.get(Ie.combos.slots(c),{params:{date:W(o)}}),y=Array.isArray(l==null?void 0:l.data)?l.data:Array.isArray(l)?l:[];me({status:"succeeded",items:y,error:null})}else{const l=await De.get(Ie.slots.list(),{params:{attraction_id:c,date:W(o)}}),y=Array.isArray(l==null?void 0:l.data)?l.data:Array.isArray(l)?l:[];me({status:"succeeded",items:y,error:null})}}catch(l){me({status:"failed",items:[],error:(l==null?void 0:l.message)||"Failed to load slots"})}}},[]);p.useEffect(()=>{const s=n.itemType,r=n.date,a=n.attractionId,o=n.comboId;(s==="combo"?o:a)&&r?(O(l=>({...l,slotKey:n.slotKey||""})),ft({itemType:s,attractionId:a,comboId:o,date:r})):me({status:"idle",items:[],error:null})},[n.itemType||"",n.attractionId||"",n.comboId||"",n.date||"",ft]);const b=p.useMemo(()=>n.itemType==="attraction"?se.find(s=>String(ie(s))===String(n.attractionId)):null,[se||[],n.itemType||"",n.attractionId||""]),_=p.useMemo(()=>n.itemType==="combo"?xe.find(s=>String(oe(s))===String(n.comboId)):null,[xe||[],n.itemType||"",n.comboId||""]),m=p.useMemo(()=>{for(let s=0;s<te.items.length;s+=1){const r=te.items[s];if(Ut(r,s)===n.slotKey)return r;const a=[r==null?void 0:r.slot_id,r==null?void 0:r.id,r==null?void 0:r._id,r==null?void 0:r.combo_slot_id].filter(Boolean);if(n.slotKey&&a.map(String).includes(String(n.slotKey)))return r}return null},[te.items,n.slotKey]),P=p.useMemo(()=>{if(n.itemType==="combo"&&_){const s=Y(Jt(_)),r=Y(Ot(_)||s),a=(m==null?void 0:m.pricing)||{},o=(m==null?void 0:m.offer)||null,c=m?Et(m,r):r,l=m?qt(m,s):s;let y=Y(a.base_price??c),h=Y(a.final_price??l);y||(y=c),h||(h=l);const T=W(n.date),u=oe(_);let v=o||null;if(!v&&(v=w.offers.find(N=>(N.rule_type==="happy_hour"||N.rule_type==="holiday"||N.rule_type==="special")&&es(N,T,m,"combo",u)),v)){const N=it(v,y||h);h=Math.max(0,(y||h)-N)}return{title:Qt(_,oe(_)),price:h,originalPrice:y||h,happyHourOffer:v,offerDescription:(v==null?void 0:v.description)||"",image:$e(_),previewImages:xa(_)}}if(n.itemType==="attraction"&&b){const s=Y(at(b)||(b==null?void 0:b.price)||(b==null?void 0:b.base_price)||(b==null?void 0:b.amount)||0),r=Y(Ot(b)||s),a=(m==null?void 0:m.pricing)||{},o=(m==null?void 0:m.offer)||null,c=m?Et(m,r):r,l=m?qt(m,s):s;let y=Y(a.base_price??c),h=Y(a.final_price??l);y||(y=c),h||(h=l);const T=W(n.date),u=ie(b);let v=o||null;if(!v&&(v=w.offers.find(N=>(N.rule_type==="happy_hour"||N.rule_type==="holiday"||N.rule_type==="special")&&es(N,T,m,"attraction",u)),v)){const N=it(v,y||h);h=Math.max(0,(y||h)-N)}return{title:(b==null?void 0:b.name)||(b==null?void 0:b.title)||`Attraction #${ie(b)}`,price:h,originalPrice:y||h,happyHourOffer:v,offerDescription:(v==null?void 0:v.description)||"",image:Ye(b)}}return{title:"",price:0,originalPrice:0,offerDescription:""}},[n.itemType||"",_||null,b||null,m||null,n.date||"",w.offers||[]]);p.useEffect(()=>{Ue==="true"&&(n.itemType==="attraction"||n.itemType==="combo")&&P.title&&!ot.current&&(ot.current=!0,Z(!0))},[Ue,n.itemType,P.title]);const ye=Math.max(1,Number(n.qty)||1),ls=Number(P.price||0)*ye,R=!!(P.title&&n.date&&n.slotKey&&ye),cs=p.useMemo(()=>S.reduce((s,r)=>s+Number(r.unitPrice||0)*Number(r.quantity||0),0),[S||[]]),Ve=p.useMemo(()=>{let s=0;return H.forEach((r,a)=>{S.find(c=>c.key===a)&&r.forEach(c=>{s+=Number(c.price||0)*Number(c.quantity||0)})}),s},[H||new Map,S||[]]),He=cs+Ve,fe=Number(D.discount||0),ht=fe>0&&(D.code||((Mt=D.data)==null?void 0:Mt.code)),ne=Math.max(0,He-fe);P.image||Ye(se[0])||$e(xe[0]);const ds=p.useMemo(()=>J?H.get(J)||new Map:new Map,[H,J]),Me=p.useCallback(()=>{if(!R)return!1;const s=n.itemType==="combo"?"Combo":"Attraction",r=n.itemType==="combo"?(m==null?void 0:m.combo_slot_id)??(m==null?void 0:m.id)??(m==null?void 0:m._id)??null:(m==null?void 0:m.slot_id)??(m==null?void 0:m.id)??(m==null?void 0:m._id)??null,a=(m==null?void 0:m.offer)||P.happyHourOffer||null,o={key:le||ua(),merge:!1,item_type:s,title:P.title,slotLabel:m?Ht(m):"",quantity:ye,booking_date:W(n.date),booking_time:(m==null?void 0:m.start_time)||(m==null?void 0:m.startTime)||(m==null?void 0:m.slot_start_time)||null,unitPrice:P.price||0,dateLabel:W(n.date),slot_id:s==="Attraction"?r:null,combo_slot_id:s==="Combo"?r:null,attraction_id:s==="Attraction"?ie(b):null,combo_id:s==="Combo"?oe(_):null,slot:m||null,attraction:b||null,combo:_||null,pricing:(m==null?void 0:m.pricing)||null,originalPrice:P.originalPrice||null,offer:a,offerDescription:P.offerDescription||(a==null?void 0:a.description)||""};return le&&e(Yt(le)),e(Ps(o)),e(We(o.key)),ze(null),O(et()),Fe(c=>{const l=new Map(c);return l.has(o.key)||l.set(o.key,new Map),l}),!0},[R,n||{},P||{},m||null,b||null,_||null,ye||1,le||null,e]),ms=p.useCallback(()=>{if(!R){alert("Please select a date, a time slot, and quantity first.");return}const r=[n.itemType==="combo"?"Combo":"Attraction",n.itemType==="combo"?n.comboId:n.attractionId||"na",(n.itemType==="attraction",n.slotKey||"na"),n.date||"na"].join(":");S.some(o=>o.fingerprint===r)||Me(),e(q(2))},[R,n,S,Me,e,f]),Ge=()=>{if(g===1)if($)e(q(2));else{if(!R){alert("Please select date, time slot and quantity.");return}Me()&&e(q(2))}else g===2?e(q(f?4:3)):g===3&&(L.verified?e(q(4)):alert("Please verify OTP to continue."))},us=()=>{g!==1&&(g===2?e(q(1)):g===3?e(q(2)):g===4&&e(q(f?2:3)))},gt=(s,r,a)=>{Fe(o=>{const c=new Map(o),l=c.get(J)||new Map;return r<=0?l.delete(s):l.set(s,{addon_id:s,name:Wt(a),price:Xt(a),quantity:r}),c.set(J,l),c})},xs=async()=>{var s,r,a,o,c,l,y,h,T;if((F==null?void 0:F.status)!=="loading"){if(!f){ce(!0);return}if($)try{const u=((D==null?void 0:D.code)||"").trim()||void 0,v=V?Number(V):void 0,N=S.map(K=>{const ge=K.item_type==="Combo",Dt=H.get(K.key)||new Map,ws=Dt?Array.from(Dt.values()).filter(Pe=>Number(Pe.quantity)>0).map(Pe=>({addon_id:Pe.addon_id,quantity:Number(Pe.quantity)})):[];return{item_type:ge?"Combo":"Attraction",combo_id:ge?K.combo_id:void 0,combo_slot_id:ge?K.combo_slot_id:void 0,attraction_id:ge?void 0:K.attraction_id,slot_id:ge?void 0:K.slot_id,booking_date:K.booking_date,quantity:K.quantity,addons:ws,coupon_code:u,offer_id:v}}),z=await e(Ds(N)).unwrap(),Te=((s=z==null?void 0:z.data)==null?void 0:s.order_id)||(z==null?void 0:z.order_id);if(!Te)throw new Error("Order ID missing");const Ns=(A.email||((r=x==null?void 0:x.user)==null?void 0:r.email)||"").trim(),ks=fa(A.phone||((a=x==null?void 0:x.user)==null?void 0:a.phone)||""),Se=await e(Is({bookingId:Te,email:Ns,mobile:ks,amount:ne})).unwrap();Se!=null&&Se.redirectUrl?window.location.assign(Se.redirectUrl):alert("Payment initiation failed.")}catch(u){if(console.error("Booking creation error:",u),(u==null?void 0:u.status)===401||((o=u==null?void 0:u.response)==null?void 0:o.status)===401){const v=(u==null?void 0:u.message)||((l=(c=u==null?void 0:u.response)==null?void 0:c.data)==null?void 0:l.message)||"",N=((y=u==null?void 0:u.config)==null?void 0:y.url)||"",z=/\/(booking-flow|payment|cart|bookings)\//.test(N);!z&&(v.toLowerCase().includes("token revoked")||v.toLowerCase().includes("token expired"))?(localStorage.removeItem("authToken"),localStorage.removeItem("user"),e(Ys()),window.dispatchEvent(new CustomEvent("openAuthModal")),alert("Your session has expired. Please sign in using the navbar to continue booking.")):z?(console.warn("Payment endpoint returned 401 - not auto-logging out to preserve session"),alert("Payment verification is processing. Please check your email for ticket confirmation.")):(ce(!0),alert("Authentication failed. Please sign in again."))}else{const v=(u==null?void 0:u.message)||((T=(h=u==null?void 0:u.response)==null?void 0:h.data)==null?void 0:T.message)||"Payment failed";alert(`Booking failed: ${v}`)}}}},bt=s=>{e(Yt(s)),Fe(r=>{const a=new Map(r);return a.delete(s),a}),le===s&&(ze(null),O(et()))},Xe=s=>{const r=s.item_type==="Combo"?"combo":"attraction";O({itemType:r,attractionId:s.attraction_id?String(s.attraction_id):"",comboId:s.combo_id?String(s.combo_id):"",date:s.booking_date||B(),slotKey:"",qty:Number(s.quantity||1)}),ze(s.key),e(We(s.key)),e(q(1)),Z(!0)},ps=s=>{const a=s.target.value.replace(/\D/g,"").slice(0,10);ke(a),a.length===10&&(we(o=>({...o,phone:void 0})),e(je({phone:`${Ne}${a}`})))},jt=async()=>{const s={},r=(A.email||"").trim();if(la.test(r)||(s.email="Please enter a valid email address"),de.length!==10&&(s.phone="Phone number must be exactly 10 digits"),Object.keys(s).length>0){we(s);return}we({});const a=`${Ne}${de}`;e(je({email:r,phone:a}));try{await e($s({email:r,phone:a})).unwrap()}catch(o){alert((o==null?void 0:o.message)||"Failed to send OTP")}},ys=async()=>{if(!_e||_e.length<4)return alert("Enter the full OTP code");await e(Os({otp:_e})).unwrap().then(()=>{ct(""),e(q(4))}).catch(s=>alert((s==null?void 0:s.message)||"OTP verification failed"))},fs=async()=>{ue&&await e(Es({code:ue,total_amount:Math.max(0,He),onDate:n.date||W(new Date)})).unwrap().then(()=>e($t(ue))).catch(()=>{})},hs=()=>t.jsxs("div",{className:"flex items-center justify-between mb-0.5 px-4",children:[[{n:1,l:"Select",icon:X},{n:2,l:"Extras",icon:Ft},{n:3,l:"Verify",icon:qs},{n:4,l:"Pay",icon:Rt}].map(s=>{if(f&&s.n===3)return null;const r=g>s.n||f&&s.n===3,a=g===s.n,o=r||f&&s.n===3,c=s.icon;return t.jsxs("div",{className:"flex flex-col items-center relative z-10 group",children:[t.jsx("div",{className:`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300 border-2 shadow-sm ${a?"bg-gradient-to-br from-sky-600 to-sky-700 border-sky-600 text-white scale-110 ring-4 ring-sky-100":o?"bg-gradient-to-br from-emerald-600 to-emerald-700 border-emerald-600 text-white shadow-md":"bg-white border-gray-200 text-gray-300 shadow-sm"}`,children:o&&!a?t.jsx(Rt,{size:16,strokeWidth:3}):t.jsx(c,{size:16})}),t.jsx("span",{className:`text-[10px] mt-2 font-bold uppercase tracking-widest ${a?"text-sky-600":o?"text-emerald-600":"text-gray-400"}`,children:s.l})]},s.n)}),t.jsx("div",{className:"absolute left-8 right-8 top-[18px] h-0.5 bg-gradient-to-r from-sky-100 to-sky-200 -z-0 overflow-hidden rounded-full",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-sky-600 to-sky-500 transition-all duration-500 ease-out shadow-sm",style:{width:`${(g-1)/(f?2:3)*100}%`}})})]}),gs=()=>{const s=n.itemType,r=p.useMemo(()=>{if(s!=="attraction")return xe;const a=Array.isArray(se)?[...se]:[],o=c=>{const l=String((c==null?void 0:c.name)??(c==null?void 0:c.title)??"").toLowerCase(),y=l.replace(/\s+/g,"");return l.includes("snow city")||y.includes("snowcity")?0:l.includes("mad lab")||y.includes("madlab")?1:2};return a.sort((c,l)=>{const y=o(c),h=o(l);return y!==h?y-h:0}),a},[s,se,xe]);return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"mb-2",children:t.jsx("div",{className:"bg-sky-50 p-1 rounded-xl inline-flex border border-sky-100",children:["attraction","combo"].map(a=>t.jsx("button",{onClick:()=>{O(o=>({...o,itemType:a,attractionId:"",comboId:"",slotKey:""}))},className:`px-6 py-2 text-sm font-semibold rounded-lg capitalize transition-all duration-200 ${n.itemType===a?"bg-white text-sky-700 shadow-sm ring-1 ring-black/5":"text-gray-600 hover:text-gray-900"}`,children:a==="attraction"?"Attractions":"Combos"},a))})}),r.length===0?t.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-dashed border-gray-200 px-4 py-6 text-center text-sm text-gray-500",children:n.itemType==="combo"?"No combos available":"No attractions available"}):r.map(a=>{const o=n.itemType==="attraction"?ie(a):oe(a),c=String(n.itemType==="attraction"?n.attractionId:n.comboId)===String(o),l=n.itemType==="combo"?Number(Jt(a)||0):Number(at(a)||a.price||a.base_price||a.amount||0),y=n.itemType==="attraction"?a.title||a.name:Qt(a),h=n.itemType==="combo"?$e(a):Ye(a),T=()=>{const u=n.itemType==="combo",v=S.find(N=>u?N.item_type==="Combo"&&Ee(N.combo_id,o):(N.item_type==="Attraction"||N.item_type===void 0)&&Ee(N.attraction_id,o));if(v){Xe(v);return}O(N=>({...N,itemType:n.itemType,attractionId:n.itemType==="attraction"?String(o):"",comboId:n.itemType==="combo"?String(o):"",slotKey:""})),Le("booking"),Z(!0)};return t.jsxs("div",{className:`bg-white rounded-3xl shadow-sm border px-4 sm:px-6 py-4 sm:py-5 flex items-center justify-between gap-4 transition-all ${c?"border-sky-400 shadow-md":"border-gray-100 hover:border-sky-200"}`,children:[t.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[t.jsx("div",{className:"w-28 h-28 rounded-2xl overflow-hidden border border-gray-100 bg-sky-50 shrink-0",children:h?t.jsx("img",{src:h,alt:y,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center text-sky-400",children:t.jsx(X,{})})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1 truncate",children:y}),t.jsx("p",{className:"text-xs text-gray-500",children:"Great for families • Flexible slots • Instant confirmation"}),t.jsxs("button",{type:"button",onClick:()=>{O(u=>({...u,itemType:n.itemType,attractionId:n.itemType==="attraction"?String(o):"",comboId:n.itemType==="combo"?String(o):"",slotKey:""})),is(h||null),Le("details"),Z(!0)},className:"inline-flex items-center gap-1 text-xs sm:text-sm font-semibold text-sky-700 hover:text-sky-900 mt-2",children:["View details",t.jsx(Ze,{size:14})]})]})]}),t.jsxs("div",{className:"flex flex-col items-end gap-2 sm:gap-3",children:[t.jsx("div",{className:"text-right text-xs text-gray-500 uppercase tracking-wide",children:"From"}),t.jsx("div",{className:"flex items-baseline gap-2",children:t.jsxs("span",{className:"text-lg sm:text-xl font-bold text-sky-700 tabular-nums",children:["₹",l||0]})}),t.jsx("button",{type:"button",onClick:T,className:`px-6 py-2 rounded-full text-white text-sm font-semibold shadow-md active:scale-[0.98] transition-all ${c?"bg-sky-700":"bg-sky-600 hover:bg-sky-700"}`,children:c?"Selected":"Select"})]})]},o)})]})},bs=()=>w.loadingOffers||!w.offers.length?null:t.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-200 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-800",children:"Available Offers"}),V&&t.jsx("button",{type:"button",onClick:()=>mt(""),className:"text-xs font-medium text-sky-700 hover:underline",children:"Remove"})]}),t.jsx("div",{className:"space-y-3",children:w.offers.map(s=>{const r=String(nt(s));if(!r)return null;const a=va(s,P.price||0,ye);return t.jsxs("label",{className:`flex items-start gap-3 rounded-2xl border px-3 py-3 cursor-pointer transition-all duration-200 ${String(V)===r?"border-sky-500 bg-sky-50 shadow-sm":"hover:border-gray-300"}`,children:[t.jsx("input",{type:"radio",name:"selected-offer",className:"mt-1",checked:String(V)===r,onChange:()=>mt(r)}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:Zt(s)}),tt(s)?t.jsx("p",{className:"text-xs text-gray-500 mt-0.5 line-clamp-2",children:tt(s)}):null]}),t.jsx("span",{className:"text-xs font-semibold text-sky-700 bg-sky-50 px-2 py-1 rounded-full",children:a?`Save ₹${a.totalDiscount.toFixed(0)}`:"No discount"})]}),a&&a.totalDiscount>0&&t.jsxs("p",{className:"text-xs text-emerald-600 mt-1",children:["Save up to ₹",a.totalDiscount.toFixed(0)," with this offer"]})]})]},`offer-${r}`)})})]}),vt=()=>{O(s=>({...s,date:B(),slotKey:""}))},Nt=()=>{O(s=>({...s,date:M().add(1,"day").format("YYYY-MM-DD"),slotKey:""}))},[kt,Ae]=p.useState(!1),[js,wt]=p.useState(null),he=p.useMemo(()=>null,[js,kt]),_t=s=>{s.preventDefault(),s.stopPropagation(),wt(s.currentTarget),Ae(!0)},vs=s=>{O(r=>({...r,date:s,slotKey:""})),Ae(!1)},Ct=s=>{if(!s)return"All Days";const r=M(s);return s===B()||s===M().add(1,"day").format("YYYY-MM-DD")?"All Days":r.format("D MMM")};return t.jsx(t.Fragment,{children:t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 to-white font-inter",children:t.jsxs("div",{className:"max-w-6xl mx-auto px-3 lg:px-0 pb-24 lg:pb-20 pt-20 md:pt-24",children:[t.jsxs("div",{className:"sticky top-[calc(64px+1px)] z-40 mt-px bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-sky-100",children:[t.jsxs("div",{className:"px-4 md:px-6 pt-3 md:pt-4 pb-2 md:pb-3 border-b border-gray-100 flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900",children:g===1?"Select tickets":g===2?"Customize Add-ons":g===3?"Verify OTP":"Checkout"}),t.jsx("button",{onClick:os,className:"p-2 hover:bg-sky-50 rounded-full text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(Qe,{size:22})})]}),t.jsx("div",{className:"relative pb-1",children:t.jsx(hs,{})})]}),t.jsxs("div",{className:"mt-2 md:mt-4",children:[g===1&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-wrap gap-2 items-center mb-1",children:[t.jsx("button",{type:"button",onClick:vt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date===B()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),t.jsx("button",{type:"button",onClick:Nt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date===M().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),t.jsx("button",{type:"button",onClick:_t,ref:wt,className:`px-4 py-2 rounded-full text-xs sm:text-sm font-medium border transition-colors ${n.date&&n.date!==""&&n.date!==B()&&n.date!==M().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:n.date&&n.date!==B()&&n.date!==M().add(1,"day").format("YYYY-MM-DD")?Ct(n.date):"All Days"}),t.jsx("span",{className:"text-xs sm:text-sm text-gray-500 ml-1",children:"Change date/time in details panel"})]}),t.jsx(gs,{})]}),t.jsx("div",{className:"lg:sticky lg:top-28",children:t.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),$?t.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:S.map(s=>{var r,a,o,c,l,y;return t.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((r=s.meta)==null?void 0:r.title)||(s.item_type==="combo"?((a=s.combo)==null?void 0:a.title)||((o=s.combo)==null?void 0:o.name)||((c=s.combo)==null?void 0:c.combo_name)||`Combo #${s.combo_id}`:((l=s.attraction)==null?void 0:l.title)||((y=s.attraction)==null?void 0:y.name)||`Attraction #${s.attraction_id}`)}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) •"," ",s.dateLabel||M(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` • ${s.slotLabel}`:""]}),t.jsxs("div",{className:"flex gap-3 mt-1",children:[t.jsx("button",{type:"button",onClick:()=>Xe(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),t.jsx("button",{type:"button",onClick:()=>bt(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["₹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):t.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:t.jsx(X,{className:"text-sky-600"})}),t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),t.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),t.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),t.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["₹",ne.toFixed(0)]})]}),t.jsxs("button",{type:"button",disabled:!$,onClick:Ge,className:`w-full flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${$?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[t.jsx("span",{children:"Continue"}),t.jsx(Je,{size:18})]})]})]})})]}),g===2&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,2.1fr)_minmax(320px,1fr)] gap-6 items-start mt-4",children:[t.jsxs("div",{className:"space-y-6",children:[S.length>1&&t.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:S.map(s=>{var r,a,o,c,l,y;return t.jsx("button",{onClick:()=>e(We(s.key)),className:`px-4 py-2 rounded-full border text-sm font-medium transition-all ${s.key===J?"bg-sky-600 text-white border-sky-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-sky-200"}`,children:s.title||((r=s.meta)==null?void 0:r.title)||(s.item_type==="combo"?((a=s.combo)==null?void 0:a.title)||((o=s.combo)==null?void 0:o.name)||((c=s.combo)==null?void 0:c.combo_name)||`Combo #${s.combo_id}`:((l=s.attraction)==null?void 0:l.title)||((y=s.attraction)==null?void 0:y.name)||`Attraction #${s.attraction_id}`)||"Item"},s.key)})}),t.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Add-ons"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Enhance your experience with optional extras"})]}),t.jsx("button",{onClick:()=>e(It({active:!0,limit:100})),className:"text-xs font-semibold text-sky-700 hover:underline",children:"Refresh"})]}),C.status==="loading"?t.jsx("div",{className:"text-center py-10 text-gray-500 text-sm",children:"Loading add-ons..."}):t.jsx("div",{className:"space-y-4",children:(C.items||[]).map(s=>{var y;const r=ca(s),a=Xt(s),o=Wt(s),c=da(s),l=Number(((y=ds.get(r))==null?void 0:y.quantity)||0);return t.jsxs("div",{className:"flex gap-4 items-center border border-gray-200 rounded-2xl p-4 hover:border-sky-200 transition-all",children:[c?t.jsx("img",{src:c,alt:o,className:"w-16 h-16 rounded-xl object-cover border border-gray-100"}):t.jsx("div",{className:"w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center text-gray-400",children:t.jsx(X,{})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold text-gray-900 truncate",children:o}),t.jsx("div",{className:"text-sm text-gray-500 tabular-nums",children:zt(a)})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>gt(r,Math.max(0,l-1),s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 transition",children:t.jsx(Bt,{size:16})}),t.jsx("span",{className:"w-6 text-center font-semibold text-gray-800 tabular-nums",children:l}),t.jsx("button",{onClick:()=>gt(r,l+1,s),className:"w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center hover:border-sky-200 active:scale-95 bg-sky-600 text-white shadow",children:t.jsx(Kt,{size:16})})]})]},r)})})]})]}),t.jsx("div",{className:"lg:sticky lg:top-28",children:t.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-gray-100 p-5 sm:p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Order details"}),$?t.jsx("div",{className:"space-y-3 mb-4 max-h-72 overflow-y-auto custom-scrollbar pr-1",children:S.map(s=>{var o,c,l,y,h,T;const r=H.get(s.key)||new Map,a=Array.from(r.values()).filter(u=>Number(u.quantity)>0);return t.jsxs("div",{className:"flex justify-between gap-3 text-sm border-b border-gray-100 pb-3 last:border-0 last:pb-0",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:s.title||((o=s.meta)==null?void 0:o.title)||(s.item_type==="combo"?((c=s.combo)==null?void 0:c.title)||((l=s.combo)==null?void 0:l.name)||((y=s.combo)==null?void 0:y.combo_name)||`Combo #${s.combo_id}`:((h=s.attraction)==null?void 0:h.title)||((T=s.attraction)==null?void 0:T.name)||`Attraction #${s.attraction_id}`)}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.quantity," ticket(s) • ",s.dateLabel||M(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` • ${s.slotLabel}`:""]}),t.jsxs("div",{className:"flex gap-3 mt-1",children:[t.jsx("button",{type:"button",onClick:()=>Xe(s),className:"text-[11px] text-sky-700 hover:underline",children:"Edit"}),t.jsx("button",{type:"button",onClick:()=>bt(s.key),className:"text-[11px] text-red-500 hover:underline",children:"Remove"})]}),a.length>0&&t.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[t.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Extras"}),t.jsx("div",{className:"space-y-1",children:a.map(u=>t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[t.jsxs("div",{className:"truncate",children:[u.name," ",t.jsxs("span",{className:"text-xs text-gray-400",children:["x",u.quantity]})]}),t.jsxs("div",{className:"tabular-nums",children:["₹",(Number(u.price||0)*Number(u.quantity||0)).toFixed(0)]})]},u.addon_id))})]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"font-semibold text-gray-900 tabular-nums",children:["₹",(s.unitPrice*s.quantity).toFixed(0)]})})]},s.key)})}):t.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-8",children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-sky-50 flex items-center justify-center mb-3",children:t.jsx(X,{className:"text-sky-600"})}),t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"The product you choose will be displayed here"}),t.jsx("p",{className:"text-xs text-gray-400",children:"Select a ticket and add to your order"})]}),t.jsxs("div",{className:"pt-3 border-t border-gray-100 mt-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"Total amount"}),t.jsxs("span",{className:"text-lg font-semibold text-sky-700 tabular-nums",children:["₹",ne.toFixed(0)]})]}),t.jsxs("button",{type:"button",disabled:!$,onClick:Ge,className:`w-full flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${$?"bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-[0.98]":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[t.jsx("span",{children:"Continue"}),t.jsx(Je,{size:18})]})]})]})})]}),g===3&&!f&&t.jsxs("div",{className:"space-y-6 max-w-md mx-auto animate-in fade-in slide-in-from-right-8 duration-300 mt-4",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"w-16 h-16 bg-sky-50 text-sky-700 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(ra,{size:32})}),t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Guest Details"}),t.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Enter your details to receive tickets via Email & SMS."})]}),t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Full Name"}),t.jsxs("div",{className:"relative group",children:[t.jsx(ia,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),t.jsx("input",{placeholder:"John Doe",className:"w-full pl-11 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 focus:bg-white outline-none transition-all font-medium",value:A.name,onChange:s=>e(je({name:s.target.value}))})]})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Email Address"}),t.jsxs("div",{className:"relative group",children:[t.jsx(Xs,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),t.jsx("input",{placeholder:"name@example.com",type:"email",className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium ${U.email?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:A.email,onChange:s=>{e(je({email:s.target.value})),U.email&&we(r=>({...r,email:void 0}))}})]}),U.email&&t.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[t.jsx(Lt,{size:12})," ",U.email]})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase ml-1",children:"Mobile Number"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"relative w-32",children:[t.jsx("div",{className:"absolute left-3 top-3.5 z-10 pointer-events-none",children:t.jsx(Us,{size:18,className:"text-gray-400"})}),t.jsx("select",{className:"w-full pl-10 pr-8 p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none appearance-none font-medium text-sm",value:Ne,onChange:s=>lt(s.target.value),children:Gt.map(s=>t.jsx("option",{value:s.code,children:s.code},s.code))}),t.jsx(Ze,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 rotate-90 pointer-events-none"})]}),t.jsxs("div",{className:"relative flex-1 group",children:[t.jsx(Js,{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-sky-600 transition-colors",size:18}),t.jsx("input",{placeholder:"98765 43210",type:"tel",maxLength:10,className:`w-full pl-11 p-3.5 bg-gray-50 border rounded-xl focus:ring-2 focus:bg-white outline-none transition-all font-medium tracking-wide ${U.phone?"border-red-300 focus:ring-red-200":"border-gray-200 focus:ring-sky-500"}`,value:de,onChange:ps})]})]}),U.phone&&t.jsxs("p",{className:"text-xs text-red-500 ml-1 flex items-center gap-1",children:[t.jsx(Lt,{size:12})," ",U.phone]})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",required:!0,checked:A.whatsapp_consent||!1,onChange:s=>e(je({whatsapp_consent:s.target.checked})),className:"w-4 h-4 text-sky-600 bg-gray-100 border-gray-300 rounded focus:ring-sky-500 focus:ring-2"}),t.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"I agree to receive WhatsApp notifications *"})]}),t.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"We'll send booking confirmations and updates via WhatsApp"})]}),L.sent?t.jsxs("div",{className:"mt-6 bg-sky-50 border border-sky-100 p-5 rounded-2xl animate-in fade-in slide-in-from-bottom-2",children:[t.jsxs("p",{className:"text-sm text-sky-800 mb-3 font-medium",children:["Enter OTP sent to ",Ne," ",de]}),t.jsxs("div",{className:"flex gap-3 flex-col sm:flex-row",children:[t.jsx("input",{placeholder:"XXXXXX",className:"flex-1 p-3.5 text-center tracking-[0.5em] font-bold text-xl border-2 border-sky-200 rounded-xl focus:border-sky-600 focus:ring-4 focus:ring-sky-100 outline-none bg-white transition-all",maxLength:6,value:_e,onChange:s=>ct(s.target.value)}),t.jsx("button",{onClick:ys,disabled:L.status==="loading",className:"bg-sky-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-sky-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 w-full sm:w-auto text-sm sm:text-base",children:L.status==="loading"?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Verifying..."})]}):L.verified?t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Verified"]}):"Verify"})]}),t.jsx("button",{onClick:jt,className:"text-xs text-sky-700 font-medium mt-3 hover:underline",children:"Resend Code"})]}):t.jsx("button",{onClick:jt,disabled:L.status==="loading",className:"w-full bg-sky-700 text-white py-3 rounded-xl font-bold text-base shadow-lg hover:bg-sky-800 transition-all disabled:opacity-70 flex items-center justify-center gap-2 mt-4",children:L.status==="loading"?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"Sending..."})]}):"Send OTP Verification"})]})]}),g===4&&t.jsxs("div",{className:"space-y-6 max-w-lg mx-auto animate-in fade-in slide-in-from-right-8 duration-300 pb-20",children:[t.jsx(bs,{}),t.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-sm",children:[t.jsxs("h3",{className:"font-bold text-gray-900 mb-4 text-lg flex items-center gap-2",children:[t.jsx(X,{className:"text-sky-600",size:20}),"Booking Summary"]}),ht&&t.jsxs("div",{className:"mb-4 rounded-xl bg-emerald-50 border border-emerald-100 p-3 text-sm text-emerald-700",children:[t.jsxs("div",{className:"font-semibold text-emerald-800",children:["Coupon ",String(D.code||((At=D.data)==null?void 0:At.code)).toUpperCase()," applied"]}),t.jsxs("div",{className:"flex items-center justify-between mt-1 text-emerald-700",children:[t.jsx("span",{children:((Tt=D.data)==null?void 0:Tt.description)||"Discount applied successfully"}),t.jsxs("span",{className:"font-bold tabular-nums",children:["-₹",fe.toFixed(0)]})]})]}),V&&(()=>{const s=w.offers.find(r=>String(nt(r))===String(V));return s?t.jsxs("div",{className:"mb-4 rounded-xl bg-green-50 border border-green-100 p-3 text-sm text-green-700",children:[t.jsxs("div",{className:"font-semibold text-green-800",children:["Offer Applied: ",Zt(s)]}),t.jsxs("div",{className:"mt-1 text-green-600",children:[tt(s),s.rule_type==="buy_x_get_y"&&s.buy_qty&&s.get_qty&&t.jsxs("div",{className:"mt-1",children:["Buy ",s.buy_qty," Get ",s.get_qty,s.get_discount_type==="percent"&&s.get_discount_value&&t.jsxs("span",{children:[" (",s.get_discount_value,"% off)"]}),s.get_discount_type==="amount"&&s.get_discount_value&&t.jsxs("span",{children:[" (",zt(s.get_discount_value)," off)"]}),!s.get_discount_value&&t.jsx("span",{children:" Free"})]})]})]}):null})(),t.jsxs("div",{className:"mb-4 space-y-2 max-h-40 overflow-y-auto custom-scrollbar pr-2",children:[S.map(s=>{var o,c,l,y,h,T;const r=H.get(s.key)||new Map,a=Array.from(r.values()).filter(u=>Number(u.quantity)>0);return t.jsxs("div",{className:"text-sm py-2 border-b border-dashed border-gray-100 last:border-0",children:[t.jsxs("div",{className:"flex justify-between mb-1",children:[t.jsxs("div",{className:"text-gray-700",children:[t.jsxs("span",{className:"font-bold text-gray-900",children:[s.quantity,"x"]})," ",s.title||((o=s.meta)==null?void 0:o.title)||(s.item_type==="combo"?((c=s.combo)==null?void 0:c.title)||((l=s.combo)==null?void 0:l.name)||((y=s.combo)==null?void 0:y.combo_name)||`Combo #${s.combo_id}`:((h=s.attraction)==null?void 0:h.title)||((T=s.attraction)==null?void 0:T.name)||`Attraction #${s.attraction_id}`),t.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:[s.dateLabel||M(s.booking_date).format("D MMMM YYYY")||s.booking_date,s.slotLabel?` • ${s.slotLabel}`:""]})]}),t.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["₹",s.unitPrice*s.quantity]})]}),a.length>0&&t.jsx("div",{className:"ml-1 mt-1.5 pl-2 border-l-2 border-sky-200 space-y-1",children:a.map(u=>t.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[t.jsxs("span",{className:"text-gray-600",children:["• ",u.name," ",t.jsxs("span",{className:"text-gray-400",children:["x",u.quantity]})]}),t.jsxs("span",{className:"font-medium text-gray-700 tabular-nums",children:["₹",(Number(u.price||0)*Number(u.quantity||0)).toFixed(0)]})]},u.addon_id))})]},s.key)}),Ve>0&&t.jsxs("div",{className:"flex justify-between text-sm py-2 border-t border-gray-100 pt-3",children:[t.jsx("div",{className:"text-gray-600 font-medium",children:"Extras / Add-ons"}),t.jsxs("div",{className:"font-medium text-gray-900 tabular-nums",children:["₹",Ve]})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl space-y-2 text-sm mt-2",children:[t.jsxs("div",{className:"flex justify-between text-gray-500",children:[t.jsx("span",{children:"Subtotal (with offers)"})," ",t.jsxs("span",{className:"tabular-nums",children:["₹",He]})]}),fe>0&&t.jsxs("div",{className:"flex justify-between text-green-600 font-medium",children:[t.jsxs("span",{children:["Coupon (",String(D.code||((St=D.data)==null?void 0:St.code)).toUpperCase(),")"]}),t.jsxs("span",{className:"tabular-nums",children:["-₹",fe.toFixed(0)]})]}),t.jsxs("div",{className:"border-t border-gray-200 pt-3 flex justify-between items-center mt-2",children:[t.jsx("span",{className:"font-bold text-gray-800 text-lg",children:"Total Payable"}),t.jsxs("span",{className:"font-bold text-2xl text-sky-700 tabular-nums",children:["₹",ne]})]})]})]}),t.jsx("div",{className:"space-y-3 border-t border-gray-200 pt-4",children:ht?t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Current Promo Code"}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsxs("div",{className:"flex-1 px-4 py-3 border border-green-200 rounded-xl bg-green-50 text-sm font-bold text-green-700 uppercase tracking-wider",children:["✓ ",String(D.code||((Pt=D.data)==null?void 0:Pt.code)).toUpperCase()," Applied"]}),t.jsx("button",{onClick:()=>{dt(""),e($t(""))},className:"px-4 py-3 rounded-xl border border-red-200 bg-red-50 text-red-600 text-sm font-semibold hover:bg-red-100 transition-colors",title:"Remove promo code",children:"Remove"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Apply Promo Code"}),t.jsx("div",{className:"flex gap-2",children:t.jsxs("div",{className:"relative flex-1",children:[t.jsx(Ft,{size:18,className:"absolute left-3 top-3 text-gray-400 pointer-events-none"}),t.jsxs("select",{className:"w-full pl-10 pr-20 p-3 border border-gray-200 rounded-xl text-sm uppercase focus:ring-2 focus:ring-sky-500 outline-none font-bold tracking-wider appearance-none bg-white cursor-pointer disabled:bg-gray-50 disabled:text-gray-400 transition-all hover:border-gray-300",value:ue,onChange:s=>dt(s.target.value),disabled:Ce,children:[t.jsx("option",{value:"",children:Ce?"Loading promos...":"Select a promo code"}),ut.map(s=>t.jsxs("option",{value:s.code,children:[s.code," ",s.discount?`(${s.discount}% off)`:""]},s.id||s.code))]}),t.jsx("button",{onClick:fs,disabled:!ue||Ce,className:"absolute right-1 top-1 bottom-1 px-4 rounded-lg bg-sky-600 text-white text-xs font-bold tracking-wide hover:bg-sky-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"APPLY"})]})})]})})]})]}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 md:px-0 py-3 md:py-3 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] z-[140]",children:t.jsxs("div",{className:"max-w-6xl mx-auto flex gap-3 items-center",children:[g>1&&t.jsx("button",{type:"button",onClick:us,className:"p-2.5 rounded-xl border border-gray-200 text-gray-700 hover:border-gray-300 active:scale-[0.98] transition-all flex items-center justify-center",title:"Go back",children:t.jsx(Ls,{size:18})}),t.jsx("div",{className:`flex-1 ${d?"hidden":""}`,children:t.jsxs("div",{className:"text-base font-semibold text-gray-900 tabular-nums",children:["₹",ne]})}),t.jsxs("button",{type:"button",onClick:g===4?xs:Ge,disabled:g===4?(F==null?void 0:F.status)==="loading"||!$:g===3?!L.verified:g===2?!$:!$&&!R,className:`ml-auto inline-flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all active:scale-[0.98] ${(g===4?(F==null?void 0:F.status)==="loading"||!$:g===3?!L.verified:g===2?!$:!$&&!R)?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-sky-600 text-white shadow-md hover:bg-sky-700"}`,children:[t.jsx("span",{children:g===4?`Pay ₹${ne}`:g===3?"Continue":"Next"}),t.jsx(Je,{size:16})]})]})}),as&&P.title&&t.jsxs("div",{className:"fixed inset-0 z-50 flex justify-end items-end md:items-stretch bg-black/40 backdrop-blur-[2px] md:bg-black/20",children:[t.jsx("div",{className:"flex-1 hidden md:block",onClick:()=>Z(!1)}),t.jsxs("div",{className:"w-full md:w-1/3 bg-white rounded-t-3xl md:rounded-l-3xl shadow-2xl flex flex-col transform translate-y-0 transition-all h-[66vh] md:h-screen max-h-[66vh] md:max-h-screen md:mt-0",children:[t.jsx("div",{className:"md:hidden flex justify-center pt-2 pb-1",children:t.jsx("div",{className:"h-1.5 w-12 rounded-full bg-gray-300"})}),t.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between px-4 sm:px-6 pt-4 pb-2 border-b border-gray-100 bg-white rounded-t-3xl md:rounded-tl-3xl sm:rounded-tl-3xl",children:[t.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 pr-3 truncate",children:P.title}),t.jsx("button",{type:"button",onClick:()=>Z(!1),className:"p-2 rounded-full hover:bg-gray-100 text-gray-500 flex-shrink-0",children:t.jsx(Qe,{size:20})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-4 py-4 space-y-4",children:rs==="details"?t.jsxs("div",{className:"space-y-4",children:[(()=>{const s=ns||P.image||(n.itemType==="combo"?$e(_):Ye(b));return s?t.jsxs("div",{className:"relative rounded-2xl overflow-hidden border border-gray-100 shadow-sm",children:[t.jsx("img",{src:s,alt:P.title,className:"w-full h-56 sm:h-64 object-cover"}),t.jsx("div",{className:"absolute inset-x-0 bottom-0 px-4 py-2 bg-gradient-to-t from-black/60 to-transparent text-white text-sm font-semibold",children:P.title})]}):null})(),t.jsx("div",{className:"text-sm text-gray-700",children:((n.itemType==="combo"?(_==null?void 0:_.description)||(_==null?void 0:_.short_description)||(_==null?void 0:_.summary)||"":(b==null?void 0:b.description)||(b==null?void 0:b.short_description)||(b==null?void 0:b.summary)||(b==null?void 0:b.about)||"")||"").split(`
`).map((r,a)=>t.jsx("p",{className:"mb-2",children:r},a))}),t.jsx("div",{className:"pt-2",children:t.jsx("button",{type:"button",onClick:()=>Le("booking"),className:"w-full px-4 py-3 rounded-xl bg-sky-600 text-white font-semibold",children:"Book this"})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Date"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:vt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date===B()?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Today"}),t.jsx("button",{type:"button",onClick:Nt,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date===M().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:"Tomorrow"}),t.jsx("button",{type:"button",onClick:_t,className:`px-4 py-2 rounded-full text-xs font-medium border transition-colors ${n.date&&n.date!==""&&n.date!==B()&&n.date!==M().add(1,"day").format("YYYY-MM-DD")?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-800 border-gray-200 hover:border-sky-300"}`,children:Ct(n.date)})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Time slot"}),t.jsx("div",{className:"relative",children:te.status==="loading"?t.jsx("div",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-sky-600 rounded-full animate-spin"}),"Loading slots..."]})}):te.status==="failed"?t.jsx("div",{className:"w-full p-3.5 bg-red-50 border border-red-200 rounded-xl flex items-center justify-center",children:t.jsx("div",{className:"text-red-600 text-sm",children:"Failed to load slots"})}):t.jsxs(t.Fragment,{children:[t.jsxs("select",{className:"w-full p-3.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none text-sm font-medium appearance-none cursor-pointer disabled:bg-gray-100 disabled:text-gray-400 transition-all hover:border-gray-300",value:n.slotKey,onChange:s=>O(r=>({...r,slotKey:s.target.value})),disabled:!n.attractionId&&!n.comboId,children:[t.jsx("option",{value:"",children:!n.attractionId&&!n.comboId?"Select a ticket above first":"Select a time slot"}),te.items.map((s,r)=>{const a=Ut(s,r),o=ga(s),c=ha(s,n.date),l=!o||!c;return t.jsxs("option",{value:a,disabled:l,children:[Ht(s)," ",o?c?"":"(Not Available)":"(Full)"]},a)})]}),t.jsx(Ze,{size:16,className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 rotate-90"})]})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Quantity"}),t.jsxs("div",{className:"flex items-center gap-4 bg-gray-50 rounded-xl p-1.5 border border-gray-200 w-fit",children:[t.jsx("button",{onClick:()=>O(s=>({...s,qty:Math.max(1,s.qty-1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-white text-gray-600 shadow-sm hover:text-sky-700 active:scale-95 transition",children:t.jsx(Bt,{size:16})}),t.jsx("span",{className:"font-bold text-lg w-8 text-center text-gray-800 tabular-nums",children:n.qty}),t.jsx("button",{onClick:()=>O(s=>({...s,qty:Math.max(1,s.qty+1)})),className:"w-9 h-9 flex items-center justify-center rounded-lg bg-sky-600 text-white shadow-md hover:bg-sky-700 active:scale-95 transition",children:t.jsx(Kt,{size:16})})]})]})]})}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-x-0 top-0 h-4 bg-gradient-to-t from-white via-white/70 to-transparent pointer-events-none"}),t.jsxs("div",{className:"px-4 sm:px-6 py-3 border-t border-gray-100 bg-white flex items-center justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-semibold",children:"Subtotal"}),t.jsxs("div",{className:"text-lg font-bold text-sky-700 tabular-nums",children:["₹",ls.toFixed(0)]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:Me,disabled:!R,className:"inline-flex items-center px-4 py-2 rounded-full border border-gray-200 text-xs font-semibold text-gray-700 hover:border-sky-300 disabled:opacity-40 disabled:cursor-not-allowed",children:"Add to order"}),t.jsxs("button",{type:"button",onClick:ms,disabled:!R,className:"flex items-center gap-2 px-4 py-2.5 rounded-full bg-sky-600 text-white text-sm font-semibold shadow-md hover:bg-sky-700 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed",children:[t.jsx(X,{size:18}),t.jsx("span",{children:"Buy"})]})]})]})]})]})]}),ss&&t.jsx(oa,{onClose:()=>ce(!1),onSignIn:()=>{ce(!1),e(q(3))},onContinueAsGuest:()=>{ce(!1),e(q(3))}}),kt&&t.jsxs("div",{className:"fixed inset-0 z-[150] flex",onClick:()=>Ae(!1),children:[t.jsx("div",{className:"flex-1"}),t.jsxs("div",{className:"absolute bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 w-80 max-h-[70vh] overflow-y-auto",style:{top:he?`${he.top}px`:"50%",left:he?`${he.left-160}px`:"50%",transform:he?"none":"translate(-50%, -50%)"},onClick:s=>s.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Select Date"}),t.jsx("button",{onClick:()=>Ae(!1),className:"p-1.5 rounded-lg hover:bg-gray-100 text-gray-400 transition-colors",children:t.jsx(Qe,{size:18})})]}),t.jsx("div",{className:"space-y-3",children:[0,1,2].map(s=>{const r=M().add(s,"month"),a=r.startOf("month"),o=r.endOf("month"),c=a.day(),l=o.date(),y=M();return t.jsxs("div",{className:"border border-gray-100 rounded-xl p-3 bg-white",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:r.format("MMMM YYYY")}),t.jsxs("div",{className:"grid grid-cols-7 gap-1 text-xs",children:[["Su","Mo","Tu","We","Th","Fr","Sa"].map(h=>t.jsx("div",{className:"text-center text-gray-400 font-medium py-2",children:h},h)),Array.from({length:c}).map((h,T)=>t.jsx("div",{className:"p-2"},`empty-${T}`)),Array.from({length:l}).map((h,T)=>{const u=a.date(T+1),v=u.format("YYYY-MM-DD"),N=u.isBefore(y,"day"),z=n.date===v,Te=u.isSame(y,"day");return t.jsx("button",{onClick:()=>vs(v),disabled:N,className:`
                                  p-2 rounded-lg text-sm font-medium transition-all duration-200
                                  ${N?"text-gray-300 cursor-not-allowed bg-gray-50":""}
                                  ${z?"bg-sky-600 text-white shadow-md":""}
                                  ${!N&&!z?"hover:bg-sky-50 text-gray-700":""}
                                  ${Te?"ring-2 ring-sky-300":""}
                                `,children:u.date()},T)})]})]},s)})})]})]})]})})})}export{Pa as default};
