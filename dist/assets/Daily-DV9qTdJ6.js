import{R as i,D as a,j as e}from"./index-CmreT6x1.js";import{a as b}from"./AdminApp-BV7zANWg.js";import{R as j,T as _}from"./CategoricalChart-DBf64Xqk.js";import{B as R,a as p}from"./BarChart-Ce8fWW8T.js";import{C as f,X as N,Y as v,L as k}from"./CartesianChart-KmrazZSN.js";import{L as z,a as V}from"./LineChart-CVdFWwId.js";import"./createLucideIcon-CgZNF2TE.js";import"./file-text-ButRzfWA.js";import"./newspaper-yOb_4zvd.js";import"./ticket-hq6RMmhb.js";import"./chevron-down-bqKWLlrR.js";import"./clsx-B-dksMZM.js";import"./index-CWA4Ncqu.js";import"./tooltipContext-Ezhy2kR-.js";const $=[{key:"7d",label:"7 days",from:()=>a().subtract(7,"day"),to:()=>a()},{key:"30d",label:"30 days",from:()=>a().subtract(30,"day"),to:()=>a()},{key:"thisMonth",label:"Month to date",from:()=>a().startOf("month"),to:()=>a()},{key:"year",label:"Year to date",from:()=>a().startOf("year"),to:()=>a()}],u=({title:m,subtitle:h,children:x})=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm dark:bg-neutral-900 dark:border-neutral-800",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-neutral-100",children:m}),h?e.jsx("p",{className:"text-xs text-gray-500",children:h}):null]}),x]}),l=({label:m,value:h,subtitle:x})=>e.jsxs("div",{className:"rounded-xl border border-gray-100 bg-gray-50 px-4 py-3",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:m}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:h}),x&&e.jsx("p",{className:"text-xs text-gray-400",children:x})]});function le(){const[m,h]=i.useState(a().subtract(30,"day").startOf("day").toISOString()),[x,S]=i.useState(a().endOf("day").toISOString()),[g,D]=i.useState([]),[M,L]=i.useState("30d"),[o,O]=i.useState(null),[P,B]=i.useState([]),[H,K]=i.useState([]),[d,Y]=i.useState(""),[c,A]=i.useState(""),[T,C]=i.useState(!1);i.useEffect(()=>{(async()=>{try{const[t,s]=await Promise.all([b.get("/api/admin/attractions"),b.get("/api/admin/combos")]);B(Array.isArray(t)?t:[]),K(Array.isArray(s)?s:[])}catch(t){console.error("Error fetching attractions/combos:",t)}})()},[]),i.useEffect(()=>{(async()=>{C(!0);try{const t={from:m,to:x};d&&(t.attraction_id=d),c&&(t.combo_id=c);const s=await b.get("/api/admin/analytics/daily",t);D(Array.isArray(s)?s:[])}catch(t){console.error("Error fetching analytics:",t),D([])}finally{C(!1)}})()},[m,x,d,c]);const F=`/api/admin/analytics/report.csv?type=daily&from=${encodeURIComponent(m)}&to=${encodeURIComponent(x)}${d?`&attraction_id=${d}`:""}${c?`&combo_id=${c}`:""}`,n=i.useMemo(()=>g.reduce((t,s)=>(t.completed_bookings+=Number(s.completed_bookings||0),t.pending_bookings+=Number(s.pending_bookings||0),t.total_bookings+=Number(s.total_bookings||0),t.total_people+=Number(s.total_people||0),t.revenue+=Number(s.revenue||0),t.pending_revenue+=Number(s.pending_revenue||0),t.slots_used+=Number(s.slots_used||0),t.hours_booked+=Number(s.hours_booked||0),t.bookings_with_offers+=Number(s.bookings_with_offers||0),t.total_discounts+=Number(s.total_discounts||0),t),{completed_bookings:0,pending_bookings:0,total_bookings:0,total_people:0,revenue:0,pending_revenue:0,slots_used:0,hours_booked:0,bookings_with_offers:0,total_discounts:0}),[g]),I=t=>{const s=$.find(y=>y.key===t);s&&(L(t),h(s.from().startOf("day").toISOString()),S(s.to().endOf("day").toISOString()))},r=t=>`₹${Number(t).toLocaleString()}`,U=t=>!t.hourly_data||!Array.isArray(t.hourly_data)?[]:t.hourly_data.map(s=>({hour:`${s.hour}:00`,bookings:s.completed_bookings,revenue:s.revenue}));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(u,{title:"Daily Analytics Filters",subtitle:"Detailed attraction/combo performance metrics",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:$.map(t=>e.jsx("button",{onClick:()=>I(t.key),className:`rounded-full border px-3 py-1 text-xs font-semibold ${M===t.key?"bg-gray-900 text-white border-gray-900":"border-gray-200 text-gray-600"}`,children:t.label},t.key))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mb-3",children:[e.jsx("input",{type:"datetime-local",className:"rounded-lg border px-3 py-2 text-sm",value:a(m).format("YYYY-MM-DDTHH:mm"),onChange:t=>h(a(t.target.value).toISOString())}),e.jsx("input",{type:"datetime-local",className:"rounded-lg border px-3 py-2 text-sm",value:a(x).format("YYYY-MM-DDTHH:mm"),onChange:t=>S(a(t.target.value).toISOString())}),e.jsxs("select",{className:"rounded-lg border px-3 py-2 text-sm",value:d,onChange:t=>{Y(t.target.value),A("")},children:[e.jsx("option",{value:"",children:"All Attractions"}),P.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{className:"rounded-lg border px-3 py-2 text-sm",value:c,onChange:t=>{A(t.target.value),Y("")},children:[e.jsx("option",{value:"",children:"All Combos"}),H.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("a",{href:F,className:"rounded-lg border px-3 py-2 text-sm text-center flex items-center justify-center",children:"Download CSV"})]}),T&&e.jsx("div",{className:"text-sm text-gray-500",children:"Loading data..."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(l,{label:"Completed Bookings",value:n.completed_bookings.toLocaleString()}),e.jsx(l,{label:"Pending Bookings",value:n.pending_bookings.toLocaleString()}),e.jsx(l,{label:"Total People",value:n.total_people.toLocaleString()}),e.jsx(l,{label:"Revenue",value:r(n.revenue)}),e.jsx(l,{label:"Pending Revenue",value:r(n.pending_revenue)})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(l,{label:"Slots Used",value:n.slots_used.toLocaleString()}),e.jsx(l,{label:"Hours Booked",value:n.hours_booked.toFixed(1)}),e.jsx(l,{label:"Bookings with Offers",value:n.bookings_with_offers.toLocaleString()}),e.jsx(l,{label:"Total Discounts",value:r(n.total_discounts)}),e.jsx(l,{label:"Avg Booking Value",value:n.completed_bookings>0?r(n.revenue/n.completed_bookings):"₹0"})]}),e.jsx(u,{title:"Daily Breakdown by Attraction/Combo",subtitle:"Click on a row to see hourly details",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Date"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Type"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Name"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Completed"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Pending"}),e.jsx("th",{className:"text-right py-2 px-2",children:"People"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Revenue"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Slots Used"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Hours"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Offers"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Discounts"}),(d||c)&&e.jsx("th",{className:"text-right py-2 px-2",children:"Base Price"}),(d||c)&&e.jsx("th",{className:"text-right py-2 px-2",children:"Potential Revenue"})]})}),e.jsx("tbody",{children:g.map((t,s)=>e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${o===t?"bg-blue-50":""}`,onClick:()=>O(o===t?null:t),children:[e.jsx("td",{className:"py-2 px-2",children:a(t.booking_date).format("MMM DD, YYYY")}),e.jsx("td",{className:"py-2 px-2 capitalize",children:t.type}),e.jsx("td",{className:"py-2 px-2 font-medium",children:t.name}),e.jsx("td",{className:"py-2 px-2 text-right",children:t.completed_bookings}),e.jsx("td",{className:"py-2 px-2 text-right",children:t.pending_bookings}),e.jsx("td",{className:"py-2 px-2 text-right",children:t.total_people}),e.jsx("td",{className:"py-2 px-2 text-right",children:r(t.revenue)}),e.jsx("td",{className:"py-2 px-2 text-right",children:t.slots_used}),e.jsx("td",{className:"py-2 px-2 text-right",children:Number(t.hours_booked).toFixed(1)}),e.jsx("td",{className:"py-2 px-2 text-right",children:t.bookings_with_offers}),e.jsx("td",{className:"py-2 px-2 text-right",children:r(t.total_discounts)}),(d||c)&&e.jsx("td",{className:"py-2 px-2 text-right",children:r(t.base_price||0)}),(d||c)&&e.jsx("td",{className:"py-2 px-2 text-right",children:t.slot_hour_data?r(t.slot_hour_data.reduce((y,E)=>y+(E.potential_revenue||0),0)):"N/A"})]},s))})]})})}),o&&!o.slot_hour_data&&e.jsx(u,{title:`Hourly Breakdown - ${o.name} (${a(o.booking_date).format("MMM DD, YYYY")})`,children:e.jsx("div",{style:{height:300},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(R,{data:U(o),children:[e.jsx(f,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(N,{dataKey:"hour"}),e.jsx(v,{}),e.jsx(_,{}),e.jsx(k,{}),e.jsx(p,{dataKey:"bookings",fill:"#2563eb",name:"Bookings"}),e.jsx(p,{dataKey:"revenue",fill:"#10b981",name:"Revenue (₹)"})]})})})}),o&&o.slot_hour_data&&e.jsx(u,{title:`Slot-wise Revenue Analysis - ${o.name} (${a(o.booking_date).format("MMM DD, YYYY")})`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsx(l,{label:"Base Price per Slot",value:r(o.base_price||0)}),e.jsx(l,{label:"Total Potential Revenue",value:r(o.slot_hour_data.reduce((t,s)=>t+(s.potential_revenue||0),0))}),e.jsx(l,{label:"Actual Revenue",value:r(o.revenue)}),e.jsx(l,{label:"Revenue Lost to Offers",value:r(o.total_discounts)})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Time Slot"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Completed"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Pending"}),e.jsx("th",{className:"text-right py-2 px-2",children:"People"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Actual Revenue"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Potential Revenue"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Revenue/Hour"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Lost to Offers"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Slot Utilization"})]})}),e.jsx("tbody",{children:o.slot_hour_data.map((t,s)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsxs("td",{className:"py-2 px-2",children:[t.start_time?a(t.start_time).format("HH:mm"):`${t.hour}:00`," -",t.end_time?a(t.end_time).format("HH:mm"):`${(t.hour+1)%24}:00`]}),e.jsx("td",{className:"py-2 px-2 text-right",children:t.completed_bookings}),e.jsx("td",{className:"py-2 px-2 text-right",children:t.pending_bookings}),e.jsx("td",{className:"py-2 px-2 text-right",children:t.total_people}),e.jsx("td",{className:"py-2 px-2 text-right",children:r(t.actual_revenue)}),e.jsx("td",{className:"py-2 px-2 text-right",children:r(t.potential_revenue)}),e.jsx("td",{className:"py-2 px-2 text-right",children:r(t.actual_revenue)}),e.jsx("td",{className:"py-2 px-2 text-right",children:r(t.lost_to_offers)}),e.jsx("td",{className:"py-2 px-2 text-right",children:t.total_slots>0?`${t.booked_slots}/${t.total_slots} (${Math.round(t.booked_slots/t.total_slots*100)}%)`:"N/A"})]},s))})]})}),e.jsx("div",{style:{height:300},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(R,{data:o.slot_hour_data,children:[e.jsx(f,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(N,{dataKey:"hour",tickFormatter:t=>`${t}:00`}),e.jsx(v,{tickFormatter:t=>`₹${t.toLocaleString()}`}),e.jsx(_,{labelFormatter:t=>`${t}:00 - ${(t+1)%24}:00`,formatter:(t,s)=>[r(t),s]}),e.jsx(k,{}),e.jsx(p,{dataKey:"actual_revenue",fill:"#10b981",name:"Actual Revenue"}),e.jsx(p,{dataKey:"potential_revenue",fill:"#e5e7eb",name:"Potential Revenue"}),e.jsx(p,{dataKey:"lost_to_offers",fill:"#ef4444",name:"Lost to Offers"})]})})})]})}),e.jsx(u,{title:"Revenue Trend",subtitle:"Daily revenue by attraction/combo",children:e.jsx("div",{style:{height:360},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(z,{data:g,children:[e.jsx(f,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(N,{dataKey:"booking_date",tickFormatter:t=>a(t).format("MM-DD")}),e.jsx(v,{tickFormatter:t=>`₹${t.toLocaleString()}`}),e.jsx(_,{labelFormatter:t=>a(t).format("YYYY-MM-DD"),formatter:(t,s)=>[s==="revenue"?r(t):t,s]}),e.jsx(k,{}),e.jsx(V,{type:"monotone",dataKey:"revenue",stroke:"#2563eb",name:"Revenue",strokeWidth:2,dot:!1})]})})})})]})}export{le as default};
