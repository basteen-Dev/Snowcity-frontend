import{D as y,C as N,R as g,j as e}from"./index-C5Mz9dTM.js";import{a as n,A as m}from"./AdminApp-C7IcGGGV.js";import"./createLucideIcon-DQ6FqzLt.js";import"./file-text-CQ7rExmv.js";import"./ticket-C3bgGsni.js";function w(){var u,h;const{id:i}=y(),x=N(),[l,d]=g.useState({status:"loading",error:null,user:null,roles:[],selectedRoleIds:[]});g.useEffect(()=>{(async()=>{try{const[s,r]=await Promise.all([n.get(m.userById(i)),n.get(m.roles())]),a=(s==null?void 0:s.user)||s||{},o=Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[],c=a.roles&&a.roles.map(v=>v.role_id)||a.role_ids||[];d({status:"idle",error:null,user:a,roles:o,selectedRoleIds:c})}catch(s){d(r=>({...r,status:"failed",error:s}))}})()},[i]);const j=s=>{d(r=>{const o=r.selectedRoleIds.includes(s)?r.selectedRoleIds.filter(c=>c!==s):[...r.selectedRoleIds,s];return{...r,selectedRoleIds:o}})},p=async()=>{try{await n.put(m.userById(i),{role_ids:l.selectedRoleIds}),x("/admin/users")}catch(s){d(r=>({...r,error:s}))}};if(l.status==="loading")return e.jsx("div",{children:"Loading…"});if(l.status==="failed")return e.jsx("div",{className:"text-red-600",children:((u=l.error)==null?void 0:u.message)||"Failed to load user"});const t=l.user||{};return e.jsxs("div",{className:"max-w-3xl",children:[e.jsxs("div",{className:"rounded-xl border bg-white p-4",children:[e.jsxs("h1",{className:"text-xl font-semibold mb-2",children:["User: ",t.name||t.email]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Email"}),e.jsx("div",{children:t.email})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Phone"}),e.jsx("div",{children:t.phone||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Last Login"}),e.jsx("div",{children:t.last_login_at||"—"})]})]})]}),e.jsxs("div",{className:"rounded-xl border bg-white p-4 mt-4",children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Roles"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:l.roles.map(s=>e.jsxs("label",{className:"flex items-center gap-2 border rounded-md px-3 py-2",children:[e.jsx("input",{type:"checkbox",checked:l.selectedRoleIds.includes(s.role_id),onChange:()=>j(s.role_id)}),e.jsx("span",{className:"text-sm",children:s.role_name})]},s.role_id))}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{className:"rounded-md bg-gray-900 text-white px-4 py-2 text-sm",onClick:p,children:"Save"}),e.jsx("button",{className:"rounded-md border px-4 py-2 text-sm",onClick:()=>x(-1),children:"Cancel"})]}),l.error?e.jsx("div",{className:"mt-2 text-sm text-red-600",children:((h=l.error)==null?void 0:h.message)||"Failed to save"}):null]})]})}export{w as default};
