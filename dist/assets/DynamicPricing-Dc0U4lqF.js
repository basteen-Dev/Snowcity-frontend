import{r as n,j as e}from"./index-CmreT6x1.js";import{a as o,A as l}from"./AdminApp-BV7zANWg.js";import"./createLucideIcon-CgZNF2TE.js";import"./file-text-ButRzfWA.js";import"./newspaper-yOb_4zvd.js";import"./ticket-hq6RMmhb.js";import"./chevron-down-bqKWLlrR.js";const oe=()=>{const[m,D]=n.useState("rules"),[w,C]=n.useState([]),[y,T]=n.useState([]),[v,B]=n.useState([]),[q,L]=n.useState(!0),[$,f]=n.useState(!1),[b,S]=n.useState(null),[s,d]=n.useState({name:"",description:"",target_type:"attraction",target_id:"",date_ranges:[{from:"",to:""}],price_adjustment_type:"fixed",price_adjustment_value:0,active:!0}),[p,O]=n.useState("attraction"),[i,k]=n.useState(""),[P,j]=n.useState([]),[U,N]=n.useState(!1),[x,A]=n.useState(null),[r,h]=n.useState({selectedDates:[],price:0});n.useEffect(()=>{V()},[]);const V=async()=>{try{const[t,a,c]=await Promise.all([o.get(l.dynamicPricing()),o.get(l.attractions(),{params:{active:!0,limit:100}}),o.get(l.combos(),{params:{active:!0,limit:100}})]);C(t.data||[]),T(a.data||[]),B(c.data||[])}catch(t){console.error("Error loading data:",t)}finally{L(!1)}},E=async()=>{try{const t=await o.get(l.dynamicPricing());C(t.data||[])}catch(t){console.error("Error loading rules:",t)}},z=async t=>{t.preventDefault();try{b?await o.put(l.dynamicPricingById(b.rule_id),s):await o.post(l.dynamicPricing(),s),E(),R()}catch(a){console.error("Error saving rule:",a),alert("Error saving rule: "+a.message)}},G=t=>{S(t),d({name:t.name,description:t.description||"",target_type:t.target_type,target_id:t.target_id||"",date_ranges:t.date_ranges||[{from:"",to:""}],price_adjustment_type:t.price_adjustment_type,price_adjustment_value:t.price_adjustment_value,active:t.active}),f(!0)},H=async t=>{if(confirm("Are you sure you want to delete this rule?"))try{await o.delete(l.dynamicPricingById(t)),E()}catch(a){console.error("Error deleting rule:",a),alert("Error deleting rule: "+a.message)}},R=()=>{d({name:"",description:"",target_type:"attraction",target_id:"",date_ranges:[{from:"",to:""}],price_adjustment_type:"fixed",price_adjustment_value:0,active:!0}),S(null),f(!1)},J=()=>{d({...s,date_ranges:[...s.date_ranges,{from:"",to:""}]})},K=t=>{s.date_ranges.length>1&&d({...s,date_ranges:s.date_ranges.filter((a,c)=>c!==t)})},F=(t,a,c)=>{const u=[...s.date_ranges];u[t][a]=c,d({...s,date_ranges:u})},M=()=>s.target_type==="attraction"?y.map(t=>e.jsx("option",{value:t.attraction_id,children:t.title},t.attraction_id)):s.target_type==="combo"?v.map(t=>e.jsx("option",{value:t.combo_id,children:t.name},t.combo_id)):null,_=async()=>{if(!i){j([]);return}try{const t=p==="attraction"?l.attractionDatePrices(i):l.comboDatePrices(i),a=await o.get(t);j(a.data||[])}catch(t){console.error("Error loading date prices:",t),j([])}};n.useEffect(()=>{m==="date-specific"&&i&&_()},[i,m]);const Q=async t=>{t.preventDefault();try{if(x){const a=p==="attraction"?l.attractionDatePricesByDate(i,r.selectedDates[0]):l.comboDatePricesByDate(i,r.selectedDates[0]);await o.put(a,{price:r.price})}else if(r.selectedDates.length===1){const a=p==="attraction"?l.attractionDatePricesByDate(i,r.selectedDates[0]):l.comboDatePricesByDate(i,r.selectedDates[0]);await o.put(a,{price:r.price})}else{const a=r.selectedDates.map(u=>({date:u,price:r.price})),c=p==="attraction"?l.attractionDatePricesBulk(i):l.comboDatePricesBulk(i);await o.post(c,{datePrices:a})}_(),I()}catch(a){console.error("Error saving date price:",a),alert("Error saving date price: "+a.message)}},W=t=>{A(t),h({selectedDates:[t.price_date],price_date:t.price_date,price:t.price}),N(!0)},X=async t=>{if(confirm("Are you sure you want to delete this date price?"))try{const a=p==="attraction"?l.attractionDatePricesByDate(i,t):l.comboDatePricesByDate(i,t);await o.delete(a),_()}catch(a){console.error("Error deleting date price:",a),alert("Error deleting date price: "+a.message)}},I=()=>{h({selectedDates:x?[]:[""],price:0}),A(null),N(!1)},Y=()=>p==="attraction"?y.map(t=>e.jsx("option",{value:t.attraction_id,children:t.title},t.attraction_id)):p==="combo"?v.map(t=>e.jsx("option",{value:t.combo_id,children:t.name},t.combo_id)):null,Z=()=>{h({...r,selectedDates:[...r.selectedDates,""]})},ee=(t,a)=>{const c=[...r.selectedDates];c[t]=a,h({...r,selectedDates:c})},te=t=>{r.selectedDates.length>1&&h({...r,selectedDates:r.selectedDates.filter((a,c)=>c!==t)})};return q?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dynamic Pricing"}),m==="rules"&&e.jsx("button",{onClick:()=>f(!0),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Add New Rule"}),m==="date-specific"&&i&&e.jsx("button",{onClick:()=>N(!0),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Add Date Price"})]}),e.jsxs("div",{className:"flex mb-6",children:[e.jsx("button",{onClick:()=>D("rules"),className:`px-4 py-2 ${m==="rules"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"} rounded-l`,children:"Dynamic Rules"}),e.jsx("button",{onClick:()=>D("date-specific"),className:`px-4 py-2 ${m==="date-specific"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"} rounded-r`,children:"Date-Specific Pricing"})]}),m==="rules"&&$&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:b?"Edit Rule":"Add New Rule"}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rule Name"}),e.jsx("input",{type:"text",value:s.name,onChange:t=>d({...s,name:t.target.value}),className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("input",{type:"text",value:s.description,onChange:t=>d({...s,description:t.target.value}),className:"w-full p-2 border rounded"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Type"}),e.jsxs("select",{value:s.target_type,onChange:t=>d({...s,target_type:t.target.value,target_id:""}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"attraction",children:"Attraction"}),e.jsx("option",{value:"combo",children:"Combo"}),e.jsx("option",{value:"all",children:"All"})]})]}),s.target_type!=="all"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s.target_type==="attraction"?"Attraction":"Combo"}),e.jsxs("select",{value:s.target_id,onChange:t=>d({...s,target_id:t.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Select..."}),M()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Active"}),e.jsx("input",{type:"checkbox",checked:s.active,onChange:t=>d({...s,active:t.target.checked}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Date Ranges"}),e.jsx("button",{type:"button",onClick:J,className:"text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Range"})]}),s.date_ranges.map((t,a)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",value:t.from,onChange:c=>F(a,"from",c.target.value),className:"flex-1 p-2 border rounded",required:!0}),e.jsx("span",{className:"self-center",children:"to"}),e.jsx("input",{type:"date",value:t.to,onChange:c=>F(a,"to",c.target.value),className:"flex-1 p-2 border rounded",required:!0}),s.date_ranges.length>1&&e.jsx("button",{type:"button",onClick:()=>K(a),className:"text-red-600 hover:text-red-800 px-2",children:"×"})]},a))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Adjustment Type"}),e.jsxs("select",{value:s.price_adjustment_type,onChange:t=>d({...s,price_adjustment_type:t.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"fixed",children:"Fixed Amount"}),e.jsx("option",{value:"percentage",children:"Percentage"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Adjustment Value (",s.price_adjustment_type==="percentage"?"%":"₹",")"]}),e.jsx("input",{type:"number",step:"0.01",value:s.price_adjustment_value,onChange:t=>d({...s,price_adjustment_value:parseFloat(t.target.value)||0}),className:"w-full p-2 border rounded",required:!0})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:[b?"Update":"Create"," Rule"]}),e.jsx("button",{type:"button",onClick:R,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Cancel"})]})]})]}),m==="rules"&&e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Target"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Date Range"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Adjustment"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[w.map(t=>{var a,c,u;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.name}),e.jsx("td",{className:"px-4 py-3",children:t.target_type==="all"?"All":t.target_type==="attraction"?((a=y.find(g=>g.attraction_id===t.target_id))==null?void 0:a.title)||`Attraction ${t.target_id}`:((c=v.find(g=>g.combo_id===t.target_id))==null?void 0:c.name)||`Combo ${t.target_id}`}),e.jsx("td",{className:"px-4 py-3",children:((u=t.date_ranges)==null?void 0:u.map((g,ae)=>e.jsxs("div",{children:[new Date(g.from).toLocaleDateString()," - ",new Date(g.to).toLocaleDateString()]},ae)))||"No ranges"}),e.jsxs("td",{className:"px-4 py-3",children:[t.price_adjustment_type==="fixed"?"₹":"",t.price_adjustment_value,t.price_adjustment_type==="percentage"?"%":""]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.active?"Active":"Inactive"})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("button",{onClick:()=>G(t),className:"text-blue-600 hover:text-blue-800 mr-2",children:"Edit"}),e.jsx("button",{onClick:()=>H(t.rule_id),className:"text-red-600 hover:text-red-800",children:"Delete"})]})]},t.rule_id)}),w.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"No dynamic pricing rules found. Create your first rule to get started."})})]})]})}),m==="date-specific"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Item Type"}),e.jsxs("select",{value:p,onChange:t=>{O(t.target.value),k(""),j([])},className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"attraction",children:"Attraction"}),e.jsx("option",{value:"combo",children:"Combo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:p==="attraction"?"Attraction":"Combo"}),e.jsxs("select",{value:i,onChange:t=>k(t.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"",children:"Select..."}),Y()]})]})]})}),U&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:x?"Edit Date Price":"Add Date Price"}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Dates"}),!x&&e.jsx("button",{type:"button",onClick:Z,className:"text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Date"})]}),r.selectedDates.map((t,a)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",value:t,onChange:c=>ee(a,c.target.value),className:"flex-1 p-2 border rounded",required:!0}),r.selectedDates.length>1&&!x&&e.jsx("button",{type:"button",onClick:()=>te(a),className:"text-red-600 hover:text-red-800 px-2",children:"×"})]},a))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Price (₹)"}),e.jsx("input",{type:"number",step:"0.01",value:r.price,onChange:t=>h({...r,price:parseFloat(t.target.value)||0}),className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:[x?"Update":"Create"," Price",r.selectedDates.length>1?"s":""]}),e.jsx("button",{type:"button",onClick:I,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Cancel"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[P.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:new Date(t.price_date).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3",children:["₹",t.price]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("button",{onClick:()=>W(t),className:"text-blue-600 hover:text-blue-800 mr-2",children:"Edit"}),e.jsx("button",{onClick:()=>X(t.price_date),className:"text-red-600 hover:text-red-800",children:"Delete"})]})]},t.price_date)),P.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"px-4 py-8 text-center text-gray-500",children:i?"No date-specific prices found. Add your first date price.":"Select an item to view date prices."})})]})]})})]})]})};export{oe as default};
