import{C as U,A as V,R as j,j as e}from"./index-CmreT6x1.js";import{a as b,A as g}from"./AdminApp-BV7zANWg.js";import{I as D}from"./ImageUploader-BX4irtyE.js";import"./createLucideIcon-CgZNF2TE.js";import"./file-text-ButRzfWA.js";import"./newspaper-yOb_4zvd.js";import"./ticket-hq6RMmhb.js";import"./chevron-down-bqKWLlrR.js";import"./media-DcknJ8BL.js";function W(){var N,k,y,w,C,A,S,E,P;const{id:u}=U(),_=V(),m=!!u,[o,l]=j.useState({status:m?"loading":"idle",error:null,attractions:[],form:{name:"",slug:"",attraction_ids:m?[]:["",""],attraction_prices:{},total_price:0,image_url:"",desktop_image_url:"",discount_percent:0,active:!0,meta_title:"",short_description:""}});j.useEffect(()=>{(async()=>{try{const r=await b.get(g.attractions()),t=Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray(r)?r:[];l(a=>({...a,attractions:t}))}catch{}})()},[]),j.useEffect(()=>{m&&(async()=>{try{const r=await b.get(g.comboById(u)),t=(r==null?void 0:r.combo)||r||{};let a={name:t.name||"",slug:t.slug||"",attraction_ids:[],attraction_prices:{},total_price:0,image_url:t.image_url||"",desktop_image_url:t.desktop_image_url||"",discount_percent:t.discount_percent||0,active:!!t.active,meta_title:t.meta_title||"",short_description:t.short_description||""};t.attraction_1_id&&t.attraction_2_id?(a.attraction_ids=[t.attraction_1_id,t.attraction_2_id],a.attraction_prices={[t.attraction_1_id]:(t.combo_price||0)/2,[t.attraction_2_id]:(t.combo_price||0)/2},a.total_price=t.combo_price||0):(a.attraction_ids=t.attraction_ids||[],a.attraction_prices=t.attraction_prices||{},a.total_price=Number(t.total_price||0)),l(i=>({...i,status:"idle",form:a}))}catch(r){l(t=>({...t,status:"failed",error:r}))}})()},[u,m]);const F=async r=>{var t,a,i,c,d,x;r.preventDefault();try{const s=o.form;if(!s.name||s.name.trim()===""){alert("Please enter a combo name");return}if(!s.attraction_ids||s.attraction_ids.length<2){alert("Select at least two attractions");return}for(const f of s.attraction_ids)if(!s.attraction_prices[f]||s.attraction_prices[f]<=0){const v=o.attractions.find(T=>T.attraction_id===f);alert(`Please set a valid price for ${(v==null?void 0:v.title)||"attraction"}`);return}const p={name:s.name.trim(),slug:((t=s.slug)==null?void 0:t.trim())||null,attraction_ids:s.attraction_ids,attraction_prices:s.attraction_prices,total_price:Number(s.total_price||0),image_url:((a=s.image_url)==null?void 0:a.trim())||null,desktop_image_url:((i=s.desktop_image_url)==null?void 0:i.trim())||null,discount_percent:Number(s.discount_percent||0),active:!!s.active,meta_title:((c=s.meta_title)==null?void 0:c.trim())||null,short_description:((d=s.short_description)==null?void 0:d.trim())||null};m?await b.put(g.comboById(u),p):await b.post(g.combos(),p),_("/admin/catalog/combos")}catch(s){console.error("Combo save error:",s),console.error("Error data:",s==null?void 0:s.data),console.error("Error status:",s==null?void 0:s.status),console.error("Error details:",(x=s==null?void 0:s.data)==null?void 0:x.details),l(p=>({...p,error:s}))}};if(o.status==="loading")return e.jsx("div",{children:"Loading…"});if(o.status==="failed")return e.jsx("div",{className:"text-red-600",children:((N=o.error)==null?void 0:N.message)||"Failed to load"});if(o.error&&o.error!=="Failed to load")return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error"}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsx("div",{className:"text-red-800 font-semibold mb-2",children:((y=(k=o.error)==null?void 0:k.data)==null?void 0:y.error)||"Save Failed"}),e.jsx("div",{className:"text-red-700 text-sm mb-2",children:((C=(w=o.error)==null?void 0:w.data)==null?void 0:C.message)||((A=o.error)==null?void 0:A.message)}),((E=(S=o.error)==null?void 0:S.data)==null?void 0:E.details)&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-red-800 font-medium text-sm mb-1",children:"Validation Details:"}),e.jsx("ul",{className:"text-red-700 text-sm list-disc list-inside",children:o.error.data.details.map((r,t)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[r.field,":"]})," ",r.message,r.value!==void 0&&e.jsxs("span",{className:"text-red-600 ml-1",children:["(value: ",JSON.stringify(r.value),")"]})]},t))})]}),e.jsx("button",{onClick:()=>l(r=>({...r,error:null})),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Dismiss"})]})]});const n=o.form,I=o.attractions||[],R=()=>{l(r=>({...r,form:{...r.form,attraction_ids:[...r.form.attraction_ids,""]}}))},O=r=>{const t=o.form.attraction_ids.filter((i,c)=>c!==r),a={...o.form.attraction_prices};delete a[o.form.attraction_ids[r]],l(i=>({...i,form:{...i.form,attraction_ids:t,attraction_prices:a}})),h(t,a)},B=(r,t)=>{const a=o.form.attraction_ids[r],i=[...o.form.attraction_ids];i[r]=t;const c={...o.form.attraction_prices};if(a&&a!==t&&delete c[a],t&&!c[t]){const d=o.attractions.find(x=>x.attraction_id===t);c[t]=(d==null?void 0:d.price)||0}l(d=>({...d,form:{...d.form,attraction_ids:i,attraction_prices:c}})),h(i,c)},L=(r,t)=>{const a={...o.form.attraction_prices,[r]:Number(t||0)};l(i=>({...i,form:{...i.form,attraction_prices:a}})),h(o.form.attraction_ids,a)},h=(r,t)=>{const a=r.reduce((i,c)=>i+(Number(t[c])||0),0);l(i=>({...i,form:{...i.form,total_price:a}}))};return e.jsxs("form",{onSubmit:F,className:"max-w-4xl bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-xl p-4",children:[e.jsxs("h1",{className:"text-xl font-semibold mb-4",children:[m?"Edit":"New"," Combo"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Combo Name *"}),e.jsx("input",{type:"text",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.name,onChange:r=>l(t=>({...t,form:{...t.form,name:r.target.value}})),placeholder:"Enter combo name",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Slug (URL-friendly identifier)"}),e.jsx("input",{type:"text",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.slug,onChange:r=>l(t=>({...t,form:{...t.form,slug:r.target.value}})),placeholder:"auto-generated-from-name"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:"Leave empty to auto-generate from name. Used in URLs like /combo-your-slug-here"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Short Description (for lists/previews)"}),e.jsx("textarea",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",rows:2,value:n.short_description,onChange:r=>l(t=>({...t,form:{...t.form,short_description:r.target.value}})),placeholder:"Brief summary of the combo"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Meta Title (SEO title)"}),e.jsx("input",{type:"text",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.meta_title,onChange:r=>l(t=>({...t,form:{...t.form,meta_title:r.target.value}})),placeholder:"Custom page title for SEO (leave empty to use default)"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:"Optional custom title for search engines and browser tabs"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300",children:"Attractions *"}),e.jsx("button",{type:"button",onClick:R,className:"text-sm bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700",children:"+ Add Attraction"})]}),n.attraction_ids.length===0&&e.jsx("div",{className:"text-gray-500 text-sm mb-2",children:"No attractions selected. Add at least 2 attractions."}),n.attraction_ids.map((r,t)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("select",{className:"flex-1 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:r,onChange:a=>B(t,a.target.value),children:[e.jsx("option",{value:"",children:"— Select attraction —"}),I.map(a=>e.jsx("option",{value:a.attraction_id,disabled:n.attraction_ids.includes(String(a.attraction_id))&&String(a.attraction_id)!==r,children:a.title},a.attraction_id))]}),r&&e.jsx("input",{type:"number",className:"w-32 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.attraction_prices[r]||"",onChange:a=>L(r,a.target.value),placeholder:"Price",min:"0",step:"0.01"}),n.attraction_ids.length>2&&e.jsx("button",{type:"button",onClick:()=>O(t),className:"px-2 py-1 text-red-600 border border-red-300 rounded-md hover:bg-red-50",children:"Remove"})]},t)),n.attraction_ids.length>0&&n.attraction_ids.length<2&&e.jsx("div",{className:"text-orange-600 text-sm mt-1",children:"Please select at least 2 attractions"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-neutral-800 rounded-md",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-neutral-300",children:"Total Combo Price"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["₹",Number(n.total_price||0).toFixed(2)]}),n.attraction_ids.length>0&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:["Based on ",n.attraction_ids.length," attraction(s)"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(D,{label:"Combo Image",value:n.image_url,onChange:r=>l(t=>({...t,form:{...t.form,image_url:r}})),folder:"combos"})}),e.jsx("div",{className:"mb-4",children:e.jsx(D,{label:"Desktop Image (optional)",value:n.desktop_image_url,onChange:r=>l(t=>({...t,form:{...t.form,desktop_image_url:r}})),folder:"combos"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Discount %"}),e.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.discount_percent,onChange:r=>l(t=>({...t,form:{...t.form,discount_percent:Number(r.target.value||0)}})),min:"0",max:"100"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"active",type:"checkbox",checked:!!n.active,onChange:r=>l(t=>({...t,form:{...t.form,active:r.target.checked}}))}),e.jsx("label",{htmlFor:"active",className:"text-sm text-gray-700 dark:text-neutral-200",children:"Active"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:"Override Total Price (optional)"}),e.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",value:n.total_price,onChange:r=>l(t=>({...t,form:{...t.form,total_price:Number(r.target.value||0)}})),min:"0",step:"0.01"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-neutral-400 mt-1",children:"Automatically sums attraction prices; adjust if needed."})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{type:"submit",className:"rounded-md bg-gray-900 text-white px-4 py-2 text-sm",children:"Save"}),m&&e.jsx("button",{type:"button",className:"rounded-md bg-blue-600 text-white px-4 py-2 text-sm hover:bg-blue-700",onClick:()=>_(`/admin/catalog/combo-slots?combo_id=${u}`),children:"View Slots"}),e.jsx("button",{type:"button",className:"rounded-md border px-4 py-2 text-sm",onClick:()=>_(-1),children:"Cancel"})]}),o.error?e.jsx("div",{className:"mt-2 text-sm text-red-600",children:((P=o.error)==null?void 0:P.message)||"Error"}):null]})}export{W as default};
