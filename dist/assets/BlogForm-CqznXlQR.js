import{B as v,C as j,R as d,j as e}from"./index-Buz5vlJT.js";import{a as n}from"./AdminApp-DjyjDDmt.js";import{I as w}from"./ImageUploader-Dj1uckPh.js";import{R as y,a as _,G as f}from"./GalleryField-CYOeD8rJ.js";import"./createLucideIcon-BEwYts5j.js";import"./file-text-CuRCFKVY.js";import"./ticket-B65mU2v0.js";import"./media-DTTax9V0.js";function B(){const m=v(),{id:r}=j(),i=!!r,[t,u]=d.useState({title:"",slug:"",author:"",active:!0,image_url:"",editor_mode:"rich",content:"",raw_html:"",raw_css:"",raw_js:"",meta_title:"",meta_description:"",meta_keywords:"",section_type:"none",section_ref_id:null,gallery:[]}),[h,o]=d.useState(""),[g,p]=d.useState(!1);d.useEffect(()=>{i&&(async()=>{try{const a=await n.get(`/api/admin/blogs/${r}`);u(s=>({...s,...a,editor_mode:a.editor_mode||"rich"}))}catch(a){o(a.message||"Failed to load blog")}})()},[r,i]);const l=a=>u(s=>({...s,...a})),x=async a=>{a.preventDefault(),o(""),p(!0);try{const s={...t};i?await n.put(`/api/admin/blogs/${r}`,s):await n.post("/api/admin/blogs",s),m("/admin/catalog/blogs")}catch(s){o(s.message||"Save failed")}finally{p(!1)}},b=async()=>{try{const a=await n.post("/api/admin/blogs/preview",t),s=window.open("","_blank");if(!s)return;let c="";t.editor_mode==="raw"?c=`
<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>${t.raw_css||""}</style>
<title>${t.title||""}</title></head><body>
${t.raw_html||""}
<script>${t.raw_js||""}<\/script></body></html>`:c=`
<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>${t.title||""}</title></head><body>${t.content||""}</body></html>`,s.document.open(),s.document.write(c),s.document.close()}catch(a){alert(a.message||"Preview failed")}};return e.jsxs("form",{onSubmit:x,className:"space-y-3 max-w-3xl",children:[e.jsx("div",{className:"text-lg font-semibold",children:i?"Edit Blog":"Create Blog"}),h?e.jsx("div",{className:"text-sm text-red-600",children:h}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Title"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.title??"",onChange:a=>l({title:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Slug"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.slug??"",onChange:a=>l({slug:a.target.value}),placeholder:"my-blog"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Author"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.author??"",onChange:a=>l({author:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Featured image"}),e.jsx(w,{value:t.image_url,onChange:a=>l({image_url:a})})]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.active,onChange:a=>l({active:a.target.checked})}),"Active"]}),e.jsx("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:t.editor_mode==="rich",onChange:()=>l({editor_mode:"rich"})}),"Visual editor"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:t.editor_mode==="raw",onChange:()=>l({editor_mode:"raw"})}),"Raw (HTML/CSS/JS)"]}),e.jsx("button",{type:"button",className:"ml-auto px-3 py-1 rounded-md border text-sm",onClick:b,children:"Preview"})]})}),t.editor_mode==="raw"?e.jsx(y,{value:{raw_html:t.raw_html,raw_css:t.raw_css,raw_js:t.raw_js},onChange:a=>l(a)}):e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-sm",children:"Content"}),e.jsx(_,{value:t.content||"",onChange:a=>l({content:a})}),e.jsx(f,{label:"Content gallery",helper:"Upload multiple inline images to reuse inside your article.",value:t.gallery||[],onChange:a=>l({gallery:a})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Meta title"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.meta_title||"",onChange:a=>l({meta_title:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Meta description"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.meta_description||"",onChange:a=>l({meta_description:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Meta keywords"}),e.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.meta_keywords||"",onChange:a=>l({meta_keywords:a.target.value})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-md bg-gray-900 text-white",disabled:g,children:g?"Savingâ€¦":"Save"}),e.jsx("button",{className:"px-3 py-2 rounded-md border",type:"button",onClick:()=>m("/admin/catalog/blogs"),children:"Cancel"})]})]})}export{B as default};
