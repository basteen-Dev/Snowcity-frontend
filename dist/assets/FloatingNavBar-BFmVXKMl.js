import{B as de,g as ce,h as ue,u as w,R as l,i as J,k as Q,a0 as me,j as e,L as n,T as Z}from"./index-uOjPOlE7.js";import{g as ee}from"./ids-YExsbyMi.js";import{L as te}from"./Logo-DteIHnLx.js";const xe=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,he=[{code:"+91",label:"India (+91)"},{code:"+1",label:"USA (+1)"},{code:"+971",label:"UAE (+971)"},{code:"+44",label:"UK (+44)"},{code:"+65",label:"Singapore (+65)"}];function ge(x,g){l.useEffect(()=>{function h(I){!x.current||x.current.contains(I.target)||g==null||g()}return document.addEventListener("mousedown",h),document.addEventListener("touchstart",h,{passive:!0}),()=>{document.removeEventListener("mousedown",h),document.removeEventListener("touchstart",h)}},[x,g])}function be(x){l.useEffect(()=>{const g=document.body.style.overflow;return x&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=g}},[x])}function je(){const x=de(),g=ce(),h=ue();g.pathname.startsWith("/booking");const I=w(t=>t.attractions.items||[]);w(t=>t.offers.items||[]),w(t=>t.combos.items||[]);const se=w(t=>t.pages.items||[]),o=w(t=>{var s;return(s=t.auth)==null?void 0:s.user}),C=w(t=>{var s;return(s=t.auth)==null?void 0:s.token}),A=((o==null?void 0:o.name)||(o==null?void 0:o.full_name)||(o==null?void 0:o.email)||"Guest").trim(),_=(o==null?void 0:o.email)||"Not provided",R=(o==null?void 0:o.phone)||(o==null?void 0:o.mobile)||"Not provided",[T,f]=l.useState(null),[S,d]=l.useState(!1),[$,y]=l.useState(!1),[U,V]=l.useState(!1),[b,z]=l.useState({name:"",email:"",phone:""}),[B,D]=l.useState("+91"),[v,F]=l.useState(""),[u,L]=l.useState({}),[i,m]=l.useState({sent:!1,code:"",userId:null,debug:"",status:"idle",error:null}),[j,G]=l.useState(!1),q=((o==null?void 0:o.name)||(o==null?void 0:o.email)||"U").trim().charAt(0).toUpperCase(),H=l.useRef(null);ge(H,()=>{f(null),y(!1)}),l.useEffect(()=>{const t=()=>{window.innerWidth>=768&&d(!1)};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const W=t=>f(s=>s===t?null:t),K=I.slice(0,12),X=se.slice(0,10);be(S||U);const N="px-3 py-2 rounded-lg text-sm font-semibold tracking-wide transition-all duration-300 relative group text-gray-800 hover:text-sky-600 hover:bg-sky-50",ae="inline-flex items-center rounded-full border border-sky-400 px-5 py-2 text-sky-600 font-semibold bg-white hover:bg-sky-50 transition-all duration-300 shadow-sm",oe="inline-flex items-center rounded-full px-5 py-2 text-sm font-semibold bg-sky-600 text-white hover:bg-sky-700 shadow-md transition-all duration-300 hover:shadow-lg",E=l.useCallback(()=>{z({name:"",email:"",phone:""}),D("+91"),F(""),L({}),m({sent:!1,code:"",userId:null,debug:"",status:"idle",error:null}),G(!1)},[]),O=l.useCallback(()=>{E(),V(!0)},[E]);l.useEffect(()=>{const t=()=>{O()};return window.addEventListener("openAuthModal",t),()=>window.removeEventListener("openAuthModal",t)},[O]);const P=l.useCallback(()=>{V(!1),E()},[E]),Y=(t="")=>t.replace(/[^\d+]/g,""),M=l.useMemo(()=>v?`${B}${v}`:"",[B,v]),le=l.useCallback(t=>{const s=t.replace(/\D/g,"").slice(0,10);F(s),L(a=>({...a,phone:void 0}))},[]),ne=l.useCallback(async()=>{const t=b.name.trim(),s=b.email.trim(),a={};if(s?xe.test(s)||(a.email="Enter a valid email address"):a.email="Email is required",v?/^\d{10}$/.test(v)||(a.phone="Enter a valid 10-digit mobile number"):a.phone="Mobile number is required",Object.keys(a).length){L(a),m(c=>({...c,error:null}));return}const p=Y(M);try{m(k=>({...k,status:"sending",error:null}));const c={channel:"sms",createIfNotExists:!0,email:s,phone:p,...t&&{name:t},whatsapp_consent:j},r=await J.post(Q.auth.otpSend(),c);m(k=>({...k,sent:!0,code:"",userId:(r==null?void 0:r.user_id)||null,debug:(r==null?void 0:r.otp)||"",status:"sent",error:null}))}catch(c){m(r=>({...r,status:"idle",error:(c==null?void 0:c.message)||"Failed to send OTP"}))}},[b,v,M]),re=l.useCallback(async()=>{var s;const t=(i.code||"").trim();if(!/^\d{6}$/.test(t)){m(a=>({...a,error:"Enter the 6-digit OTP"}));return}if(!j){m(a=>({...a,error:"Please agree to WhatsApp notifications to continue"}));return}try{m(k=>({...k,status:"verifying",error:null}));const a={otp:t};i.userId&&(a.user_id=i.userId);const p=b.email.trim(),c=Y(M);i.userId||(p&&(a.email=p),c&&(a.phone=c),a.name=b.name.trim()||"Guest"),a.whatsapp_consent=j;const r=await J.post(Q.auth.otpVerify(),a);r!=null&&r.token?(h(me({user:r.user||null,token:r.token,expires_at:(r==null?void 0:r.expires_at)||null})),j&&((s=r.user)!=null&&s.phone)&&console.log("User consented to WhatsApp, please add contact manually in Interakt dashboard"),P()):m(k=>({...k,status:"idle",error:"Verification failed"}))}catch(a){m(p=>({...p,status:"idle",error:(a==null?void 0:a.message)||"OTP verification failed"}))}},[i,b,M,P,h]),ie=U?e.jsxs("div",{className:"fixed inset-0 z-[130] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:P}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 z-[140] max-h-[calc(100vh-4rem)] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sign in to SnowCity"}),e.jsx("button",{className:"p-2 rounded-full bg-gray-100 text-gray-500",onClick:P,children:"âœ•"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Enter your details once. We'll create or find your profile and send an OTP (testing code 123456)."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"w-full p-3 rounded-xl border border-gray-200 focus:border-blue-500 outline-none",placeholder:"Full Name (optional)",type:"text",value:b.name,onChange:t=>z(s=>({...s,name:t.target.value}))}),e.jsx("input",{className:`w-full p-3 rounded-xl border focus:border-blue-500 outline-none ${u!=null&&u.email?"border-red-300":"border-gray-200"}`,placeholder:"Email",type:"email",required:!0,autoComplete:"email",value:b.email,onChange:t=>{z(s=>({...s,email:t.target.value})),u.email&&L(s=>({...s,email:void 0}))}}),u.email&&e.jsx("p",{className:"text-xs text-red-500",children:u.email}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative w-32",children:[e.jsx("select",{className:"w-full pl-3 pr-8 p-3 rounded-xl bg-gray-50 border border-gray-200 focus:border-blue-500 outline-none appearance-none text-sm font-medium",value:B,onChange:t=>D(t.target.value),children:he.map(t=>e.jsx("option",{value:t.code,children:t.code},t.code))}),e.jsx("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-500",children:"â–¾"})]}),e.jsx("input",{className:`flex-1 p-3 rounded-xl border focus:border-blue-500 outline-none tracking-wide ${u!=null&&u.phone?"border-red-300":"border-gray-200"}`,placeholder:"98765 43210",type:"tel",maxLength:10,required:!0,pattern:"[0-9]{10}",value:v,onChange:t=>le(t.target.value)})]}),u.phone&&e.jsx("p",{className:"text-xs text-red-500",children:u.phone}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",required:!0,checked:j,onChange:t=>G(t.target.checked),className:"w-4 h-4 text-sky-600 bg-gray-100 border-gray-300 rounded focus:ring-sky-500 focus:ring-2"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"I agree to receive WhatsApp notifications *"})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"We'll send booking confirmations and updates via WhatsApp"})]}),e.jsx("button",{className:"w-full py-3 rounded-xl bg-gray-900 text-white font-semibold hover:bg-black disabled:opacity-60",onClick:ne,disabled:i.status==="sending",children:i.status==="sending"?"Sending...":i.sent?"Resend OTP":"Send OTP"}),i.sent&&e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("input",{className:"flex-1 p-3 rounded-xl border border-blue-200 focus:border-blue-500 outline-none text-center tracking-widest font-mono",maxLength:6,inputMode:"numeric",pattern:"[0-9]*",value:i.code,onChange:t=>m(s=>({...s,code:t.target.value}))}),e.jsx("button",{className:"px-5 py-3 rounded-xl bg-blue-600 text-white font-semibold hover:bg-blue-700",onClick:re,disabled:i.status==="verifying",children:i.status==="verifying"?"Verifying...":"Verify"})]}),i.debug&&e.jsxs("div",{className:"text-xs text-green-700 bg-green-50 border border-green-100 rounded-xl p-2",children:["Testing OTP:"," ",e.jsx("span",{className:"font-mono font-semibold",children:i.debug})]}),i.error&&e.jsx("div",{className:"text-xs text-red-600 bg-red-50 border border-red-100 rounded-xl p-2",children:i.error})]})]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("nav",{ref:H,"data-floating-nav":!0,className:"fixed top-0 left-0 right-0 z-30 transition-all duration-300 w-full bg-white border-b border-gray-200",children:[e.jsxs("div",{className:"hidden md:flex items-center justify-between gap-4 px-6 py-3 bg-white text-gray-900",children:[e.jsx(n,{to:"/",className:"flex items-center gap-2",children:e.jsx("img",{src:te,alt:"SnowCity Logo",className:"h-8 w-auto object-contain brightness-800"})}),e.jsxs("div",{className:"flex items-center gap-3 text-sm font-medium",children:[e.jsx(n,{to:"/",className:N,children:"Home"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:N,onClick:()=>W("attr"),children:"Attractions â–¾"}),T==="attr"&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-64 rounded-lg border border-gray-200 bg-white shadow-lg p-2 z-[110]",style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:e.jsxs("div",{className:"max-h-72 overflow-y-auto",children:[K.map((t,s)=>{const a=ee(t),p=(t==null?void 0:t.name)||(t==null?void 0:t.title)||"Attraction",c=t!=null&&t.slug?`/${t.slug}`:a?`/attractions/${a}`:"/attractions";return e.jsx(n,{to:c,className:"block px-4 py-2.5 text-sm text-gray-800 hover:bg-sky-100 rounded-lg transition-all duration-200 font-medium",onClick:()=>f(null),children:p},s)}),e.jsx(n,{to:"/attractions",className:"block px-4 py-2.5 text-sky-600 text-sm hover:bg-sky-100 rounded-lg transition-all duration-200 font-semibold border-t border-gray-200 mt-2 pt-3",onClick:()=>f(null),children:"View All â†’"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:N,onClick:()=>W("offers"),children:"Offers â–¾"}),T==="offers"&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-56 rounded-lg border border-gray-200 bg-white shadow-lg p-2 z-[110]",style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:[e.jsx(n,{to:"/offers",className:"block px-4 py-2.5 text-sm text-gray-800 hover:bg-sky-100 rounded-lg transition-all duration-200 font-medium",onClick:()=>f(null),children:"All Offers"}),e.jsx(n,{to:"/combos",className:"block px-4 py-2.5 text-sm text-gray-800 hover:bg-sky-100 rounded-lg transition-all duration-200 font-medium",onClick:()=>f(null),children:"Combo Deals"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:N,onClick:()=>W("guide"),children:"Visitor Guide â–¾"}),T==="guide"&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-64 rounded-lg border border-gray-200 bg-white shadow-lg p-2 z-[110]",style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:X.map((t,s)=>e.jsx(n,{to:`/page/${t.slug||t.id}`,className:"block px-4 py-2.5 text-sm text-gray-800 hover:bg-sky-100 rounded-lg transition-all duration-200 font-medium",onClick:()=>f(null),children:t.title||t.name},s))})]}),e.jsx(n,{to:"/contact",className:N,children:"Contact Us"}),e.jsx(n,{to:"/blogs",className:N,children:"Blogs"}),!C&&e.jsx("button",{className:ae,onClick:O,children:"ğŸ” Sign In"}),e.jsx("button",{className:oe,onClick:()=>x("/booking"),children:"ğŸŸï¸ Book Tickets"}),C&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"h-10 w-10 rounded-full flex items-center justify-center text-sm font-bold bg-gradient-to-br from-sky-400 to-cyan-500 text-white hover:from-sky-500 hover:to-cyan-600 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-110",onClick:()=>y(t=>!t),title:A,children:q}),$&&e.jsxs("div",{className:"absolute right-0 top-full mt-3 w-56 rounded-lg border border-gray-200 bg-white shadow-lg p-3 z-[110]",style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:[e.jsx(n,{to:"/my-bookings",className:"block px-3 py-2 text-gray-800 hover:bg-gray-100 rounded-lg text-sm font-medium transition-all duration-200",onClick:()=>y(!1),children:"ğŸ“‹ My Bookings"}),e.jsxs("div",{className:"px-3 py-2.5 mt-2 rounded-lg bg-gray-50 border border-gray-200 text-xs text-gray-700",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1.5",children:"Account Details"}),e.jsxs("p",{className:"leading-relaxed mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Name:"})," ",A||"Guest"]}),e.jsxs("p",{className:"leading-relaxed mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Phone:"})," ",R]}),e.jsxs("p",{className:"leading-relaxed",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Email:"})," ",_]})]}),e.jsx("button",{className:"w-full px-3 py-2 mt-2 text-red-600 hover:bg-red-50 rounded-lg text-sm font-semibold transition-all duration-200",onClick:()=>{h(Z()),y(!1)},children:"ğŸšª Logout"})]})]})]})]}),e.jsxs("div",{className:"md:hidden px-3 py-2.5 flex items-center justify-between bg-white text-gray-900 border-b border-gray-200",children:[e.jsx("button",{className:"p-0 rounded-lg text-black font-bold  hover:scale-105",onClick:()=>d(t=>!t),"aria-expanded":S,"aria-label":"Open menu",children:S?"âœ•":e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"block w-4 h-0.5 bg-black"}),e.jsx("span",{className:"block w-4 h-0.5 bg-black"}),e.jsx("span",{className:"block w-4 h-0.5 bg-black"})]})}),e.jsx(n,{to:"/","aria-label":"Home",children:e.jsx("img",{src:te,alt:"SnowCity Logo",className:"h-8 w-auto object-contain brightness-800"})}),e.jsx("div",{className:"relative",children:C?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"h-10 w-10 rounded-full flex items-center justify-center text-sm font-bold bg-gradient-to-br from-sky-400 via-blue-500 to-cyan-500 text-white hover:from-sky-300 hover:via-blue-400 hover:to-cyan-400 transition-all duration-300 shadow-lg shadow-sky-500/40 hover:shadow-xl hover:scale-110 border border-sky-300/40",onClick:()=>y(t=>!t),"aria-expanded":$,"aria-label":"Account menu",title:A,children:q}),$&&e.jsxs("div",{className:"absolute right-0 top-full mt-3 w-56 rounded-lg border border-gray-200 bg-white shadow-lg p-3 z-[110]",style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:[e.jsx(n,{to:"/my-bookings",className:"block px-3 py-2 text-gray-800 text-sm hover:bg-gray-100 rounded-lg font-medium transition-all duration-200",onClick:()=>{y(!1),d(!1)},children:"ğŸ“‹ My Bookings"}),e.jsxs("div",{className:"px-3 py-2.5 mt-2 rounded-lg bg-gray-50 border border-gray-200 text-xs text-gray-700",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1.5",children:"Account Details"}),e.jsxs("p",{className:"leading-relaxed mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Name:"})," ",A||"Guest"]}),e.jsxs("p",{className:"leading-relaxed mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Phone:"})," ",R]}),e.jsxs("p",{className:"leading-relaxed",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Email:"})," ",_]})]}),e.jsx("button",{className:"w-full px-3 py-2 mt-2 text-red-600 hover:bg-red-50 rounded-lg text-sm font-semibold transition-all duration-200",onClick:()=>{h(Z()),y(!1),d(!1)},children:"ğŸšª Logout"})]})]}):e.jsx("div",{className:"h-10 w-10"})})]}),S&&e.jsxs("div",{className:"md:hidden fixed left-0 right-0 top-[3.5rem] z-[120] bg-white border-b border-gray-200 shadow-lg px-4 py-4 space-y-2 max-h-[calc(100vh-6rem)] overflow-y-auto",children:[e.jsx(n,{to:"/",className:"block py-3 px-4 text-black hover:text-gray-800 font-semibold transition-all duration-200 rounded-lg hover:bg-gray-100",onClick:()=>d(!1),children:"ğŸ  Home"}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer py-3 px-4 text-black hover:text-gray-800 font-semibold transition-all duration-200 rounded-lg hover:bg-gray-100 list-none",children:"ğŸ¢ Attractions"}),e.jsxs("div",{className:"pl-4 space-y-1 mt-2 pb-3 border-t border-sky-400/20 pt-3",children:[K.slice(0,8).map((t,s)=>e.jsxs(n,{to:t!=null&&t.slug?`/${t.slug}`:`/attractions/${ee(t)}`,className:"block py-2 pl-4 text-gray-700 hover:text-black font-medium hover:bg-gray-50 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:["â€¢ ",t.name||t.title]},s)),e.jsx(n,{to:"/attractions",className:"block py-2 pl-4 text-blue-600 font-bold hover:bg-gray-50 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:"â†’ View All"})]})]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer py-3 px-4 text-black hover:text-gray-800 font-semibold transition-all duration-200 rounded-lg hover:bg-gray-100 list-none",children:"ğŸ Offers"}),e.jsxs("div",{className:"pl-4 space-y-1 mt-2 pb-3 border-t border-sky-400/20 pt-3",children:[e.jsx(n,{to:"/offers",className:"block py-2 pl-4 text-gray-700 hover:text-black font-medium hover:bg-gray-50 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:"â€¢ All Offers"}),e.jsx(n,{to:"/combos",className:"block py-2 pl-4 text-gray-700 hover:text-black font-medium hover:bg-gray-50 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:"â€¢ Combo Deals"})]})]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer py-3 px-4 text-black hover:text-gray-800 font-semibold transition-all duration-200 rounded-lg hover:bg-gray-100 list-none",children:"ğŸ“– Visitor Guide"}),e.jsx("div",{className:"pl-4 space-y-1 mt-2 pb-3 border-t border-sky-400/20 pt-3",children:X.map((t,s)=>e.jsxs(n,{to:`/page/${t.slug||t.id}`,className:"block py-2 pl-4 text-gray-700 hover:text-black font-medium hover:bg-gray-50 rounded-lg transition-all duration-200",onClick:()=>d(!1),children:["â€¢ ",t.title||t.name]},s))})]}),e.jsx(n,{to:"/contact",className:"block py-3 px-4 text-black hover:text-gray-800 font-semibold transition-all duration-200 rounded-lg hover:bg-gray-100 border-t border-sky-400/20 mt-3 pt-4",onClick:()=>d(!1),children:"ğŸ“ Contact Us"}),e.jsx(n,{to:"/blogs",className:"block py-3 px-4 text-black hover:text-gray-800 font-semibold transition-all duration-200 rounded-lg hover:bg-gray-100",onClick:()=>d(!1),children:"ğŸ“° Blogs"}),e.jsxs("div",{className:"space-y-2 border-t border-sky-400/20 mt-4 pt-4",children:[!C&&e.jsx("button",{className:"w-full py-3 border-2 border-sky-400 text-black font-bold rounded-full hover:bg-gray-100 transition-all duration-300 hover:text-gray-800",onClick:()=>{d(!1),O()},children:"ğŸ” Sign In"}),e.jsx("button",{className:"w-full py-3 bg-gradient-to-r from-sky-500 via-blue-500 to-cyan-500 text-white font-bold rounded-full hover:from-sky-600 hover:via-blue-600 hover:to-cyan-600 shadow-lg shadow-sky-500/30 transition-all duration-300 hover:scale-105",onClick:()=>{d(!1),x("/booking")},children:"ğŸŸï¸ Book Tickets"})]})]})]}),ie]})}export{je as default};
