const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cy1IvPOK.js","assets/index-CNdOvwUA.js","assets/index-DF6iILUU.css","assets/index-Djbb2BBh.js","assets/quill-4RyaA7S0.css"])))=>i.map(i=>d[i]);
import{R as n,j as e,_ as B}from"./index-CNdOvwUA.js";import{I as J}from"./ImageUploader-BR89ENI0.js";import{a as Z}from"./AdminApp-sxxeVGC_.js";function ee(s,d,m){return`
<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>${d||""}</style>
</head>
<body>
${s||""}
<script>${m||""}<\/script>
</body>
</html>`}function de({value:s={},onChange:d}){const[m,r]=n.useState(s.raw_html||""),[i,c]=n.useState(s.raw_css||""),[N,j]=n.useState(s.raw_js||""),[_,p]=n.useState("");return n.useEffect(()=>{r(s.raw_html||""),c(s.raw_css||""),j(s.raw_js||"")},[s.raw_html,s.raw_css,s.raw_js]),n.useEffect(()=>{const o=ee(m,i,N);p(o),d==null||d({raw_html:m,raw_css:i,raw_js:N})},[m,i,N]),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Upload assets (images/videos) to use in your HTML/CSS"}),e.jsx(J,{label:"Upload",onChange:o=>{}}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:'Tip: After uploading, copy the returned URL and reference it in <img src="..."/> or CSS backgrounds.'})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:"HTML"}),e.jsx("textarea",{className:"w-full h-64 rounded-md border px-2 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:m,onChange:o=>r(o.target.value),placeholder:"<div>Hello</div>"})]}),e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:"CSS"}),e.jsx("textarea",{className:"w-full h-64 rounded-md border px-2 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:i,onChange:o=>c(o.target.value),placeholder:"body { font-family: system-ui; }"})]}),e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:"JS"}),e.jsx("textarea",{className:"w-full h-64 rounded-md border px-2 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:N,onChange:o=>j(o.target.value),placeholder:"console.log('ready');"})]})]}),e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Live Preview"}),e.jsx("iframe",{title:"preview",className:"w-full h-[360px] rounded-md border dark:border-neutral-800 bg-white",sandbox:"allow-scripts allow-same-origin",srcDoc:_})]})]})}const te="/api/admin/uploads";async function re(s,{fieldName:d="file",extra:m={}}={}){var c;if(!s)throw new Error("No file selected");const r=await Z.upload(te,s,{fieldName:d,...m}),i=(r==null?void 0:r.url)||(r==null?void 0:r.url_path)||(r==null?void 0:r.secure_url)||(r==null?void 0:r.location)||((c=r==null?void 0:r.data)==null?void 0:c.url)||"";if(!i)throw new Error((r==null?void 0:r.message)||"Upload response missing URL");return i}function ie({value:s,onChange:d,placeholder:m="Type here…",height:r=260}){const i=n.useRef({Editor:null}),c=n.useRef(null),N=n.useRef(null),j=n.useRef(null),[,_]=n.useReducer(t=>t+1,0),[p,o]=n.useState(!1),[h,I]=n.useState(""),[T,A]=n.useState(null),[U,H]=n.useState(100),C=n.useRef({index:null,src:null}),[F,V]=n.useState(!1),[P,G]=n.useState(null);n.useEffect(()=>{let t=!0;return(async()=>{try{const l=await B(()=>import("./index-Cy1IvPOK.js"),__vite__mapDeps([0,1,2,3]));try{await B(()=>Promise.resolve({}),__vite__mapDeps([4]))}catch{}if(t){i.current.Editor=l.default||l,_(),V(!0);return}}catch(l){console.warn("RichText: editor not available. Using textarea fallback.",l)}})(),()=>{t=!1}},[]);const q=n.useCallback(()=>{var t;I(""),(t=N.current)==null||t.click()},[]),X=async t=>{var g,f,v;const l=(g=t.target.files)==null?void 0:g[0];if(l)try{o(!0),I("");const b=await re(l),w=(v=(f=c.current)==null?void 0:f.getEditor)==null?void 0:v.call(f);if(!w)return;const L=w.getSelection(!0),E=L?L.index:w.getLength();w.insertEmbed(E,"image",b,"user"),w.setSelection(E+1)}catch(b){I((b==null?void 0:b.message)||"Upload failed")}finally{o(!1),t.target.value=""}},O=n.useCallback((t,l)=>{if(!t)return;const g=Math.min(100,Math.max(20,l));t.style.width=`${g}%`,t.style.maxWidth="100%",t.dataset.widthPct=String(g)},[]),Y=n.useCallback(t=>{var f,v;if(!t){A(null);return}const l=(v=(f=c.current)==null?void 0:f.getEditor)==null?void 0:v.call(f);if(!l)return;const[g]=l.getLeaf(t.index);if(g&&g.domNode&&g.domNode.tagName==="IMG"){A(g.domNode);const b=Number(g.domNode.dataset.widthPct||100);H(Number.isFinite(b)?b:100)}else A(null)},[]),W=t=>{H(t),O(T,t)};n.useEffect(()=>{var E,Q;if(!F)return;const t=(Q=(E=c.current)==null?void 0:E.getEditor)==null?void 0:Q.call(E);if(!t)return;const l=t.root,g=a=>{if(document.caretRangeFromPoint)return document.caretRangeFromPoint(a.clientX,a.clientY);if(document.caretPositionFromPoint){const u=document.caretPositionFromPoint(a.clientX,a.clientY);if(u){const y=document.createRange();return y.setStart(u.offsetNode,u.offset),y.collapse(!0),y}}return null},f=a=>{var k,R,S,M;if(!(a.target instanceof HTMLElement)||a.target.tagName!=="IMG")return;const u=(R=(k=c.current)==null?void 0:k.getEditor)==null?void 0:R.call(k);if(!u)return;const x=u.constructor.find(a.target,!0);if(!x)return;const D=u.getIndex(x);C.current={index:D,src:a.target.getAttribute("src")},(S=a.dataTransfer)==null||S.setData("text/plain","drag-image"),(M=a.dataTransfer)==null||M.setDragImage(a.target,a.target.width/2,a.target.height/2)},v=a=>{C.current.src&&a.preventDefault()},b=a=>{var S,M;const{index:u,src:y}=C.current;if(u==null||!y)return;a.preventDefault();const x=(M=(S=c.current)==null?void 0:S.getEditor)==null?void 0:M.call(S);if(!x)return;const D=g(a);let k=x.getLength();if(D){const z=x.constructor.find(D.startContainer,!0);z&&(k=x.getIndex(z))}let R=k;R>u&&(R-=1),x.deleteText(u,1,"user"),x.insertEmbed(R,"image",y,"user"),x.setSelection(R+1,0,"user"),C.current={index:null,src:null}},w=a=>{var x;if(!(a.target instanceof HTMLElement)||a.target.tagName!=="IMG")return;a.target.setAttribute("draggable","true");const u=a.target.getBoundingClientRect(),y=(x=j.current)==null?void 0:x.getBoundingClientRect();y&&G({left:u.left-y.left+j.current.scrollLeft,top:u.top-y.top+j.current.scrollTop-30,width:u.width})},L=a=>{a.target instanceof HTMLElement&&a.target.tagName==="IMG"&&G(null)};return l.addEventListener("dragstart",f),l.addEventListener("dragover",v),l.addEventListener("drop",b),l.addEventListener("mouseover",w),l.addEventListener("mouseout",L),()=>{l.removeEventListener("dragstart",f),l.removeEventListener("dragover",v),l.removeEventListener("drop",b),l.removeEventListener("mouseover",w),l.removeEventListener("mouseout",L)}},[F]);const K=n.useMemo(()=>({toolbar:{container:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["clean"]],handlers:{image:q}}}),[q]),$=i.current.Editor;return $?e.jsxs("div",{ref:j,className:"richtext space-y-2 relative",children:[e.jsx($,{ref:c,theme:"snow",value:s||"",onChange:t=>d==null?void 0:d(t),onChangeSelection:Y,placeholder:m,style:{minHeight:r},modules:K}),e.jsx("input",{ref:N,type:"file",accept:"image/*",className:"hidden",onChange:X}),p?e.jsx("div",{className:"text-xs text-gray-500",children:"Uploading image…"}):null,h?e.jsx("div",{className:"text-xs text-red-600",children:h}):null,T?e.jsxs("div",{className:"flex flex-col gap-2 rounded-md border border-dashed p-2 text-sm",children:[e.jsx("div",{className:"font-medium",children:"Selected image controls"}),e.jsxs("label",{className:"text-xs",children:["Width: ",U,"%"]}),e.jsx("input",{type:"range",min:20,max:100,value:U,onChange:t=>W(Number(t.target.value))}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("button",{type:"button",className:"px-2 py-1 rounded-md border",onClick:()=>W(100),children:"Reset width"}),e.jsx("button",{type:"button",className:"px-2 py-1 rounded-md border",onClick:()=>T&&O(T,50),children:"50%"})]})]}):null,P?e.jsx("div",{className:"pointer-events-none absolute z-10",style:{left:P.left,top:Math.max(0,P.top)},children:e.jsx("div",{className:"rounded-full bg-gray-900/80 text-white text-xs px-3 py-1 shadow",children:"Drag image to reposition"})}):null]}):e.jsx("textarea",{value:s||"",onChange:t=>d==null?void 0:d(t.target.value),placeholder:m,style:{minHeight:r},className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200"})}function se(s){return Array.isArray(s)?s:s?Array.isArray(s==null?void 0:s.data)?s.data:[]:[]}function ce({label:s="Gallery images",helper:d="Upload or paste multiple images to reuse across the page/blog.",value:m,onChange:r}){const i=se(m),c=n.useCallback(p=>{const o=p.filter(h=>h&&typeof h=="string");r==null||r(o)},[r]),N=(p,o)=>{const h=[...i];h[p]=o,c(h)},j=p=>{const o=i.filter((h,I)=>I!==p);c(o)},_=()=>{c([...i,""])};return e.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-neutral-100",children:s}),d?e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400",children:d}):null]}),i.length===0?e.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400",children:'No images yet. Use "Add image" to upload multiple assets.'}):null,i.map((p,o)=>e.jsxs("div",{className:"rounded-md border border-dashed dark:border-neutral-700 p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-neutral-300",children:[e.jsxs("span",{children:["Image #",o+1]}),e.jsx("button",{type:"button",className:"text-red-600 hover:underline",onClick:()=>j(o),children:"Remove"})]}),e.jsx(J,{label:"",value:p,onChange:h=>N(o,h)})]},`gallery-${o}`)),e.jsx("button",{type:"button",className:"px-3 py-2 rounded-md border text-sm",onClick:_,children:"Add image"})]})}export{ce as G,de as R,ie as a};
