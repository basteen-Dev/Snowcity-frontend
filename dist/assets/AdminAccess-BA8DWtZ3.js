import{C as X,G as q,B as H,R as o,j as e,L as J}from"./index-LUC8W6HM.js";import{a as g}from"./AdminApp-BAIHpeWj.js";import"./createLucideIcon-BY9DOx5Q.js";import"./file-text-Bc3jcJvJ.js";import"./ticket-xkTq38T-.js";const K="__module_all__",A=w=>`${K}:${w}`,B=Object.freeze({attraction:[],combo:[],banner:[],page:[],blog:[],gallery:[]}),Q=Object.freeze({attractions:[],combos:[],banners:[],pages:[],blogs:[],gallery:[]});function _({title:w,items:C,sel:$,setSel:b,disabled:y,moduleLabel:N,moduleValue:l}){const j=Array.isArray($)?$:[],d=C.map(i=>i.id),x=l?j.includes(l):!1,u=l?x:!!(N&&(d.length===0||d.every(i=>j.includes(i)))),P=i=>{if(y||x)return;const h=j.includes(i)?j.filter(S=>S!==i):[...j,i];b(h)},E=()=>{y||!N||b(l?x?[]:[l]:u?[]:d)};return e.jsxs("div",{className:"rounded-xl border p-4 dark:border-neutral-800 dark:bg-neutral-900/60 bg-white/70",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-neutral-100",children:w}),N?e.jsxs("label",{className:["inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-medium transition-colors",u?"bg-emerald-600 text-white border-emerald-600":"text-blue-600 border-blue-500 hover:bg-blue-50 dark:hover:bg-neutral-800",y?"opacity-60 cursor-not-allowed":""].join(" "),children:[e.jsx("input",{type:"checkbox",className:"accent-white",checked:u,onChange:E,disabled:y||!l&&!d.length&&!u}),e.jsx("span",{children:N})]}):null]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:[C.map(i=>e.jsxs("label",{className:["flex items-center gap-2 text-sm rounded-lg border px-3 py-2",y||x?"opacity-60 cursor-not-allowed":"hover:border-blue-400 dark:hover:border-blue-500"].join(" "),children:[e.jsx("input",{type:"checkbox",disabled:y||x,checked:j.includes(i.id),onChange:()=>P(i.id)}),e.jsx("span",{className:"truncate",children:i.label})]},i.id)),!C.length&&e.jsx("div",{className:"text-xs text-gray-500",children:"No items"})]})]})}function te(){const w=X(),[C]=q(),$=H(),b=(w==null?void 0:w.id)||"",[y,N]=o.useState([]),[l,j]=o.useState(b||C.get("adminId")||""),[d,x]=o.useState(B),[u,P]=o.useState(Q),[E,i]=o.useState(!0),[h,S]=o.useState(!1),[F,R]=o.useState(!1),[I,p]=o.useState(""),[G,L]=o.useState(""),[T,M]=o.useState(!1),[z,O]=o.useState(B);o.useEffect(()=>{(async()=>{try{p(""),i(!0);const[a,n,r,m,c,f,t]=await Promise.all([g.get("/api/admin/admins",{limit:200}),g.get("/api/admin/attractions",{limit:200}),g.get("/api/admin/combos",{active:!0}),g.get("/api/admin/banners",{limit:200}),g.get("/api/admin/pages",{limit:200}),g.get("/api/admin/blogs",{limit:200}),g.get("/api/admin/gallery",{limit:200})]);N(Array.isArray(a)?a:[]),P({attractions:((n==null?void 0:n.data)||n||[]).map(s=>({id:s.attraction_id,label:s.title||`Attraction #${s.attraction_id}`})),combos:((r==null?void 0:r.data)||r||[]).map(s=>({id:s.combo_id,label:s.title||`${s.attraction_1_id}+${s.attraction_2_id}`})),banners:((m==null?void 0:m.data)||m||[]).map(s=>({id:s.banner_id,label:s.title||`Banner #${s.banner_id}`})),pages:((c==null?void 0:c.data)||c||[]).map(s=>({id:s.page_id,label:s.title})),blogs:((f==null?void 0:f.data)||f||[]).map(s=>({id:s.blog_id,label:s.title})),gallery:((t==null?void 0:t.data)||t||[]).map(s=>({id:s.gallery_item_id,label:s.title||s.url}))})}catch(a){p(a.message||"Failed to load Grant Access data")}finally{i(!1)}})()},[]),o.useEffect(()=>{if(!l){x(B);return}let a=!1;return(async()=>{var n,r,m,c,f,t;try{p(""),L(""),S(!0);const s=await g.get(`/api/admin/admins/${l}/access`);if(a)return;x({attraction:((n=s==null?void 0:s.access)==null?void 0:n.attraction)||[],combo:((r=s==null?void 0:s.access)==null?void 0:r.combo)||[],banner:((m=s==null?void 0:s.access)==null?void 0:m.banner)||[],page:((c=s==null?void 0:s.access)==null?void 0:c.page)||[],blog:((f=s==null?void 0:s.access)==null?void 0:f.blog)||[],gallery:((t=s==null?void 0:s.access)==null?void 0:t.gallery)||[]})}catch(s){a||p(s.message||"Failed to load admin access")}finally{a||S(!1)}})(),()=>{a=!0}},[l]);const Y=async()=>{if(!l){p("Select an admin to grant access.");return}try{p(""),L(""),R(!0),await g.put(`/api/admin/admins/${l}/access`,{access:d}),L("Access updated successfully."),b&&$("/admin/admins")}catch(a){p(a.message||"Save failed")}finally{R(!1)}},D=async()=>{var a,n,r,m,c,f;if(l)try{S(!0);const t=await g.get(`/api/admin/admins/${l}/access`);O({attraction:((a=t==null?void 0:t.access)==null?void 0:a.attraction)||[],combo:((n=t==null?void 0:t.access)==null?void 0:n.combo)||[],banner:((r=t==null?void 0:t.access)==null?void 0:r.banner)||[],page:((m=t==null?void 0:t.access)==null?void 0:m.page)||[],blog:((c=t==null?void 0:t.access)==null?void 0:c.blog)||[],gallery:((f=t==null?void 0:t.access)==null?void 0:f.gallery)||[]}),M(!0)}catch(t){p(t.message||"Failed to load access preview")}finally{S(!1)}},U=async a=>{if(l&&confirm(`Revoke all ${a} access for ${(v==null?void 0:v.name)||`Admin #${l}`}?`))try{p(""),L("");const n={...z,[a]:[]};await g.put(`/api/admin/admins/${l}/access`,{access:n}),O(n),L(`${a} access revoked successfully.`),String(l)===String(l)&&x(r=>({...r,[a]:[]}))}catch(n){p(n.message||"Revoke failed")}},k=o.useCallback(a=>n=>{x(r=>{const m=Array.isArray(r[a])?r[a]:[],c=typeof n=="function"?n(m):n;return{...r,[a]:Array.isArray(c)?c:[]}})},[]);if(E)return e.jsx("div",{className:"p-3 text-sm",children:"Loading Grant Access module…"});const v=y.find(a=>String(a.user_id)===String(l)),V=!!l&&!h;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"Grant Access"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400",children:"Root & Super Admins can scope sub-admins to specific attractions, combos, and content. Sub-admins will only see revenue, bookings, offers, promos, and creatives tied to what you select here."})]}),I?e.jsx("div",{className:"text-sm text-red-600",children:I}):null,G?e.jsx("div",{className:"text-sm text-emerald-600",children:G}):null,e.jsxs("div",{className:"rounded-xl border bg-white dark:bg-neutral-900 p-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center",children:[e.jsx("label",{className:"text-sm font-medium w-full md:w-64 text-gray-900 dark:text-neutral-200",children:"Select Sub Admin"}),e.jsxs("select",{className:"flex-1 rounded-lg border px-3 py-2 bg-white dark:bg-neutral-900",value:l,onChange:a=>j(a.target.value),disabled:!!b,children:[e.jsx("option",{value:"",children:"Pick an admin…"}),y.map(a=>e.jsx("option",{value:a.user_id,children:a.name||a.email||`Admin #${a.user_id}`},a.user_id))]}),e.jsx(J,{to:"/admin/admins/new",className:"text-sm font-medium text-blue-600 hover:text-blue-500 whitespace-nowrap",children:"+ Create Admin"})]}),b?e.jsxs("p",{className:"text-xs text-gray-500",children:["Granting access for admin #",b,". Selection locked."]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Need a fresh sub-admin for SnowCity or combos? Create them first, then grant access here."})]}),l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-500/10 p-4 text-sm text-gray-700 dark:text-neutral-200",children:[(v==null?void 0:v.name)||"This sub-admin"," will only see dashboards, revenue, bookings, offers, banners, pages, blogs, and gallery items tied to the attractions/combos you check below. Select Snow City & Snow City Together Combo to limit them to those modules."]}),e.jsx(_,{title:"Attractions (bookings / revenue scope)",items:u.attractions,sel:d.attraction,setSel:k("attraction"),disabled:h,moduleLabel:"attractions module",moduleValue:A("attraction")}),e.jsx(_,{title:"Combos",items:u.combos,sel:d.combo,setSel:k("combo"),disabled:h,moduleLabel:"combos module",moduleValue:A("combo")}),e.jsx(_,{title:"Banners",items:u.banners,sel:d.banner,setSel:k("banner"),disabled:h,moduleLabel:"banners module",moduleValue:A("banner")}),e.jsx(_,{title:"Pages",items:u.pages,sel:d.page,setSel:k("page"),disabled:h,moduleLabel:"pages module",moduleValue:A("page")}),e.jsx(_,{title:"Blogs",items:u.blogs,sel:d.blog,setSel:k("blog"),disabled:h,moduleLabel:"blog module",moduleValue:A("blog")}),e.jsx(_,{title:"Gallery",items:u.gallery,sel:d.gallery,setSel:k("gallery"),disabled:h,moduleLabel:"gallery module",moduleValue:A("gallery")})]}):e.jsx("div",{className:"rounded-xl border border-dashed bg-white/50 dark:bg-neutral-900/40 p-6 text-center text-sm text-gray-500",children:"Select an admin above to start granting scoped access."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-900 text-white disabled:bg-gray-400",onClick:Y,disabled:!V||F,children:F?"Saving…":"Save Access"}),e.jsx("button",{className:"px-4 py-2 rounded-lg border border-blue-500 text-blue-600 dark:text-blue-400",onClick:D,disabled:!l||h,children:"Preview Access"}),e.jsx("button",{className:"px-4 py-2 rounded-lg border",onClick:()=>{b?$("/admin/admins"):j("")},children:"Cancel"})]}),T&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-xl shadow-xl max-w-2xl w-full max-h-[80vh] overflow-auto p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Current Access for ",(v==null?void 0:v.name)||`Admin #${l}`]}),e.jsx("div",{className:"space-y-3 text-sm",children:Object.entries(z).map(([a,n])=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"font-medium capitalize mb-1 flex items-center justify-between",children:[e.jsx("span",{children:a}),n.length>0&&e.jsx("button",{className:"text-xs px-2 py-1 rounded bg-red-500 text-white hover:bg-red-600",onClick:()=>U(a),children:"Revoke All"})]}),n.length===0?e.jsx("div",{className:"text-gray-500",children:"No access"}):n.includes("*")?e.jsx("div",{className:"text-green-600 font-medium",children:"Full module access"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:n.map(r=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-neutral-800 rounded text-xs",children:r},r))})]},a))}),e.jsx("div",{className:"flex justify-end gap-2 mt-6",children:e.jsx("button",{className:"px-4 py-2 rounded-lg border",onClick:()=>M(!1),children:"Close"})})]})})]})}export{te as default};
