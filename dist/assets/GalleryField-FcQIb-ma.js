const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CEjlWuwb.js","assets/index-C5Mz9dTM.js","assets/index-D5Jqzt5t.css","assets/index-CCCQe3aM.js","assets/quill-4RyaA7S0.css"])))=>i.map(i=>d[i]);
import{R as s,j as t,_ as ee}from"./index-C5Mz9dTM.js";import{I as se}from"./ImageUploader-DAvc2Cys.js";import{t as ne}from"./media-DDlhmRHE.js";import{a as ue}from"./AdminApp-C7IcGGGV.js";function me(r,d,m){return`
<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>${d||""}</style>
</head>
<body>
${r||""}
<script>${m||""}<\/script>
</body>
</html>`}function ge(r){var m;const d=ne(r);return d||(r?/^https?:\/\//i.test(r)?r:typeof window<"u"&&((m=window.location)!=null&&m.origin)?r.startsWith("/")?`${window.location.origin}${r}`:`${window.location.origin}/${r}`:r:"")}function Ne({value:r={},onChange:d}){const m=s.useRef(null),[a,f]=s.useState(r.raw_html||""),[p,j]=s.useState(r.raw_css||""),[R,C]=s.useState(r.raw_js||""),[k,h]=s.useState(""),[b,M]=s.useState([]),[O,N]=s.useState("");s.useEffect(()=>{f(r.raw_html||""),j(r.raw_css||""),C(r.raw_js||"")},[r.raw_html,r.raw_css,r.raw_js]),s.useEffect(()=>{const n=me(a,p,R);h(n),d==null||d({raw_html:a,raw_css:p,raw_js:R})},[a,p,R]);const D=s.useCallback(n=>{if(!n)return;const v=ge(n);M(y=>{const I=[{id:`${Date.now()}-${Math.random()}`,url:n,absolute:v}];for(const L of y)L.absolute!==v&&I.push(L);return I.slice(0,6)})},[]),H=s.useCallback(async n=>{var v;try{(v=navigator==null?void 0:navigator.clipboard)!=null&&v.writeText&&(await navigator.clipboard.writeText(n),N(n),setTimeout(()=>N(""),2e3))}catch(y){console.warn("Copy failed",y)}},[]),P=s.useCallback(n=>{f(v=>{const y=m.current;if(!y)return`${v}${n}`;const I=y.selectionStart??v.length,L=y.selectionEnd??I,W=`${v.slice(0,I)}${n}${v.slice(L)}`;return requestAnimationFrame(()=>{y.focus();const _=I+n.length;y.selectionStart=_,y.selectionEnd=_}),W})},[]),F=s.useCallback(n=>{D(n)},[D]);return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-3",children:[t.jsx("div",{className:"text-sm font-medium mb-2",children:"Upload assets (images/videos) to use in your HTML/CSS"}),t.jsx(se,{label:"Upload",onChange:n=>{},onUploadComplete:F}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:'Tip: After uploading, copy the returned URL and reference it in <img src="..."/> or CSS backgrounds.'}),b.length?t.jsx("div",{className:"mt-3 space-y-2",children:b.map(n=>t.jsxs("div",{className:"rounded-md border border-dashed dark:border-neutral-700 p-2 space-y-1 text-xs",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"flex-1 break-all text-gray-700 dark:text-neutral-200",children:n.absolute}),t.jsx("button",{type:"button",className:"px-2 py-1 rounded-md border text-[11px]",onClick:()=>H(n.absolute),children:O===n.absolute?"Copied!":"Copy URL"}),t.jsx("button",{type:"button",className:"px-2 py-1 rounded-md border text-[11px]",onClick:()=>P(`<img src="${n.absolute}" alt="" />`),children:"Insert <img>"})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-gray-500 dark:text-neutral-400",children:[t.jsx("button",{type:"button",className:"underline",onClick:()=>P(`style="background-image: url('${n.absolute}');"`),children:"Add background snippet"}),t.jsxs("span",{className:"opacity-75 break-all",children:["Original: ",n.url]})]})]},n.id))}):null]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[t.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[t.jsx("div",{className:"text-xs font-medium mb-1",children:"HTML"}),t.jsx("textarea",{className:"w-full h-64 rounded-md border px-2 py-2 dark:bg-neutral-900 dark:border-neutral-700",ref:m,value:a,onChange:n=>f(n.target.value),placeholder:"<div>Hello</div>"})]}),t.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[t.jsx("div",{className:"text-xs font-medium mb-1",children:"CSS"}),t.jsx("textarea",{className:"w-full h-64 rounded-md border px-2 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:p,onChange:n=>j(n.target.value),placeholder:"body { font-family: system-ui; }"})]}),t.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[t.jsx("div",{className:"text-xs font-medium mb-1",children:"JS"}),t.jsx("textarea",{className:"w-full h-64 rounded-md border px-2 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:R,onChange:n=>C(n.target.value),placeholder:"console.log('ready');"})]})]}),t.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:[t.jsx("div",{className:"text-sm font-medium mb-2",children:"Live Preview"}),t.jsx("iframe",{title:"preview",className:"w-full h-[360px] rounded-md border dark:border-neutral-800 bg-white",sandbox:"allow-scripts allow-same-origin",srcDoc:k})]})]})}const fe="/api/admin/uploads";async function xe(r,{fieldName:d="file",extra:m={}}={}){var p;if(!r)throw new Error("No file selected");const a=await ue.upload(fe,r,{fieldName:d,...m}),f=(a==null?void 0:a.url)||(a==null?void 0:a.url_path)||(a==null?void 0:a.secure_url)||(a==null?void 0:a.location)||((p=a==null?void 0:a.data)==null?void 0:p.url)||"";if(!f)throw new Error((a==null?void 0:a.message)||"Upload response missing URL");return f}const te=r=>{var m;const d=ne(r);return d||(r?/^https?:\/\//i.test(r)?r:typeof window<"u"&&((m=window.location)!=null&&m.origin)?r.startsWith("/")?`${window.location.origin}${r}`:`${window.location.origin}/${r}`:r:"")},re=["inter","poppins","roboto","serif","monospace"];function ve({value:r,onChange:d,placeholder:m="Type here…",height:a=260,gallery:f=[]}){const p=s.useRef({Editor:null}),j=s.useRef(null),R=s.useRef(null),C=s.useRef(null),[,k]=s.useReducer(e=>e+1,0),[h,b]=s.useState(!1),[M,O]=s.useState(""),[N,D]=s.useState(null),[H,P]=s.useState(100),F=s.useRef({index:null,src:null}),[n,v]=s.useState(!1),[y,I]=s.useState(null),L=s.useRef(!1),[W,_]=s.useState("inline"),[J,ae]=s.useState(!1);s.useEffect(()=>{let e=!0;return(async()=>{var l;try{const i=await ee(()=>import("./index-CEjlWuwb.js"),__vite__mapDeps([0,1,2,3]));try{await ee(()=>Promise.resolve({}),__vite__mapDeps([4]))}catch{}if(e){const c=i.default||i,g=i.Quill||window.Quill;if(g&&!L.current){const u=(l=g.import)==null?void 0:l.call(g,"formats/font");u&&(u.whitelist=re,g.register(u,!0),L.current=!0)}p.current.Editor=c,k(),v(!0);return}}catch(i){console.warn("RichText: editor not available. Using textarea fallback.",i)}})(),()=>{e=!1}},[]);const X=s.useCallback(()=>{var e;O(""),(e=R.current)==null||e.click()},[]),le=async e=>{var i,c,g;const l=(i=e.target.files)==null?void 0:i[0];if(l)try{b(!0),O("");const u=await xe(l),S=(g=(c=j.current)==null?void 0:c.getEditor)==null?void 0:g.call(c);if(!S)return;const q=S.getSelection(!0),A=q?q.index:S.getLength(),Q=te(u);S.insertEmbed(A,"image",Q,"user"),S.setSelection(A+1)}catch(u){O((u==null?void 0:u.message)||"Upload failed")}finally{b(!1),e.target.value=""}},ie=s.useCallback(async e=>{var l,i;try{const c=(i=(l=j.current)==null?void 0:l.getEditor)==null?void 0:i.call(l);if(!c)return;const g=c.getSelection(!0),u=g?g.index:c.getLength(),S=te(e);c.insertEmbed(u,"image",S,"user"),c.setSelection(u+1)}catch(c){console.error("Insert image failed",c)}},[]),B=s.useCallback((e,l)=>{if(!e)return;const i=Math.min(100,Math.max(20,l));e.style.width=`${i}%`,e.style.maxWidth="100%",e.dataset.widthPct=String(i)},[]),z=s.useCallback((e,l)=>{if(!e)return;const i=l||"inline";e.dataset.alignMode=i,e.style.float="",e.style.display="",e.style.margin="",e.style.marginLeft="",e.style.marginRight="",e.style.marginTop="",e.style.marginBottom="",i==="left"?(e.style.float="left",e.style.margin="0 1rem 1rem 0",e.style.display="block"):i==="right"?(e.style.float="right",e.style.margin="0 0 1rem 1rem",e.style.display="block"):i==="center"?(e.style.display="block",e.style.marginLeft="auto",e.style.marginRight="auto",e.style.marginBottom="1rem"):(e.style.display="inline-block",e.style.marginBottom="1rem")},[]),oe=s.useCallback(e=>{var c,g;if(!e){D(null),P(100),_("inline");return}const l=(g=(c=j.current)==null?void 0:c.getEditor)==null?void 0:g.call(c);if(!l)return;const[i]=l.getLeaf(e.index);if(i&&i.domNode&&i.domNode.tagName==="IMG"){D(i.domNode);const u=Number(i.domNode.dataset.widthPct||100);P(Number.isFinite(u)?u:100),_(i.domNode.dataset.alignMode||"inline")}else D(null),_("inline")},[]),Y=e=>{P(e),B(N,e)},de=e=>{_(e),z(N,e)};s.useEffect(()=>{N&&(B(N,H),z(N,W))},[N,H,W,B,z]),s.useEffect(()=>{var A,Q;if(!n)return;const e=(Q=(A=j.current)==null?void 0:A.getEditor)==null?void 0:Q.call(A);if(!e)return;const l=e.root,i=o=>{if(document.caretRangeFromPoint)return document.caretRangeFromPoint(o.clientX,o.clientY);if(document.caretPositionFromPoint){const x=document.caretPositionFromPoint(o.clientX,o.clientY);if(x){const E=document.createRange();return E.setStart(x.offsetNode,x.offset),E.collapse(!0),E}}return null},c=o=>{var $,T,U,G;if(!(o.target instanceof HTMLElement)||o.target.tagName!=="IMG")return;const x=(T=($=j.current)==null?void 0:$.getEditor)==null?void 0:T.call($);if(!x)return;const w=x.constructor.find(o.target,!0);if(!w)return;const V=x.getIndex(w);F.current={index:V,src:o.target.getAttribute("src")},(U=o.dataTransfer)==null||U.setData("text/plain","drag-image"),(G=o.dataTransfer)==null||G.setDragImage(o.target,o.target.width/2,o.target.height/2)},g=o=>{F.current.src&&o.preventDefault()},u=o=>{var U,G;const{index:x,src:E}=F.current;if(x==null||!E)return;o.preventDefault();const w=(G=(U=j.current)==null?void 0:U.getEditor)==null?void 0:G.call(U);if(!w)return;const V=i(o);let $=w.getLength();if(V){const Z=w.constructor.find(V.startContainer,!0);Z&&($=w.getIndex(Z))}let T=$;T>x&&(T-=1),w.deleteText(x,1,"user"),w.insertEmbed(T,"image",E,"user"),w.setSelection(T+1,0,"user"),F.current={index:null,src:null}},S=o=>{var w;if(!(o.target instanceof HTMLElement)||o.target.tagName!=="IMG")return;o.target.setAttribute("draggable","true");const x=o.target.getBoundingClientRect(),E=(w=C.current)==null?void 0:w.getBoundingClientRect();E&&I({left:x.left-E.left+C.current.scrollLeft,top:x.top-E.top+C.current.scrollTop-30,width:x.width})},q=o=>{o.target instanceof HTMLElement&&o.target.tagName==="IMG"&&I(null)};return l.addEventListener("dragstart",c),l.addEventListener("dragover",g),l.addEventListener("drop",u),l.addEventListener("mouseover",S),l.addEventListener("mouseout",q),()=>{l.removeEventListener("dragstart",c),l.removeEventListener("dragover",g),l.removeEventListener("drop",u),l.removeEventListener("mouseover",S),l.removeEventListener("mouseout",q)}},[n]);const ce=s.useMemo(()=>({toolbar:{container:[[{font:re}],[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["clean"]],handlers:{image:X}}}),[X]),K=p.current.Editor;return K?t.jsxs("div",{ref:C,className:"richtext space-y-2 relative",children:[Array.isArray(f)&&f.length?t.jsx("div",{className:"rounded-md border p-2 flex gap-2 overflow-x-auto mb-2 bg-white dark:bg-neutral-800",children:f.map((e,l)=>t.jsx("button",{type:"button",onClick:()=>ie(e),className:"w-20 h-12 shrink-0 rounded-md overflow-hidden border hover:ring-2 hover:ring-blue-500",title:"Insert image into editor",children:t.jsx("img",{src:e,alt:`img-${l}`,className:"w-full h-full object-cover",onError:i=>{i.target.onerror=null,i.target.src="/placeholder-image.png"}})},`g-${l}`))}):null,t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[t.jsx("span",{children:"Visual Editor"}),t.jsx("button",{type:"button",onClick:()=>ae(e=>!e),className:"px-2 py-1 rounded-md border",children:J?"Hide preview":"Show preview"})]}),t.jsx(K,{ref:j,theme:"snow",value:r||"",onChange:e=>d==null?void 0:d(e),onChangeSelection:oe,placeholder:m,style:{minHeight:a},modules:ce}),t.jsx("input",{ref:R,type:"file",accept:"image/*",className:"hidden",onChange:le}),h?t.jsx("div",{className:"text-xs text-gray-500",children:"Uploading image…"}):null,M?t.jsx("div",{className:"text-xs text-red-600",children:M}):null,N?t.jsxs("div",{className:"flex flex-col gap-2 rounded-md border border-dashed p-2 text-sm",children:[t.jsx("div",{className:"font-medium",children:"Selected image controls"}),t.jsxs("label",{className:"text-xs",children:["Width: ",H,"%"]}),t.jsx("input",{type:"range",min:20,max:100,value:H,onChange:e=>Y(Number(e.target.value))}),t.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[t.jsx("button",{type:"button",className:"px-2 py-1 rounded-md border",onClick:()=>Y(100),children:"Reset width"}),t.jsx("button",{type:"button",className:"px-2 py-1 rounded-md border",onClick:()=>N&&B(N,50),children:"50%"})]}),t.jsx("div",{className:"text-xs font-medium mt-2",children:"Alignment"}),t.jsx("div",{className:"flex flex-wrap gap-2 text-xs",children:["inline","left","center","right"].map(e=>t.jsx("button",{type:"button",className:`px-2 py-1 rounded-md border ${W===e?"bg-gray-900 text-white":""}`,onClick:()=>de(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}):null,J?t.jsx("div",{className:"richtext-preview text-sm mt-2",children:r?t.jsx("div",{dangerouslySetInnerHTML:{__html:r}}):t.jsx("div",{className:"text-gray-400 text-xs",children:"Start typing to see a live preview…"})}):null,y?t.jsx("div",{className:"pointer-events-none absolute z-10",style:{left:y.left,top:Math.max(0,y.top)},children:t.jsx("div",{className:"rounded-full bg-gray-900/80 text-white text-xs px-3 py-1 shadow",children:"Drag image to reposition"})}):null]}):t.jsx("textarea",{value:r||"",onChange:e=>d==null?void 0:d(e.target.value),placeholder:m,style:{minHeight:a},className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200"})}function pe(r){return Array.isArray(r)?r:r?Array.isArray(r==null?void 0:r.data)?r.data:[]:[]}function ke({label:r="Gallery images",helper:d="Upload or paste multiple images to reuse across the page/blog.",value:m,onChange:a}){const f=pe(m),p=s.useCallback(k=>{const h=k.filter(b=>b&&typeof b=="string");a==null||a(h)},[a]),j=(k,h)=>{const b=[...f];b[k]=h,p(b)},R=k=>{const h=f.filter((b,M)=>M!==k);p(h)},C=()=>{p([...f,""])};return t.jsxs("div",{className:"rounded-lg border dark:border-neutral-800 p-3 space-y-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-neutral-100",children:r}),d?t.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400",children:d}):null]}),f.length===0?t.jsx("div",{className:"text-xs text-gray-500 dark:text-neutral-400",children:'No images yet. Use "Add image" to upload multiple assets.'}):null,f.map((k,h)=>t.jsxs("div",{className:"rounded-md border border-dashed dark:border-neutral-700 p-2 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-neutral-300",children:[t.jsxs("span",{children:["Image #",h+1]}),t.jsx("button",{type:"button",className:"text-red-600 hover:underline",onClick:()=>R(h),children:"Remove"})]}),t.jsx(se,{label:"",value:k,onChange:b=>j(h,b)})]},`gallery-${h}`)),t.jsx("button",{type:"button",className:"px-3 py-2 rounded-md border text-sm",onClick:C,children:"Add image"})]})}export{ke as G,Ne as R,ve as a};
