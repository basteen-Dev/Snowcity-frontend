import{B as N,R as u,j as e}from"./index-LUC8W6HM.js";import{a as c,A as o}from"./AdminApp-BAIHpeWj.js";import{A as f}from"./AdminTable-BYWoXvnz.js";import{D as _,c as k,S as A,v as S,a as C}from"./sortable.esm-C8933g1_.js";import"./createLucideIcon-BY9DOx5Q.js";import"./file-text-Bc3jcJvJ.js";import"./ticket-xkTq38T-.js";function E(){const m=N(),[s,r]=u.useState({status:"idle",items:[],error:null,q:"",active:"",page:1,limit:20,meta:null,reorder:!1,saving:!1}),l=async(t=1)=>{r(a=>({...a,status:"loading",error:null,page:t}));try{const a=await c.get(o.attractions(),{params:{q:s.q||void 0,active:s.active||void 0,page:t,limit:s.limit}}),i=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[];r(n=>({...n,status:"succeeded",items:i,meta:(a==null?void 0:a.meta)||null,page:t}))}catch(a){r(i=>({...i,status:"failed",error:a}))}};u.useEffect(()=>{l(1)},[]);const h=t=>{const{active:a,over:i}=t;!i||a.id===i.id||r(n=>{const y=n.items.findIndex(x=>String(x.attraction_id)===String(a.id)),b=n.items.findIndex(x=>String(x.attraction_id)===String(i.id)),j=C(n.items,y,b);return{...n,items:j}})},v=async()=>{const t=s.items.map(a=>a.attraction_id);r(a=>({...a,saving:!0}));try{try{await c.post(o.attractionsReorder(),{ids:t})}catch{await Promise.all(t.map((a,i)=>c.put(`${o.attractions()}/${a}`,{sort_order:i})))}alert("Order saved")}catch(a){alert((a==null?void 0:a.message)||"Failed to save order")}finally{r(a=>({...a,saving:!1,reorder:!1})),l(s.page)}},d=s.meta||{},p=s.page>1,g=d.page?d.page<(d.totalPages||d.total_pages||1):!1;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Attractions"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>r(t=>({...t,reorder:!t.reorder})),children:s.reorder?"Exit Reorder":"Reorder"}),s.reorder?e.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm disabled:opacity-50",onClick:v,disabled:s.saving,children:s.saving?"Saving…":"Save Order"}):e.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm",onClick:()=>m("/admin/catalog/attractions/new"),children:"New Attraction"})]})]}),s.reorder?e.jsx("div",{className:"overflow-x-auto rounded-lg border bg-white dark:bg-neutral-900",children:e.jsx(_,{collisionDetection:k,onDragEnd:h,children:e.jsx(A,{items:s.items.map(t=>String(t.attraction_id)),strategy:S,children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-neutral-800 text-gray-600 dark:text-neutral-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Drag"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Title"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Base Price"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Active"})]})}),e.jsx("tbody",{className:"text-gray-800 dark:text-neutral-200",children:s.items.map(t=>e.jsxs("tr",{id:String(t.attraction_id),className:"border-t border-gray-200 dark:border-neutral-800",children:[e.jsx("td",{className:"px-3 py-2 cursor-grab",children:"⋮⋮"}),e.jsx("td",{className:"px-3 py-2",children:t.title||"—"}),e.jsxs("td",{className:"px-3 py-2",children:["₹",(t==null?void 0:t.base_price)??0]}),e.jsx("td",{className:"px-3 py-2",children:String(t==null?void 0:t.active)})]},t.attraction_id))})]})})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 grid grid-cols-1 md:grid-cols-4 gap-2",children:[e.jsx("input",{className:"rounded-md border px-3 py-2",placeholder:"Search title",value:s.q,onChange:t=>r(a=>({...a,q:t.target.value}))}),e.jsxs("select",{className:"rounded-md border px-3 py-2",value:s.active,onChange:t=>r(a=>({...a,active:t.target.value})),children:[e.jsx("option",{value:"",children:"Active: All"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]}),e.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>l(1),children:"Filter"})]}),e.jsx(f,{keyField:"attraction_id",columns:[{key:"title",title:"Title"},{key:"base_price",title:"Base Price",render:t=>`₹${(t==null?void 0:t.base_price)??0}`},{key:"active",title:"Active",render:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded ${t!=null&&t.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t!=null&&t.active?"Active":"Inactive"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),window.confirm(`Are you sure you want to delete "${t.title}"? This will also delete all associated slots.`)&&c.delete(`${o.attractions()}/${t.attraction_id||t.id}`).then(()=>r(i=>({...i,items:i.items.filter(n=>(n.attraction_id||n.id)!==(t.attraction_id||t.id))}))).catch(i=>alert(i.message||"Failed to delete attraction"))},className:"text-red-600 hover:text-red-800 text-sm underline",title:"Delete attraction",children:"Delete"})]})},{key:"__slots",title:"Slots",render:t=>e.jsx("button",{onClick:a=>{a.stopPropagation(),m(`/admin/catalog/attraction-slots?attraction_id=${t.attraction_id||t.id}`)},className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"View Slots"})}],rows:s.items,onRowClick:t=>m(`/admin/catalog/attractions/${t.attraction_id||t.id}`),empty:s.status==="loading"?"Loading…":"No attractions"}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>p&&l(s.page-1),disabled:!p||s.status==="loading",children:"Prev"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",d.page||s.page]}),e.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>g&&l(s.page+1),disabled:!g||s.status==="loading",children:"Next"})]})]})]})}export{E as default};
