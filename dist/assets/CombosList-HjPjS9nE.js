import{C as y,R as b,j as e}from"./index-C5Mz9dTM.js";import{a as d,A as m}from"./AdminApp-C7IcGGGV.js";import{A as g}from"./AdminTable-8G2GjJdl.js";import"./createLucideIcon-DQ6FqzLt.js";import"./file-text-CQ7rExmv.js";import"./ticket-C3bgGsni.js";function N(){const u=y(),[s,l]=b.useState({status:"idle",items:[],error:null,active:"",attractions:[],slotCounts:{}}),x=async()=>{l(t=>({...t,status:"loading",error:null}));try{const[t,a]=await Promise.all([d.get(m.combos(),{params:{active:s.active||void 0}}),d.get(m.attractions())]),o=Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t)?t:[],n=Array.isArray(a==null?void 0:a.data)?a.data:Array.isArray(a)?a:[],r={};await Promise.all(o.map(async c=>{try{const i=await d.get(m.comboSlots(),{params:{combo_id:c.combo_id}}),p=Array.isArray(i==null?void 0:i.data)?i.data:Array.isArray(i)?i:[];r[c.combo_id]=p.length}catch{r[c.combo_id]=0}})),l(c=>({...c,status:"succeeded",items:o,attractions:n,slotCounts:r}))}catch(t){l(a=>({...a,status:"failed",error:t}))}};return b.useEffect(()=>{x()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Combos"}),e.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm",onClick:()=>u("/admin/catalog/combos/new"),children:"New Combo"})]}),e.jsxs("div",{className:"mb-3 flex gap-2",children:[e.jsxs("select",{className:"rounded-md border px-3 py-2",value:s.active,onChange:t=>l({...s,active:t.target.value}),children:[e.jsx("option",{value:"",children:"Active: All"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]}),e.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:x,children:"Filter"})]}),e.jsx(g,{keyField:"combo_id",columns:[{key:"combo_id",title:"ID"},{key:"name",title:"Combo Name",render:t=>t.name||`Combo #${t.combo_id}`},{key:"attractions",title:"Attractions",render:t=>{if(!t.attraction_ids||!Array.isArray(t.attraction_ids)||t.attraction_ids.length===0)return"No attractions";const a=t.attraction_ids.map(o=>{const n=s.attractions.find(r=>r.attraction_id===o);return(n==null?void 0:n.title)||`Attraction #${o}`}).filter(Boolean);return a.length>0?a.join(", "):"Unknown attractions"}},{key:"total_price",title:"Total Price",render:t=>`₹${((t==null?void 0:t.total_price)??0).toFixed(2)}`},{key:"discount_percent",title:"Discount %",render:t=>`${(t==null?void 0:t.discount_percent)??0}%`},{key:"slots",title:"Slots",render:t=>{const a=s.slotCounts[t.combo_id]||0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:[a," slots"]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),u(`/admin/catalog/combo-slots?combo_id=${t.combo_id}`)},className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"View"})]})}},{key:"image_url",title:"Image",render:t=>t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-8 h-8 object-cover rounded",onError:a=>{a.target.style.display="none"}}):"No image"},{key:"active",title:"Active",render:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded ${t!=null&&t.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t!=null&&t.active?"Active":"Inactive"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),window.confirm(`Are you sure you want to delete "${t.name||`Combo #${t.combo_id}`}"? This will also delete all associated slots.`)&&d.delete(m.comboById(t.combo_id)).then(()=>x()).catch(o=>alert(o.message||"Failed to delete combo"))},className:"text-red-600 hover:text-red-800 text-sm underline",title:"Delete combo",children:"Delete"})]})}],rows:s.items,onRowClick:t=>u(`/admin/catalog/combos/${t.combo_id}`),empty:s.status==="loading"?"Loading…":"No combos"})]})}export{N as default};
