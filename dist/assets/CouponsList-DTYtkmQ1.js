import{B as h,R as x,j as a}from"./index-CNdOvwUA.js";import{a as m,A as u}from"./AdminApp-sxxeVGC_.js";import{A as f}from"./AdminTable-DrGBelt1.js";import{A as j}from"./AdminPagination-B-lWN1TB.js";import"./createLucideIcon-D7GIchwo.js";import"./file-text-B3yKuaPb.js";import"./ticket-BYx_I3BZ.js";function P(){const p=h(),[o,n]=x.useState({status:"idle",items:[],meta:null,error:null,q:"",active:"",page:1,limit:20}),l=async(t=1)=>{n(e=>({...e,status:"loading",error:null,page:t}));try{const e=await m.get(u.coupons(),{params:{q:o.q||void 0,active:o.active||void 0,page:t,limit:o.limit}}),s=Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e)?e:[];n(i=>({...i,status:"succeeded",items:s,meta:(e==null?void 0:e.meta)||null,page:t}))}catch(e){n(s=>({...s,status:"failed",error:e}))}};x.useEffect(()=>{l(1)},[]);const v=async(t,e)=>{var s;(s=e==null?void 0:e.stopPropagation)==null||s.call(e);try{const i=t.coupon_id||t.id;await m.put(`${u.coupons()}/${i}`,{active:!t.active}),n(d=>({...d,items:d.items.map(c=>(c.coupon_id||c.id)===i?{...c,active:!t.active}:c)}))}catch(i){alert((i==null?void 0:i.message)||"Failed to update")}},g=async(t,e)=>{var s;if((s=e==null?void 0:e.stopPropagation)==null||s.call(e),!!window.confirm(`Delete coupon "${t.code}"? This cannot be undone.`))try{const i=t.coupon_id||t.id;await m.delete(`${u.coupons()}/${i}`),n(d=>({...d,items:d.items.filter(c=>(c.coupon_id||c.id)!==i)}))}catch(i){alert((i==null?void 0:i.message)||"Delete failed")}},r=o.meta||{},y=r.totalPages||r.total_pages||1;return a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Coupons"}),a.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm",onClick:()=>p("/admin/catalog/coupons/new"),children:"New Coupon"})]}),a.jsxs("div",{className:"mb-3 grid grid-cols-1 md:grid-cols-4 gap-2",children:[a.jsx("input",{className:"rounded-md border px-3 py-2",placeholder:"Search code/desc",value:o.q,onChange:t=>n(e=>({...e,q:t.target.value}))}),a.jsxs("select",{className:"rounded-md border px-3 py-2",value:o.active,onChange:t=>n(e=>({...e,active:t.target.value})),children:[a.jsx("option",{value:"",children:"Active: All"}),a.jsx("option",{value:"true",children:"Active"}),a.jsx("option",{value:"false",children:"Inactive"})]}),a.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>l(1),children:"Filter"})]}),a.jsx(f,{keyField:"coupon_id",columns:[{key:"code",title:"Code"},{key:"type",title:"Type"},{key:"value",title:"Value"},{key:"valid_from",title:"From"},{key:"valid_to",title:"To"},{key:"active",title:"Active",render:t=>String(t==null?void 0:t.active)},{key:"__actions",title:"Actions",render:t=>a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx("button",{className:`rounded-md px-2 py-1 text-xs ${t.active?"border text-red-600":"bg-blue-600 text-white"}`,onClick:e=>v(t,e),children:t.active?"Deactivate":"Activate"}),a.jsx("button",{className:"rounded-md border px-2 py-1 text-xs text-red-600",onClick:e=>g(t,e),children:"Delete"})]})}],rows:o.items,onRowClick:t=>p(`/admin/catalog/coupons/${t.coupon_id||t.id}`),empty:o.status==="loading"?"Loadingâ€¦":"No coupons found"}),a.jsx(j,{page:r.page||o.page,totalPages:y,onPage:t=>l(t)})]})}export{P as default};
