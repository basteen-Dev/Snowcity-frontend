import{B as k,R as n,j as a}from"./index-CNdOvwUA.js";import{a as g,A as p}from"./AdminApp-sxxeVGC_.js";import{A}from"./AdminTable-DrGBelt1.js";import{i as D}from"./media-Ct2xuz47.js";import"./createLucideIcon-D7GIchwo.js";import"./file-text-B3yKuaPb.js";import"./ticket-BYx_I3BZ.js";const S=t=>Array.isArray(t)?t:[],_=t=>t?Array.isArray(t)?{items:t,meta:null}:Array.isArray(t==null?void 0:t.data)?{items:t.data,meta:t.meta||null}:t!=null&&t.data&&typeof t.data=="object"&&Array.isArray(t.data.data)?{items:t.data.data,meta:t.data.meta||t.meta||null}:{items:S(t.items||t.list),meta:t.meta||null}:{items:[],meta:null};function B(){var f,h;const t=k(),[o,u]=n.useState({status:"idle",items:[],error:null}),[r,y]=n.useState({q:"",type:""}),[d,x]=n.useState([]),[c,m]=n.useState({loading:!1,error:null}),i=n.useCallback(async(e=r)=>{u(l=>({...l,status:"loading",error:null}));try{const l={q:e.q||void 0,type:e.type||void 0},s=await g.get(p.gallery(),{params:l}),{items:N}=_(s);u({status:"succeeded",items:N,error:null}),x([])}catch(l){u(s=>({...s,status:"failed",error:l}))}},[r]);n.useEffect(()=>{i(r)},[i,r]);const b=async e=>{if(window.confirm(`Are you sure you want to delete "${e.title||"this item"}"?`)){m({loading:!0,error:null});try{const s=(e==null?void 0:e.gallery_item_id)??(e==null?void 0:e.gallery_id)??(e==null?void 0:e.id);await g.delete(p.galleryDelete(s)),await i(r)}catch(s){m({loading:!1,error:s})}}},j=async()=>{if(!(d.length===0||!window.confirm(`Are you sure you want to delete ${d.length} selected items?`))){m({loading:!0,error:null});try{await g.post(p.galleryBulkDelete(),{ids:d}),await i(r)}catch(l){m({loading:!1,error:l})}}},v=[{key:"preview",title:"Preview",render:e=>{const l=e.media_type==="video"||e.url&&e.url.match(/\.(mp4|webm|ogg)$/i),s=e.media_type==="pdf"||e.url&&e.url.match(/\.pdf$/i);return a.jsx("div",{className:"w-20 h-14 rounded-md overflow-hidden bg-gray-100",children:l?a.jsx("video",{src:e.url,className:"w-full h-full object-cover",muted:!0}):s?a.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):a.jsx("img",{src:D(e)||e.url,alt:e.title||"Gallery media",className:"w-full h-full object-cover",loading:"lazy"})})}},{key:"title",title:"Title"},{key:"media_type",title:"Type"},{key:"status",title:"Status"},{key:"priority",title:"Priority"},{key:"created_at",title:"Created"},{key:"updated_at",title:"Updated"}];return a.jsxs("div",{children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Gallery"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Manage homepage and gallery media assets."})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>t("/admin/catalog/banners"),children:"Manage Banners"}),a.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm",onClick:()=>t("/admin/catalog/gallery/new"),children:"Add Media"}),d.length>0&&a.jsx("button",{className:"rounded-md bg-red-600 text-white px-3 py-2 text-sm disabled:opacity-50",onClick:j,disabled:c.loading,children:c.loading?"Deleting...":`Delete Selected (${d.length})`})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 mb-4",children:[a.jsx("input",{className:"rounded-md border px-3 py-2",placeholder:"Search title",value:r.q,onChange:e=>y(l=>({...l,q:e.target.value}))}),a.jsxs("select",{className:"rounded-md border px-3 py-2",value:r.type,onChange:e=>y(l=>({...l,type:e.target.value})),children:[a.jsx("option",{value:"",children:"Type: All"}),a.jsx("option",{value:"image",children:"Images"}),a.jsx("option",{value:"video",children:"Videos"}),a.jsx("option",{value:"pdf",children:"PDFs"})]}),a.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>i(r),disabled:o.status==="loading",children:"Apply"}),a.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>{y({q:"",type:""}),i({q:"",type:""})},children:"Reset"})]}),o.status==="failed"&&a.jsxs("div",{className:"mb-4 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-600",children:["Failed to load gallery items. ",((f=o.error)==null?void 0:f.message)||""]}),c.error&&a.jsxs("div",{className:"mb-4 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-600",children:["Delete failed. ",((h=c.error)==null?void 0:h.message)||""]}),a.jsx(A,{keyField:"gallery_item_id",columns:v,rows:o.items,showSelection:!0,selectedItems:d,onSelectionChange:x,actions:[{label:"Delete",onClick:b,className:"bg-red-100 hover:bg-red-200 text-red-700",title:"Delete this item"}],onRowClick:e=>{const l=(e==null?void 0:e.gallery_item_id)??(e==null?void 0:e.gallery_id)??(e==null?void 0:e.id);l!=null&&t(`/admin/catalog/gallery/${l}`)},empty:o.status==="loading"?"Loadingâ€¦":"No media found"})]})}export{B as default};
