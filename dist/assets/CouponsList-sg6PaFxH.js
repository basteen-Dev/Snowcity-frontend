import{A as h,R as x,j as a}from"./index-DpUnVvi7.js";import{a as m,A as p}from"./AdminApp-DElutmvv.js";import{A as f}from"./AdminTable-C9C_doBs.js";import{A as j}from"./AdminPagination-CaGCxGFe.js";import"./createLucideIcon-DlloiUI2.js";import"./file-text-BcxeLTgw.js";import"./users-Dj4zQjFo.js";import"./newspaper-D6LH_a5a.js";import"./ticket-DJwTfedz.js";import"./chevron-down-BM4ufvPU.js";function F(){const u=h(),[o,n]=x.useState({status:"idle",items:[],meta:null,error:null,q:"",active:"",page:1,limit:20}),l=async(e=1)=>{n(t=>({...t,status:"loading",error:null,page:e}));try{const t=await m.get(p.coupons(),{params:{q:o.q||void 0,active:o.active||void 0,page:e,limit:o.limit}}),s=Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t)?t:[];n(i=>({...i,status:"succeeded",items:s,meta:(t==null?void 0:t.meta)||null,page:e}))}catch(t){n(s=>({...s,status:"failed",error:t}))}};x.useEffect(()=>{l(1)},[]);const v=async(e,t)=>{var s;(s=t==null?void 0:t.stopPropagation)==null||s.call(t);try{const i=e.coupon_id||e.id;await m.put(`${p.coupons()}/${i}`,{active:!e.active}),n(d=>({...d,items:d.items.map(c=>(c.coupon_id||c.id)===i?{...c,active:!e.active}:c)}))}catch(i){alert((i==null?void 0:i.message)||"Failed to update")}},g=async(e,t)=>{var s;if((s=t==null?void 0:t.stopPropagation)==null||s.call(t),!!window.confirm(`Delete coupon "${e.code}"? This cannot be undone.`))try{const i=e.coupon_id||e.id;await m.delete(`${p.coupons()}/${i}`),n(d=>({...d,items:d.items.filter(c=>(c.coupon_id||c.id)!==i)}))}catch(i){alert((i==null?void 0:i.message)||"Delete failed")}},r=o.meta||{},y=r.totalPages||r.total_pages||1;return a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Coupons"}),a.jsx("button",{className:"rounded-md bg-gray-900 text-white px-3 py-2 text-sm",onClick:()=>u("/admin/catalog/coupons/new"),children:"New Coupon"})]}),a.jsxs("div",{className:"mb-3 grid grid-cols-1 md:grid-cols-4 gap-2",children:[a.jsx("input",{className:"rounded-md border px-3 py-2",placeholder:"Search code/desc",value:o.q,onChange:e=>n(t=>({...t,q:e.target.value}))}),a.jsxs("select",{className:"rounded-md border px-3 py-2",value:o.active,onChange:e=>n(t=>({...t,active:e.target.value})),children:[a.jsx("option",{value:"",children:"Active: All"}),a.jsx("option",{value:"true",children:"Active"}),a.jsx("option",{value:"false",children:"Inactive"})]}),a.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>l(1),children:"Filter"})]}),a.jsx(f,{keyField:"coupon_id",columns:[{key:"code",title:"Code"},{key:"type",title:"Type"},{key:"value",title:"Value"},{key:"valid_from",title:"From"},{key:"valid_to",title:"To"},{key:"active",title:"Active",render:e=>String(e==null?void 0:e.active)},{key:"__actions",title:"Actions",render:e=>a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx("button",{className:`rounded-md px-2 py-1 text-xs ${e.active?"border text-red-600":"bg-blue-600 text-white"}`,onClick:t=>v(e,t),children:e.active?"Deactivate":"Activate"}),a.jsx("button",{className:"rounded-md border px-2 py-1 text-xs text-red-600",onClick:t=>g(e,t),children:"Delete"})]})}],rows:o.items,onRowClick:e=>u(`/admin/catalog/coupons/${e.coupon_id||e.id}`),empty:o.status==="loading"?"Loadingâ€¦":"No coupons found"}),a.jsx(j,{page:r.page||o.page,totalPages:y,onPage:e=>l(e)})]})}export{F as default};
