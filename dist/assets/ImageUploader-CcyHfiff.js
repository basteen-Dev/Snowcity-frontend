import{R as r,j as e}from"./index-uOjPOlE7.js";import{a as T}from"./AdminApp-BnGJaM53.js";import{i as M}from"./media-D2Wlcy5m.js";const p={},S="/api/admin/uploads",U=(p==null?void 0:p.VITE_CLOUDINARY_UPLOAD_PRESET)||"";function Q({label:P="Image",value:c,onChange:d,fieldName:D="file",extra:R={},accept:E="image/*,video/*,.pdf",requiredPerm:A=null,folder:f="",multiple:z=!1,onMultipleChange:C}){const g=r.useId(),[V,W]=r.useState([]),[$,q]=r.useState([]),[Y,_]=r.useState([]),[B,G]=r.useState([]),[b,o]=r.useState(""),[a,u]=r.useState(null),[m,h]=r.useState(""),[y,j]=r.useState(""),[v,x]=r.useState("idle"),i=r.useMemo(()=>M(c||""),[c]);r.useEffect(()=>{if(!a)return;const t=URL.createObjectURL(a);return h(t),j(a.name||""),()=>URL.revokeObjectURL(t)},[a]);const N=t=>t?t.type.startsWith("image/")?"image":t.type.startsWith("video/")?"video":t.type==="application/pdf"?"pdf":"unknown":"unknown",F=t=>{var n;const l=((n=t.target.files)==null?void 0:n[0])||null;o(""),u(l)},I=t=>{var n,s;t.preventDefault(),t.stopPropagation();const l=((s=(n=t.dataTransfer)==null?void 0:n.files)==null?void 0:s[0])||null;l&&(o(""),u(l))},L=t=>{t.preventDefault(),t.stopPropagation()},w=()=>{u(null),h(""),j("")},O=async()=>{var t;if(a){x("loading"),o("");try{const l=/cloudinary\.com/i.test(S),n={...R||{}};l&&U&&!n.upload_preset&&(n.upload_preset=U),f&&!l&&(n.folder=f);const s=await T.upload(S,a,{fieldName:D,data:n}),k=(s==null?void 0:s.url)||(s==null?void 0:s.url_path)||(s==null?void 0:s.secure_url)||(s==null?void 0:s.location)||((t=s==null?void 0:s.data)==null?void 0:t.url)||"";if(!k)throw new Error((s==null?void 0:s.message)||"Upload response missing URL");d==null||d(k),x("done"),w()}catch(l){x("error"),o((l==null?void 0:l.message)||"Upload failed")}}};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:P}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"text",className:"flex-1 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",placeholder:"https://...",value:c||"",onChange:t=>d==null?void 0:d(t.target.value)})}),e.jsxs("div",{className:"mt-2 rounded-md border border-dashed px-3 py-3 text-sm text-gray-600 dark:text-neutral-300 dark:border-neutral-700",onDrop:I,onDragOver:L,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{id:g,type:"file",accept:E,onChange:F,className:"sr-only"}),e.jsx("label",{htmlFor:g,className:"inline-flex items-center rounded-md border px-3 py-2 text-sm cursor-pointer dark:border-neutral-700 dark:text-neutral-200",role:"button",children:"Choose"}),e.jsx("button",{className:"inline-flex items-center rounded-md bg-gray-900 text-white px-3 py-2 text-sm disabled:opacity-50",onClick:O,disabled:!a||v==="loading",type:"button",children:v==="loading"?"Uploadingâ€¦":"Upload"}),y?e.jsxs("span",{className:"text-xs text-gray-500 dark:text-neutral-400",children:["Selected: ",y]}):null,a?e.jsx("button",{className:"inline-flex items-center rounded-md border px-2 py-1 text-xs dark:border-neutral-700 dark:text-neutral-200",onClick:w,type:"button",children:"Clear"}):null]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 dark:text-neutral-400",children:"Drag a file here, or click Choose to select."})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[m?e.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:N(a)==="video"?e.jsx("video",{src:m,className:"w-full h-full object-cover",muted:!0}):N(a)==="pdf"?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):e.jsx("img",{src:m,alt:"snowcity",loading:"lazy",className:"w-full h-full object-cover"})}):null,i?e.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:i.match(/\.(mp4|webm|ogg)$/i)?e.jsx("video",{src:i,className:"w-full h-full object-cover",muted:!0}):i.match(/\.pdf$/i)?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):e.jsx("img",{src:i,alt:"snowcity",loading:"lazy",className:"w-full h-full object-cover"})}):null]}),b?e.jsx("div",{className:"text-xs text-red-600 mt-2",children:b}):null]})}export{Q as I};
