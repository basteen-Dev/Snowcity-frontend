import{B as f,C,R as s,j as a}from"./index-CNdOvwUA.js";import{a as c}from"./AdminApp-sxxeVGC_.js";import{R as S,a as $,G as P}from"./GalleryField-CtPWiJ08.js";import{u as A}from"./useCatalogTargets-CzVh11Q7.js";import"./createLucideIcon-D7GIchwo.js";import"./file-text-B3yKuaPb.js";import"./ticket-BYx_I3BZ.js";import"./ImageUploader-BR89ENI0.js";import"./media-Ct2xuz47.js";const E=[{key:"",label:"No nav"},{key:"visitors_guide",label:"Visitors Guide"}],R=[{key:"none",label:"No special placement"},{key:"home_bottom",label:"Home - Bottom section"},{key:"attraction_details",label:"Attraction - Details section (select attraction)"}];function H(){const u=f(),{id:i}=C(),o=!!i,[t,p]=s.useState({title:"",slug:"",active:!0,editor_mode:"rich",content:"",raw_html:"",raw_css:"",raw_js:"",meta_title:"",meta_description:"",meta_keywords:"",section_type:"none",section_ref_id:null,gallery:[],nav_group:"",nav_order:0,placement:"none",placement_ref_id:null}),[h,m]=s.useState(""),[g,b]=s.useState(!1);s.useEffect(()=>{o&&(async()=>{try{const e=await c.get(`/api/admin/pages/${i}`);p(n=>({...n,...e,editor_mode:e.editor_mode||"rich",nav_group:e.nav_group||"",nav_order:e.nav_order??0,placement:e.placement||"none",placement_ref_id:e.placement_ref_id||null}))}catch(e){m(e.message||"Failed to load page")}})()},[i,o]);const l=e=>p(n=>({...n,...e})),y=async e=>{e.preventDefault(),m(""),b(!0);try{const n=N=>{const j=Number(N);return Number.isFinite(j)?j:null},r={...t};r.section_type=t.section_type||"none",r.section_ref_id=r.section_type==="none"?null:n(t.section_ref_id),r.placement_ref_id=t.placement==="attraction_details"?n(t.placement_ref_id):null,r.nav_order=Number.isFinite(Number(t.nav_order))?Number(t.nav_order):0,r.editor_mode==="raw"&&(r.content=r.content||""),o?await c.put(`/api/admin/pages/${i}`,r):await c.post("/api/admin/pages",r),u("/admin/catalog/pages")}catch(n){m(n.message||"Save failed")}finally{b(!1)}},{attractions:x=[],combos:v=[],status:d}=A(),_=s.useMemo(()=>x.map(e=>({value:e.attraction_id||e.id,label:e.title||e.name||`Attraction #${e.attraction_id||e.id}`})),[x]),k=s.useMemo(()=>v.map(e=>({value:e.combo_id||e.id,label:e.title||e.name||`Combo #${e.combo_id||e.id}`})),[v]),w=async()=>{try{const e=await c.post("/api/admin/pages/preview",t),n=window.open("","_blank");if(!n)return;let r="";t.editor_mode==="raw"?r=`
<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>${t.raw_css||""}</style>
<title>${t.title||""}</title>
</head><body>
${t.raw_html||""}
<script>${t.raw_js||""}<\/script>
</body></html>`:r=`
<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>${t.title||""}</title>
</head><body>${t.content||""}</body></html>`,n.document.open(),n.document.write(r),n.document.close()}catch(e){alert(e.message||"Preview failed")}};return a.jsxs("form",{onSubmit:y,className:"space-y-3 max-w-3xl",children:[a.jsx("div",{className:"text-lg font-semibold",children:o?"Edit Page":"Create Page"}),h?a.jsx("div",{className:"text-sm text-red-600",children:h}):null,a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Title"}),a.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.title,onChange:e=>l({title:e.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Slug"}),a.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.slug,onChange:e=>l({slug:e.target.value}),placeholder:"my-page"})]})]}),a.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"checkbox",checked:!!t.active,onChange:e=>l({active:e.target.checked})}),"Active"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Nav group"}),a.jsx("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.nav_group||"",onChange:e=>l({nav_group:e.target.value}),children:E.map(e=>a.jsx("option",{value:e.key,children:e.label},e.key))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Nav order"}),a.jsx("input",{type:"number",className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.nav_order??0,onChange:e=>l({nav_order:Number(e.target.value)})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Placement"}),a.jsx("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.placement,onChange:e=>l({placement:e.target.value}),children:R.map(e=>a.jsx("option",{value:e.key,children:e.label},e.key))})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Section type"}),a.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.section_type||"none",onChange:e=>l({section_type:e.target.value,section_ref_id:null}),children:[a.jsx("option",{value:"none",children:"None"}),a.jsx("option",{value:"attraction",children:"Attraction"}),a.jsx("option",{value:"combo",children:"Combo"})]})]}),t.section_type&&t.section_type!=="none"?a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm",children:t.section_type==="attraction"?"Select attraction":"Select combo"}),a.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.section_ref_id||"",onChange:e=>l({section_ref_id:e.target.value?Number(e.target.value):null}),disabled:d==="loading",children:[a.jsx("option",{value:"",children:d==="loading"?"Loading…":"Choose option"}),(t.section_type==="attraction"?_:k).map(e=>a.jsx("option",{value:e.value||"",children:e.label},`section-${e.value}`))]})]}):null]}),t.placement==="attraction_details"?a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Attraction (for placement)"}),a.jsxs("select",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.placement_ref_id||"",onChange:e=>l({placement_ref_id:e.target.value?Number(e.target.value):null}),disabled:d==="loading",children:[a.jsx("option",{value:"",children:d==="loading"?"Loading…":"Select attraction"}),_.map(e=>a.jsx("option",{value:e.value||"",children:e.label},`placement-${e.value}`))]})]}):null,a.jsx("div",{className:"rounded-lg border dark:border-neutral-800 p-2",children:a.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[a.jsxs("label",{className:"inline-flex items-center gap-2",children:[a.jsx("input",{type:"radio",checked:t.editor_mode==="rich",onChange:()=>l({editor_mode:"rich"})}),"Visual editor"]}),a.jsxs("label",{className:"inline-flex items-center gap-2",children:[a.jsx("input",{type:"radio",checked:t.editor_mode==="raw",onChange:()=>l({editor_mode:"raw"})}),"Raw (HTML/CSS/JS)"]}),a.jsx("button",{type:"button",className:"ml-auto px-3 py-1 rounded-md border text-sm",onClick:w,children:"Preview"})]})}),t.editor_mode==="raw"?a.jsx(S,{value:{raw_html:t.raw_html,raw_css:t.raw_css,raw_js:t.raw_js},onChange:e=>l(e)}):a.jsxs(a.Fragment,{children:[a.jsx("label",{className:"block text-sm",children:"Content"}),a.jsx($,{value:t.content||"",onChange:e=>l({content:e})}),a.jsx(P,{label:"Content gallery",helper:"Upload multiple inline assets to reuse inside the visual editor or elsewhere in the page.",value:t.gallery||[],onChange:e=>l({gallery:e})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Meta title"}),a.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.meta_title||"",onChange:e=>l({meta_title:e.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Meta description"}),a.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.meta_description||"",onChange:e=>l({meta_description:e.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Meta keywords"}),a.jsx("input",{className:"w-full rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700",value:t.meta_keywords||"",onChange:e=>l({meta_keywords:e.target.value})})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{className:"px-3 py-2 rounded-md bg-gray-900 text-white",disabled:g,children:g?"Saving…":"Save"}),a.jsx("button",{className:"px-3 py-2 rounded-md border",type:"button",onClick:()=>u("/admin/catalog/pages"),children:"Cancel"})]})]})}export{H as default};
