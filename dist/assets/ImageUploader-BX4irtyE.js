import{R as s,j as t}from"./index-CmreT6x1.js";import{a as M}from"./AdminApp-BV7zANWg.js";import{i as A}from"./media-DcknJ8BL.js";const g={},P="/api/admin/uploads",D=(g==null?void 0:g.VITE_CLOUDINARY_UPLOAD_PRESET)||"";function Z({label:E="Image",value:c,onChange:i,onUploadComplete:u,fieldName:R="file",extra:U={},accept:F="image/*,video/*,.pdf",requiredPerm:z=null,folder:h="",multiple:V=!1,onMultipleChange:W}){const b=s.useId(),[$,q]=s.useState([]),[Y,_]=s.useState([]),[B,G]=s.useState([]),[H,J]=s.useState([]),[y,o]=s.useState(""),[l,m]=s.useState(null),[x,j]=s.useState(""),[v,N]=s.useState(""),[w,p]=s.useState("idle"),d=s.useMemo(()=>A(c||""),[c]);s.useEffect(()=>{if(!l)return;const e=URL.createObjectURL(l);return j(e),N(l.name||""),()=>URL.revokeObjectURL(e)},[l]);const k=e=>e?e.type.startsWith("image/")?"image":e.type.startsWith("video/")?"video":e.type==="application/pdf"?"pdf":"unknown":"unknown",I=e=>{var n;const a=((n=e.target.files)==null?void 0:n[0])||null;o(""),m(a)},L=e=>{var n,r;e.preventDefault(),e.stopPropagation();const a=((r=(n=e.dataTransfer)==null?void 0:n.files)==null?void 0:r[0])||null;a&&(o(""),m(a))},O=e=>{e.preventDefault(),e.stopPropagation()},S=()=>{m(null),j(""),N("")},T=async()=>{var e;if(l){p("loading"),o("");try{const a=/cloudinary\.com/i.test(P),n={...U||{}};a&&D&&!n.upload_preset&&(n.upload_preset=D),h&&!a&&(n.folder=h);const r=await M.upload(P,l,{fieldName:R,data:n}),f=(r==null?void 0:r.url)||(r==null?void 0:r.url_path)||(r==null?void 0:r.secure_url)||(r==null?void 0:r.location)||((e=r==null?void 0:r.data)==null?void 0:e.url)||"";if(!f)throw new Error((r==null?void 0:r.message)||"Upload response missing URL");i==null||i(f),u==null||u(f),p("done"),S()}catch(a){p("error"),o((a==null?void 0:a.message)||"Upload failed")}}};return t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-600 dark:text-neutral-300 mb-1",children:E}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("input",{type:"text",className:"flex-1 rounded-md border px-3 py-2 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-200",placeholder:"https://...",value:c||"",onChange:e=>i==null?void 0:i(e.target.value)})}),t.jsxs("div",{className:"mt-2 rounded-md border border-dashed px-3 py-3 text-sm text-gray-600 dark:text-neutral-300 dark:border-neutral-700",onDrop:L,onDragOver:O,children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("input",{id:b,type:"file",accept:F,onChange:I,className:"sr-only"}),t.jsx("label",{htmlFor:b,className:"inline-flex items-center rounded-md border px-3 py-2 text-sm cursor-pointer dark:border-neutral-700 dark:text-neutral-200",role:"button",children:"Choose"}),t.jsx("button",{className:"inline-flex items-center rounded-md bg-gray-900 text-white px-3 py-2 text-sm disabled:opacity-50",onClick:T,disabled:!l||w==="loading",type:"button",children:w==="loading"?"Uploadingâ€¦":"Upload"}),v?t.jsxs("span",{className:"text-xs text-gray-500 dark:text-neutral-400",children:["Selected: ",v]}):null,l?t.jsx("button",{className:"inline-flex items-center rounded-md border px-2 py-1 text-xs dark:border-neutral-700 dark:text-neutral-200",onClick:S,type:"button",children:"Clear"}):null]}),t.jsx("div",{className:"mt-2 text-xs text-gray-500 dark:text-neutral-400",children:"Drag a file here, or click Choose to select."})]}),t.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[x?t.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:k(l)==="video"?t.jsx("video",{src:x,className:"w-full h-full object-cover",muted:!0}):k(l)==="pdf"?t.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):t.jsx("img",{src:x,alt:"snowcity",loading:"lazy",className:"w-full h-full object-cover"})}):null,d?t.jsx("div",{className:"w-16 h-16 rounded-md border dark:border-neutral-800 overflow-hidden bg-gray-100",children:d.match(/\.(mp4|webm|ogg)$/i)?t.jsx("video",{src:d,className:"w-full h-full object-cover",muted:!0}):d.match(/\.pdf$/i)?t.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"PDF"}):t.jsx("img",{src:d,alt:"Current media",loading:"lazy",className:"w-full h-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="/placeholder-image.png"}})}):null]}),y?t.jsx("div",{className:"text-xs text-red-600 mt-2",children:y}):null]})}export{Z as I};
